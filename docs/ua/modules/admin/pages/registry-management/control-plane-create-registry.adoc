= Розгортання екземпляра реєстру
include::platform:ROOT:partial$templates/document-attributes/default-set-ua.adoc[]

include::platform:ROOT:partial$admonitions/language-ua.adoc[]

Після успішного xref:installation/platform-deployment/platform-deployment-overview.adoc[встановлення Платформи на цільовому оточенні], адміністратор Платформи отримує доступ до адміністративної панелі, що має назву *Control Plane*. Вона дозволяє керувати конфігураціями інфраструктурних компонентів Платформи (`cluster-mgmt`), а також компонентів реєстру.

[TIP]
====
Посилання до сервісу *Control Plane* можливо отримати у консолі *Openshift*. Перейдіть до розділу *Networking* > *Routes*, у пошуку вкажіть значення *`control-plane`*, і посилання буде доступне у стовпці *Location*.

image:infrastructure/cluster-mgmt/cp-registry-deploy-12.png[]
====

[IMPORTANT]
====
Розгорнути реєстр в адмін-панелі *Control Plane* може лише адміністратор Платформи з відповідними правами доступу. Для цього необхідна роль `cp-cluster-mgmt-admin` у реалмі `control-plane-admin` сервісу *Keycloak*.

Детальна інформація доступна на сторінці xref:admin:registry-management/control-plane-assign-platform-admins.adoc[].
====


Для розгортання нового реєстру виконайте наступні кроки: ::
+
. Увійдіть до адміністративної панелі *Control Plane*, використовуючи попередньо отримані логін та пароль.
+
image:admin:infrastructure/cluster-mgmt/update-cluster-mgmt-01.png[]

. Перейдіть до розділу +++<b style="font-weight: 600">Реєстри<b>+++ > далі натисніть `+++<font style="font-weight: bold">Створити новий</font>+++`.
+
image:infrastructure/cluster-mgmt/cp-registry-deploy-1.png[]

. Заповніть параметри конфігурації відповідними даними.
+
TIP: Детальніше про кроки розгортання описано у розділах нижче.

[#general-settings]
== Загальні налаштування

На цьому кроці ви можете вказати службову (системну) назву реєстру, яка буде використовуватися у різних операціях обміну даними на Платформі.

[CAUTION]
====
* Назва повинна бути унікальною, і її неможливо буде змінити після створення реєстру. Поле +++<b style="font-weight: 600">Назва реєстру<b>+++ є обов'язковим до заповнення.
* Для введення доступні лише латинські літери (`"a-z"`) та знак `"-"`.
* Довжина не повинна перевищувати 12 символів.
====

Додатково ви можете вказати опис, який може містити офіційну назву реєстру чи його призначення. Це поле потрібне для інформаційних (бізнес- або юридичних) цілей.

Натисніть `+++<b style="font-weight: 600">Підтвердити<b>+++` для переходу до наступного кроку.

image:admin:registry-management/registry-create/cp-create-registry-1.png[]

== Створення адміністраторів реєстру

На цьому кроці ви можете призначити _адміністраторів реєстру_.

[NOTE]
====
Можливість внесення нових адміністраторів буде доступна і згодом після розгортання, через опцію редагування реєстру.

Детальніше про це див. на сторінці xref:registry-develop:registry-admin/create-users/create-registry-admins.adoc[].
====

. У полі +++<b style="font-weight: 600">Адміністратори<b>+++ вкажіть адміністраторів, яким буде надано доступ до реєстру.
+
CAUTION: Поле є обов'язковим до заповнення.
+
image:admin:registry-management/registry-create/cp-create-registry-2-1.png[]
+
Натисніть `+` (`Додати`) та у новому вікні введіть дані кожного адміністратора реєстру, а саме:
+
--
* +++<b style="font-weight: 600">Ім'я<b>+++
* +++<b style="font-weight: 600">Прізвище<b>+++
* +++<b style="font-weight: 600">Електронна пошта<b>+++
* +++<b style="font-weight: 600">Тимчасовий пароль<b>+++
--
+
image:admin:registry-management/registry-create/cp-create-registry-2.png[]

+
Для того, щоб надати доступ декільком особам, повторіть дію для кожного адміністратора окремо (`+` > вкажіть дані адміністратора > `+++<b style="font-weight: 600">Підтвердити<b>+++`).
+
[NOTE]
====
Використовуйте нижній регістр для введення даних електронної пошти.

Доступні символи: `"0-9"`, `"a-z"`, `"_"`, `"-"`, `"@"`, `"."`, `","`.
====

. Натисніть `+++<b style="font-weight: 600">Далі<b>+++` для переходу до наступного кроку.

+
image:admin:registry-management/registry-create/cp-create-registry-2-2.png[]

+
[NOTE]
====
Користувач-адміністратор реєстру автоматично створюється у реалмі `openshift` сервісу *Keycloak* із роллю `cp-registry-admin-<registry-name>` та групою `/cp-registry-admin-<registry-name>`, де `<registry-name>` -- назва реєстру.
====


== Шаблон розгортання реєстру

На цьому кроці оберіть шаблон для розгортання реєстру. Залежно від навантаження, яке очікується на реєстр, ви можете обрати одну з доступних конфігурацій, тобто певний шаблон із відповідною кількістю ресурсів. Наприклад, мінімальна або рекомендована конфігурація, або конфігурація з геосервером тощо).

Приблизну вартість обчислювальних ресурсів реєстру ви можете розрахувати на сторінці xref:arch:architecture/platform-system-requirements/registry-requirements.adoc[], або зверніться за консультацією до команди технічної підтримки Платформи.

image:admin:registry-management/registry-create/cp-create-registry-3.png[]

. У полі +++<b style="font-weight: 600">Шаблон реєстру<b>+++ оберіть зі списку шаблон конфігурації, відповідно до якого розгортатиметься реєстр.
+
Шаблон реєстру визначає параметри конфігурації та кількість інстансів для реєстру, що розгортається, тобто виділену кількість ресурсів, зокрема *CPU*, *RAM* тощо, та кількість нод у *MachineSets*.
+
CAUTION: Поле є обов'язковим до заповнення.
+
image:admin:registry-management/registry-create/cp-create-registry-3-1.png[]

. У полі +++<b style="font-weight: 600">Гілка шаблону реєстру<b>+++ оберіть гілку, яка буде застосована при розгортанні реєстру.
+
NOTE: Мається на увазі версія гілки компонента у Gerrit-репозиторії, що містить відповідну версію шаблону реєстру.
+
CAUTION: Поле є обов'язковим до заповнення.
+
image:admin:registry-management/registry-create/cp-create-registry-3-2.png[]

. Натисніть `+++<b style="font-weight: 600">Далі<b>+++` для переходу до наступного кроку.

+
image:admin:registry-management/registry-create/cp-create-registry-3-3.png[]

== Вибір поштового сервера

На цьому кроці оберіть тип поштового сервера для відправлення email-повідомлень у реєстрі.

CAUTION: Крок є опціональним. Ви можете пропустити ці налаштування. Їх можна змінити під час редагування реєстру.

image:admin:registry-management/registry-create/cp-create-registry-4.png[]

* +++<b style="font-weight: 600">Внутрішній поштовий сервер<b>+++ (`*platform-mail-server*`) — поштовий сервер, який розповсюджується як платформний сервіс та доступний для використання усіма реєстрами одного екземпляра Платформи.

* +++<b style="font-weight: 600">Зовнішній поштовий сервер<b>+++ (*`external-mail-server`*) — зовнішній відносно платформи поштовий сервіс (*gmail* тощо).

[TIP]
====
Детальна інформація доступна на сторінці xref:registry-develop:registry-admin/user-notifications/email/config-smtp-server.adoc[].
====

Натисніть `+++<b style="font-weight: 600">Далі<b>+++` для переходу до наступного кроку.

== Дані про ключ

На цьому кроці налаштуйте параметри конфігурації для ключів та сертифікатів цифрового підпису, які будуть використовуватись у реєстрі. Надалі дані про ключ можна оновлювати при редагуванні реєстру.

[IMPORTANT]
====
Крок є обов'язковим.

Секція +++<b style="font-weight: 600">Дані про ключ<b>+++ має містити налаштування для ініціалізації криптосервісу (*`digital-signature-ops`*) та накладання системного підпису (цифрової печатки системи). Без внесення цих даних пода криптосервісу не запуститься.

Такі ключі використовуються для підпису витягів, сформованих Платформою, та підпису даних, що змінюються відповідно до логіки бізнес-процесів реєстру.
====

[TIP]
====
Детальна інформація щодо налаштування ключів доступна на сторінці xref:registry-management/system-keys/control-plane-registry-keys.adoc[].
====

. У полі +++<b style="font-weight: 600">Тип носія<b>+++ оберіть відповідний тип ключа, що використовується.

. Оберіть електронний ключ.
+
Поле +++<b style="font-weight: 600">Файловий ключ (розширення .dat)<b>+++ заповнюється операційним ключем із розширенням
`.dat` (_Key-6.dat_) адміністратора Платформи.
Завантажте файл із ключем, натиснувши kbd:[*Browse*], оберіть ключ у відповідній директорії та натисніть kbd:[*Open*].

. У полі +++<b style="font-weight: 600">АЦСК, що видав ключ<b>+++ показана повна назва АЦСКfootnote:[**АЦСК** - Акредитований центр сертифікації ключів.], що видав ключ.

. У полі +++<b style="font-weight: 600">Пароль до файлового ключа<b>+++ введіть пароль до завантаженого ключа.

. Секція +++<b style="font-weight: 600">Дані для перевірки ключа<b>+++ містить дані публічних сертифікатів та перелік АЦСК:

* У полі +++<b style="font-weight: 600">Публічні сертифікати АЦСК (розширення .p7b)<b>+++ завантажте файл із переліком сертифікатів сумісних ЦСК (https://iit.com.ua/download/productfiles/CACertificates.p7b[CACertificates.p7b]), який можна отримати на сайті АТ "ІІТ" за посиланням https://iit.com.ua/downloads.
* У полі +++<b style="font-weight: 600">Список АЦСК (розширення .json)<b>+++ завантажте файл із параметрами взаємодії сумісними ЦСК (link:https://iit.com.ua/download/productfiles/[CAs.json]), який можна отримати на сайті АТ "ІІТ" за посиланням: https://iit.com.ua/downloads.

. Вкажіть +++<b style="font-weight: 600">Перелік дозволених ключів<b>+++, підпис яких може вважатися дійсним.
+
[NOTE]
====
У цьому блоці зазначається перелік ключів, у тому числі й старих (наприклад, при ротації ключів), щоб все, що раніше було підписано старим ключем, вважалося валідованим. Тобто перелік дозволених ключів повинен містити історію даних усіх ключів, що використовувались у системі для накладання підпису.
====

. Натисніть `+++<b style="font-weight: 600">Далі<b>+++` для переходу до наступного кроку.

image:admin:registry-management/registry-create/cp-create-registry-5.png[]

== Ресурси реєстру

На цьому кроці ви можете визначити конфігурацію для ресурсів реєстру по певних сервісах, які у ньому розгортаються. Керування ресурсами, що використовуються контейнерами в рамках вашого екземпляра реєстру, дозволяє забезпечити оптимальну працездатність та ефективність.

. Оберіть зі списку сервіс для конфігурації ресурсів і натисніть *`+`* (`Додати`).
+
[CAUTION]
====
Крок є опціональним.

Під час розгортання реєстру усі наявні сервіси налаштовані та передзаповнені відповідними значеннями запитів, лімітів та змінних оточення за замовчуванням.

Навіть у випадку видалення сервісів зі списку, під час розгортання реєстру Платформа застосує стандартну конфігурацію.
====
+
image:admin:registry-management/registry-create/cp-create-registry-7.png[]

. Встановіть власні значення для ресурсів.
. Натисніть `+++<b style="font-weight: 600">Далі<b>+++` для переходу до наступного кроку.
+
image:admin:registry-management/registry-create/cp-create-registry-7-1.png[]

TIP: Детальніше про налаштування ви можете переглянути на сторінці xref:registry-management/control-plane-registry-resources.adoc[].

== Налаштування DNS

На цьому кроці ви можете встановити власні DNS-імена і завантажити SSL-сертифікати у `.pem`-форматі для сервісу Keycloak, а також Кабінетів користувачів.

[CAUTION]
====
Крок є опціональним.

Якщо ви не вкажете тут жодних налаштувань, система використає значення за замовчуванням.
====

image:admin:registry-management/registry-create/cp-create-registry-6.png[]

TIP: Детальніше про функціональність читайте у розділі xref:admin:registry-management/custom-dns/custom-dns-overview.adoc[].

Натисніть `+++<b style="font-weight: 600">Далі<b>+++` для переходу до наступного кроку.

== Обмеження доступу

На цьому кроці ви можете встановити обмеження доступу до певних компонентів, які використовуються у реєстрі, зокрема _Кабінетів посадової особи та отримувача послуг_, а також _адміністративних компонентів реєстру_.

[CAUTION]
====
Крок є опціональним, але з метою безпеки рекомендовано встановити CIDR для відповідних компонентів.
====

image:admin:registry-management/registry-create/cp-create-registry-8.png[]

TIP: Детальніше про функціональність читайте на сторінці xref:admin:registry-management/control-plane-cidr-access-endpoints.adoc[].

Натисніть `+++<b style="font-weight: 600">Далі<b>+++` для переходу до наступного кроку.

== Автентифікація надавачів послуг

На цьому кроці ви можете налаштувати тип автентифікації для надавачів послуг (посадових осіб), а також дозволити, або заборонити можливість автореєстрації.

[CAUTION]
====
Крок є опціональним.

Якщо ви не вкажете тут жодних налаштувань, система використає значення за замовчуванням -- автентифікація з КЕП та вимкнена автореєстрація.
====

image:admin:registry-management/registry-create/cp-create-registry-9.png[]

Ви можете обрати один із двох типів автентифікації, який буде доступний для ідентифікації особи в системі:

* КЕП (*IIT*-віджет)
* Віджет *id.gov.ua*

TIP: Детальніше про функціональність читайте на сторінці xref:registry-develop:registry-admin/cp-auth-setup/cp-auth-setup-officers.adoc[].

Самостійна реєстрація посадових осіб дозволить вам спростити процес реєстрації користувачів без необхідності залучення адміністратора.

TIP: Детальніше про функціональність читайте на сторінці xref:registry-develop:registry-admin/cp-auth-setup/cp-officer-self-registration.adoc[].

Натисніть `+++<b style="font-weight: 600">Далі<b>+++` для переходу до наступного кроку.

== Автентифікація отримувачів послуг

На цьому кроці ви можете налаштувати перевірку наявності активного запису в ЄДР для бізнес-користувачів, що дозволяє встановити зв'язок між КЕП користувача та його юридичною особою чи фізичною особою-підприємцем, що зареєстровані в Єдиному державному реєстрі (ЄДР). Це важливий аспект безпеки та надійності системи, який допомагає забезпечити відповідність даних користувача та підтвердження їх особистості.

[CAUTION]
====
Крок є опціональним.

Якщо ви не вкажете тут жодних налаштувань, система використає значення за замовчуванням -- перевірка увімкнена.
====

image:admin:registry-management/registry-create/cp-create-registry-10.png[]

TIP: Детальніше про функціональність читайте на сторінці xref:registry-develop:registry-admin/cp-auth-setup/cp-auth-setup-citizens.adoc[].

Натисніть `+++<b style="font-weight: 600">Далі<b>+++` для переходу до наступного кроку.

== Цифрові документи

Адміністративна панель Control Plane надає зручний інтерфейс, який дозволяє адміністраторам керувати обмеженнями на завантаження цифрових документів до реєстру користувачами та бізнес-процесами.

Ви можете встановити максимальний розмір для одного файлу та групи файлів для завантаження до реєстру.

NOTE: Значення вводиться у мегабайтах (MB) і може складатися з цифр (`0-9`) та крапки. Максимальна довжина значення -- 4 символи. Наприклад, можна встановити значення `10`, `100`, `50.2` тощо. Головне, щоб воно було менше або дорівнювало глобальному обмеженню на рівні Платформи, яке становить `100` МБ для максимального розміру запита.

image:registry-management/cp-digital-docs-restrictions/cp-digital-docs-restrictions-2.png[]

TIP: TIP: Детальніше про функціональність читайте на сторінці xref:admin:registry-management/control-plane-digital-documents.adoc[].

Натисніть `+++<b style="font-weight: 600">Далі<b>+++` для переходу до наступного кроку.

== Резервне копіювання

На цьому кроці ви можете налаштувати розклад створення резервних копій компонентів реєстру, а також період зберігання таких копій у сховищі бекапів.

Резервні копії компонентів створюються за допомогою інструменту *`velero`* та зберігаються у захищеному сховищі бекапів *`minio`*, що знаходиться поза межами кластера Платформи.

Розклад резервного копіювання налаштовується у форматі https://uk.wikipedia.org/wiki/Cron[*unix-cron*] на інтерфейсі адміністративної панелі *Control Plane*.

Також система виконує автоматичну реплікацію даних, які зберігаються в S3-бакетах. Ви можете налаштувати розклад резервного копіювання таких реплікацій.

image:admin:backup-restore/backup-schedule-registry-components/backup-schedule-registry-components-8-1.png[]

TIP: Детальніше про автоматичне створення резервних копій реєстру, а також резервне копіювання реплікацій S3-бакетів, читайте на сторінці xref:admin:backup-restore/backup-schedule-registry-components.adoc[].

TIP: Додатково ознайомтеся зі створенням бекапів у ручному режимі та відновленням з них середовища реєстру на сторінці xref:admin:backup-restore/control-plane-backup-restore.adoc[].

Натисніть `+++<b style="font-weight: 600">Далі<b>+++` для переходу до наступного кроку.

== ШБО Трембіта

На цьому кроці ви можете надати можливість зовнішнім системам звертатися до реєстру через ШБО "Трембіта". Для цього вкажіть IP-адреси ШБО "Трембіта", з яких буде дозволено доступ до SOAP API реєстру.

[CAUTION]
====
Крок є опціональним.

Якщо ви не вкажете тут жодних налаштувань, система не створить роути для вхідних SOAP-інтеграцій. Ви можете завжди зможете виконати необхідні конфігурації потім.
====

. Перейдіть до секції +++<b style="font-weight: 600">ШБО Трембіта<b>+++. Тут можна вказати дозволи на доступ до SOAP API реєстру через ШБО "Трембіта". Активуйте перемикач, щоб увімкнути доступ.
+
TIP: За замовчуванням доступ вимкнено для нових реєстрів.
+
image:registry-management/cp-soap-api-access/cp-soap-api-access-trembita-5.png[]

. У полі +++<b style="font-weight: 600">IP-адреси ШБО Трембіта<b>+++ додайте нову IP-адресу ШБО "Трембіта", з якої буде дозволено доступ до хосту, на якому розгортатимуться роути SOAP API.

. Натисніть +++<b style="font-weight: 600">Підтвердити<b>+++ та повторіть дію для кожної такої IP-адреси.
+
image:registry-management/cp-soap-api-access/cp-soap-api-access-trembita-6.png[]
+
[NOTE]
====
* Допустимі символи: `"0-9"`, `"."` Наприклад: `127.0.0.1`.
* Необхідно вказувати лише IP-адресу, без маски.
* Дозволено введення лише IP-адрес, а не підмереж (_див. детальніше -- xref:registry-management/control-plane-cidr-access-endpoints.adoc[CIDR]_).
* Кількість IP-адрес обмежена 10-ма.
* Якщо перелік `ipList` не містить жодної IP-адреси, доступ до SOAP API є відсутнім (роут не створюється).
====
+
image:registry-management/cp-soap-api-access/cp-soap-api-access-trembita-7.png[]

. Натисніть +++<b style="font-weight: 600">Далі<b>+++ для переходу до наступного кроку.

TIP: Детальніше з описом функціональності ви можете ознайомитися на сторінці xref:registry-management/control-plane-soap-api-access-trembita.adoc[].

== Підтвердження та процес розгортання

Завершіть процедуру натисканням клавіші `+++<b style="font-weight: 600">Створити реєстр<b>+++`.

Ви можете також перевірити дані, внесені на попередніх кроках, переміщаючись між відповідними вкладками.

image:admin:registry-management/registry-create/cp-create-registry-12.png[]

У результаті реєстр додається до переліку доступних у розділі +++<b style="font-weight: 600">Реєстри<b>+++ адміністративної панелі *Control Plane*.

У разі успішного розгортання, реєстр позначається зеленою піктограмою у стовпці +++<b style="font-weight: 600">Статус<b>+++.

image:admin:registry-management/registry-create/cp-create-registry-12-2.png[]

Розгортання реєстру займає певний час і виконується автоматично сервісом Jenkins. Сервіс запускає процес (пайплайн), що має назву *Master-Build-`<registry-name>`*, де `<registry-name>` -- назва реєстру. Переглянути статус розгортання можна, перейшовши до розділу +++<b style="font-weight: 600">Реєстри<b>+++ > відкрийте щойно створений реєстр > +++<b style="font-weight: 600">Конфігурація<b>+++ > *CI*.

image:admin:registry-management/registry-create/cp-create-registry-12-1.png[]

image:admin:registry-management/registry-create/cp-create-registry-12-3.png[]

Після успішного розгортання реєстру, ви можете переглядати поточні налаштування реєстру та вносити зміни до його конфігурацій

TIP: Детальніше про це див. на сторінці xref:registry-management/control-plane-edit-registry.adoc[].