= –û–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è Ceph-–∫–ª–∞—Å—Ç–µ—Ä–∞ —Ç–∞ —Å—É–º—ñ–∂–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤
include::platform:ROOT:partial$templates/document-attributes/default-set-ua.adoc[]

include::platform:ROOT:partial$admonitions/language-ua.adoc[]

–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –º—ñ—Å—Ç–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç *`openshift-storage`*, —â–æ —Ä–æ–∑–≥–æ—Ä—Ç–∞—î —Ç–∞ –∫–µ—Ä—É—î Ceph-–∫–ª–∞—Å—Ç–µ—Ä–æ–º –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é *`rook-operator`*. –£ —Ü—å–æ–º—É –¥–æ–∫—É–º–µ–Ω—Ç—ñ –∑—ñ–±—Ä–∞–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó —â–æ–¥–æ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è Ceph-–∫–ª–∞—Å—Ç–µ—Ä–∞ —Ç–∞ –ø–æ–≤'—è–∑–∞–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤ –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ —Ç–∞ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö.

[#manual-deep-scrub]
== –†—É—á–Ω–∏–π –∑–∞–ø—É—Å–∫ —Ç–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø—Ä–æ—Ü–µ—Å–∞–º–∏ Deep Scrubbing

–ü—ñ—Å–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ü–ª–∞—Ç—Ñ–æ—Ä–º–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ xref:admin:file-system/ceph-scrubbing.adoc#disable-deep-scrub[–≤–∏–º–∫–Ω—É—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –∑–∞–ø—É—Å–∫ deep scrubbing] –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –≤–ø–ª–∏–≤—É –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —É –ø—ñ–∫–æ–≤—ñ –≥–æ–¥–∏–Ω–∏. –û–¥–Ω–∞–∫ –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –≥–ª–∏–±–æ–∫–æ–≥–æ —Å–∫—Ä–∞–±—É–≤–∞–Ω–Ω—è —î –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–∏–º –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ –æ–±'—î–∫—Ç—ñ–≤. –¶–µ–π —Ä–æ–∑–¥—ñ–ª –æ–ø–∏—Å—É—î, —è–∫ –ø–æ–≤—Ç–æ—Ä–Ω–æ –∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ deep scrubbing, –∫–µ—Ä—É–≤–∞—Ç–∏ –Ω–∏–º –≤—Ä—É—á–Ω—É —Ç–∞ –æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ –π–æ–≥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è.

[IMPORTANT]
====
‚ùó *–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç–∏ deep scrubbing –≤—Ä—É—á–Ω—É —Ä–µ–≥—É–ª—è—Ä–Ω–æ*, —â–æ–Ω–∞–π–º–µ–Ω—à–µ *—Ä–∞–∑ –Ω–∞ –∫—ñ–ª—å–∫–∞ —Ç–∏–∂–Ω—ñ–≤*, –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ SLA —Ç–∞ –æ–±—Å—è–≥—É –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö.

–ó–∞–ø—É—Å–∫–∞–π—Ç–µ deep scrubbing —É —Ç—ñ –ø–µ—Ä—ñ–æ–¥–∏, –∫–æ–ª–∏ —É –≤–∞—à–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ *–∫–ª–∞—Å—Ç–µ—Ä –Ω–∞–π–º–µ–Ω—à–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏–π* -- –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —É–Ω–æ—á—ñ –≤ –±—É–¥–Ω—ñ –∞–±–æ –Ω–∞ –≤–∏—Ö—ñ–¥–Ω–∏—Ö, —è–∫—â–æ –¥–æ–∑–≤–æ–ª—è—î –≥—Ä–∞—Ñ—ñ–∫.
–§–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ, —è–∫—â–æ –ø—Ä–æ—Ü–µ—Å –Ω–µ –≤–ø–ª–∏–≤–∞—î –Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏.

üìå –í–∞–∂–ª–∏–≤–æ -- *–Ω–µ –¥–æ–ø—É—Å–∫–∞—Ç–∏ –Ω–∞–∫–æ–ø–∏—á–µ–Ω–Ω—è —á–µ—Ä–≥–∏ PG*, —è–∫—ñ —Ç—Ä–∏–≤–∞–ª–∏–π —á–∞—Å –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –±–µ–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏.
–£ –∫–ª–∞—Å—Ç–µ—Ä—ñ –∑ –≤–µ–ª–∏–∫–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—é –æ–±'—î–∫—Ç—ñ–≤ —ñ PG –º–æ–∂–µ –∑–Ω–∞–¥–æ–±–∏—Ç–∏—Å—è –∑–∞–ø—É—Å–∫ —â–æ–¥–Ω—è –∑ –æ–±–º–µ–∂–µ–Ω–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—é –ø–∞—Ä–∞–ª–µ–ª—å–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤ (`osd_max_scrubs`), —Ç–æ–¥—ñ —è–∫ —É –º–µ–Ω—à –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –æ–¥–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫—É –Ω–∞ –≤–∏—Ö—ñ–¥–Ω–∏—Ö.
====

[#deep-scrub-enable]
=== –†–æ–∑–±–ª–æ–∫—É–≤–∞–Ω–Ω—è —Ç–∞ –∑–∞–ø—É—Å–∫ deep scrubbing

–©–æ–± –∑–∞–ø—É—Å—Ç–∏—Ç–∏ deep scrubbing –≤—Ä—É—á–Ω—É, —Å–ø–µ—Ä—à—É –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –ø—Ä–∏–±—Ä–∞—Ç–∏ –ø—Ä–∞–ø–æ—Ä—Ü—ñ `nodeep-scrub` –∑ —É—Å—ñ—Ö –ø—É–ª—ñ–≤, –∞ –ø–æ—Ç—ñ–º —ñ–Ω—ñ—Ü—ñ—é–≤–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ –¥–ª—è ceph cli –∑ –ø–æ–¥—É `rook-operator` –≤ OKD-–ø—Ä–æ—î–∫—Ç—ñ `openshift-storage`.

.–ó–Ω—è—Ç—Ç—è –ø—Ä–∞–ø–æ—Ä—Ü—ñ–≤ nodeep-scrub –∑ —É—Å—ñ—Ö –ø—É–ª—ñ–≤
[source,bash]
----
for pool in $(ceph --conf=/var/lib/rook/openshift-storage/openshift-storage.config osd pool ls); do
  ceph --conf=/var/lib/rook/openshift-storage/openshift-storage.config osd pool set "$pool" nodeep-scrub false
done
----

.–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –ø—Ä–∞–ø–æ—Ä—Ü—ñ–≤
[source,bash]
----
ceph --conf=/var/lib/rook/openshift-storage/openshift-storage.config osd pool ls detail
----

.–ó–∞–ø—É—Å–∫ deep scrubbing –Ω–∞ –≤—Å—ñ—Ö OSD (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)
[source,bash]
----
ceph osd --conf=/var/lib/rook/openshift-storage/openshift-storage.config deep-scrub all
----

.–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –∑–∞–ø—É—Å–∫—É deep —Å–∫—Ä–∞–±—É–≤–∞–Ω–Ω—è PGs
[source,bash]
----
# –î–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ OSD
ceph osd --conf=/var/lib/rook/openshift-storage/openshift-storage.config deep-scrub 0

# –î–ª—è –≤—Å—ñ—Ö –ø—É–ª—ñ–≤
for pool in $(ceph --conf=/var/lib/rook/openshift-storage/openshift-storage.config osd pool ls); do
  ceph --conf=/var/lib/rook/openshift-storage/openshift-storage.config osd pool deep-scrub "$pool"
done
----

[#deep-scrub-speedup]
=== –ü—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è deep scrubbing –ø—Ä–∏ –Ω–∞–∫–æ–ø–∏—á–µ–Ω–Ω—ñ —á–µ—Ä–≥–∏

–£ –≤–∏–ø–∞–¥–∫–∞—Ö –≤–µ–ª–∏–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ PG, —è–∫—ñ –æ—á—ñ–∫—É—é—Ç—å –Ω–∞ deep scrubbing, –º–æ–∂–Ω–∞ –ø—Ä–∏—Å–∫–æ—Ä–∏—Ç–∏ –ø—Ä–æ—Ü–µ—Å:

* –¢–∏–º—á–∞—Å–æ–≤–æ –ø—ñ–¥–≤–∏—â–∏–≤—à–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–∞—Ä–∞–ª–µ–ª—å–Ω–∏—Ö —Å–∫—Ä–∞–±—É–≤–∞–Ω—å.
+
*_–ê–ë–û_*

* –†–æ–∑—à–∏—Ä–∏—Ç–∏ –≤—ñ–∫–Ω–æ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è, –∑–∞–ø—É—Å–∫–∞—é—á–∏ deep —Å–∫—Ä–∞–±—É–≤–∞–Ω–Ω—è –≤—Ä—É—á–Ω—É –Ω–∞ –Ω—ñ—á —É –±—É–¥–Ω—ñ –¥–Ω—ñ.

–ó–±—ñ–ª—å—à—Ç–µ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—ñ–≤ —Å–∫—Ä–∞–±—É–≤–∞–Ω–Ω—è –Ω–∞ –æ–¥–Ω–æ–º—É OSD –≤ –æ–¥–∏–Ω –º–æ–º–µ–Ω—Ç —á–∞—Å—É, *–∞–ª–µ –Ω–µ –±—ñ–ª—å—à–µ 4*.

.–ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –ø—Ä–æ—Ü–µ—Å—ñ–≤ –¥–æ 4
[source,bash]
----
ceph config --conf=/var/lib/rook/openshift-storage/openshift-storage.config set osd osd_max_scrubs 4
----

[NOTE]
====
–ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ—ó —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è `osd_max_scrubs` –¥–æ `1`.

‚û°Ô∏è –î–µ—Ç–∞–ª—å–Ω—ñ—à–µ –ø—Ä–æ —Ü–µ –æ–ø–∏—Å–∞–Ω–æ —É —Ä–æ–∑–¥—ñ–ª—ñ xref:admin:file-system/ceph-scrubbing.adoc#max-concurrent-scrubs[–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–∞—Ä–∞–ª–µ–ª—å–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤ scrubbing].
====

image::file-system/ceph-scrubbing/ceph-scrubbing-2.png[]

[#scrubbing-monitoring]
== –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å—É Scrubbing

–¶–µ–π —Ä–æ–∑–¥—ñ–ª –æ–ø–∏—Å—É—î, —è–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å —Å–∫—Ä–∞–±—É–≤–∞–Ω–Ω—è —É –∫–ª–∞—Å—Ç–µ—Ä—ñ, –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è deep scrubbing —Ç–∞ –ø–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏ –∂—É—Ä–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –∑–∞ PG. –¶–µ –¥–æ–ø–æ–º–∞–≥–∞—î —Å–≤–æ—î—á–∞—Å–Ω–æ –≤–∏—è–≤–ª—è—Ç–∏ –ø—Ä–æ–±–ª–µ–º–∏ —Ç–∞ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ —Ü—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö.

[#grafana-monitoring]
=== –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ –≤–µ–±—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å Grafana

–î–ª—è –∑—Ä—É—á–Ω–æ–≥–æ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–∞ —Å—Ç–∞–Ω–æ–º scrubbing —ñ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—é OSD –º–æ–∂–Ω–∞ —Å–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏—Å—è *Grafana Dashboard*, –∑–æ–∫—Ä–µ–º–∞ –¥–∞—à–±–æ—Ä–¥–æ–º *Ceph & PostgreSQL Deep Scrubbing Dashboard*.

–¶–µ–π –¥–∞—à–±–æ—Ä–¥ –≤—ñ–∑—É–∞–ª—ñ–∑—É—î:

* –ö—ñ–ª—å–∫—ñ—Å—Ç—å PG —É –ø—Ä–æ—Ü–µ—Å—ñ deep scrubbing -- –∑–∞ —á–∞—Å–æ–≤–æ—é —à–∫–∞–ª–æ—é;

* –ó–∞—Ç—Ä–∏–º–∫–∏ —á–∏—Ç–∞–Ω–Ω—è/–∑–∞–ø–∏—Å—É –Ω–∞ —Ä—ñ–≤–Ω—ñ OSD (OSD Read & Write Latency);

* –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω –∫–ª–∞—Å—Ç–µ—Ä–∞ -- –ø–∞–Ω–µ–ª—å Cluster Healthy Status.

.Grafana Dashboard. Ceph Deep Scrubbing Metrics
image::file-system/ceph-cluster-maintenance/ceph-cluster-maintenance-1.png[]

[ceph-cli-monitoring]
=== –ü–µ—Ä–µ–≥–ª—è–¥ —Å—Ç–∞—Ç—É—Å—É —á–µ—Ä–µ–∑ Ceph CLI

–í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –ø—Ä–æ—Ü–µ—Å —Å–∫—Ä–∞–±—É–≤–∞–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Ceph CLI. –ù–∏–∂—á–µ –ø–æ–¥–∞–Ω–æ –ø–µ—Ä–µ–ª—ñ–∫ –∫–æ—Ä–∏—Å–Ω–∏—Ö –∫–æ–º–∞–Ω–¥:

.–ü–µ—Ä–µ–≥–ª—è–¥ –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞–Ω—É –∫–ª–∞—Å—Ç–µ—Ä–∞
[source,bash]
----
ceph -s --conf=/var/lib/rook/openshift-storage/openshift-storage.config
----

.–°—Ç–∞—Ç—É—Å –ø–æ Placement Groups
[source,bash]
----
ceph --conf=/var/lib/rook/openshift-storage/openshift-storage.config pg stat
----

.–ü–æ—à—É–∫ –∞–∫—Ç–∏–≤–Ω–∏—Ö scrubbing-–ø—Ä–æ—Ü–µ—Å—ñ–≤
[source,bash]
----
ceph pg --conf=/var/lib/rook/openshift-storage/openshift-storage.config dump pgs | grep -E 'scrub|deep'
----

.–î–µ—Ç–∞–ª—å–Ω–∏–π –∑–∞–ø–∏—Ç –ø–æ PG
[source,bash]
----
ceph pg 19.11 query --conf=/var/lib/rook/openshift-storage/openshift-storage.config
----

.–ú—ñ—Ç–∫–∏ –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ deep scrubbing –ø–æ PG
[source,bash]
----
ceph --conf=/var/lib/rook/openshift-storage/openshift-storage.config pg dump pgs | awk '{print $1, $23}' | sort -k2 | column -t
----

[#scrubbing-stop]
== –ó—É–ø–∏–Ω–∫–∞ –ø—Ä–æ—Ü–µ—Å—É Deep Scrubbing

–Ü–Ω–æ–¥—ñ –≤–∏–Ω–∏–∫–∞—î –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ—Å—Ç—å —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ –∑—É–ø–∏–Ω–∏—Ç–∏ –∞–±–æ –ø—Ä–∏–≥–∞–ª—å–º—É–≤–∞—Ç–∏ deep scrubbing -- –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —á–µ—Ä–µ–∑ –ø—ñ–∫–æ–≤–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–±–æ –∫—Ä–∏—Ç–∏—á–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –≤ —ñ–Ω—à–∏—Ö —Å–µ—Ä–≤—ñ—Å–∞—Ö. –¶–µ–π —Ä–æ–∑–¥—ñ–ª –æ–ø–∏—Å—É—î –±–µ–∑–ø–µ—á–Ω—ñ —Å–ø–æ—Å–æ–±–∏ –∑–Ω–∏–∂–µ–Ω–Ω—è –∞–±–æ –ø–æ–≤–Ω–æ—ó –∑—É–ø–∏–Ω–∫–∏ –ø—Ä–æ—Ü–µ—Å—É.

[#scrubbing-soft-stop]
=== –ú'—è–∫–∞ –∑—É–ø–∏–Ω–∫–∞ (soft stop)

–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ -- –∑–º–µ–Ω—à–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –æ–¥–Ω–æ—á–∞—Å–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤ —Å–∫—Ä–∞–±—É–≤–∞–Ω–Ω—è (`osd_max_scrubs`), –¥–æ–∑–≤–æ–ª–∏–≤—à–∏ –ø–æ—Ç–æ—á–Ω–∏–º –∑–∞–≤–µ—Ä—à–∏—Ç–∏—Å—å –±–µ–∑ –∑–∞–ø—É—Å–∫—É –Ω–æ–≤–∏—Ö. –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è = `1`.

.–ó–º–µ–Ω—à–µ–Ω–Ω—è –∑–Ω–∞—á–µ–Ω–Ω—è Max Scrubs
[source,bash]
----
ceph config --conf=/var/lib/rook/openshift-storage/openshift-storage.config set osd osd_max_scrubs 1
----

[#scrubbing-force-stop]
=== –ü—Ä–∏–º—É—Å–æ–≤–∞ –∑—É–ø–∏–Ω–∫–∞ (force stop)

–£ —Ä–∞–∑—ñ –∫—Ä–∏—Ç–∏—á–Ω–æ—ó –ø–æ—Ç—Ä–µ–±–∏ –∑—É–ø–∏–Ω–∏—Ç–∏ –ø—Ä–æ—Ü–µ—Å *deep scrubbing* –Ω–µ–≥–∞–π–Ω–æ -- –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —á–µ—Ä–µ–∑ –¥–µ–≥—Ä–∞–¥–∞—Ü—ñ—é –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –∞–±–æ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è IO -- –¥–æ–ø—É—Å–∫–∞—î—Ç—å—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ OSD, –Ω–∞ —è–∫–∏—Ö –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è PG —É —Å—Ç–∞—Ç—É—Å—ñ `scrubbing+deep`.
–¶–µ–π –º–µ—Ç–æ–¥ —î *–∂–æ—Ä—Å—Ç–∫–∏–º –≤—Ç—Ä—É—á–∞–Ω–Ω—è–º* —ñ –ø–æ–≤–∏–Ω–µ–Ω –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è *–ª–∏—à–µ —É –≤–∏–Ω—è—Ç–∫–æ–≤–∏—Ö –≤–∏–ø–∞–¥–∫–∞—Ö*.

. –í–∏–∑–Ω–∞—á—Ç–µ PG, –¥–ª—è —è–∫–∏—Ö –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è deep scrubbing.
+
[source,bash]
----
ceph pg --conf=/var/lib/rook/openshift-storage/openshift-storage.config dump pgs | grep -E 'scrub|deep'
----
+
.–ü—Ä–∏–∫–ª–∞–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É —É –≤–∏–≤–æ–¥—ñ –∫–æ–º–∞–Ω–¥–∏

``
19.11         554                   0         0          0        0    72797490            0           0  854       854  active+clean+scrubbing+deep 2025-04-03T07:03:00.295292+0000     2326'7347    2326:18658  [0,2,1]           0  [0,2,1]               0     2263'7328  2025-04-03T07:03:00.295251+0000        2136'4471  2025-03-31T07:38:49.421946+0000              0
``
+
.–ü–æ—è—Å–Ω–µ–Ω–Ω—è –∫–ª—é—á–æ–≤–∏—Ö –ø–æ–ª—ñ–≤ —É –≤–∏–≤–æ–¥—ñ –∫–æ–º–∞–Ω–¥–∏ `ceph pg dump pgs`
[cols="30,70", options="header"]
|===
^| –ó–Ω–∞—á–µ–Ω–Ω—è –ø–æ–ª—è ^| –û–ø–∏—Å

| `19.11` | *PG ID* -- —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä Placement Group —É —Ñ–æ—Ä–º–∞—Ç—ñ `pool_id.pg_num`.

| `active+clean+scrubbing+deep` | *–°—Ç–∞—Ç—É—Å PG* ‚Äî –≤–∫–∞–∑—É—î, —â–æ PG –∞–∫—Ç–∏–≤–Ω–∞, —Ü—ñ–ª—ñ—Å–Ω–∞ (`clean`) —ñ –Ω–∞—Ä–∞–∑—ñ –ø–µ—Ä–µ–±—É–≤–∞—î –≤ –ø—Ä–æ—Ü–µ—Å—ñ –≥–ª–∏–±–æ–∫–æ–≥–æ —Å–∫—Ä–∞–±—É–≤–∞–Ω–Ω—è (`scrubbing+deep`).

| `[0,2,1]` | *Acting Set* -- —Å–ø–∏—Å–æ–∫ OSD, —è–∫—ñ –æ–±—Å–ª—É–≥–æ–≤—É—é—Ç—å –¥–∞–Ω—É PG. –ü–µ—Ä—à–∏–π —É —Å–ø–∏—Å–∫—É ‚Äî —Ü–µ *primary OSD*.

| `0` | *Primary OSD index* -- –ø–æ–∑–∏—Ü—ñ—è –≤ Acting Set, —è–∫–∞ –≤–∏–∑–Ω–∞—á–∞—î, —è–∫–∏–π —Å–∞–º–µ OSD —î primary. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ Acting Set ‚Äî `[0,2,1]` —ñ —ñ–Ω–¥–µ–∫—Å -- `0`, —Ç–æ primary -- —Ü–µ `OSD 0`.

| `2025-04-03T07:03:00.295251+0000` | *deep_scrub_stamp* -- –¥–∞—Ç–∞ —Ç–∞ —á–∞—Å –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è deep scrubbing –¥–ª—è PG.

|===

. –í–∏–¥–∞–ª—ñ—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π pod OSD —á–µ—Ä–µ–∑ *OpenShift UI* –∞–±–æ *CLI*.
+
[source,bash]
----
oc delete pod rook-ceph-osd-0-example -n openshift-storage
----

CAUTION: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ pod –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ –∑—É–ø–∏–Ω–∫–∏ –ø–æ—Ç–æ—á–Ω–∏—Ö —Å–∫—Ä–∞–±—ñ–Ω–≥-–ø—Ä–æ—Ü–µ—Å—ñ–≤ –Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ–º—É OSD —Ç–∞ —ñ–Ω—ñ—Ü—ñ—é—î *recovery/rebalancing* PG. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –ª–∏—à–µ –∑–∞ –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤.

[#related-pages]
== –ü–æ–≤'—è–∑–∞–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏

* xref:file-system/ceph-scrubbing.adoc[]
* xref:file-system/ceph-osd-scaling-and-rebalancing.adoc[]



