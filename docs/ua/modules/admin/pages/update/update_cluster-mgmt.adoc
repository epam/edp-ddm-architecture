= Оновлення інфраструктурних компонентів Платформи
:toc:
:toclevels: 5
:toc-title: ЗМІСТ
:sectnums:
:sectnumlevels: 5
:sectanchors:

== Загальний опис

Керування кластером Платформи відбувається за підходом *GitOps*. Це означає, що будь-які зміни у конфігурації кластера, компонентів кластера та компонентів Платформи відбуваються через внесення змін до конфігурації відповідних компонентів у git-гілках цих компонентів.

Кожен компонент є окремим git-репозиторієм.
Метадані усіх інфраструктурних компонентів, для яких реалізована можливість управління через GitOps-підхід, зберігаються в компоненті *cluster-management*.

TIP: *Cluster Management* або *cluster-mgmt* -- це композитний репозиторій, який визначає конкретні версії інфраструктурних компонентів. Оновлення цього компонента дозволить автоматично оновити відповідні інфраструктурні компоненти Платформи.

Нижче представлено список компонентів, для яких наразі імплементована можливість оновлення через GitOps-підхід:

* `catalog-source`;
* `storage`;
* `monitoring`;
* `logging`;
* `service-mesh`;
* `velero`;
* `control-plane-nexus`;
* `user-management`.

Керування оновленнями інфраструктурних компонентів Платформи відбувається в адміністративній панелі керування Платформою та реєстрами *Control Plane*.

Процес оновлення можна умовно поділити на такі етапи: ::

. Налаштування в адміністративній панелі керування кластером та реєстрами *Control Plane*.

. Проходження процедури перевірки коду в системі рецензування коду *Gerrit*.

. Контроль за виконанням збірки коду в *Jenkins*.

== Налаштування в адміністративній панелі керування кластером та реєстрами Control Plane

. Увійдіть до адміністративної панелі керування кластером та реєстрами *Control Plane*.
+
image:infrastructure/cluster-mgmt/update-cluster-mgmt-01.png[]

. Відкрийте меню _Керування кластером_.
. У правому верхньому куті сторінки натисніть `Редагувати`.
+
image:admin:infrastructure/cluster-mgmt/update-cluster-mgmt-1.png[]
. На сторінці, що відкрилася, знайдіть секцію _Оновлення кластера_.
. У випадному списку оберіть версію, до якої необхідно оновити компоненти Платформи.
+
NOTE: Доступні версії збірки для оновлення компонентів завжди будуть вищими за поточну.

. Натисніть кнопку `Підтвердити` для збереження змін.
+
В результаті буде сформовано запит на оновлення компонентів Платформи, тобто відбудеться передача змін (`git push`) до репозиторію Gerrit для подальшої перевірки коду.
+
image:admin:infrastructure/cluster-mgmt/cluster-mgmt-update.png[]

== Проходження процедури перевірки коду в системі рецензування коду Gerrit

Після успішного створення запита на оновлення в інтерфейсі Control Plane, необхідно пройти процедуру перевірки коду в системі Gerrit. Для цього виконайте наступні кроки:

. Відкрийте консоль керування кластером у *Control Plane*.
. Перейдіть до секції _Запити на оновлення_ -> _Посилання_.
. Перейдіть до інтерфейсу *Gerrit* за відповідним посиланням.
+
image:admin:infrastructure/cluster-mgmt/update-cluster-mgmt-2.png[]

. Виконайте перевірку коду та підтвердьте внесення змін (`git merge`) до `master`-гілки репозиторію.
+
image:admin:infrastructure/cluster-mgmt/cluster-mgmt-gerrit-mr.png[]

За фактом злиття змін до `master`-гілки репозиторію в Gerrit, відбудеться автоматичний запуск процесу збірки внесених змін інструментом Jenkins.

== Контроль за виконанням збірки коду в Jenkins

Після успішного надходження змін до `master`-гілки репозиторію в Gerrit, необхідно переконатися, що Jenkins-pipeline `cluster-mgmt` запустився й успішно завершився. Для цього виконайте наступні кроки:

. Відкрийте консоль керування кластером у *Control Plane*.
. Перейдіть до секції _Конфігурація_ -> _CI_.
. Перейдіть до інтерфейсу *Jenkins* за відповідним посиланням.
+
image:admin:infrastructure/cluster-mgmt/update-cluster-mgmt-3.png[]

. Дочекайтеся виконання всіх кроків збірки `MASTER-Build-cluster-mgmt`.
+
image:admin:infrastructure/cluster-mgmt/cluster-mgmt-jenkins.png[]

[IMPORTANT]
====
Після успішної збірки, інфраструктурні компоненти Платформи оновлюються до обраної версії. Після цього стає доступною опція xref:update/update-registry-components.adoc[оновлення компонентів реєстру].
====