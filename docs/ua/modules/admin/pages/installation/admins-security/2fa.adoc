= Налаштування двохфакторної автентифікації
include::platform:ROOT:partial$templates/document-attributes/default-set-ua.adoc[]

== Загальні положення

Двохфакторна автентифікація (2FA) є важливою стратегією в кібербезпеці, яка забезпечує додатковий рівень захисту облікових записів, комбінуючи два різні типи перевірки - зазвичай це щось, що користувач знає (пароль), і щось, що користувач має (наприклад, мобільний телефон або токен). Цей метод значно ускладнює несанкціонований доступ, зменшуючи ризики, пов'язані зі слабкими або скомпрометованими паролями, та допомагає відповідати нормативним вимогам. Незважаючи на додатковий крок у процесі входу та потенційні технічні виклики, переваги 2FA в контексті зростаючих кіберзагроз є значними, що робить її критично важливим компонентом у стратегії кібербезпеки Платформи Реєстрів.

== Кроки налаштування 2FA

1. Вхід в Адміністративну Консоль Keycloak
2. Виберіть _openshift_ реалм, для якого будуть здійснені налаштування.
3. У меню зліва виберіть "Authentication".
4. Перейдіть у вкладку "Flows"
5. Навпроти "Browser - Conditional OTP " поставте перемикач у положення "REQUIRED"
6. Переконайтесь що на кроці "Condition - User Configured" та OTP Form перемикач також у положенні "REQUIRED"
7. Переконайтесь що у вкладці "Required Actions" параметр "Configure OTP" увімкнений (див. Зображення Кроки налаштування OTP "Required Actions" )
8. При наступному вході адміністративному користувачеві буде запропоновано налаштувати двухфакторну автентифікацію (див. Зображення 2 та наступну секцію)

CAUTION: Процедура має бути повторена для _<registry>-admin_ реалму реєстру для випадків, коли користувача було створено не через Control Plane, а напряму в реєстровому реалмі через Keycloak UI.

.Кроки налаштування двохфакторної автентифікації
image::admins-security/2fa.png[Кроки налаштування двохфакторної автентифікації]

.Кроки налаштування OTP "Required Actions"
image::admins-security/required_actions_otp.png[Кроки налаштування OTP "Required Actions"]

== Кроки налаштування автентифікатора

. Вхід в Адміністративну Консоль Keycloak
. Після введення облікових даних зявиться інтерфейс налаштування другого фактору.
+

.Кроки налаштування автентифікатора
image::admins-security/authenticator.png[Кроки налаштування автентифікатора]

+
[TIP]
--
Додатки які офіційно підтримуються KeyCloak для налаштування TOTP - Google Authenticator та FreeOTP. Microsoft Authenticator, на момент написання розділу (кінець 2023 року), може бути використаний лише за умови налаштування OTP політики з ненадійним алгоритмом SHA1 та не рекомендується.
--

. Встановіть додаток "Google Authenticator" на ваш мобільний пристрій.
. Відкрийте додаток та натисніть "+" додати обліковий запис.
. Відскануйте згенерований RQ-код з другого кроку (якщо треба надайте "Google Authenticator" доступ до камери).
+

.Відскануйте QR-код
image::admins-security/qr_scan.png[Відскануйте QR-код]

. Переконайтесь що новий обліковий запис було додано
+

.Обліковий запис додано
image::admins-security/authenticator_added.png[Обліковий запис додано]

. Введіть згенерований одноразовий код в інтерйесі з другого кроку
. Введіть довільний ідентифікатор вашого пристрою. Будь-яка назва яка для вас буде ідентифікувати використаний пристрій з автентифікатором
. Підтверте форму.

== Кроки налаштування параметрів OTP

1. Вхід в Адміністративну Консоль Keycloak
2. Виберіть openshift realm, для якого будуть здійснені налаштування. 
3. У меню зліва виберіть "Authentication".
4. Перейдіть у вкладку "OTP Policy"
5. Змініть "OTP Hash Algorithm" на SHA256
6. Збережіть зміни

.Кроки налаштування OTP політик
image::admins-security/otp_policy.png[Кроки налаштування OTP політик]

[TIP]
--
Хоча SHA1 широко використовується та підтримується, він вважається слабшим , ніж SHA256 або SHA512. Якщо можливо, використовуйте SHA256 або SHA512 для підвищення безпеки. Однак переконайтеся, що ваш вибір сумісний із користувацькими OTP додатками.
--
