= Політика паролів
include::platform:ROOT:partial$templates/document-attributes/default-set-ua.adoc[]

== Загальна інформація

Традиційно у сфері кібербезпеки існували стандарти, які пропагували використання паролів з високою ступенем комплексності, включаючи комбінацію великих і малих літер, цифр та спеціальних символів. Прикладами таких стандартів є PCI DSS (стандарт безпеки даних індустрії платіжних карток) та ISO/IEC 27001 (міжнародний стандарт управління інформаційною безпекою). Ці стандарти встановлювали вимоги до складності паролів з метою збільшення захисту від несанкціонованого доступу.

Однак, у недавні роки були зроблені зміни у підходах до парольної політики. Організації, такі як NIST та OWASP, почали рекомендувати зосереджуватися більше на довжині та унікальності паролів, ніж на їхній складності, зменшуючи акцент на обов'язкове використання спецсимволів та чисел. Це змінило стандартизовані практики парольної безпеки, роблячи їх орієнтованими на легшість запам'ятовування та зменшення ризику використання слабких, легко вгадуваних паролів.

Приведені налаштування є рекомендацією, а не нормативною вимогою.

CAUTION: При створенні адміністративного користувача через Control Plane тимчасовий пароль має відповідати встановленим політикам у противному випадку користувача створено не буде.

== Базова політика

Базується на класичному підході комплексного паролю.

=== Кроки налаштування

1. Відкрийте адміністративну консоль Keycloak.
2. Виберіть _openshift_ realm, для якого буде налаштована політика паролів.
3. У меню зліва виберіть "Authentication".
4. Перейдіть до вкладки "Password Policy".
5. Натисніть на "Add policy" для додавання нової політики.
6. Виберіть "Regular Expression", встановіть значення та збережіть зміни.
[source]
----
^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=.*[@#$%^&+=])(?=\S+$).{10,}$
----
[TIP]
--
Має принаймні 10 символів. + 
Oдну малу літеру. +
Oдну велику літеру. + 
Містить принаймні одну цифру. + 
Мати принаймні один спеціальний символ із зазначеного набору (@, #, $, %, ^, &, +, =). +
Не має пробілів. +
--

CAUTION: Процедура має бути повторена для _<registry>-admin_ реалму реєстру для випадків, коли користувача було створено не через Control Plane, а напряму в реєстровому реалмі через Keycloak UI.

.Кроки налаштування базової політики
image::admins-security/password_policy_general.png[Кроки налаштування базової політики]

== Просунута політика

Просунута політика базується на OWASP ASVS 2.1 Password Security та NIST Special Publication 800-63: Digital Identity Guidelines та робить акцент на секретах які просто запамятати. Вимоги складаються з використання довгих паролів, наявності пробілів, сиволів юнікоду та блеклісту загальних паролів що не дозволяє користувачам вибирати дуже загальні значення, які були б особливо вразливими, особливо для онлайн-атаки.

CAUTION: Використання блеклісту загальних паролів доступне з релізу 1.9.9

=== Кроки налаштування

1. Вхід в Адміністративну Консоль Keycloak
- Відкрийте адміністративну консоль Keycloak.
- Увійдіть за допомогою облікових даних адміністратора.
2. Виберіть _openshift_ realm, для якого буде налаштована політика паролів.
3. У меню зліва виберіть "Authentication".
4. Перейдіть до вкладки "Password Policy".
5. Натисніть на "Add policy" для додавання нової політики.
6. Виберіть "Minimum Length" та встановіть значення у 12
7. Виберіть "Password Blacklist" та встановіть значення "blacklist.txt"
8. Збережіть зміни.

[TIP]
--
Мінімальна довжина: Налаштування мінімальної довжини пароля в 12 символів. +
Максимальна довжина: Keycloak підтримує паролі довжиною 64 символи або більше за замовчуванням. +
Дозвіл на пробіли в паролях: Keycloak дозволяє використовувати пробіли у паролях та не обрізає їх за замовчуванням. +
Підтримка символів Unicode: Використання символів Unicode у паролях підтримується за замовчуванням. +
Відсутність обмежень на склад пароля: Не створюйте політик, які обмежують типи символів у паролі.
--

CAUTION: Процедура має бути повторена для _<registry>-admin_ реалму реєстру для випадків, коли користувача було створено не через Control Plane, а напряму в реєстровому реалмі через Keycloak UI.

.Кроки налаштування просунутої політики
image::admins-security/password_policy_advanced.png[Кроки налаштування просунутої політики]

== Примусова зміна паролів користувачів

На жаль Keycloak не пропонує вбудованого функціоналу для масової примусової зміни паролів до всіх користувачів одночасно через адміністративний інтерфейс. 

Існує два способи примусової зміни пароля користувачів - виставлення "Update Password" в "Required User Actions" для кожного користувача через адміністративний інтерфейс KeyCloak або написання скрипту для автоматизацї за допомогою Keycloak REST API.

=== Ручні кроки

1. Вхід до Адміністративної Консолі Keycloak:
- Відкрийте адміністративну консоль Keycloak і ввійдіть за допомогою своїх облікових даних адміністратора.
2. Вибір Реалму
- У верхньому лівому куті виберіть потрібний реалм, де ви хочете змусити користувачів змінити паролі.
3. Перехід до Розділу "Users"
- У лівому меню перейдіть до розділу "Users".
4. Вибір Користувачів
- Відкрийте список користувачів у реалмі.
- Клікніть на ім'я користувача, щоб відкрити його налаштування. 
5. Перейдіть на вкладку "Details". 
6. У розділі "Required User Actions" виберіть "Update Password".
7. Збережіть зміни

.Кроки налаштування примусової зміни паролів користувачів в ручну
image::admins-security/password_reset.png[Кроки налаштування примусової зміни паролів користувачів в ручну]

Це треба зробити для кожного користувача окремо. Якщо кількість користувачів велика, це може бути доволі трудомістким.

=== Автоматизація

Якщо у вас є велика кількість користувачів, можна використовувати Keycloak REST API для програмного встановлення "Required Action" (Update Password) для всіх користувачів. Це потребує написання скрипту, який ітерує через всі облікові записи користувачів у вашому реалмі та встановлює необхідну дію для зміни пароля.

