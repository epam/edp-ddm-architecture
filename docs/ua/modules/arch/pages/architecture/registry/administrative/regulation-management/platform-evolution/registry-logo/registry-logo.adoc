= Налаштування логотипу реєстру

== Загальний опис

Необхідно надати можливість налаштовувати логотипи у хедері сторінок, логотип лоадера, favicon для окремого реєстру.
Обрані логотипи платформи мають відображатись у всіх кабінетах.

== Актори та ролі користувачів

* Моделювальник реєстру
* Посадова особа
* Користувач порталів

== Функціональні сценарії

* Перегляд логотипів у порталах реєстру (officer, citizen, admin).
* Оновлення логотипів для окремого реєстру

== Загальні принципи та положення

* Налаштування логотипів відбувається на рівні регламенту реєстру
* Моделювальник може вказати наступні логотипи:
** Логотип у навігаційному меню
** Логотип у вкладці браузера (favicon)
** Логотип у лоадеру
* За замовчуванням використовуються поточні українські логотипи та іконки

== Високорівневий дизайн рішення

На рівні регламенту з'являється нова папка _assets_, яка міститиме необхідні файли

Структура папки:

* ./assets
** ./header-logo.svg
** ./loader-logo.svg
** ./favicon.png

Файли з цієї папки читаються на рівні пайплайну публікації регламенту і перетворюються на base64 рядки.

Після цього вони:

* додаються до конфігмапи *registry-logos*, дана конфігмапа маунтиться до порталів
* додаються до keycloak auth flow для оновлення на сторінках автентифікації

Найближчий приклад - _UpdateRegistrySettings.groovy_ у репозиторії пайплайну публікації регламенту

[source,yaml]
.deployments/officer-portal
----
volumeMounts:
  - name: registry-logos
    mountPath: /usr/share/nginx/html/portal-officer/logos/registry-logos
----

[source,yaml]
.Вміст конфігмапи
----
logoHeader: base64File
logoLoader: base64File
logoFavicon: base64File
----

== Компоненти системи та їх призначення в рамках дизайну рішення

У даному розділі наведено перелік компонент системи, які залучені або потребують змін в рамках реалізації функціональних вимог.

|===
|Підсистема|Компонент|Опис змін

|Підсистема кабінетів
|*common-web-app*
|Додати обробку логотипів, які передаються у форматі base64 тексту, у порталах та на сторінках автентифікації
|Підсистема розгортання регламенту
|*registry-regulation-publication-pipeline*
|Додати стейдж обробки логотипів з регламенту і оновлення конфігмапи та кіклок ресурсів
|Підсистема розгортання регламенту
|*registry-regulation-validator*
|Додати перевірку наявності та не пустоти трьох нових файлів
|Підсистема розгортання та налаштування Платформи та реєстрів
|*registry-configuration*
|Додати створення конфігмапи _registry-logos_ з дефолтними контентом для подальшого оновлення пайплайном публікації, додати створення дефолтних значень для нових полів автентифікаторів кіклока
|Підсистема управління користувачами та ролями
|*keycloak-ds-officer-authenticator*
|Додати обробку параметрів з логотипами на сторінках автентифікації (_FormParam.java_, _DsoOfficerAuthenticator.java_, _DsoOfficerAuthenticatorFactory.java_, _IdGovUaOfficerAuthenticator.java_, _IdGovUaOfficerAuthenticatorFactory.java_)
|Підсистема управління користувачами та ролями
|*keycloak-ds-citizen-authenticator*
|Додати обробку параметрів з логотипами на сторінках автентифікації (_FormParam.java_, _DsoCitizenAuthenticator.java_, _DsoCitizenAuthenticatorFactory.java_)

|===

=== Експертизи

* DevOps
* BE
* FE (react)

== Міграція існуючих реєстрів при оновленні

Необхідний міграційний скрипт, який до усіх існуючих реєстрів додасть файли з дефолтними українськими логотипами
