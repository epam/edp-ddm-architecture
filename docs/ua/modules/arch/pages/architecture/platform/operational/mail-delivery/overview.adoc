= Підсистема поштових повідомлень

== Загальний опис

Підсистема, призначенням якої є обслуговування поштових скриньок реєстрів, аналіз поштових повідомлень на спам та віруси та відправлення поштових повідомлень користувачам.

== Функції підсистеми

* Адміністрування поштових служб екземпляра _Платформи Реєстрів_
* Обслуговування поштових скриньок реєстрів
* Відправка поштових повідомлень користувачам реєстрів
* Аналіз поштових повідомлень на спам та фільтрація
* Аналіз поштових повідомлень на наявність троянів, вірусів, тощо.

== Технічний дизайн підсистеми

На даній діаграмі зображено компоненти, які входять в _Підсистему поштових повідомлень_ та їх взаємодію з іншими підсистемами в рамках реалізації функціональних сценаріїв.

image::arch:architecture/platform/operational/mail-delivery/mail-subsystem-design.svg[float="center",align="center"]

== Складові підсистеми

|===
|Назва компоненти|Namespace|Deployment|Походження|Репозиторій|Призначення

|_Зворотній проксі-сервер_
|`smtp-server`
|`mailu-front`
|3rd-party
.7+|https://github.com/epam/edp-ddm-smtp-server[github:/epam/edp-ddm-smtp-server]
|Веб-інтерфейс перегляду електронної пошти IMAP

|_Веб-інтерфейс адміністрування Mailu_
|`smtp-server`
|`mailu-admin`
|3rd-party
|Адміністративний веб-інтерфейс для керування платформним поштовим сервером Mailu

|_Веб-інтерфейс IMAP-клієнту_
|`smtp-server`
|`mailu-roundcube`
|3rd-party
|Веб-інтерфейс перегляду електронної пошти IMAP

|_SMTP поштовий сервер_
|`smtp-server`
|`mailu-postfix`
|3rd-party
|Компонент підсистеми, який передає електронні повідомлення за допомогою SMTP протоколу

|_IMAP / POP3 поштовий сервер_
|`smtp-server`
|`mailu-dovecot`
|3rd-party
|Компонент підсистеми, який надає доступ до поштових скриньок за допомогою POP3 та IMAP протоколів

|_Сервіс виявлення та фільтрації спаму_
|`smtp-server`
|`mailu-rspamd`
|3rd-party
|Компонент підсистеми для виявлення спаму на базі попередньо налаштованих правил

|_Сервіс захисту від вірусів_
|`smtp-server`
|`mailu-clamav`
|3rd-party
|Компонент підсистеми для виявлення троянів, вірусів, шкідливих програм та інших зловмисних загроз

|_Сховище даних Rspamd_
|`smtp-server`
|`mailu-redis`
|3rd-party
|Розподілене сховище пар ключ-значення для зберігання даних антиспам фільтрами.
|===

== Технологічний стек

При проектуванні та розробці підсистеми, були використані наступні технології:

* xref:arch:architecture/platform-technologies.adoc#mailu[Mailu]
* xref:arch:architecture/platform-technologies.adoc#postfix[Postfix]
* xref:arch:architecture/platform-technologies.adoc#dovecot[Dovecot]
* xref:arch:architecture/platform-technologies.adoc#rspamd[Rspamd]
* xref:arch:architecture/platform-technologies.adoc#clamav[ClamAV]
* xref:arch:architecture/platform-technologies.adoc#roundcube[Roundcube]
* xref:arch:architecture/platform-technologies.adoc#nginx[Nginx]
* xref:arch:architecture/platform-technologies.adoc#redis[Redis]

== Атрибути якості підсистеми

=== _Security_

Службові веб-інтерфейси _Підсистеми поштових повідомлень_ доступні лише для автентифікованих користувачів через _Підсистему управління зовнішнім трафіком_, а доступ до компонентів підсистеми обмежено мережевими політиками.

_Підсистема поштових повідомлень_ реалізує функції виявлення та фільтрації спаму, виявлення вірусів в поштових повідомленнях та їх блокування.

=== _Scalability_

_Підсистема поштових повідомлень_ підтримує як горизонтальне, так і вертикальне масштабування в залежності від навантаження.
[TIP]
--
Детальніше з масштабуванням підсистем можна ознайомитись у розділі:

* xref:architecture/container-platform/container-platform.adoc[]
--

=== _Observability_

_Підсистеми поштових повідомлень_ надає службові веб-інтерфейси для виявлення та вирішення проблем з відправкою поштових повідомлень, перегляд відправлених та черги повідомлень на відправку, перегляд переліку відфільтрованих / заблокованих повідомлень, тощо.

_Підсистема поштових повідомлень_ підтримує журналювання вхідних запитів та збір метрик продуктивності
для подальшого аналізу через веб-інтерфейси відповідних підсистем Платформи.

[TIP]
--
Детальніше з дизайном підсистем можна ознайомитись у відповідних розділах:

* xref:arch:architecture/platform/operational/logging/overview.adoc[]
* xref:arch:architecture/platform/operational/monitoring/overview.adoc[]
--

=== _Auditability_

Всі події відправки поштових повідомлень фіксуються разом с повним контекстом в журналі аудиту _Підсистемою нотифікацій користувачів_ перед передачею на опрацювання _Підсистемі поштових повідомлень_.

[TIP]
--
Детальніше з дизайном підсистеми можна ознайомитись у відповідних розділах:

* xref:arch:architecture/registry/operational/notifications/overview.adoc#_аудит_та_журналювання_подій[Підсистема нотифікацій користувачів]
--