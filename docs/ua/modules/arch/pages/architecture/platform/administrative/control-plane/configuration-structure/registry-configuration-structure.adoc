= Структура конфігурації Реєстру

[NOTE]
--
Сторінка технічної документації у процесі розробки...
--

include::common/description.adoc[]

[caption=]
.Налаштування реєстру
|===
|Рівень налаштувань|Репозиторій|Шлях|Призначення

.2+|_Реєстр_
.2+|`<registry name>`
|`<<registry-yaml,/deploy-templates/values.yaml>>`
|Загальні налаштування реєстру. Налаштовується адміністратором через адмін-консоль.

|`<<registry-gotmpl,/deploy-templates/values.gotmpl>>`
|Містить шаблони та значення за замовчуванням для системних параметрів реєстру. У більшості випадків не потребує коригувань.

|===

TIP: Детальніше про процеси розгортання конфігурації див. xref:architecture/platform/administrative/config-management/overview.adoc[] та
xref:architecture/platform/administrative/control-plane/overview.adoc[]

== Специфікація yaml конфігурації реєстру (values.yaml)
[[registry-yaml]]
У цьому розділі наведено список загальних параметрів налаштувань реєстру, що налаштовуються адміністраторами через адмін-консоль або через коміт в репозиторій.

=== Загальні параметри реєстру
[[root]]
[cols="20%,15%,7%,7%,60%",options="header",caption=]
.Загальні параметри реєстру
|===
|Поле|Тип|Значення за замовчуванням|Обовʼязкове|Призначення

|`<<administrators,administrators>>`
|[]object
|❌
|✅
|Вказання переліку користувачів реєстру, що мають роль адміністратора Платформи (`cp-registry-admin-<registry-name>`).

|`<<digital-signature,digitalSignature>>`
|object
|❌
|✅
|Налаштування _сервісу цифрового підпису_ Підсистеми цифрових підписів реєстру.

|`<<digital-documents,digitalDocuments>>`
|object
|❌
|✅
|Налаштування обмежень _сервісу цифрових документів_ на завантаження файлів цифрових документів до реєстру користувачами та бізнес-процесами.

|`<<dso,dso>>`
|object
|❌
|✅
|Налаштування реплік _сервісу цифрового підпису_ Підсистеми цифрових підписів реєстру.

|`<<external-systems,external-systems>>`
|[]object
|❌
|✅
|Налаштування взаємодії з іншими зовнішніми системами.

|`<<global,global>>`
|object
|❌
|✅
|Глобальні налаштування реєстру

|`<<griada,griada>>`
|object
|❌
|✅
|Глобальні налаштування програмно-апаратного криптомодуля "Гряда".

|`<<keycloak,keycloak>>`
|object
|❌
|✅
|Налаштування _сервісу управління користувачами та ролями_.

|`<<kongPluginsConfig,kongPluginsConfig>>`
|object
|❌
|✅
|Налаштування плагінів _зовнішнього API-шлюзу операційної зони реєстру_.

|`<<nontrembita-external-registration,nontrembita-external-registration>>`
|[]object
|❌
|✅
|Налаштування плагінів _зовнішнього API-шлюзу операційної зони реєстру_.

|`<<portals,portals>>`
|object
|❌
|✅
|Налаштування кабінетів користувача.

|`<<redash,redash>>`
|object
|❌
|✅
|Налаштування підсистеми аналітичної звітності реєстру.

|`registryVaultPath`
|string
|registry-kv/registry/<registry_name>
|✅
|Шлях до реєстрового Vault Engine в cервісі управління секретами та шифруванням Hashicorp Vault.

|`<<signWidget,signWidget>>`
|object
|❌
|✅
|Налаштування IIT-віджету автентифікації.

|`<<trembita,trembita>>`
|object
|❌
|✅
|Налаштування _шлюзу безпечного обміну "Трембіта"_.

|===

=== Параметри налаштувань сервісу цифрових документів
`digitalDocuments` містить налаштування сервісу цифрових документів.

[[digital-documents]]
[cols="20%,10%,5%,5%,60%",options="header",caption=]
.digitalDocuments | <<parent-digital-documents,Повернутись на батьківську таблицю>>
|===
|Поле|Тип|Значення за замовчуванням|Обовʼязкове|Призначення

|`maxFileSize`
|string
|100MB
|✅
|Максимальний розмір файлу для завантаження, MB

|`maxTotalFileSize`
|string
|100MB
|✅
|Макс. сумарний розмір групи файлів для завантаження, MB

|===

[source,yaml]
.Приклад специфікації налаштування digitalDocuments
----
digitalDocuments:
    maxFileSize: 100MB
    maxTotalFileSize: 100MB
----

=== Параметри налаштувань адміністраторів реєстру
`administrators` містить перелік адміністраторів реєстру.

[[administrators]]
[cols="20%,10%,5%,5%,60%",options="header",caption=]
.administrators | <<root,Повернутись на батьківську таблицю>>
|===
|Поле|Тип|Значення за замовчуванням|Обовʼязкове|Призначення

|`email`
|string
|❌
|✅
|Адреса електронної пошти, що ідентифікує користувача.

|`firstName`
|string
|❌
|✅
|Імʼя користувача

|`lastName`
|string
|❌
|✅
|Прізвище користувача

|`passwordVaultSecret`
|string
|❌
|✅
|Шлях до тимчасового пароля в _Сервісі управління секретами та шифруванням_ Hashicorp Vault.

|`passwordVaultSecretKey`
|string
|❌
|✅
|Ключ для пошуку тимчасового пароля в _Сервісі управління секретами та шифруванням_ Hashicorp Vault.

|`username`
|string
|❌
|✅
|Імʼя акаунту користувача. Дорівнює полю `email`.

|===

[source,yaml]
.Приклад специфікації налаштування адміністраторів
----
administrators:
    - email: user@company.com
      firstName: user
      lastName: user
      passwordVaultSecret: registry-kv/cluster/user@company.com
      passwordVaultSecretKey: password
      username: user@company.com
----

=== Параметри налаштувань сервісу цифрового підпису реєстру

`digitalSignature` містить перелік налаштувань сервісу цифрового підпису реєстру

[[digital-signature]]
[cols="20%,10%,5%,5%,60%",options="header",caption=]
.digitalSignature | <<root,Повернутись на батьківську таблицю>>
|===
|Поле|Тип|Значення за замовчуванням|Обовʼязкове|Призначення

|`<<digital-signature-data,data>>`
|object
|❌
|✅
|Налаштування ключів сервісу цифрового підпису реєстру.

|`<<digital-signature-env,env>>`
|object
|❌
|✅
|Налаштування оточення сервісу цифрового підпису реєстру.

|===

[[digital-signature-data]]
[cols="20%,10%,5%,5%,60%",options="header",caption=]
.data | <<digital-signature,Повернутись на батьківську таблицю>>
|===
|Поле|Тип|Значення за замовчуванням|Обовʼязкове|Призначення

|`Key-6-dat`
|string
|❌
|✅
|Шлях до приватного файлового ключа організації в _Сервісі управління секретами та шифруванням_ Hashicorp Vault.

|`allowed-keys-yml`
|string
|❌
|✅
|Шлях до файлу з переліком атрибутів дозволених (або раніше виданих) ключів в _Сервісі управління секретами та шифруванням_ Hashicorp Vault.

|`osplm.ini`
|string
|❌
|✅
|Шлях до конфігураційного файлу програмно-апаратного криптомодуля "Гряда" в _Сервісі управління секретами та шифруванням_ Hashicorp Vault. Використовується тільки з апаратним типом ключа.

|===

[[digital-signature-env]]
[cols="20%,10%,5%,5%,60%",options="header",caption=]
.env | <<digital-signature,Повернутись на батьківську таблицю>>
|===
|Поле|Тип|Значення за замовчуванням|Обовʼязкове|Призначення

|`sign.key.device-type`
|string
|❌
|✅
|Визначає тип ключа що використовується реєстром. Допустимі значення `file` або `hardware`.

|`sign.key.file.issuer`
|string
|❌
|✅
|Шлях до інформації про емітента приватного ключа організації. в _Сервісі управління секретами та шифруванням_ Hashicorp Vault.

|`sign.key.file.password`
|string
|❌
|✅
|Шлях до пароля приватного ключа організації. в _Сервісі управління секретами та шифруванням_ Hashicorp Vault.

|`sign.key.hardware.device`
|string
|❌
|✅
|Шлях до інформації про серійний номер, хост та порт апаратного екземпляра Гряди в _Сервісі управління секретами та шифруванням_ Hashicorp Vault. Використовується тільки з апаратним типом ключа.

|`sign.key.hardware.password`
|string
|❌
|✅
|Шлях до пароля апаратного екземпляра Гряди в _Сервісі управління секретами та шифруванням_ Hashicorp Vault. Використовується тільки з апаратним типом ключа.

|`sign.key.hardware.type`
|string
|❌
|✅
|Шлях до типу апаратного екземпляра Гряди в _Сервісі управління секретами та шифруванням_ Hashicorp Vault. Використовується тільки з апаратним типом ключа.

|===

[source,yaml]
.Приклад специфікації налаштування сервісу цифрового підпису реєстру
----
digital-signature:
    data:
        Key-6-dat: registry-kv/registry/<registry_name>/key-management-20231608T063220Z
        allowed-keys-yml: registry-kv/registry/<registry_name>/key-management-20231608T063220Z
        osplm.ini: ""
    env:
        sign.key.device-type: file
        sign.key.file.issuer: registry-kv/registry/<registry_name>/key-management-20231608T063220Z
        sign.key.file.password: registry-kv/registry/<registry_name>/key-management-20231608T063220Z
        sign.key.hardware.device: ""
        sign.key.hardware.password: ""
        sign.key.hardware.type: ""
----

`dso` містить перелік налаштувань кількості реплік сервісу цифрового підпису реєстру

[[dso]]
[cols="20%,10%,5%,5%,60%",options="header",caption=]
.dso | <<root,Повернутись на батьківську таблицю>>
|===
|Поле|Тип|Значення за замовчуванням|Обовʼязкове|Призначення

|`maxReplicas`
|int
|3
|❌
|Поле для вказання максимальної кількості реплік компонента.

|`minReplicas`
|int
|1
|❌
|Поле для вказання мінімальної кількості реплік компонента.

|===

=== Глобальні параметри налаштувань реєстру

`global` мість глобальні параметри реєстру, що не були класифіковані в окремі розділи.

[[global]]
[cols="20%,10%,5%,5%,60%",options="header",caption=]
.global | <<root,Повернутись на батьківську таблицю>>
|===
|Поле|Тип|Значення за замовчуванням|Обовʼязкове|Призначення

|`deploymentMode`
|string
|development
|✅
|Налаштування режиму розгортання реєстру. Детальніше див. xref:registry-develop:registry-admin/change-dev-prod-mode.adoc[Налаштування режиму розгортання реєстру].

|`<<whitelistip,whiteListIP>>`
|object
|❌
|✅
|Налаштування доступів до реєстрових сервісів.

|`<<excludePortals,excludePortals>>`
|[]object
|❌
|✅
|Перелік користувацьких порталів, що не будуть розгортатись в реєстрі.

|`<<bpAdminPortal,bpAdminPortal>>`
|object
|❌
|✅
|

|`<<crunchyPostgres,crunchyPostgres>>`
|object
|❌
|✅
|

|`<<kafkaOperator,kafkaOperator>>`
|object
|❌
|✅
|

|`<<notifications,notifications>>`
|object
|❌
|✅
|

|`<<registry,registry>>`
|object
|❌
|✅
|

|`<<registryBackup,registryBackup>>`
|object
|❌
|✅
|

|`<<regulationManagement,regulationManagement>>`
|object
|❌
|✅
|

|===

=== Параметри налаштувань програмно-апаратного криптомодуля "Гряда"

`griada` містить налаштувань програмно-апаратного криптомодуля "Гряда".

[[griada]]
[cols="20%,10%,5%,5%,60%",options="header",caption=]
.griada | <<root,Повернутись на батьківську таблицю>>
|===
|Поле|Тип|Значення за замовчуванням|Обовʼязкове|Призначення

|`enabled`
|bool
|true
|✅
|Визначає використання чи відсутність апаратного ключа в реєстрі.

|===

=== Параметри налаштувань доступів до реєстрових сервісів

`whiteListIP` містить параметри конфігурації доступів до реєстрових сервісів.

[[whitelistip]]
[cols="20%,10%,5%,5%,60%",options="header",caption=]
.whiteListIP | <<global,Повернутись на батьківську таблицю>>
|===
|Поле|Тип|Значення за замовчуванням|Обовʼязкове|Призначення

|`adminRoutes`
|string
|0.0.0.0/0
|✅
|Налаштування доступу до роутів адміністративних сервісів реєстру.

|===

=== Параметри налаштувань IIT-віджету автентифікації

`signWidget` містить параметри конфігурації IIT-віджету автентифікації.

[[signWidget]]
[cols="20%,10%,5%,5%,60%",options="header",caption=]
.signWidget | <<root,Повернутись на батьківську таблицю>>
|===
|Поле|Тип|Значення за замовчуванням|Обовʼязкове|Призначення

|`copyFromAuthWidget`
|bool
|false
|✅
|

|`height`
|int
|0
|✅
|

|`url`
|string
|❌
|✅
|

|===

=== Параметри реєстрових налаштувань сервісу управління користувачами та ролями

`keycloak` містить перелік налаштувань сервісу управління користувачами та ролями.

=== Параметри реєстрових налаштувань зовнішнього API-шлюзу операційної зони реєстру

`kongPluginsConfig` містить перелік налаштувань зовнішнього API-шлюзу операційної зони реєстру.

[[kongPluginsConfig]]
[cols="20%,15%,7%,7%,60%",options="header",caption=]
.kongPluginsConfig | <<root,Повернутись на батьківську таблицю>>
|===
|Поле| **Тип** | **Значення за замовчуванням** | **Обовʼязкове** | **Призначення**

|`pluginsPrometheusBandwidthMetrics`
|bool
|true
|✅
|Налаштування

|`pluginsPrometheusLatencyMetrics`
|bool
|true
|✅
|Налаштування

|`pluginsPrometheusPerConsumerMetrics`
|bool
|true
|✅
|Налаштування

|`pluginsPrometheusStatusCodeMetrics`
|bool
|true
|✅
|Налаштування

|`pluginsProxyCacheTtl`
|int
|900
|✅
|Налаштування

|`pluginsRateLimitByHeaderFaultTolerant`
|bool
|true
|✅
|Налаштування

|`pluginsRateLimitByHeaderHeaderName`
|string
|token-claim
|✅
|Налаштування

|`pluginsRateLimitByHeaderHideClientHeaders`
|bool
|false
|✅
|Налаштування

|`pluginsRateLimitByHeaderPolicy`
|string
|local
|✅
|Налаштування

|`pluginsRateLimitByHeaderRequestsPerHour`
|int
|10000
|✅
|Налаштування

|`pluginsRateLimitByHeaderRequestsPerSecond`
|int
|10
|✅
|Налаштування

|`pluginsRateLimitByIpFaultTolerant`
|bool
|true
|✅
|Налаштування

|`pluginsRateLimitByIpHideClientHeaders`
|bool
|false
|✅
|Налаштування

|`pluginsRateLimitByIpPolicy`
|string
|local
|✅
|Налаштування

|`pluginsRateLimitByIpRequestsPerHour`
|int
|10000
|✅
|Налаштування

|`pluginsRateLimitByIpRequestsPerSecond`
|int
|10
|✅
|Налаштування

|`rateLimitingPluginEnable`
|bool
|false
|✅
|Налаштування

|===

=== Параметри налаштувань доступів для реєстрів Платформи та зовнішніх систем

`nontrembita-external-registration` містить перелік налаштувань доступів для реєстрів Платформи та зовнішніх систем.
[[nontrembita-external-registration]]
[cols="20%,15%,7%,7%,60%",options="header",caption=]
.nontrembita-external-registration | <<root,Повернутись на батьківську таблицю>>
|===
|Поле| **Тип** | **Значення за замовчуванням** | **Обовʼязкове** | **Призначення**

|`enabled`
|bool
|❌
|❌
|

|`external`
|bool
|❌
|❌
|

|`name`
|string
|❌
|❌
|

|===

=== Параметри налаштувань шлюзу безпечного обміну "Трембіта"

`trembita` містить перелік налаштувань шлюзу безпечного обміну "Трембіта".
[[trembita]]
[cols="20%,15%,7%,7%,60%",options="header",caption=]
.trembita | <<root,Повернутись на батьківську таблицю>>
|===
|Поле| **Тип** | **Значення за замовчуванням** | **Обовʼязкове** | **Призначення**

|`<<ipList,ipList>>`
|[]object
|
|
|

|`<<registries,registries>>`
|object
|
|
|

|===

=== Параметри налаштувань інтеграції з зовнішніми системами

`external-systems` налаштовують інтеграції з зовнішніми системами.
[[external-systems]]
[cols="20%,15%,7%,7%,60%",options="header",caption=]
.external-systems | <<root,Повернутись на батьківську таблицю>>
|===
|Поле| **Тип** | **Значення за замовчуванням** | **Обовʼязкове** | **Призначення**

|<<external-systems-spec,diia>>
|object
|❌
|✅
|Системна інтеграція з ДіЯ. Присутня за замовчуванням і недоступна для видалення.

|<<external-systems-spec,<system_name_placeholder> >>
|object
|❌
|✅
|Параметри зовнішньої системи для інтеграції з реєстром.

|===

[[external-systems-spec]]
[cols="20%,15%,7%,7%,60%",options="header",caption=]
.external-systems spec | <<external-systems,Повернутись на батьківську таблицю>>
|===
|Поле| **Тип** | **Значення за замовчуванням** | **Обовʼязкове** | **Призначення**

|`protocol`
|string
|❌
|✅
|

|`type`
|string
|❌
|✅
|

|`url`
|string
|❌
|✅
|

|`mock`
|string
|❌
|✅
|

|`<<external-systems-auth-spec,auth>>`
|object
|❌
|✅
|

|===

[[external-systems-auth-spec]]
[cols="20%,15%,7%,7%,60%",options="header",caption=]
.external-systems-auth spec | <<external-systems-spec,Повернутись на батьківську таблицю>>
|===
|Поле| **Тип** | **Значення за замовчуванням** | **Обовʼязкове** | **Призначення**

|`secret`
|string
|❌
|✅
|

|`type`
|string
|❌
|✅
|

|===

=== Параметри налаштувань кабінетів користувачів

`portals` налаштування кабінетів користувачів.
[[portals]]
[cols="20%,15%,7%,7%,60%",options="header",caption=]
.portals | <<root,Повернутись на батьківську таблицю>>
|===
|Поле| **Тип** | **Значення за замовчуванням** | **Обовʼязкове** | **Призначення**

|`<<portals-spec,citizen>>`
|object
|❌
|✅
|Налаштування кабінету отримувача послуг.

|`<<portals-spec,officer>>`
|object
|❌
|✅
|Налаштування кабінету надавача послуг.

|===

[[portals-spec]]
[cols="20%,15%,7%,7%,60%",options="header",caption=]
.portals | <<root,Повернутись на батьківську таблицю>>
|===
|Поле| **Тип** | **Значення за замовчуванням** | **Обовʼязкове** | **Призначення**

|`<<customdns-spec,customDns>>`
|object
|❌
|✅
|Налаштування власних DNS-імен для кабінетів користувачів.

|`<<signwidget-spec,signWidget>>`
|object
|❌
|✅
|Налаштування IIT-віджету авторизації для кабінетів користувачів.

|===

[[customdns-spec]]
[cols="20%,15%,7%,7%,60%",options="header",caption=]
.customDns | <<portals-spec,Повернутись на батьківську таблицю>>
|===
|Поле| **Тип** | **Значення за замовчуванням** | **Обовʼязкове** | **Призначення**

|`enabled`
|bool
|❌
|✅
|

|`host`
|string
|❌
|❌
|

|===

[[signwidget-spec]]
[cols="20%,15%,7%,7%,60%",options="header",caption=]
.signWidget | <<portals-spec,Повернутись на батьківську таблицю>>
|===
|Поле| **Тип** | **Значення за замовчуванням** | **Обовʼязкове** | **Призначення**

|`url`
|string
|❌
|✅
|

|`height`
|object
|❌
|✅
|

|`copyFromAuthWidget`
|bool
|❌
|✅
|

|===


== Специфікація технічної yaml конфігурації реєстру (values.gotmpl)
[[registry-gotmpl]]

IMPORTANT: Власноруч вносити зміни в цей файл не рекомендується.
