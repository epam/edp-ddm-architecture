= Мінімізація кількості шаблонів розгортання реєстру

== Загальний опис

== Актори та ролі користувачів
* Службові адміністратори

== Загальні принципи та положення

== Функціональні сценарії

== Поточна реалізація

== Цільовий дизайн

Адмін-консоль має розпізнавати тип інфраструктури на якій розгорнутий кластер OpenShift (AWS, vSphere тощо). Це можна зробити через ресурс:

----
oc get infrastructure cluster -o jsonpath='{.status.platformStatus.type}'
----

На основі типа інфраструктури мають відображатись відповідні параметри для налаштування віртуальних машин реєстру.

=== Цільові кластери

=== Оточення для розробки CICD2

=== Перелік параметрів для винесення на рівень адмін-консолі

WARNING: Наступний перелік параметрів не вичерпний, а мінімально необхідний для зменшення кількості темплейтів до одного і може розширюватись за потребою.

[cols="5*",options="header"]
.spec parameters
|===
|Поле|Тип|Значення за замовчуванням|Приналежність|Призначення

|`griada`
|<<griada,griada>>
|-
|Registry values.yaml
|Налаштування програмно-апаратного криптомодуля "Гряда"

|`global`
|<<global,global>>
|-
|Registry values.yaml

Cluster values.yaml
|Глобальні параметри налаштувань реєстрів або Платформи

|===

[[griada]]
[cols="4*",options="header"]
.griada object
|===
|Поле|Тип|Значення за замовчуванням|Призначення

|`enabled`
|string
|Пусте значення. Встановлюється в залежності від попередньо заданого типу носія ключа на табі "Дані про ключ". Файловий носій
— `false`, апаратний — `true`.
|Поле для вказання, чи використовується апаратний ключ для реєстру.

|`ip`
|string
|Пусте значення. Задається з поля `Хост ключа` на табі "Дані про ключ" при вибраному апаратному носію ключа.
|Поле для вказання ip-адреси програмно-апаратного криптомодуля "Гряда".

|`port`
|string
|Пусте значення. Задається з поля `Порт ключа` на табі "Дані про ключ" при вибраному апаратному носію ключа.
|Поле для вказання порту програмно-апаратного криптомодуля "Гряда".

|===

WARNING: Параметр `griada.url` не виноситься на рівень адмін-консолі за відсутністю кейсів використання, а залишається доступним для зміни через комміт в Gerrit.
При цьому, Griada ServiceEntry не повинен створюватись, якщо url не заданий явно.

[[global]]
[cols="5*",options="header"]
.global object
|===
|Поле|Тип|Значення за замовчуванням|Приналежність|Призначення

|`geoServer`
|bool
|`false`
|Registry helmfile.yaml
|Поле для вказання, чи має бути розгорнута _підсистема управління геоданими_.

|`deploymentMode`
|string
|`development`
|Registry values.yaml

Cluster values.yaml
|Поле для вказання режиму розгортання реєстру. Дозволені значення `development` або `production`.

|`excludePortals`
|list
|Пусте значення.
|Registry values.yaml
|Поле для вказання, які портали не мають бути розгорнуті. За замовчуванням розгортаються всі. Дозволені значення в листі `citizen-portal`, `officer-portal`, `admin-portal`.

|`computeResources`
|<<computeResources,computeResources>>
|Пусте значення.
|Registry values.yaml
|Поле для вказання, які портали не мають бути розгорнуті. За замовчуванням розгортаються всі.

|===

[[computeResources]]
[cols="4*",options="header"]
.computeResources object
|===
|Поле|Тип|Значення за замовчуванням|Призначення

|`instanceCount`
|integer
|`2`
|Поле для вказання кількості віртуальних машин для розгортання реєстру з типом інфраструктури `AWS` або `vSphere`.

|`awsInstanceType`
|string
|`r5.2xlarge`
|Поле для вказання типу AWS EC2-інстансу для розгортання реєстру з типом інфраструктури `AWS`.

|`awsSpotInstance`
|bool
|`false`
|Поле для вказання spot типу для AWS EC2-інстансу реєстру

|`awsSpotInstanceMaxPrice`
|string
|Пусте значення
|Поле для вказання spot типу для AWS EC2-інстансу реєстру

|`awsInstanceVolumeType`
|string
|`gp3`
|Поле для вказання типу системного диска AWS EC2-інстансу для розгортання реєстру з типом інфраструктури `AWS`.

|`instanceVolumeSize`
|integer
|`80`
|Поле для вказання розміру системного диска віртуальної машини реєстру з типом інфраструктури `AWS` або `vSphere`.

|`vSphereInstanceCPUCount`
|integer
|`8`
|Поле для вказання кількості vCPU віртуальної машини реєстру з типом інфраструктури `vSphere`.

|`vSphereInstanceCoresPerCPUCount`
|integer
|`1`
|Поле для вказання кількості ядер у кожного vCPU віртуальної машини реєстру з типом інфраструктури `vSphere`.

|`vSphereInstanceRAMSize`
|integer
|`32768`
|Поле для вказання кількості RAM віртуальної машини реєстру з типом інфраструктури `vSphere`.

|===

=== Компоненти системи та їх призначення в рамках дизайну рішення

[cols="3*",options="header"]
.Компоненти підсистеми
|===
|Компонент|Службова назва|Призначення / Суть змін

|-
|control-plane-gerrit
|-

|-
|edp-library-pipelines(stages)-fork
|-

|===

== Високорівневий план розробки
=== Технічні експертизи
* _DevOps_
* _FE_

=== План розробки
