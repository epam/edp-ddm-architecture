= Локалізація реєстру

== Загальний опис

Адміністратор реєстру повинен мати можливість обрати мову для порталу моделювання реєстру.

== Актори та ролі користувачів

* Адміністратор платформи
* Технічний адміністратор реєстру
* Моделювальник реєстру

== Функціональні сценарії

* Управління налаштуванням мови реєстру у control-plane-console.
* Перегляд та використання інтерфейсу admin portal у обраній мові.

== Загальні принципи та положення

* Мову обирає технічний адміністратор реєстру, а не користувач застосунків для зменшення складності рішення.
* В майбутньому користувачі зможуть обирати мову самі
* Застосування змін потребує оновлення файлів у git та пере розгортання кабінетів та сервісів
* Зараз небхідно додати дві мови - англійську та українську
* За замовчуванням обрано мову платформи
* Переклади зберігаються у вигляді файлів у JSON-форматі стандартизованої структури

== Компоненти системи та їх призначення в рамках дизайну рішення

У даному розділі наведено перелік компонент системи, які задіяні або потребують змін в рамках реалізації функціональних вимог.

|===
|Підсистема|Компонент|Опис змін

|Підсистема управління Платформою та Реєстрами
|*control-plane-console*
|Розширення інтерфейсу управління реєстру налаштуванням мови.

|Підсистема управління Реєстром
|*registry-regulation-management*
|Додати локалізацію з використанням JSON файлів з конфіг мапи та локалі з env змінної.

|Портал управління Реєстром
|*admin-portal*
|Нормалізувати переклади переклавши усі в один файл. Використовувати локаль с Config Map для вибору мови.

|===

== Ключові сценарії

=== Зміна мови реєстру

- перехід у налаштування реєстру
- перехід на вкладку Загальне
- на цій вкладці обрати нову мову із запропонованих та зберегти зміни
- прийняти зміни та дочекатись редеплою порталів з новою env змінною та Config Map.
- сторінки тепер завантажуються новою мовою

=== Інтерфейси адміністратора

Зміна мови реєстру:

image::architecture-workspace/platform-evolution/localization/registry_locale_edit.png[]

Перегляд обраної мови:

image::architecture-workspace/platform-evolution/localization/registry_locale_view.png[]

== Міграція існуючих реєстрів при оновленні

Усі існуючи реєстри мають поставити змінну `global.language` з файла `values.yaml` у значення `uk`, бо значення за замовчуванням - `en`.

== Високорівневий план розробки

=== Технічні експертизи

* Devops
* BE (Java)
* FE (vue)
* FE (react)

=== Дизайн рішення

.Передача мови платформи
image::arch:architecture-workspace/platform-evolution/localization/localization_admin_portal.svg[]

[source,yaml]
.:registry/deploy-templates/values.yaml
----
global:
  language: uk
----

[source,js]
.environment.js
----
const ENVIRONMENT_VARIABLES = {
  language: 'uk'
  /*...*/
};
----

[source,yaml]
.registry-regulation-management/deploy-templates/templates/deployment.yaml
----
env:
    - name: OPENSHIFT_NAMESPACE
      value: {{ .Values.global.language }}
----

=== План розробки

* Додати на вкладку `Загальне` налаштувань реєстру можливість вибору мови та обробити запит на оновлення цьєї змінної (у `values.yaml`)
** Доступні дві мови - English (en) та Українська (uk)
** Зберігати необхідно саме https://www.w3schools.com/tags/ref_language_codes.asp[HTML language codes]
* Зробити змінну обраної мови доступною:
** для registry-regulation-management як environment variable (Devops).
** частиною Config Map (`environment.js`) у common-web-app (Devops).
* На admin-portal:
** Нормалізувати переклади та перекласти їх усі в один файл
** Сформувати файл з англомовними перекладами
** Зробити ці файли доступними через Config Map в інших сервісах (Devops)
* На registry-regulation-management використовуючи JSON з Config map та обрану локаль з environment variable додати переклад до усіх текстів які може побачити користувач (enum, помилки тощо), а також додати логіку локалі до валідаційних перевірок, форматів дат тощо.
** Зробити registry-regulation-management залежним від common-web-app - щоб він розгортався пізніше, бо необхідний сервісу Config Map додається саме у common-web-app (*_needs_* в helmfile)

=== Особливості файлів з перекладом

- Бекенд та фронтенд використовують одні й ті самі файли перекладу у форматі JSON
- Файли перекладу розташовані у репозиторії common-web-app
- Всі файли перекладу потрапляють у Config Map з репозиторію common-web-app
- Ця Config Map буде використовуватись на всіх сервісах де це потрібно
- У admin-portal (розташован у common-web-app) треба переформатувати файли перекладу та скласти усі тексти в один файл
- Частина перекладу треба при форматуванні перекласти з web-components

== Поза скоупом

* Моделювальних реєстру чи адміністратор реєстру обирає свою індивідуальну мову інтерфейсу
