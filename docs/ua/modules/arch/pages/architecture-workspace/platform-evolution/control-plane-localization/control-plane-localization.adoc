= Локалізація control-plane

== Загальний опис

Адміністратор повинен мати можливість обрати мову для інтерфейсів платформи. Зараз розглянемо як цей вибір позначається на інтерфейсах control-plane-console.

== Актори та ролі користувачів

* Адміністратор платформи
* Технічний адміністратор реєстру

== Функціональні сценарії

* Управління налаштуванням мови платформи.
* Перегляд та використання інтерфейсу control plane console у обраній мові.

== Загальні принципи та положення

* Мову обирає адміністратор платформи, а не користувач застосунків (для зменшення складності рішення).
* Застосування змін потребує оновлення файлів у git та пере-розгортання cp консолі
* Зараз необхідно додати дві мови - англійську та українську
* За замовчуванням обрано англійську
* Переклади зберігаються у вигляді файлів у JSON-форматі стандартизованої структури
* +++<del>+++Технічний адміністратор платформи обирає свою індивідуальну мову інтерфейсу+++</del>+++ (out of scope)

== Компоненти системи та їх призначення в рамках дизайну рішення

У даному розділі наведено перелік компонент системи, які задіяні або потребують змін в рамках реалізації функціональних вимог.

|===
|Підсистема|Компонент|Опис змін

.2+|Підсистема управління Платформою та Реєстрами
|*control-plane-console*
|Розширення інтерфейсу управління платформою налаштуванням мови. Додавання механізму зміни мови у *control-plane-console*. Фактичний переклад на дві мови - англійська та українська.

|===

== Ключові сценарії

=== Зміна мови платформи

- перехід у налаштування платформи
- перехід на вкладку Загальне
- на цій вкладці обрати нову мову із запропонованих та зберегти зміни
- прийняти зміни та дочекатись редеплою control-plane-console з новою env змінною.
- сторінки тепер завантажуються новою мовою

=== Інтерфейси адміністратора

Зміна мови платформи:

image::architecture-workspace/platform-evolution/localization/platform_locale_edit.png[]

image::architecture-workspace/platform-evolution/localization/platform_locale_view.png[]

== Міграція існуючих реєстрів при оновленні

Усі існуючи екземпляри платформи мають поставити змінну `global.language` з файла `values.yaml` репозиторія `cluster-mgmt` у значення `uk`, бо значення за замовчуванням - `en`.

== Високорівневий план розробки

=== Технічні експертизи

* Devops
* BE (_Go_)
* FE

=== Технології

* `goi18n` для перекладу golang частини та її шаблонів
* `vue-i18n` для перекладу у vue додатку

=== План розробки

* Додати нову вкладку в налаштування платформи - `Загальне`
* Додати на цю вкладку можливість вибору мови та обробити запит на оновлення цьєї змінної (у `values.yaml`)
** Доступні дві мови - English (en) та Українська (uk)
** Зберігати необхідно саме https://www.w3schools.com/tags/ref_language_codes.asp[HTML language codes]
* Зробити змінну обраної мови доступною для control-plane-console як environment variable (control-plane-console вже зараз пере розгортається після змін у gerrit платформи).
* З використанням бібліотеки `goi18n` додати механізм перемикання мов у golang додаток. Файли перекладів зберігаються у json.
* Трансформувати усі тексти які бачить користувач у селектори перекладу. Перетворення стосується як запитів на golang backend так і сторінок які рендеряться з використанням шаблонізатора `go`
* Додати у vue frontend бібліотеку перекладу та механізм перемикання перекладів на основі обраної мови з gerrit. json файли перекладів ті ж самі що і для golang.
* Трансформувати усі тексти vue frontend які бачить користувач у селектори перекладу.

=== Особливості файлів з перекладом

- Бекенд та фронтенд використовують одні й ті самі файли перекладу у форматі JSON.
- Файли зберігаються у репозиторії *control-plane-console*
- Файли перекладу потрапляюсь в артефакт vue додатку
- Локаль передається у vue додаток через go template variable
