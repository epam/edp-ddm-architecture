= Підготовка оточення для запуску тестування навантаження
include::platform:ROOT:partial$templates/document-attributes/default-set-ua.adoc[]


== Підготовка реєстру

=== Налаштування файлу запуску

Для виконання прекондішнів по підготовці до запуску тестів навантаження необхідно підготувати файл, дана конфігурація виконає наступні кроки:

** Створення реєстру за заданою назвою
** Розгортання обраного регламенту
** Додавання доступу для зовнішніх систем
** Налаштування EDR
** Налаштування піблічного доступу до заданого ендпоінту

.Файл підготовки оточення __registry.json__
(xref:arch:attachment$/architecture/performance-testing/registry.json[Завантажити])
[%collapsible, json]
====
----
include::arch:attachment$/architecture/performance-testing/registry.json[json]
----
====

Необхідно налаштувати параметри до котрих додані коментарі

[options="header"]
|===
| Назва секції | Опис
| name
| Назва реєстру. Необхідно вказати назву бажаного реєстру

| isGeoServer
| Присутність геосерверу. True - присутній, False - не присутній


| accessToExternalSystems
| Назва доступу до зовнішньої системи


| publicApiSettings
| Необхідно вказати назву публічного доступу, ендпоіну, ліміту на годину


| template
| Тип реєстру. Productuion - оточення продакшн типу, Development - оточення для розробки


| repository
| Назва регламенту. Доступні регламенти:

* certified-laboratories-registry-regulation
* consent-data

| branch
| Гілка регламенту для разгортання

| regulationDeployOnly
| Тип запуску тестів попереднього розгортання. True - запуск лише розгортання регламенту, False - повний флоу
|===

=== Запуск прекондішн тестів
Для виконнання прекондішн тестів необхідно перейти до Jenkins -> Clusters -> <cluster name> -> <cluster name>-run-installer-validation-tests

* Запуск пайплайну з параметрами

image::testing:perf-test/test-preparation/run-pipeline.png[]

* Обрати виключно параметр RUN_REGISTRY_TESTS

image::testing:perf-test/test-preparation/test-params.png[]

* Вказати tag з Gerrit до відповідного очікуваного регламенту

image::testing:perf-test/test-preparation/set-build.png[]

* Передати підготовлений файл як input param до пайплайну на кроку control-plane-tests

image::testing:perf-test/test-preparation/file-uplpad.png[]


=== Підготовка оточення до проведення тестування навантаження

Для подальшого налаштування реєстру необхідно виконати наступні дії:

* Створення конфіг мапи в опеншифті для тестових користувачів

Конфіг мапа створюється у namespace реєстру який був створений за назвою sign-widget-mock-users

.Файл контенту секрету __sign-widget-mock-users__
(xref:arch:attachment$/architecture/performance-testing/sign-widget-mock-users.yml[Завантажити])
[%collapsible, json]
====
----
include::arch:attachment$/architecture/performance-testing/sign-widget-mock-users.yml[yml]
----
====

* Додати у Control Plane Gerrit, в репозиторії реєстру, файл values.yml наступну змінну

*caIsolation: true*

* Встановити аутентифікацію через браузер у опеншифті

** Необхідно перейти до Пошуку та занайти сутність Keycloak Realms для  реєстру та обрати officer-portal

image::testing:perf-test/test-preparation/keycloak-realm-path.png[]


** Встановити для browser-flow у ресурсі browser

image::testing:perf-test/test-preparation/keycloak-flow.png[]

== Запуск тестування навантаження

Для запуску тестування навантаження необхідно виконати наступні кроки:

* Перейти до Carrier та обрати вкладику Baackend, натиснути кнопку ран навпроти officer-processes

image::testing:perf-test/test-preparation/carrier-perf-start.png[]

* У параметрах задати неймспейс рееєстру та натиснути кнопку start

image::testing:perf-test/test-preparation/carrier-perf-params.png[]

