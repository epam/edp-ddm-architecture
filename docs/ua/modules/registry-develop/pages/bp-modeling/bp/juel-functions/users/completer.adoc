= Функція _completer()_
include::platform:ROOT:partial$templates/document-attributes/default-set-ua.adoc[]

== Опис

JUEL-функція *`completer(String taskDefinitionKey): UserDto`* використовується для отримання даних про виконавця / завершувача завдання користувача (User Task) в рамках бізнес-процесу.

== Параметри

.Параметри функції
|===
|*Аргумент*            | *Опис*
| `taskDefinitionKey` | Ключ завдання, для якого потрібно отримати дані завершувача.
|===

== Що повертає

Ця функція повертає об'єкт типу `UserDto`, що містить дані про виконавця завдання.

.UserDto
|===
|*Поле*            | *Опис*
| `userName`      | Ім'я користувача.
| `accessToken`   | Токен користувача.
| `language`      | Мова користувача.
| `drfo`          | Ідентифікаційний код користувача.
| `edrpou`        | Код ЄДРПОУ користувача.
| `fullName`      | Повне ім'я користувача.
| `roles`         | Ролі користувача.
| `subjectType`   | Тип суб'єкта користувача.
| `isRepresentative` | Чи є користувач представником.
| `attributes`    | Інші атрибути користувача у вигляді ключів-значень.
|===

TIP: Клас `UserDto` є обгорткою даних користувача.

== Методи взаємодії

Функція надає наступні методи:

.Методи взаємодії
|===
|*Метод*            | *Опис*
| `getUserName()`  | Повертає ім'я користувача, що можна використовувати в полях *Assignee* та *Candidate Users* задач користувача.
| `getAccessToken()` | Повертає токен користувача, що можна використовувати в інтеграційних конекторах для дій від імені користувача.
| `getLanguage()` | Повертає мову користувача, що можна використовувати для налаштування інтерфейсу.
| `getDrfo()` | Делегує виклик на `JwtClaimsDto` та повертає Keycloak-атрибут `drfo` користувача.
| `getEdrpou()` | Делегує виклик на `JwtClaimsDto` та повертає Keycloak-атрибут `edrpou` користувача.
| `getFullName()` | Делегує виклик на `JwtClaimsDto` та повертає Keycloak-атрибут `fullName` користувача.
| `getRoles()` | Повертає ролі користувача.
| `getSubjectType()` | Повертає тип суб'єкта користувача.
| `isRepresentative()` | Повертає, чи є користувач представником.
| `getAttributes()` | Повертає інші атрибути користувача у вигляді ключів-значень.
|===

NOTE: Функція `completer()` доступна для використання після успішного завершення користувацької задачі.

Ця функція корисна, коли вам потрібно отримати інформацію про користувача, який завершив певне завдання у бізнес-процесі. Замість того, щоб робити прямі запити до API контексту виконання, ви можете використовувати цю JUEL-функцію прямо в Groovy-редакторі.

== Приклади використання

Цей розділ демонструє приклади використання JUEL-функції у завданнях бізнес-процесу.

[TIP]
====
[%collapsible]
.Де можна знайти приклад бізнес-процесу?
=====
include::partial$snippets/demo-reg-reference-examples-ua.adoc[]

Застосування функції `completer()` представлено у багатьох бізнес-процесах.

Ви можете використати один із багатьох прикладів процесів за пошуком по ключовим словам — *_edit-grid-rows-action_*.

У Кабінеті користувача бізнес-процес буде доступний у розділі *Доступні послуги*.
=====
====

Існує декілька варіантів використання функції `completer()` у бізнес-процесі.

Один із найбільш розповсюджених сценаріїв -- застосування функції в інтеграційних розширеннях (делегатах) для передачі *X-Access-Token* у бізнес-процесі, тобто токена доступу користувача, під яким виконується операція. Цей токен забезпечує повноваження виконавця задачі щодо доступу до даних.

[source,groovy]
----
${completer('Task definition ID').accessToken}
----

* `'Task definition ID'` — ID попередньої задачі користувача.

TIP: Застосування функції `completer()` детально представлено у референтному прикладі на сторінці xref:best-practices/edit-grid-rows-action.adoc[].

== Пов'язані сторінки

* xref:bp-modeling/bp/juel-functions/users/initiator.adoc[]
* xref:bp-modeling/bp/juel-functions/users/system-user.adoc[]
* xref:best-practices/edit-grid-rows-action.adoc[]
