:toc-title: ЗМІСТ
:toc: auto
:toclevels: 5
:experimental:
:important-caption:     ВАЖЛИВО
:note-caption:          ПРИМІТКА
:tip-caption:           ПІДКАЗКА
:warning-caption:       ПОПЕРЕДЖЕННЯ
:caution-caption:       УВАГА
:example-caption:           Приклад
:figure-caption:            Зображення
:table-caption:             Таблиця
:appendix-caption:          Додаток
:sectnums:
:sectnumlevels: 5
:sectanchors:
:sectlinks:
:partnums:

= Каталог типових розширень до бізнес-процесів

[#business-process-modeler-extensions-installation]
== Встановлення каталогу типових розширень до бізнес-процесів

Для спрощення моделювання бізнес-процесів розроблені типові розширення-конектори -- **Element Templates**.

[#preconditions]
=== Передумови

==== Встановлення застосунку Сamunda Modeler

. Завантажте архів із застосунком **Camunda Modeler** за link:https://downloads.camunda.cloud/release/camunda-modeler/4.8.0/[посиланням].
+
[NOTE]
====
Рекомендовано використовувати версію саме 4.8.0 для стабільної роботи системи.
====
. Оберіть продукт **Open Source Modeler** та завантажте відповідну версію, сумісну із вашою операційною системою (наприклад, `Windows 64bit`);
. Після завантаження архіву з додатком, розпакуйте його на локальній машині.
+
[TIP]
====
Папка із застосунком може мати, наприклад, таку назву:

_camunda-modeler-4.8.1-win-x64_
====

==== Встановлення плагіну BPMN Linter

Встановіть плагін **BPMN Linter** для розширення функціональності Camunda та валідації ваших BPMN-діаграм.

. Перейдіть до офіційного репозиторію за https://github.com/camunda/camunda-modeler-linter-plugin[посиланням].

. Натисніть кнопку `Code` -> `Download ZIP` та завантажте архів.
+
image:bp-modeling/bp/element-temp/element-temp-install-bpmnlint.png[]

. Після завантаження, розпакуйте вміст архіву до папки _camunda-modeler-4.8.1-win-x64\resources\plugins_ застосунку Camunda.

. Перезапустіть додадок Camunda Modeler.
. Увімкніть плагін. Для цього натисність *Plugins* -> *BPMN Linter* -> *Toggle Linting*.
+
Альтернативно застосуйте комбінацію клавіш `Ctrl+L`.
+
image:bp-modeling/bp/element-temp/element-temp-turn-on-bpmnlint.png[]
+
TIP: Плагін вмикається та вимикається однаково -- `Ctrl+L`.

[#element-temp-install-windows]
=== Встановлення каталогу типових розширень для Windows OS

Виконайте настанови, подані нижче, для інсталювання каталогу Element Templates.

. Завантажте каталог типових розширень одним зі способів:

* _Спосіб 1._ +
Отримайте каталог з Github-репозиторію за https://github.com/epam/edp-ddm-business-process-modeler-extensions/tree/main/element-templates[посиланням].

* _Спосіб 2._ +
Отримайте каталог із захищеного сховища артефактів **Nexus** за посиланням: `https://nexus-{CP-NAMESPACE}.{DNS-WILDCARD}/[]`:
+
[TIP]
====
`{CP-NAMESPACE}` _та `{DNS-WILDCARD}` є змінними, де `{CP-NAMESPACE}` -- назва namespace (простору імен) у Nexus, а `{DNS-WILDCARD}` -- значення DNS wildcardfootnote:[В системі DNS можна задавати запис за замовчуванням для неоголошених піддоменів. Такий запис називається **wildcard**.].

Наприклад: :: https://nexus.apps.envone.dev.registry.eua.gov.ua/nexus
====

** знайдіть папку _business-process-modeler-extensions_;
** буде показано каталог папок типу _version.build_ (наприклад, _0.0.1-SNAPSHOT.12_);
** оберіть папку з останньою версією;
** оберіть `.zip`-файл у папці, що була відкрита (останньою версією zip може бути, наприклад, файл _business-process-modeler-extensions-1.7.0.zip_);
** на вкладці *Summary* натисніть правою кнопкою миші на посилання `Path`. Таким чином розпочнеться завантаження `.zip`-архіву;

. Розпакуйте із заміною завантажений `.zip`-файл у підпапці _resources_ вашої локальної директорії, де зберігається додаток. Приклад шляху може бути наступним: _C:\Users\Downloads\camunda-modeler-4.8.1-win-x64\resources_.
+
[TIP]
====
* _camunda-modeler-4.8.1-win-x64_ -- локальна директорія, в якій зберігається додаток.
* _resources_ -- папка, що містить розширення (_element-templates_) та плагіни (_plugins_)_.
====

. Підсумкова структура директорії _resources_ має виглядати наступним чином:
+
image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-02.png[]

. Підсумкова структура директорії _element-templates_ має виглядати наступним чином:
+
image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-03.png[]

. Підсумкова структура директорії _plugins_ має виглядати наступним чином:
+
image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-04.png[]

. Перезапустіть додаток Camunda Modeler.
. Перевірте доступність розширень у каталозі при моделюванні бізнес-процесу:

* Створіть задачу -- оберіть *Create Task*.
* Натисніть іконку ключа -- оберіть *Change Type*.
* Вкажіть тип задачі -- сервісна (*Service Task*), користувацька (*User Task*) або *Call Activity*.
* Натисніть кнопку `Open Catalog`. +
В результаті відкриється каталог розширень *Element Templates*, які можна застосувати в процесі моделювання.
+
image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-01.png[]

=== Встановлення каталогу типових розширень для Mac OS

Виконайте настанови, подані нижче, для інсталювання каталогу Element Templates.

. Завантажте каталог розширень до бізнес-процесів за аналогією до пункту xref:#element-temp-install-windows[].
. Відкрийте термінал.
. Перейдіть до локальної директорії розміщення ресурсів Camunda Modeler за допомогою команди:
+
[source, bash]
----
cd ~/Library/Application\ Support/camunda-modeler/resources
----

. Створіть нову директорію під розширення категорії `element templates` у випадку, якщо її там немає, за допомогою команди:
+
[source, bash]
----
mkdir element-templates
----

. Скопіюйте всі JSON-файли розширень із директорії `business-process-modeler-extensions` до директорії, що була створена, за допомогою команди:
+
[source,bash]
----
cp business-process-modeler-extensions/*.json ~/Library/Application\ Support/camunda-modeler/resources/element-templates
----

. Підсумкова структура директорії виглядатиме наступним чином:
+
----
~/Library/Application\ Support/camunda-modeler/resources/element-templates/
----
+
image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-05.jpg[]

. Перезапустіть додаток Camunda Modeler.
. Перевірте доступність розширень у каталозі при моделюванні бізнес-процесу:

* Створіть задачу -- оберіть *Create Task*.
* Натисніть іконку ключа -- оберіть *Change Type*.
* Вкажіть тип задачі -- сервісна (*Service Task*), користувацька (*User Task*) або *Call Activity*.
* Натисніть кнопку `Open Catalog`. +
В результаті відкриється каталог розширень *Element Templates*, які можна застосувати в процесі моделювання.
+
image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-01.png[]

[#business-process-modeler-extensions-configuration]
== Налаштування типових розширень до бізнес-процесів

Цей розділ описує налаштування типових розширень для бізнес-процесів -- **Element Templates**.

Типи задач для застосування розширень ::

Типові розширення **Element Templates** можуть бути застосовані до різних типів задач, наприклад:

* xref:#element-temp-user-task[]
* xref:#element-temp-service-task[]
* xref:#element-temp-call-activity[]
* xref:#element-temp-send-task[]
* xref:#extensions-integrate-bp-another-registries[]

[CAUTION]
====
Налаштування типових розширень-конекторів відбувається у застосунку *Camunda Modeler*.

Перед початком роботи переконайтеся, що виконано всі передумови, описані у розділі xref:business-process-modeler-extensions-installation[Встановлення каталогу типових розширень до бізнес-процесів].
====

[#element-temp-user-task]
=== Типові розширення для користувацьких задач

==== Задача, що потребує валідації підписом особи-отримувача послуг реєстру (Citizen Sign Task)

Розширення використовується для визначення задачі, що потребує валідації підписом особи-отримувача послуг реєстру (може бути доступна тільки ініціаторові бізнес-процесу).

NOTE: _Перш за все, переконайтеся, що папка `/element-templates` містить файл `citizenSignTaskTemplate.json`._

* Відкрийте **User Task**, натисніть кнопку `Open Catalog` та оберіть шаблон (Template) зі списку.
* У полі `Form key` введіть службову назву форми.
* У полі `Assignee` введіть значення `${initiator}`, (для того, щоб призначити задачу одразу користувачеві, що ініціював бізнес-процес) або значення ідентифікатора користувача (для того, щоб призначити задачу одному чітко визначеному користувачу).
* У полі `Candidate users` введіть **список користувачів** (написаних через кому), для котрих задача буде доступною для виконання. В рамках бізнес-процесу кожен користувач зможе цю задачу призначити собі та виконати.
* У полі `Candidate roles` введіть **список ролей** (написаних через кому), для яких задача доступна для виконання. В рамках бізнес-процесу кожен користувач, що має хоча б одну з цих ролей зможе цю задачу призначити собі та виконати (навіть якщо у нього немає доступу до самого бізнес-процесу.

TIP: _Наприклад, бізнес-процес із умовною назвою **bp1** зможе ініціювати лише користувач з роллю `officer-bp1`, хоча задачу в цьому бізнес-процесі, яка доступна ролі `officer-task` зможе виконати користувач, лише маючи одну регламенту роль `officer-task`)._

* Проставте необхідні прапорці у наступних полях, вказавши валідаційний пакет підпису:

** `CITIZEN` -- для регламентної ролі `Фізична особа`;
** `ENTERPRENEUR` -- для регламентної ролі `Фізична особа-підприємець (ФОП)`;
** `LEGAL` -- для регламентної ролі `Юридична особа`.

image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-1.png[]

==== Задача, що потребує валідації підписом посадової особи (Officer Sign Task)

Розширення використовується для визначення задачі, що потребує валідації підписом посадової особи.

NOTE: _Перш за все, переконайтеся, що папка `/element-templates` містить файл `officerSignTaskTemplate.json`._

* Відкрийте **User Task**, натисніть кнопку `Open Catalog` та оберіть шаблон (Template) зі списку.
* У полі `Form key` введіть службову назву форми.
* У полі `Assignee` введіть значення `${initiator}`, (для того, щоб призначити задачу одразу користувачеві, що ініціював бізнес-процес) або значення ідентифікатора користувача (для того, щоб призначити задачу одному чітко визначеному користувачу).

* У полі `Candidate users` введіть **список користувачів** (написаних через кому), для котрих задача буде доступною для виконання. В рамках бізнес-процесу кожен користувач зможе цю задачу призначити собі та виконати.
* У полі `Candidate roles` введіть **список ролей** (написаних через кому), для яких задача доступна для виконання. В рамках бізнес-процесу кожен користувач, що має хоча б одну з цих ролей зможе цю задачу призначити собі та виконати (навіть якщо у нього немає доступу до самого бізнес-процесу.

TIP: _Наприклад, бізнес-процес із умовною назвою **bp1** зможе ініціювати лише користувач з роллю `officer-bp1`, хоча задачу в цьому бізнес-процесі, яка доступна ролі `officer-task` зможе виконати користувач, лише маючи одну регламенту роль `officer-task`)._

image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-2.png[]

==== Користувацька форма (User form)

Розширення використовується для визначення звичайної задачі, що не потребує валідації підписом посадової особи.

NOTE: _Перш за все, переконайтеся, що папка `/element-templates` містить файл `userTaskTemplate.json`._

* Відкрийте **User Task**, натисніть кнопку `Open Catalog` та оберіть шаблон (Template) зі списку.
* У полі `Form key` введіть службову назву форми.
* У полі `Assignee` введіть значення `${initiator}`, (для того, щоб призначити задачу одразу користувачеві, що ініціював бізнес-процес) або значення ідентифікатора користувача (для того, щоб призначити задачу одному чітко визначеному користувачу).

* У полі `Candidate users` введіть **список користувачів** (написаних через кому), для котрих задача буде доступною для виконання. В рамках бізнес-процесу кожен користувач зможе цю задачу призначити собі та виконати.
* У полі `Candidate roles` введіть **список ролей** (написаних через кому), для яких задача доступна для виконання. В рамках бізнес-процесу кожен користувач, що має хоча б одну з цих ролей зможе цю задачу призначити собі та виконати (навіть якщо у нього немає доступу до самого бізнес-процесу.

TIP: _Наприклад, бізнес-процес із умовною назвою **bp1** зможе ініціювати лише користувач з роллю `officer-bp1`, хоча задачу в цьому бізнес-процесі, яка доступна ролі `officer-task` зможе виконати користувач, лише маючи одну регламенту роль `officer-task`)._

image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-3.png[]

[#element-temp-service-task]
=== Типові розширення для сервісних задач

==== Додавання ролі користувачу Keycloak (Add role to Keycloak user)

Розширення використовується для призначення ролі користувача Keycloak.

NOTE: _Перш за все, переконайтеся, що папка `/element-templates` містить файл `addRoleToKeycloakUser.json`._

* Відкрийте **Service Task**, натисніть кнопку `Open Catalog` та оберіть шаблон (Template) зі списку.
* У полі `User name` вкажіть ідентифікатор користувача у Keycloak.
* У полі `Role` вкажіть роль користувача.

image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-4.png[]

[#save-user-roles]
==== Збереження ролей користувачів до Keycloak (Save user roles)

.Короткі відомості про делегат
|===
|Назва | Пояснення

|Бізнес-назва інтеграційного розширення
|*Save user roles*

|Службова назва інтеграційного розширення
|*`${keycloakSaveUserRoleConnectorDelegate}`*

|Назва файлу у бібліотеці розширень
|*_keycloakSaveUserRoleConnectorDelegate.json_*
|===

Загальний опис ::

Загальне інтеграційне розширення-делегат надає можливість взаємодіяти із сервіс управління ідентифікацією та доступом *Keycloak* для зміни ролей користувача. Делегат налаштовується у сервісних задачах (*Service Task*) бізнес-процесу за допомогою шаблону *Save user roles*.

Налаштування ::

. Створіть *Service Task*.
. У полі *`Name`* вкажіть назву сервісної задачі.
. Застосуйте шаблон делегата *Save user roles* зі списку доступних у каталозі.

. У секції *Inputs > Roles* передайте ролі, які необхідно призначити користувачу. Наприклад, `officer`.
+
[NOTE]
====
У нашому прикладі передається одна роль (`officer`) масивом (`List`).

Доступні типи змінних, через які можна передати ролі:

* *`List`* -- список/масив;
* *`Map`* -- ключі-значення;
* *`Script`* -- скрипт;
* *`String or expression`* -- рядок або вираз.
====
+
.Масив ролей, які необхідно призначити користувачу
====
[source,list]
----
['officer', 'manager1', 'manager2']
----
* `officer` -- системна роль, яка призначається користувачу після реєстрації.
* `manager1` та `manager2` -- можуть бути регламентними ролями у реєстрі.
====

. Вкажіть ім'я користувача (*`username`*) у системі Keycloak. Це можна зробити, наприклад, за допомогою juel-функції *`initiator()`*:
+
----
${initiator().userName}
----

. Оберіть реалм Keycloak, до якого відноситься користувач. Наприклад, *`officer`*, при реєстрації посадових осіб.
+
Доступні опції реалмів:

* *`CITIZEN`* -- реалм, в якому зберігаються отримувачі послуг та їх ролі.
* *`OFFICER`* -- реалм, в якому зберігаються посадові особи (надавачі послуг) та їх ролі.

. Вкажіть тип ролей, які можуть бути змінені для користувача. Доступні опції:

* *`ALL ROLES`* -- усі поточні ролі будуть заміщені переліком ролей, вказаних у секції `Roles`.
* *`PLATFORM ROLES`* -- поточні системні ролі, призначені користувачу, будуть заміщені переліком ролей, вказаних у секції `Roles`. Поточні регламентні/реєстрові ролі залишаться без змін.
* *`REGISTRY ROLES`* -- у користувача будуть заміщені лише регламентні/реєстрові ролі.

+
[NOTE]
====
* Якщо при налаштуванні делегата як input-параметри передати масив ролей, одна з яких -- системна, а дві інші - регламентні (_тут_ -- `officer` та `manager1` і `manager2`), то необхідно обрати опцію *`ALL ROLES`*.

* Якщо при налаштуванні делегата передати системну роль (_тут_ -- *`officer`*), то необхідно обрати опцію *`PLATFORM ROLES`*.

* Якщо при налаштуванні делегата передати регламентні ролі (_тут_ -- `manager1` і `manager2`), то необхідно обрати опцію *`REGISTRY ROLES`*.
====

image:bp-modeling/bp/element-temp/service-task/save-user-roles/delegate-save-user-roles-1.png[]

[#batch-creation-entities-v1]
==== Створення сутностей масивом у фабриці даних (Batch creation of entities in data factory)

CAUTION: Новіша версія цього інтеграційного розширення описана нижче, у розділі xref:#batch-creation-entities-v2[].

.Короткі відомості про делегат
|===
|Назва | Пояснення

|Бізнес-назва інтеграційного розширення
|*Batch creation of entities in data factory*

|Службова назва інтеграційного розширення
|*`${dataFactoryConnectorBatchCreateDelegate}`*

|Назва файлу у бібліотеці розширень
|*_dataFactoryConnectorBatchCreateDelegate.json_*
|===

Загальний опис ::

Загальне інтеграційне розширення-делегат надає можливість взаємодіяти з REST API реєстру та створювати сутності у базі даних масивом. Делегат налаштовується у сервісних задачах (*Service Task*) бізнес-процесу за допомогою шаблону *Batch creation of entities in data factory*.

Налаштування шаблону у бізнес-процесі: ::
+
NOTE: При налаштуванні делегата у додатку Camunda Modeler, переконайтеся, що папка із застосунком *_resources > element-templates_* містить файл *_dataFactoryConnectorBatchCreateDelegate.json_*.

. Відкрийте *Service Task*, натисніть kbd:[*Open Catalog*] та оберіть шаблон зі списку, після чого натисніть kbd:[*Apply*].
+
image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-5.png[]

. У полі `Name` вкажіть назву задачі.
. У полі `Resource` вкажіть ресурс, назву ендпоінту для таблиці, куди зберігатимуться дані. Наприклад, `diplomas`.
. У полі `Payload` введіть дані для створення, що передаються як тіло запита. Наприклад, `${payload}`. +
Payload зазвичай формується у попередній скрипт-задачі процесу та передається до сервісної задачі як змінна.
. У полі `X-Access-Token source` вкажіть токен доступу користувача до системи, під яким виконується операція. Наприклад, `${completer('signCsvFileActivity').accessToken}`.
. У полі `X-Digital-Signature source` вкажіть джерело цифрового підпису. Наприклад, `${sign_submission('signCsvFileActivity').signatureDocumentId}`.
. У полі `Result variable` вкажіть будь-яке ім'я для вихідного параметра (_за замовчуванням_ -- `response`).
+
image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-5-1.png[]

[#batch-creation-entities-v2]
==== Створення сутностей масивом у фабриці даних (Batch creation of entities in data factory v2)

.Короткі відомості про делегат
|===
|Назва | Пояснення

|Бізнес-назва інтеграційного розширення
|*Batch creation of entities in data factory v2*

|Службова назва інтеграційного розширення
|*`${dataFactoryConnectorBatchCreateDelegateV2}`*

|Назва файлу у бібліотеці розширень
|*_dataFactoryConnectorBatchCreateDelegateV2.json_*
|===

Загальний опис ::

Загальне інтеграційне розширення-делегат надає можливість взаємодіяти з REST API реєстру та створювати сутності у базі даних масивом як *`LIST`* або *`CSV`* _транзакційно_ -- _тобто зберігаються або усі дані, або жодні_. Делегат налаштовується у сервісних задачах (*Service Task*) бізнес-процесу за допомогою шаблону *Batch creation of entities in data factory v2*.
+
[NOTE]
====
Максимальна кількість записів для завантаження до БД через цей делегат -- 50:

* 50 записів для *`LIST`*
* 50 записів для `*CSV*`.
====

+
TIP: Детальніше про застосування делегата у бізнес-процесах ви можете переглянути на сторінці xref:registry-develop:bp-modeling/bp/loading-data-from-csv.adoc[].

Налаштування шаблону у бізнес-процесі: ::
+
NOTE: При налаштуванні делегата у додатку Camunda Modeler, переконайтеся, що папка із застосунком *_resources > element-templates_* містить файл *_dataFactoryConnectorBatchCreateDelegateV2.json_*.

. Відкрийте *Service Task*, натисніть kbd:[*Open Catalog*] та оберіть шаблон зі списку, після чого натисніть kbd:[*Apply*].
+
image:registry-develop:bp-modeling/bp/loading_data_from_csv/loading_data_from_csv-05.png[]

. У полі `Name` вкажіть назву задачі.
. У полі `Resource` вкажіть ресурс, назву ендпоінту для таблиці, куди зберігатимуться дані. Наприклад, `diplomas`.
. У полі `Upload type` оберіть формат завантаження даних зі списку -- `*CSV*`, або `*LIST*`.
+
[NOTE]
====
Для обох типів, `*CSV*` та `*LIST*`, конфігурація конектора є однаковою. Відрізнятиметься лише `${payload}`, який зазвичай формується у попередній скрипт-задачі процесу та передається до сервісної задачі як змінна `${payload}`.

* Якщо необхідно завантажити дані масивом у *CSV*-форматі, то `payload` може формуватися у скрипті наступним чином:
+
.Приклад формування payload (CSV)
[source,groovy]
----
set_transient_variable('payload', submission('signCsvFileActivity').formData.prop('csvFile').elements().first())
----
+
Тобто отримуємо список елементів `csvFile` із форми (`formData`) за допомогою JUEL-функції `submission()`, формуємо об'єкт `payload` й надалі використовуємо як змінну при налаштуванні делегата. СSV-дані на форму можна завантажити за допомогою компонента *`Content`* (_детальніше про моделювання форм -- за xref:registry-develop:bp-modeling/bp/loading-data-from-csv.adoc#save-data-csv-content[посиланням]_).

* Якщо необхідно завантажити дані масивом як *`LIST`*, то `payload` може формуватися у скрипті наступним чином:
+
.Приклад формування масиву даних (LIST)
[source,groovy]
----
var data=
'''
[
   {
      "data":"test data",
      "description":"some description"
   },
   {
      "data2":"test data2",
      "description2":"some description2"
   }
]
'''

execution.setVariable("jsonArray", S(data))
----
+
Створюємо рядок *`data`*, який містить JSON-масив із двома об'єктами. Кожен об'єкт містить пари ключ-значення -- дані, які беруться з UI-форми. Результат записуємо до змінної *`jsonArray`*, яку потім використовуємо при налаштуванні делегата. дані на форму можна завантажити як масив за допомогою компонента `*Edit Grid*` (_детальніше про моделювання форм -- за xref:bp-modeling/forms/components/edit-grid/edit-grid.adoc#save-data-array-edit-grid[посиланням]_).

====
. У полі `Payload` введіть дані для створення, що передаються як тіло запита. Наприклад, `${payload}`.
. У полі `X-Access-Token source` вкажіть токен доступу користувача до системи, під яким виконується операція. Наприклад, `${completer('signCsvFileActivity').accessToken}`.
. У полі `X-Digital-Signature source` вкажіть джерело цифрового підпису. Наприклад, `${sign_submission('signCsvFileActivity').signatureDocumentId}`.
. У полі `Result variable` вкажіть будь-яке ім'я для вихідного параметра (_за замовчуванням_ -- `response`).
+
image:registry-develop:bp-modeling/bp/loading_data_from_csv/loading_data_from_csv-04.png[]

==== Групове читання сутностей у фабриці даних (Batch Read entities from data factory)

NOTE: _Перш за все, переконайтеся, що папка `/element-templates` містить файл `dataFactoryConnectorBatchReadDelegate.json`._

* Відкрийте **Service Task**, натисніть кнопку `Open Catalog` та оберіть шаблон (Template) зі списку.
* У полі `Name` вкажіть назву задачі.
* У полі `Resource` вкажіть ресурс.
* У полі `Resource ids` вкажіть ідентифікатор ресурсу.
* У полі `X-Access-Token source` зазначте токен доступу до системи користувача, під яким виконується операція.
* У полі `Result variable` вкажіть будь-яке ім'я для вихідного параметра (за замовчуванням -- `response`).

image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-6.png[]

==== Створення сутності у фабриці даних (Create entity in data factory)

NOTE: _Перш за все, переконайтеся, що папка `/element-templates` містить файл `dataFactoryConnectorCreateDelegate.json`._

* Відкрийте **Service Task**, натисніть кнопку `Open Catalog` та оберіть шаблон (Template) зі списку.
* У полі `Name` вкажіть назву задачі.
* У полі `Resource` вкажіть ресурс.
* У полі `Payload` введіть дані для створення.
* У полі `X-Access-Token source` зазначте токен доступу до системи користувача, під яким виконується операція.
* У полі `X-Digital-Signature source` вкажіть джерело цифрового підпису.
* У полі `X-Digital-Signature-Derived source` вкажіть джерело системного цифрового підпису.
* У полі `Result variable` вкажіть будь-яке ім'я для вихідного параметра (за замовчуванням -- `response`).

image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-7.png[]

[#create-nested-entities]
==== Створення декількох сутностей в рамках однієї транзакції (Create nested entities in data factory)

Розширення *Create nested entities in data factory* -- делегат для створення декількох сутностей в рамках однієї транзакції, що налаштовується за допомогою розробленого однойменного шаблону *Create nested entities in data factory* (_dataFactoryConnectorNestedCreateDelegate.json_).

NOTE: Перед налаштуванням шаблону в Сamunda Modeler переконайтеся, що папка `/element-templates` містить файл _dataFactoryConnectorNestedCreateDelegate.json_.

. Змоделюйте сервісну задачу (*Service Task*).

+
image:bp-modeling/bp/element-temp/nested-entities/nested-entities-1.png[]

. Натисніть `Open Catalog` та оберіть шаблон *Create nested entities in data factory* зі списку.

+
image:bp-modeling/bp/element-temp/nested-entities/nested-entities-2.png[]
image:bp-modeling/bp/element-temp/nested-entities/nested-entities-3.png[]

. Сконфігуруйте обраний шаблон:

* У полі `Name` вкажіть назву задачі. Наприклад, `Зберегти дані до Фабрики даних`.
* У полі `Resource` вкажіть ресурс, тобто назву ендпоінту, до якого необхідно звернутися. Наприклад, `person-profile`.
+
NOTE: На рівні API, ендпоінт виглядає наступним чином: `/nested/<resource name>`, де `<resource name>` -- назва ресурсу. Тобто у полі `Resource` необхідно вказати значення, яке визначається після останньої косої риски (`/`).

* У полі `Payload` введіть тіло запита -- JSON-об`єкт із вкладеною структурою декількох сутностей, яку необхідно зберегти до Фабрики даних. Наприклад, `${payload}`.
+
NOTE: Майте на увазі, що необхідно попередньо побудувати цей JSON-об`єкт, тобто `payload`, в рамках задачі скриптування.

* У полі `X-Access-Token` вкажіть токен доступу.
+
[TIP]
====
Токен доступу береться з АБО ініціатора (наприклад, `$initiator().accessToken}`), АБО виконавця задачі (наприклад, `${completer('taskDefinitionId').accessToken}`).
====

+
image:bp-modeling/bp/element-temp/nested-entities/nested-entities-4.png[]

* У полі `X-Digital-Signature source` вкажіть джерело цифрового підпису.
* У полі `X-Digital-Signature-Derived source` вкажіть джерело системного цифрового підпису.
* У полі `Result variable` вкажіть назву змінної процесу, до якої необхідно записати результат (за замовчуванням -- `response`).

+
image:bp-modeling/bp/element-temp/nested-entities/nested-entities-5.png[]

TIP: Особливості використання та налаштування делегата *Create nested entities in data factory* у бізнес-процесі дивіться за xref:bp-modeling/bp/modeling-facilitation/bp-nested-entities-in-data-factory.adoc[посиланням].

==== Визначення статусу бізнес-процесу (Define business process status)

NOTE: _Перш за все, переконайтеся, що папка `/element-templates` містить файл `defineBusinessProcessStatusDelegate.json`._

* Відкрийте **Service Task**, натисніть кнопку `Open Catalog` та оберіть шаблон (Template) зі списку.
* У полі `Name` вкажіть назву задачі.
* У полі `Status` вкажіть статус, що відображатиметься після завершення процесу.

image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-9.png[]

==== Видалення сутності з фабрики даних (Delete entity from data factory)

NOTE: _Перш за все, переконайтеся, що папка `/element-templates` містить файл `dataFactoryConnectorDeleteDelegate.json`._

* Відкрийте **Service Task**, натисніть кнопку `Open Catalog` та оберіть шаблон (Template) зі списку.
* У полі `Name` вкажіть назву задачі.
* У полі `Resource` вкажіть ресурс.
* У полі `Payload` введіть дані для створення.
* У полі `X-Access-Token source` зазначте токен доступу до системи користувача, під яким виконується операція.
* У полі `X-Digital-Signature source` вкажіть джерело цифрового підпису.
* У полі `X-Digital-Signature-Derived source` вкажіть джерело системного цифрового підпису.
* У полі `Result variable` вкажіть будь-яке ім'я для вихідного параметра (за замовчуванням -- `response`).

image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-10.png[]

[[header,Delegate]]
==== Розширення для делегатаfootnote:[**Делегат (англ. Delegate)** -- клас, який дозволяє зберігати в собі посилання на метод із певною сигнатурою (порядком і типами значень, що приймаються та повертається) довільного класу. Екземпляри делегатів містять посилання на конкретні методи конкретних класів.] цифрового підпису DSO (Digital signature by DSO service)

NOTE: _Перш за все, переконайтеся, що папка `/element-templates` містить файл `digitalSignatureConnectorDelegate.json`._

* Відкрийте **Service Task** -> у вікні справа натисніть кнопку `Open Catalog` та оберіть відповідний шаблон (Template) зі списку.
* У полі `Payload` введіть дані для підпису.
* У полі `X-Access-Token source` введіть токен доступу до системи користувача, під яким виконується операція.
* У полі `Result variable` вкажіть будь-яке ім'я для вихідного параметра (за замовчуванням -- `response`).

image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-11.png[]

==== Отримання ролі з Keycloak (Get roles from Keycloak)

NOTE: _Перш за все, переконайтеся, що папка `/element-templates` містить файл `getRolesFromKeycloak.json`._

* Відкрийте **Service Task** -> у вікні справа натисніть кнопку `Open Catalog` та оберіть відповідний шаблон (Template) зі списку.
* У полі `Name` вкажіть назву задачі.
* У полі `Result variable` вкажіть будь-яке ім'я для вихідного параметра (наприклад, `rolesOutput`).

image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-12.png[]

==== Отримання детальної інформації за суб'єктом з ЄДР (Get subject detail EDR Registry)

NOTE: _Перш за все, переконайтеся, що папка `/element-templates` містить файл `subjectDetailEdrRegistryConnectorDelegate.json`._

* Відкрийте **Service Task** -> у вікні справа натисніть кнопку `Open Catalog` та оберіть відповідний шаблон (Template) зі списку.
* У полі `Name` вкажіть назву задачі.
* У полі `Authorization token` вкажіть токен для доступу до СЕВ ДЕІР «Трембіта».
* Поле `Id` визначає змінну, де зберігається код для пошуку в у зовнішньому реєстрі (ЄДР).
* У полі `Result variable` вкажіть будь-яке ім'я для вихідного параметра (за замовчуванням -- `response`).

image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-13.png[]

==== Читання сутності із фабрики даних (Read entity from data factory)

NOTE: _Перш за все, переконайтеся, що папка `/element-templates` містить файл `dataFactoryConnectorReadDelegate.json`._

* Відкрийте **Service Task** -> у вікні справа натисніть кнопку `Open Catalog` та оберіть відповідний шаблон (Template) зі списку.
* У полі `Name` вкажіть назву задачі.
* У полі `Resource` вкажіть ресурс.
* У полі `Resource id` введіть ідентифікатор ресурсу.
* У полі `X-Access-Token source` вкажіть токен доступу до системи користувача, під яким виконується операція.
* У полі `Result variable` вкажіть будь-яке ім'я для вихідного параметра (за замовчуванням -- `response`).

image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-17.png[]

==== Читання користувацьких налаштувань (Read user settings)

NOTE: _Перш за все, переконайтеся, що папка `/element-templates` містить файл `userSettingsConnectorReadDelegate.json`._

* Відкрийте **Service Task** -> у вікні справа натисніть кнопку `Open Catalog` та оберіть відповідний шаблон (Template) зі списку.
* У полі `Name` вкажіть назву задачі.
* У полі `X-Access-Token source` зазначте токен доступу до системи користувача, під яким виконується операція.
* У полі `Result variable` вкажіть будь-яке ім'я для вихідного параметра (за замовчуванням -- `response`).

image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-19.png[]

==== Видалення ролі у користувача Keycloak (Remove role from Keycloak user)

NOTE: _Перш за все, переконайтеся, що папка `/element-templates` містить файл `removeRoleFromKeycloakUser.json`._

* Відкрийте **Service Task** -> у вікні справа натисніть кнопку `Open Catalog` та оберіть відповідний шаблон (Template) зі списку.
* У полі `Name` вкажіть назву задачі.
* У полі `User name` вкажіть ідентифікатор користувача у Keycloak.
* У полі `Role` зазначте роль користувача.

image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-21.png[]

==== Пошук посадових осіб у Keycloak за їх атрибутами

Розширення *Get users by attributes from keycloak* -- делегат `${getUsersByAttributesFromKeycloak}`, для якого імплементовано однойменний шаблон *Get users by attributes from keycloak*, представлений у вигляді JSON-файлу _getUsersByAttributesFromKeycloak.json_.

Делегат потрібний для того, щоб при виконанні бізнес-процесу отримувати список користувачів (посадових осіб) за певними атрибутами із сервісу керування ідентифікацією та доступом Keycloak.

NOTE: Перед налаштуванням шаблону в Сamunda Modeler переконайтеся, що папка із застосунком _resources_ -> _element-templates_ містить файл _getUsersByAttributesFromKeycloak.json_.

Налаштування шаблону ::

. Змоделюйте нову задачу.
. Визначте її тип, натиснувши іконку ключа та обравши з меню пункт *Service Task* (сервісна задача).
+
image:bp-modeling/bp/element-temp/keycloak-users-attributes/element-temp-keycloak-attributes-delegate-1.png[]

. Перейдіть до панелі налаштувань справа та застосуйте делегат *Get users by attributes from keycloak*. Для цього оберіть відповідний шаблон із каталогу (`Open Catalog`) та натисніть `Apply` для підтвердження.
+
image:bp-modeling/bp/element-temp/keycloak-users-attributes/element-temp-keycloak-attributes-delegate-2.png[]
+
image:bp-modeling/bp/element-temp/keycloak-users-attributes/element-temp-keycloak-attributes-delegate-3.png[]

. Виконайте подальші налаштування:

* У полі `Name` вкажіть назву задачі. Наприклад, `Отримати список користувачів із Keycloak`.
* У полі `Edrpou attribute value` вкажіть значення атрибута `edrpou`. Наприклад, `11111111`.
+
[NOTE]
====
Значення атрибута `edrpou` є обов'язковим для заповнення. Його можна передати як напряму (тобто ввести код ЄДРПОУ, наприклад, `11111111`), так і через функцію `submission()`, вказавши ID останньої користувацької задачі (наприклад, `'userTaskId'`).
====

* У полі `Drfo attribute value` вкажіть значення атрибута `drfo`. Наприклад, `2222222222`.
+
[NOTE]
====
Значення атрибута `drfo` є опціональним. Його можна передати як напряму (тобто ввести код ДРФО, наприклад, `2222222222`), так і через функцію `submission()`, вказавши ID останньої користувацької задачі (наприклад, `'userTaskId'`).
====

* У полі `Result variable` вкажіть назву змінної, до якої необхідно зберегти відповідь -- `usersByAttributes`.
+
[CAUTION]
====
В результаті запита отримуємо список користувачів із Keycloak за їх атрибутами, який зберігатиметься у змінній `usersByAttributes`.

* Якщо користувач передає лише значення параметра `edrpou`, то сервіс повертає список _усіх посадових осіб_ відповідної організації.
* Якщо користувач передає значення параметрів `edrpou` та `drfo`, то сервіс повертає список з іменем _конкретної посадової особи_ відповідної організації.
====
+
image:bp-modeling/bp/element-temp/keycloak-users-attributes/element-temp-keycloak-attributes-delegate-4.png[]

TIP: Детальніше про налаштування та використання делегата у бізнес-процесі -- за xref:bp-modeling/bp/access/bp-limiting-access-keycloak-attributes.adoc[посиланням].

[#get-citizen-users-by-attributes-from-keycloak]
==== Пошук отримувачів послуг у Keycloak за їх атрибутами (Get citizen users by attributes from keycloak)

Розширення *Get citizen users by attributes from keycloak* -- делегат `${getCitizenUsersByAttributesFromKeycloak}`, для якого імплементовано однойменний шаблон *Get citizen users by attributes from keycloak*, представлений у вигляді JSON-файлу _getCitizenUsersByAttributesFromKeycloak.json_.

Делегат потрібний для того, щоб при виконанні бізнес-процесу отримувати список користувачів (отримувачів послуг) за певними атрибутами із сервісу керування ідентифікацією та доступом Keycloak.

[NOTE]
====
Перед налаштуванням шаблону в Сamunda Modeler переконайтеся, що папка із застосунком _resources → element-templates містить файл getCitizenUsersByAttributesFromKeycloak.json._
====

_Налаштування шаблону:_

. Змоделюйте нову задачу.
. Визначте її тип, натиснувши _іконку ключа_ та обравши з меню пункт *Service Task* (сервісна задача).
+
image:registry-develop:registry-admin/e-mail-notification/e-mail-notification-04.png[]

. Перейдіть до панелі налаштувань справа та застосуйте делегат *Get citizen users by attributes from keycloak*. Для цього оберіть відповідний шаблон із каталогу (`Open Catalog`) та натисніть `Apply` для підтвердження.
+
image:registry-develop:registry-admin/e-mail-notification/e-mail-notification-05.png[]

. Виконайте подальші налаштування:
*	У полі `Name` вкажіть назву задачі. Наприклад, `Отримати список отримувачів послуг із Keycloak`.
*	У полі `Edrpou attribute value` вкажіть значення атрибута edrpou. Наприклад, `11111111`.
+
[NOTE]
====
Значення атрибута `edrpou` є обов’язковим для заповнення. Його можна передати як напряму (тобто ввести код ЄДРПОУ, наприклад, 11111111), так і через функцію `submission()`, вказавши ID останньої користувацької задачі (наприклад, `userTaskId`).
====

*	У полі `Drfo attribute value` вкажіть значення атрибута drfo. Наприклад, `2222222222`.
+
[NOTE]
====
Значення атрибута drfo є опціональним. Його можна передати як напряму (тобто ввести код ДРФО, наприклад, 2222222222), так і через функцію submission(), вказавши ID останньої користувацької задачі (наприклад, 'userTaskId').
====
*	У полі `Result variable` вкажіть назву змінної, до якої необхідно зберегти відповідь -- `citizenUsersByAttributes`.
+
[CAUTION]
====
В результаті запита отримуємо список користувачів із Keycloak за їх атрибутами, який зберігатиметься у змінній `citizenUsersByAttributes`.

*	Якщо користувач передає лише значення параметра `edrpou`, то сервіс повертає список _усіх отримувачів послуг_ відповідної організації.
*	Якщо користувач передає значення параметрів `edrpou` та `drfo`, то сервіс повертає список з іменем _конкретного отримувача послуг_ відповідної організації.
====

+
image:registry-develop:registry-admin/e-mail-notification/e-mail-notification-06.png[]

==== Пошук сутностей у фабриці даних (Search for entities in data factory)

NOTE: _Перш за все, переконайтеся, що папка `/element-templates` містить файл `dataFactoryConnectorSearchDelegate.json`._

* Відкрийте **Service Task** -> у вікні справа натисніть кнопку `Open Catalog` та оберіть відповідний шаблон (Template) зі списку.
* У полі `Name` вкажіть назву задачі.
* У полі `Resource` вкажіть ресурс.
* У полі `Result variable` вкажіть будь-яке ім'я для вихідного параметра (за замовчуванням -- `response`.
* У полі `X-Access-Token source` вкажіть токен доступу до системи користувача, під яким виконується операція.

image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-22.png[]

==== Пошук суб'єкта в ЄДР (Search subjects EDR Registry)

NOTE: _Перш за все, переконайтеся, що папка `/element-templates` містить файл `searchSubjectsEdrRegistryConnectorDelegate.json`._

* Відкрийте **Service Task** -> у вікні справа натисніть кнопку `Open Catalog` та оберіть відповідний шаблон (Template) зі списку.
* У полі `Name` вкажіть назву задачі.
* У полі `Authorization token` вкажіть токен для доступу до СЕВ ДЕІР «Трембіта».
* Поле `Code` визначає змінну, де зберігається код для пошуку в ЄДР.
* У полі `Result variable` вкажіть будь-яке ім'я для вихідного параметра (за замовчуванням -- `response`).

image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-23.png[]

==== Надсилання системної помилки (Throw system error)

NOTE: _Перш за все, переконайтеся, що папка `/element-templates` містить файл `camundaSystemErrorDelegate.json`._

* Відкрийте **Service Task** -> у вікні справа натисніть кнопку `Open Catalog` та оберіть відповідний шаблон (Template) зі списку.
* У полі `Name` вкажіть назву задачі.
* У полі `Message` зазначте текст помилки, що буде показано.

image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-24.png[]

==== Надсилання помилки перевірки правдивості (Throw validation error)

NOTE: _Перш за все, переконайтеся, що папка `/element-templates` містить файл `userDataValidationErrorDelegate.json`._

* Відкрийте **Service Task** -> у вікні справа натисніть кнопку `Open Catalog` та оберіть відповідний шаблон (Template) зі списку.
* У полі `Name` вкажіть назву задачі.
* У випадному списку **Validation errors**:
** зазначте у полі `Variable Assignment Type` тип змінної, вказавши значення `List`;
** натисніть `Add Value` та у полі `Value` вкажіть значення помилки, що відображатиметься.

.Приклад
[source, json]
----
{"field": "laboratory", "value": "${submission('start_event').formData.prop('laboratory').prop('laboratoryId').value()}", "message": "Статус в ЄДР "Скаcовано" або "Припинено"}.
----

image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-25.png[]

==== Оновлення сутності у Фабриці даних (Update entity in data factory)

NOTE: _Перш за все, переконайтеся, що папка `/element-templates` містить файл `dataFactoryConnectorUpdateDelegate.json`._

* Відкрийте **Service Task** -> у вікні справа натисніть кнопку `Open Catalog` та оберіть відповідний шаблон (Template) зі списку.
* У полі `Name` вкажіть назву задачі.
* У полі `Resource` вкажіть ресурс.
* У полі `Resource id` вкажіть ідентифікатор ресурсу.
* У полі `Payload` зазначте дані для створення.
* У полі `X-Access-Token source` введіть токен доступу до системи користувача, під яким виконується операція.
* У полі `X-Digital-Signature source` вкажіть джерело для Ceph-документа, де зберігається підпис користувача, накладений на дані UI-форми при внесенні.
* У полі `X-Digital-Signature-Derived source` вкажіть джерело для Ceph-документа, де зберігається системний підпис, автоматично накладений на тіло запита.
* У полі `Result variable` вкажіть будь-яке ім'я для вихідного параметра (за замовчуванням -- `response`).

image:registry-develop:bp-modeling/bp/element-temp/bp-element-temp-26.png[]

[#update_entity_in_data_factory_partially]
==== Часткове оновлення сутності у Фабриці даних (Update entity in data factory partially)

Розширення *Update entity in data factory partially* -- делегат для часткового оновлення сутності у фабриці даних, який налаштовується за допомогою розробленого однойменного шаблону *Update entity in data factory partially* (_dataFactoryConnectorPartialUpdateDelegate.json_).

NOTE: Перед налаштуванням шаблону в Сamunda Modeler переконайтеся, що папка із застосунком _resources_ -> _element-templates_ містить файл _dataFactoryConnectorPartialUpdateDelegate.json_.

. Створіть *Service Task*.

. На панелі налаштувань справа натисніть кнопку `Open Catalog`, оберіть відповідний шаблон *Update entity in data factory partially* зі списку та натисніть `Apply` для підтвердження.

+
image:bp-modeling/bp/element-temp/partial-update/partial-update-1.png[]

. Сконфігуруйте обраний шаблон:

* У полі `Name` вкажіть назву задачі. Наприклад, `Часткове оновлення виконанно`.
* У полі `Resource` вкажіть ресурс, тобто назву ендпоінту, до якого необхідно звернутися, -- `person-profile`.
+
NOTE: На рівні API ендпоінт виглядає як `/partial/<resource-name>/<resource-id>`, де `<resource-name>` -- назва ресурсу, а `<resource-id>` -- ідентифікатор ресурсу у Фабриці даних. У полі `Resource` необхідно вказати значення між `/partial` та `/<resource-id>`, без косої риски (`/`).

* У полі `Resource id` вкажіть ідентифікатор ресурсу, тобто сутності у Фабриці даних, яку необхідно оновити. Наприклад, `{id}`.
+
[NOTE]
====
Ідентифікатор ресурсу визначається у форматі `UUID`.
Його можна передати як змінну, взяту із попередніх задач бізнес-процесу, або напряму -- як `f7dc68fe-98e1-4d95-b80f-df5ce42cebb9`.
====

* У полі `Payload` введіть тіло запита -- JSON-структуру із параметрами, які необхідно оновити у Фабриці даних. Наприклад, `${updatePersonPayload}`.

* У полі `X-Access-Token` введіть токен доступу до ресурсу. Наприклад, `${completer('signEditedPersonalProfile').accessToken}`.
+
[TIP]
====
Токен доступу береться з АБО ініціатора (наприклад, `$initiator().accessToken}`), АБО виконавця останньої користувацької задачі (наприклад, `${completer('taskDefinitionId').accessToken}`).
====

* У полі `X-Digital-Signature source` вкажіть джерело для Ceph-документа, де зберігається підпис користувача, накладений на дані UI-форми при внесенні, -- `${sign_submission('signEditedPersonalProfile').signatureDocumentId}`.

* У полі `X-Digital-Signature-Derived source` вкажіть джерело для Ceph-документа, де зберігається системний підпис, автоматично накладений на тіло запита, -- `${updatePersonPayloadDerivedKey}`.

* У полі `Result variable` вкажіть назву змінної процесу, до якої необхідно записати результат (за замовчуванням -- `response`).

+
image:bp-modeling/bp/element-temp/partial-update/partial-update-2.png[]

TIP: Особливості використання та налаштування делегата *Update entity in data factory partially* у бізнес-процесі дивіться за xref:bp-modeling/bp/modeling-facilitation/partial-update.adoc[посиланням].

[#connect-to-data-factory]
==== Конектор до фабрики даних (Connect to data factory)

Розширення *Connect to data factory* -- загальний делегат для інтеграції бізнес-процесів із Фабрикою даних, який налаштовується за допомогою розробленого однойменного шаблону *Connect to data factory* (_dataFactoryConnectorDelegate.json_).

Завдяки цьому делегату можна надіслати будь-який запит до будь-якого АРІ-ендпоінту для отримання будь-яких даних.
Тобто можна використати для запита будь-яку точку інтеграції (ендпоінт), розроблену на рівні Фабрики даних, яка відображена у REST API реєстру, тобто у Swagger UI.

TIP: Один цей загальний делегат здатен замінити усі інші делегати конкретного призначення.

Делегат підтримує взаємодію із HTTP-методами, а саме: ::

* `POST` -- для створення сутності/ресурсу. Відповідає БД-операції `CREATE`.
* `GET`  -- для пошуку або читання даних. Відповідає БД-операції `READ`.
* `PUT`  -- для оновлення сутності. Відповідає БД-операції `UPDATE`.
* `DELETE` -- для видалення сутності. Відповідає БД-операції `DELETE`).
* `PATCH`  -- для часткового оновлення (модифікації) сутності. Відповідає БД-операції `UPDATE`.

+
image:release-notes:whats-new-1-6-15.png[]

NOTE: Перед налаштуванням шаблону в Сamunda Modeler переконайтеся, що папка із застосунком _resources_ -> _element-templates_ містить файл _dataFactoryConnectorDelegate.json_.

TIP: Ця інструкція розглядає випадки взаємодії делегата з різними типами ендпоінтів на прикладі сутності `ownership` (право власності).

[#connect-to-df-post]
===== Налаштування взаємодії з POST-ендпоінтом

HTTP-метод `POST` використовується для створення сутності/ресурсу в базі даних реєстру.

Для налаштування шаблону делегата в Camunda Modeler, необхідно виконати наступні кроки:

. Створіть *Service Task*.

. На панелі налаштувань справа натисніть кнопку `Open Catalog`, оберіть відповідний шаблон *Connect to data factory* зі списку та натисніть `Apply` для підтвердження.
+
image:registry-develop:bp-modeling/bp/element-temp/universal-delegate/connect-to-data-factory-delegate-1.png[]

. Сконфігуруйте обраний шаблон:

* У полі `Name` вкажіть назву задачі. Наприклад, `Створити сутність (POST)`.

* Розгорніть блок *Method* у секції *Custom Fields* та оберіть з випадного списку HTTP-метод *`POST`* для взаємодії з Фабрикою даних.
+
image:registry-develop:bp-modeling/bp/element-temp/universal-delegate/connect-to-data-factory-delegate-2.png[]

* Розгорніть блок *Path* та вкажіть шлях до ресурсу у Фабриці даних, тобто назву ендпоінту, до якого необхідно звернутися:

** Активуйте позначку `Local Variable Assignment` -> `ON`. Це дозволить створити локальну змінну для ендпоінту.
** У полі `Variable Assignment Type` оберіть з випадного списку тип призначення змінної -- `String or Expression`.
** У полі `Variable Assignment Value` вкажіть ендпоінт -- `/ownership`.
+
NOTE: Назву ендпоінту необхідно вказувати через косу риску (`/`) як префікс.

+
image:registry-develop:bp-modeling/bp/element-temp/universal-delegate/connect-to-data-factory-delegate-3.png[]

* Метод `POST` не вимагає додаткових request-параметрів, окрім тіла запита, а отже блок *Request parameters* залиште порожнім.
+
image:registry-develop:bp-modeling/bp/element-temp/universal-delegate/connect-to-data-factory-delegate-4.png[]

* Розгорніть блок *Payload* та вкажіть вхідні параметри, тобто тіло запита:

** Активуйте позначку `Local Variable Assignment` -> `ON`. Це дозволить створити локальну змінну для тіла запита.
** У полі `Variable Assignment Type` оберіть з випадного списку тип призначення змінної -- `String or Expression`.
** У полі `Variable Assignment Value` введіть тіло запита -- JSON-структуру із параметрами, які необхідно записати до БД. Наприклад, `${payload}`.
+
[TIP]
====
У нашому прикладі ми передаємо змінну `${payload}`, до якої були збережені дані в одній із попередніх задач бізнес-процесу.

.Схема тіла запита згідно з REST API реєстру
=====
[source,json]
----
{
  "ownershipId": "b45b90c0-c53d-4fd3-aa82-02e8e7392345",
  "code": "string",
  "name": "string"
}
----
=====
====

+
image:registry-develop:bp-modeling/bp/element-temp/universal-delegate/connect-to-data-factory-delegate-5.png[]

* Розгорніть блок *X-Access-Token* та вкажіть введіть токен доступу до ресурсу:

** Активуйте позначку `Local Variable Assignment` -> `ON`. Це дозволить створити локальну змінну для токена доступу.
** У полі `Variable Assignment Type` оберіть з випадного списку тип призначення змінної -- `String or Expression`.
** У полі `Variable Assignment Value` введіть токен доступу. Наприклад, `${completer('taskId').accessToken}`.
+
[TIP]
====
Токен доступу береться з АБО ініціатора (наприклад, `$initiator().accessToken}`), АБО виконавця останньої користувацької задачі (наприклад, `${completer('taskDefinitionId').accessToken}`).
====

+
image:registry-develop:bp-modeling/bp/element-temp/universal-delegate/connect-to-data-factory-delegate-6.png[]

* Розгорніть блок *X-Digital-Signature source* та вкажіть джерело для Ceph-документа, де зберігається підпис користувача (КЕП), накладений на дані UI-форми при внесенні:

** Активуйте позначку `Local Variable Assignment` -> `ON`. Це дозволить створити локальну змінну для КЕП.
** У полі `Variable Assignment Type` оберіть з випадного списку тип призначення змінної -- `String or Expression`.
** У полі `Variable Assignment Value` вкажіть підпис користувача (КЕП). Наприклад, `${sign_submission('taskId').signatureDocumentId}`.
+
[TIP]
====
У нашому прикладі ми передаємо КЕП із користувацької форми, де його застосовано, через функцію `sign_submission()` (_детальніше про використання JUEL-функцій у бізнес-процесах -- за xref:bp-modeling/bp/modeling-facilitation/modelling-with-juel-functions.adoc[посиланням]._)
====

+
image:registry-develop:bp-modeling/bp/element-temp/universal-delegate/connect-to-data-factory-delegate-7.png[]

* Розгорніть блок *X-Digital-Signature-Derived source* та вкажіть джерело для Ceph-документа, де зберігається системний підпис, автоматично накладений на тіло запита:

** Активуйте позначку `Local Variable Assignment` -> `ON`. Це дозволить створити локальну змінну для системного підпису.
** У полі `Variable Assignment Type` оберіть з випадного списку тип призначення змінної -- `String or Expression`.
** У полі `Variable Assignment Value` передайте системний підпис. `Наприклад, `${createPersonPayloadDerivedKey}`.
+
TIP: У нашому прикладі ми передаємо змінну `${createPersonPayloadDerivedKey}`, до якої було збережено системний підпис в одній із попередніх задач бізнес-процесу.

+
image:registry-develop:bp-modeling/bp/element-temp/universal-delegate/connect-to-data-factory-delegate-8.png[]

* Розгорніть блок *Result variable* та вкажіть назву змінної процесу, до якої необхідно записати результат (за замовчуванням -- `response`):

** Активуйте позначку `Local Variable Assignment` -> `ON`.
** У полі `Variable Assignment Type` оберіть з випадного списку тип призначення змінної -- `String or Expression`.
** У полі `Variable Assignment Value` введіть назву результівної змінної (за замовчуванням -- `response`).
+
[NOTE]
====
Сервіс не повертає тіла у відповідь на `POST`-запит. В результаті повертається лише код відповіді та його опис.

.Код відповіді та його опис згідно з REST API реєстру
=====
[source,http]
----
201
OK, ресурс успішно створено
----
=====
====

+
image:registry-develop:bp-modeling/bp/element-temp/universal-delegate/connect-to-data-factory-delegate-9.png[]

[#connect-to-df-get]
===== Налаштування взаємодії з GET-ендпоінтом

HTTP-метод `GET` використовується для отримання даних сутності (`SELECT` за id із таблиці в БД) або пошуку даних за певними критеріями (`SELECT` із представлення (view)) в базі даних реєстру. Використовується для отримання об’єктів. Не змінює стан ресурсу.

CAUTION: КЕП і системний підпис не використовуються при GET-запиті.

Отримання даних сутності за id ::

Цей випадок описує приклад отримання ресурсу за його ID із певної таблиці в базі даних.
+
Для налаштування шаблону делегата в Camunda Modeler, необхідно виконати наступні кроки:

. Створіть *Service Task*.

. На панелі налаштувань справа натисніть кнопку `Open Catalog`, оберіть відповідний шаблон *Connect to data factory* зі списку та натисніть `Apply` для підтвердження.
+
image:registry-develop:bp-modeling/bp/element-temp/universal-delegate/connect-to-data-factory-delegate-1.png[]

. Сконфігуруйте обраний шаблон:

* У полі `Name` вкажіть назву задачі. Наприклад, `Отримати сутніть за id (GET)`.

* Розгорніть блок *Method* у секції *Custom Fields* та оберіть з випадного списку HTTP-метод *`GET`* для взаємодії з Фабрикою даних.
+
image:registry-develop:bp-modeling/bp/element-temp/universal-delegate/connect-to-data-factory-delegate-10.png[]

* Розгорніть блок *Path* та вкажіть шлях до ресурсу у Фабриці даних, тобто назву ендпоінту, до якого необхідно звернутися:

** Активуйте позначку `Local Variable Assignment` -> `ON`. Це дозволить створити локальну змінну для ендпоінту.
** У полі `Variable Assignment Type` оберіть з випадного списку тип призначення змінної -- `String or Expression`.
** У полі `Variable Assignment Value` вкажіть ендпоінт. Наприклад, `/ownership/${response.value.responseBody.prop('id).value()}`.
+
[NOTE]
====
Назву ендпоінту необхідно вказувати через косу риску (`/`) як префікс.

Обов'язково необхідно передати ідентифікатор сутності. ID можна передати декількома способами. Наприклад:

* через змінну як `${response.value.responseBody.prop('id).value()}`;
* через змінну як `/${id}`;
* через функцію `submission()` як `${submission('taskId').formData.prop('id').value()}`
* через константне значення UUID напряму -- `/b45b90c0-c53d-4fd3-aa82-02e8e7392345`.
====
+
image:registry-develop:bp-modeling/bp/element-temp/universal-delegate/connect-to-data-factory-delegate-11.png[]

* Цей випадок не вимагає додаткових request-параметрів, окрім параметрів шляху (path params), а отже блоки *Request parameters* та *Payload* залиште порожніми.

* Розгорніть блок *X-Access-Token* та вкажіть введіть токен доступу до ресурсу:

** Активуйте позначку `Local Variable Assignment` -> `ON`. Це дозволить створити локальну змінну для токена доступу.
** У полі `Variable Assignment Type` оберіть з випадного списку тип призначення змінної -- `String or Expression`.
** У полі `Variable Assignment Value` введіть токен доступу. Наприклад, `${completer('taskId').accessToken}`.
+
[TIP]
====
Токен доступу береться з АБО ініціатора (наприклад, `$initiator().accessToken}`), АБО виконавця останньої користувацької задачі (наприклад, `${completer('taskDefinitionId').accessToken}`).
====
+
image:registry-develop:bp-modeling/bp/element-temp/universal-delegate/connect-to-data-factory-delegate-12.png[]

* Розгорніть блок *Result variable* вкажіть назву змінної процесу, до якої необхідно записати результат (за замовчуванням -- `response`):

** Активуйте позначку `Local Variable Assignment` -> `ON`.
** У полі `Variable Assignment Type` оберіть з випадного списку тип призначення змінної -- `String or Expression`.
** У полі `Variable Assignment Value` введіть назву результівної змінної (за замовчуванням -- `response`).
+
[NOTE]
====
У відповідь на GET-запит сервіс повертає ресурс за його ID.

.Приклад тіла відповіді згідно з REST API реєстру
=====
[source,json]
----
{
  "ownershipId": "b45b90c0-c53d-4fd3-aa82-02e8e7392345",
  "code": "string",
  "name": "string"
}
----
=====
====
+
image:registry-develop:bp-modeling/bp/element-temp/universal-delegate/connect-to-data-factory-delegate-13.png[]

Пошук даних за критеріями ::

Цей випадок описує приклад отримання списку ресурсів через запит до ендпоінту, що згенерований на базі відповідного представлення (Search Condition) у Фабриці даних.
+
Для налаштування шаблону делегата в Camunda Modeler, необхідно виконати наступні кроки:

. Створіть *Service Task*.

. На панелі налаштувань справа натисніть кнопку `Open Catalog`, оберіть відповідний шаблон *Connect to data factory* зі списку та натисніть `Apply` для підтвердження.
+
image:registry-develop:bp-modeling/bp/element-temp/universal-delegate/connect-to-data-factory-delegate-1.png[]

. Сконфігуруйте обраний шаблон:

* У полі `Name` вкажіть назву задачі. Наприклад, `Пошук даних за критеріями (GET)`.

* Розгорніть блок *Method* у секції *Custom Fields* та оберіть з випадного списку HTTP-метод *`GET`* для взаємодії з Фабрикою даних.
+
image:registry-develop:bp-modeling/bp/element-temp/universal-delegate/connect-to-data-factory-delegate-14.png[]

* Розгорніть блок *Path* та вкажіть шлях до ресурсу у Фабриці даних, тобто назву ендпоінту, до якого необхідно звернутися:

** Активуйте позначку `Local Variable Assignment` -> `ON`. Це дозволить створити локальну змінну для ендпоінту.
** У полі `Variable Assignment Type` оберіть з випадного списку тип призначення змінної -- `String or Expression`.
** У полі `Variable Assignment Value` вкажіть ресурс. Наприклад, `/staff-equal-constant-code`.
+
[NOTE]
====
* Назва ресурсу відповідає назві ендпоінту для Search Condition у Фабриці даних.
* Назву ресурсу необхідно вказувати через косу риску (`/`) як префікс.
====
+
image:registry-develop:bp-modeling/bp/element-temp/universal-delegate/connect-to-data-factory-delegate-15.png[]

* Цей випадок вимагає налаштування додаткових параметрів запита -- query-параметрів. Розгорніть блок *Request parameters* та вкажіть query-параметри як пари ключ-значення (Map).

** Активуйте позначку `Local Variable Assignment` -> `ON`. Це дозволить створити локальну змінну ендпоінту для Search Condition.
** У полі `Variable Assignment Type` оберіть з випадного списку тип призначення змінної -- `Map`.
** У полі `Variable Assignment Value` введіть ключ пошуку -- `constantCode` та його значення -- `${submission('formId').formData.prop('staffStatusCode').value()}`.
+
[NOTE]
====
У нашому випадку значення ключа пошуку `constantCode` передається через функцію `submission()` (_детальніше про використання JUEL-функцій у бізнес-процесах -- за xref:bp-modeling/bp/modeling-facilitation/modelling-with-juel-functions.adoc[посиланням]._). Інші параметри є опціональними.

.Приклад query-параметрів запита у форматі JSON згідно з REST API реєстру
=====
[source, json]
----
{
"offset": 0,
"constantCode": "string",
"limit": 0
}
----
=====
====
+
image:registry-develop:bp-modeling/bp/element-temp/universal-delegate/connect-to-data-factory-delegate-16.png[]

* Розгорніть блок *X-Access-Token* та вкажіть введіть токен доступу до ресурсу:

** Активуйте позначку `Local Variable Assignment` -> `ON`. Це дозволить створити локальну змінну для токена доступу.
** У полі `Variable Assignment Type` оберіть з випадного списку тип призначення змінної -- `String or Expression`.
** У полі `Variable Assignment Value` введіть токен доступу. Наприклад, `${completer('taskId').accessToken}`.
+
[TIP]
====
Токен доступу береться з АБО ініціатора (наприклад, `$initiator().accessToken}`), АБО виконавця останньої користувацької задачі (наприклад, `${completer('taskDefinitionId').accessToken}`).
====
+
image:registry-develop:bp-modeling/bp/element-temp/universal-delegate/connect-to-data-factory-delegate-17.png[]

* Розгорніть блок *Result variable* вкажіть назву змінної процесу, до якої необхідно записати результат (за замовчуванням -- `response`):

** Активуйте позначку `Local Variable Assignment` -> `ON`.
** У полі `Variable Assignment Type` оберіть з випадного списку тип призначення змінної -- `String or Expression`.
** У полі `Variable Assignment Value` введіть назву результівної змінної (за замовчуванням -- `response`).
+
[NOTE]
====
У відповідь на GET-запит сервіс повертає масив об'єктів/ресурсів за критеріями пошуку.

.Приклад тіла відповіді від сервісу згідно з REST API реєстру
=====
[source,json]
----
[
  {
    "staffStatusId": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
    "constantCode": "string",
    "name": "string"
  }
]
----
=====
====
+
image:registry-develop:bp-modeling/bp/element-temp/universal-delegate/connect-to-data-factory-delegate-18.png[]

[#connect-to-df-put]
===== Налаштування взаємодії з PUT-ендпоінтом

HTTP-метод `PUT` використовується для оновлення сутності/ресурсу в базі даних реєстру. Використовується для зміни наявного ресурсу за вказаним ID.

[NOTE]
====
Принцип налаштування делегата для оновлення сутності є ідентичним до xref:#connect-to-df-post[] за декількома винятками:

* Розгорніть блок *Method* у секції *Custom Fields* та оберіть з випадного списку HTTP-метод *`PUT`* для взаємодії з Фабрикою даних.
+
image:bp-modeling/bp/element-temp/universal-delegate/connect-to-data-factory-delegate-19.png[]

* У блоці *Path* вкажіть ендпоінт `/ownership/${response.value.responseBody.prop('id).value()}` як локальну зміну із зазначенням ідентифікатора ресурсу, який необхідно оновити.
+
image:bp-modeling/bp/element-temp/universal-delegate/connect-to-data-factory-delegate-20.png[]

+
TIP: У нашому випадку ми передаємо значення id як змінну `${response.value.responseBody.prop('id).value()}` (_детальніше про опції передачі id ви можете переглянути у розділі xref:#connect-to-df-get[]_).

* У блоці `Result variable` до результівної змінної зберігається такий код відповіді:

.Код відповіді та його опис згідно з REST API реєстру
=====
[source,http]
----
204 OK
----
=====
====

===== Налаштування взаємодії з DELETE-ендпоінтом

HTTP-метод `DELETE` використовується для видалення сутності/ресурсу в базі даних реєстру. Використовується для видалення ресурсу за вказаним ID.

[NOTE]
====
Принцип налаштування делегата для видалення сутності є ідентичним до xref:#connect-to-df-put[] за двома винятками:

* У блоці *Method* вкажіть метод `DELETE` як локальну змінну.
+
image:bp-modeling/bp/element-temp/universal-delegate/connect-to-data-factory-delegate-21.png[]
* Видалення сутності не потребує визначення параметрів тіла запита, а тому залиште блок *Payload* порожнім.
+
image:bp-modeling/bp/element-temp/universal-delegate/connect-to-data-factory-delegate-21-1.png[]
====

===== Налаштування взаємодії з PATCH-ендпоінтом

HTTP-метод `PATCH` використовується для часткового оновлення сутності/ресурсу в базі даних реєстру. Використовується для модифікації конкретних параметрів ресурсу за вказаним ID.

[NOTE]
====
Принцип налаштування делегата для часткового оновлення сутності є ідентичним до xref:#connect-to-df-put[] за одним винятком:

* Розгорніть блок *Method* у секції *Custom Fields* та оберіть з випадного списку HTTP-метод *`PATCH`* для взаємодії з Фабрикою даних.

+
image:bp-modeling/bp/element-temp/universal-delegate/connect-to-data-factory-delegate-22.png[]
====

==== Інтеграція із зовнішніми системами (Connect to external system v2)

[TIP]
====
[.underline]#Бізнес-назва інтеграційного розширення#: *Connect to external system v2*.

[.underline]#Службова назва інтеграційного розширення#: *`${externalSystemConnectorDelegateV2}`*.

[.underline]#Назва файлу у бібліотеці розширень#: *_externalSystemConnectorDelegateV2.json_*.
====

Загальне інтеграційне розширення-делегат, також відоме як *REST Connector*, надає можливість взаємодіяти із зовнішніми системами через REST API й налаштовується у сервісних задачах (*Service Task*) бізнес-процесу за допомогою шаблону *Connect to external system v2*.

NOTE: При налаштуванні делегата у додатку Camunda Modeler, переконайтеся, що папка із застосунком *_resources > element-templates_* містить файл *_externalSystemConnectorDelegateV2.json_*.

TIP: Детальніше про застосування REST-конектора у бізнес-процесах ви можете переглянути на сторінці xref:registry-develop:bp-modeling/bp/rest-connector.adoc[].

[#element-temp-send-task]
=== Типові розширення для задач на відправлення повідомлень (Send Task)

[#send-user-notification]
==== Відправлення повідомлень користувачу (Send User Notification)

Розширення *Send User Notification* -- делегат для відправлення повідомлень отримувачам послуг електронною поштою, з використанням заданого шаблону в HTML-вигляді.

Делегат застосовується до задач типу *Send Task*.

[NOTE]
====
Перед налаштуванням шаблону в Сamunda Modeler переконайтеся, що папка із застосунком _resources → element-templates_ містить _sendUserNotification.json_
====

Для налаштування шаблону виконайте наступні кроки:

. Створіть *Send Task*.
+
image:registry-develop:registry-admin/e-mail-notification/e-mail-notification-02.png[]

. На панелі налаштувань справа натисніть кнопку `Open Catalog` та оберіть шаблон (template) делегата -- *Send User Notification*. Для підтвердження натисніть `Apply`.
+
image:registry-develop:registry-admin/e-mail-notification/e-mail-notification-03.png[]

. Виконайте подальші налаштування:

* У полі `name` вкажіть назву задачі (наприклад, `Відправка email користувачу`).

* У полі `Recipient` вкажіть унікальний ідентифікатор -- `<username>` отримувача повідомлення (наприклад, `${initiator().userName}`).

* У полі `Subject` вкажіть текстову назву теми повідомлення (наприклад, `Email successfully generated`).

* У полі `Notification message template` -- вкажіть унікальну назву _FreeMarker_-шаблону для формування тіла повідомлення, яка відповідає назві директорії шаблону відповідно до структури _<registry-regulation>/notifications/<channel>/<template_name>/*.*_ (наприклад, `add-lab-template`).

* У полі `Notification template model` -- вкажіть набір даних для генерації тіла повідомлення на базі шаблону (наприклад, `${templateModel}`).

[#element-temp-call-activity]
=== Типові розширення для виклику глобальних підпроцесів (Call Activity)

NOTE: Каталог розроблених шаблонів для налаштування делегатів зберігається у сховищі коду Gerrit, в окремому репозиторії _business-process-modeler-extensions_ -> _element-templates_.


TIP: Особливості використання Call Activity у бізнес-процесах дивіться за xref:bp-modeling/bp/bpmn/subprocesses/call-activities.adoc[посиланням].

[#bp-element-temp-call-activity-call-activity]
==== Делегат виклику глобального підпроцесу (Call Activity)

Розширення *Call Activity* -- загальний делегат для виклику глобального підпроцесу, що налаштовується за допомогою розробленого однойменного шаблону *Call Activity* (_callActivity.json_).

Розширення використовується, коли необхідно з одного бізнес-процесу викликати зовнішній підпроцес.

NOTE: Перед налаштуванням шаблону в Сamunda Modeler переконайтеся, що папка із застосунком _resources_ -> _element-templates_ містить файл _callActivity.json_.

[IMPORTANT]
====
Існують певні обмеження щодо кількості рівнів вкладеності бізнес-процесів при викликах зовнішніх підпроцесів за допомогою делегата Call Activity.

Для правильної роботи функціональності виклику зовнішніх підпроцесів через Call Activity, використовуйте не більше 3-х рівнів вкладеності бізнес-процесів, тобто основний процес, глобальний підпроцес 1-го рівня та глобальний підпроцес 2-го рівня.
====

[configure-temp]
===== Налаштування шаблону

. Створіть *Call Activity*.

+
image:bp-modeling/bp/element-temp/call-activity/element-temp-call-activity-1.png[]

. На панелі налаштувань справа натисніть кнопку `Open Catalog`, оберіть відповідний шаблон *Call Activity* зі списку та натисніть `Apply` для підтвердження.

+
image:bp-modeling/bp/element-temp/call-activity/element-temp-call-activity-2.png[]

+
image:bp-modeling/bp/element-temp/call-activity/element-temp-call-activity-3.png[]

. Виконайте подальші налаштування:

* У полі `Name` вкажіть назву задачі (наприклад, `call-activity-task`).
* У полі `Called Element` вкажіть ідентифікатор стороннього процесу або підпроцесу, що викликатиметься (наприклад, `called-process`).
* У полі `Input data` вкажіть вхідні дані, які необхідно передати бізнес-процесу, що викликається. Параметри мають передаватися у вигляді пар _ключ-значення_ (наприклад, `${payload}`).
* У полі `Output variable name` вкажіть назву змінної, до якої необхідно записати дані (payload), отримані в результаті виконання підпроцесу, що викликається (наприклад, `callActivityOutput`).
+
TIP: Якщо підпроцес, що викликали, продукує якісь дані на виході, він запише ці дані до вказаної змінної. Далі, якщо є потреба використати отримані дані в основному процесі, то необхідно звернутися до змінної, де ці дані зберігаються.
+
image:bp-modeling/bp/element-temp/call-activity/element-temp-call-activity-4.png[]

////
======================== System digital signature process has been   DEPRECATED, so delegate can't call any process===============================
TODO: Instead, there is a new delegate for system digital signature -- add description

[#element-temp-system-digital-signature]
==== Делегат виклику підпроцесу для підпису даних системним ключем (System digital signature)

Розширення *System digital signature* -- специфікований делегат для виклику підпроцесу підпису даних системним ключем, що налаштовується за допомогою розробленого однойменного шаблону *System digital signature* (_systemDigitalSignatureCallActivity.json_).

NOTE: Перед налаштуванням шаблону в Сamunda Modeler переконайтеся, що папка із застосунком _resources_ -> _element-templates_ містить файл _systemDigitalSignatureCallActivity.json_.

[configure-temp]
===== Налаштування шаблону

. Створіть *Call Activity*.

+
image:bp-modeling/bp/element-temp/call-activity/element-temp-call-activity-1.png[]

. На панелі налаштувань справа натисніть кнопку `Open Catalog`, оберіть відповідний шаблон *System digital signature* зі списку та натисніть `Apply` для підтвердження.

+
image:bp-modeling/bp/element-temp/call-activity/element-temp-call-activity-2.png[]

+
image:bp-modeling/bp/element-temp/call-activity/element-temp-call-activity-system-digital-signature-1.png[]

. Виконайте подальші налаштування:

* У полі `Name` вкажіть назву задачі (наприклад, `call-activity-task`).
* У полі `Input data` вкажіть вхідні дані, які необхідно підписати та передати бізнес-процесу, що викликається -- `${payload}`. Параметри мають передаватися у вигляді пар _ключ-значення_.
* У полі `Output variable name` вкажіть назву змінної -- `system_signature_ceph_key`, до якої необхідно зберегти системний ключ для підпису, отриманий в результаті виконання підпроцесу, що викликається.
+
TIP: Якщо підпроцес, що викликали, продукує якісь дані на виході (тут -- системний ключ для підпису), він запише ці дані до вказаної змінної. Далі, якщо є потреба використати отримані дані в основному процесі, то необхідно звернутися до змінної, де ці дані зберігаються.
+
image:bp-modeling/bp/element-temp/call-activity/element-temp-call-activity-system-digital-signature-2.png[]

NOTE: Всі інші атрибути, як то `Called Element`, `CallActivity Type` тощо, необхідні для налаштування Call Activity вручну, без використання шаблону, визначаються автоматично, "під капотом".
////

[#element-temp-check-excerpt-status]
==== Делегат виклику підпроцесу для перевірки статусу витягу (Check excerpt status)

Розширення *Check excerpt status* -- специфікований делегат для виклику підпроцесу перевірки статусу витягу, що налаштовується за допомогою розробленого однойменного шаблону *Check excerpt status* (_checkExcerptStatusCallActivity.json_).

NOTE: Перед налаштуванням шаблону в Сamunda Modeler переконайтеся, що папка із застосунком _resources_ -> _element-templates_ містить файл _checkExcerptStatusCallActivity.json_.

[comfigure-temp]
===== Налаштування шаблону

. Створіть *Call Activity*.

+
image:bp-modeling/bp/element-temp/call-activity/element-temp-call-activity-1.png[]

. На панелі налаштувань справа натисніть кнопку `Open Catalog`, оберіть відповідний шаблон *Check excerpt status* зі списку та натисніть `Apply` для підтвердження.

+
image:bp-modeling/bp/element-temp/call-activity/element-temp-call-activity-2.png[]

+
image:bp-modeling/bp/element-temp/call-activity/element-temp-call-activity-check-excerpt-status-1.png[]

. Виконайте подальші налаштування:

* У полі `Name` вкажіть назву задачі (наприклад, `call-activity-task`).
* У полі `Input excerpt identifier` вкажіть ID витягу, який необхідно передати бізнес-процесу, що викликається (наприклад, `${excerptIdentifier}`).
* У полі `Output variable name` вкажіть назву змінної, до якої необхідно зберегти статус витягу, отриманий в результаті виконання підпроцесу, що викликається (наприклад, `excerptStatusOutput`).
+
TIP: Якщо підпроцес, що викликали, продукує якісь дані на виході (тут -- статус витягу), він запише ці дані до вказаної змінної. Далі, якщо є потреба використати отримані дані в основному процесі, то необхідно звернутися до змінної, де ці дані зберігаються.
+
image:bp-modeling/bp/element-temp/call-activity/element-temp-call-activity-check-excerpt-status-2.png[]

NOTE: Всі інші атрибути, як то `Called Element`, `CallActivity Type` тощо, необхідні для налаштування Call Activity вручну, без використання шаблону, визначаються автоматично, "під капотом".

////
[#read-entity-another-registry]
==== Делегат для отримання даних із сутності в БД іншого реєстру

Розширення *Read entity from another registry data factory* -- делегат для інтеграції бізнес-процесів із бізнес-процесами інших реєстрів на Платформі, який налаштовується за допомогою розробленого однойменного шаблону *Read entity from another registry data factory* (_registryDataFactoryConnectorReadDelegate.json_).

Для налаштування шаблону делегата в Camunda Modeler, необхідно виконати наступні кроки: ::

. Створіть *Service Task*.

. На панелі налаштувань справа натисніть кнопку `Open Catalog`, оберіть відповідний шаблон *Read entity from another registry data factory* зі списку та натисніть `Apply` для підтвердження.
+
image:bp-modeling/bp/element-temp/read-entity-another-registry/read-entity-another-registry-1.png[]

. Сконфігуруйте обраний шаблон:
+
NOTE: Перед налаштуванням шаблону в Сamunda Modeler переконайтеся, що папка із застосунком _resources_ -> _element-templates_ містить файл _registryDataFactoryConnectorReadDelegate.json_.

* У полі `Name` введіть назву сервісної задачі, в рамках якої налаштовується делегат. Наприклад, `Отримати сутність із БД іншого реєстру на Платформі`.

* У полі *Target registry* вкажіть назву цільового реєстру, в БД якого знаходиться сутність.  Наприклад, `test-another-registry`.
+
TIP: Назва реєстру має відповідати назві, вказаній для реєстру (namespace) в адміністративній панелі Control Plane.
+
[NOTE]
====
У нашому випадку ми передаємо назву реєстру як константу, напряму, -- `test-another-registry`.

Можна також застосувати для цього функцію `submission()` і передати назву реєстру з користувацької форми як `${submission('<formId>').formData.prop('namespace').value()}`, де `'<formId>'` треба замінити на ID користувацької задачі (форми) у бізнес-процесі, а `'namespace'` -- атрибут для середовища (простір імен) кластера, де такий реєстр розгорнуто.

.Приклад для передачі назви реєстру через функцію submission()
=====
[source,juel]
----
${submission('childDataInput').formData.prop('namespace').value()}
----
=====
====

* У полі `Resource` вкажіть ресурс, тобто назву ендпоінту в API Фабрики даних реєстру, до якого необхідно звернутися. Наприклад, `edu-type`.

* У полі `Resource Id` вкажіть ідентифікатор ресурсу, тобто сутності у Фабриці даних іншого реєстру, яку необхідно отримати. Наприклад, `${typeId}`.
+
[TIP]
====
Ідентифікатор ресурсу визначається у форматі `UUID`. Його можна передати як змінну, взяту із попередніх задач бізнес-процесу, або напряму як `f7dc68fe-98e1-4d95-b80f-df5ce42cebb9`.
====

* У полі `X-Access-Token` вкажіть введіть токен доступу до ресурсу. Наприклад, `${initiator().accessToken}`.
+
[TIP]
====
Токен доступу береться з АБО ініціатора (наприклад, `$initiator().accessToken}`), АБО виконавця останньої користувацької задачі (наприклад, `${completer('taskDefinitionId').accessToken}`).
====

* У полі `Result variable` вкажіть назву змінної процесу, до якої необхідно записати результат (за замовчуванням -- `response`).
+
image:bp-modeling/bp/element-temp/read-entity-another-registry/read-entity-another-registry-2.png[]
////
