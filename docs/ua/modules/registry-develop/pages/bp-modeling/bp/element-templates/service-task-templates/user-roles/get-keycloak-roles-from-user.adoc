= –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ä–æ–ª–µ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ Keycloak: _Get Keycloak roles from user_
include::platform:ROOT:partial$templates/document-attributes/default-set-ua.adoc[]

–¶–µ–π –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ—è—Å–Ω—é—î, —è–∫ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å–∏—Å—Ç–µ–º–Ω—ñ —Ç–∞ —Ä–µ—î—Å—Ç—Ä–æ–≤—ñ —Ä–æ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ Keycloak —É –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—ñ.

== –ó–∞–≥–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è

–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω–µ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è *Get Keycloak roles from user* –¥–æ–∑–≤–æ–ª—è—î –≤–∞–º –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ä–æ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –ø–µ–≤–Ω–æ–≥–æ Keycloak-—Ä–µ–∞–ª–º—É –∑–∞ `userName`.

.–ö–æ—Ä–æ—Ç–∫—ñ –≤—ñ–¥–æ–º–æ—Å—Ç—ñ –ø—Ä–æ –¥–µ–ª–µ–≥–∞—Ç
|===
|–ù–∞–∑–≤–∞ |–ü–æ—è—Å–Ω–µ–Ω–Ω—è

|–ë—ñ–∑–Ω–µ—Å-–Ω–∞–∑–≤–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω–æ–≥–æ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è
|*Get Keycloak roles from user*

|–°–ª—É–∂–±–æ–≤–∞ –Ω–∞–∑–≤–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω–æ–≥–æ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è
|`${keycloakGetUserRoleConnectorDelegate}`

|–ù–∞–∑–≤–∞ —Ñ–∞–π–ª—É –≤ –±—ñ–±–ª—ñ–æ—Ç–µ—Ü—ñ —Ä–æ–∑—à–∏—Ä–µ–Ω—å
|_keycloakGetUserRoleConnectorDelegate.json_
|===

== –ü–µ—Ä–µ–¥ –ø–æ—á–∞—Ç–∫–æ–º

include::partial$admonitions/install-element-templates.adoc[]

== –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

–î–µ–ª–µ–≥–∞—Ç *Get Keycloak roles from user* –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —É —Å–µ—Ä–≤—ñ—Å–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω–Ω—è—Ö (Service Task) –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—É. –í—ñ–Ω –æ—Ç—Ä–∏–º—É—î —Å–ø–∏—Å–æ–∫ —Ä–æ–ª–µ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –ø–µ–≤–Ω–æ–≥–æ Keycloak-—Ä–µ–∞–ª–º—É –∑–∞ —ñ–º–µ–Ω–µ–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.

=== –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å–Ω–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è

. –°—Ç–≤–æ—Ä—ñ—Ç—å –∑–∞–≤–¥–∞–Ω–Ω—è —Ç–∏–ø—É *Service Task* —É –≤–∞—à–æ–º—É –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—ñ.
. –ù–∞–∑–≤—ñ—Ç—å –∑–∞–≤–¥–∞–Ω–Ω—è, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `–û—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö —ñ —Ä–µ—î—Å—Ç—Ä–æ–≤–∏—Ö —Ä–æ–ª–µ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞`.
. –ó–∞—Å—Ç–æ—Å—É–π—Ç–µ —à–∞–±–ª–æ–Ω –¥–µ–ª–µ–≥–∞—Ç–∞, –æ–±—Ä–∞–≤—à–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π –∑—ñ —Å–ø–∏—Å–∫—É –≤ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö –∑–∞–≤–¥–∞–Ω–Ω—è.
+
image:bp-modeling/bp/element-temp/service-task/get-kc-roles-from-user/get-keycloak-roles-from-user-1.png[]

=== –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–µ–ª–µ–≥–∞—Ç–∞

. –£ –ø–æ–ª—ñ *Realm* –æ–±–µ—Ä—ñ—Ç—å `Officer` –¥–ª—è –Ω–∞–¥–∞–≤–∞—á—ñ–≤ –ø–æ—Å–ª—É–≥ –∞–±–æ `Citizen` –¥–ª—è –æ—Ç—Ä–∏–º—É–≤–∞—á—ñ–≤ –ø–æ—Å–ª—É–≥.
. –î–ª—è *Username* –≤—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `${initiator}`, —â–æ–± –≤–∫–∞–∑–∞—Ç–∏ —ñ–Ω—ñ—Ü—ñ–∞—Ç–æ—Ä–∞ –ø—Ä–æ—Ü–µ—Å—É.
. –û–±–µ—Ä—ñ—Ç—å *Role Type*, —â–æ–± –≤–∏–∑–Ω–∞—á–∏—Ç–∏, —è–∫—ñ —Ä–æ–ª—ñ –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏: `REGISTRY ROLES`, `PLATFORM ROLES` –∞–±–æ `ALL ROLES`. –í–∏ –º–æ–∂–µ—Ç–µ –∑–∞–ø–∏—Ç–∞—Ç–∏ –≤—Å—ñ (—Å–∏—Å—Ç–µ–º–Ω—ñ —Ç–∞ —Ä–µ—î—Å—Ç—Ä–æ–≤—ñ), –ª–∏—à–µ —Å–∏—Å—Ç–µ–º–Ω—ñ, –∞–±–æ –ª–∏—à–µ —Ä–µ—î—Å—Ç—Ä–æ–≤—ñ —Ä–æ–ª—ñ, –¥–æ—Å—Ç—É–ø–Ω—ñ –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —É —Ä–µ—î—Å—Ç—Ä—ñ. _–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ_ `REGISTRY ROLES`.
. –í–∫–∞–∂—ñ—Ç—å –∑–º—ñ–Ω–Ω—É –ø—Ä–æ—Ü–µ—Å—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `rolesResponse`), –∫—É–¥–∏ –±—É–¥–µ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å. –¶—è –∑–º—ñ–Ω–Ω–∞ –±—É–¥–µ —Ç–∏–º—á–∞—Å–æ–≤–æ—é (transient). –¶–µ –¥–æ–∑–≤–æ–ª—è—î –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç–∏ –æ—Ç—Ä–∏–º–∞–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏ –±–µ–∑ –∑–∞–π–≤–æ–≥–æ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö.

–†–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–ø–∏—Ç–∞ –±—É–¥–µ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –ø–µ—Ä–µ–ª—ñ–∫—É –Ω–∞–∑–≤ —Ä–æ–ª–µ–π –ø–µ–≤–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–æ–≥–æ —Ä–µ–∞–ª–º–∞: `List<String>`.

.–ü—Ä–∏–∫–ª–∞–¥ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –∑—ñ —Å–ø–∏—Å–∫–æ–º —Ä–æ–ª–µ–π —É —Ñ–æ—Ä–º–∞—Ç—ñ JSON
[source,json]
----
[
  "user",
  "admin",
  "hierarchy-registry-manager",
  "personnel-officer-admin",
  "reviewer"
]
----

–ù–∞–¥–∞–ª—ñ –≤–∏ –∑–º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –æ—Ç—Ä–∏–º–∞–Ω–∏–π —Å–ø–∏—Å–æ–∫ —Ä–æ–ª–µ–π –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Ü—ñ–ª–µ–π —É –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—ñ. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏ –∑–º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –ª–∏—à–µ –ø–µ–≤–Ω—É —Ä–æ–ª—å –∑—ñ —Å–ø–∏—Å–∫—É –∑–∞ —ñ–Ω–¥–µ–∫—Å–æ–º, —Å—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ payload —ñ–∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–º –∑–Ω–∞—á–µ–Ω–Ω—è–º —Ç–∞ –∑–±–µ—Ä–µ–≥—Ç–∏ –¥–æ —Ç–∏–º—á–∞—Å–æ–≤–æ—ó –∑–º—ñ–Ω–Ω–æ—ó –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ–≥–æ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —É –ø—Ä–æ—Ü–µ—Å—ñ:

.–ü—Ä–∏–∫–ª–∞–¥ groovy-—Å–∫—Ä–∏–ø—Ç—É –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–µ—Ä—à–æ—ó —Ä–æ–ª—ñ –∑ –º–∞—Å–∏–≤—É
[source,groovy]
----
// –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –º–∞—Å–∏–≤—É —Ä–æ–ª–µ–π
def roles = ["user", "admin", "hierarchy-registry-manager", "personnel-officer-admin", "reviewer"]

// –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–µ—Ä—à–æ—ó —Ä–æ–ª—ñ –∑ –º–∞—Å–∏–≤—É
def firstRole = roles[0]

// –§–æ—Ä–º—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, —Å—Ç–≤–æ—Ä–∏–º–æ Map –¥–ª—è —Ç–∏–º—á–∞—Å–æ–≤–æ—ó –∑–º—ñ–Ω–Ω–æ—ó payload
def payload = [firstRole: firstRole]

// –ü—Ä–∏–ø—É—Å—Ç–∏–º–æ, —â–æ –≤–µ—Å—å –º–∞—Å–∏–≤ —Ä–æ–ª–µ–π —î –¥–æ—Å—Ç—É–ø–Ω–∏–º–∏ —Ä–æ–ª—è–º–∏, —è–∫—ñ –º–∏ —Ö–æ—á–µ–º–æ –∑–±–µ—Ä–µ–≥—Ç–∏
def availableRoles = roles

// –ó–∞–ø–∏—Å –¥–∞–Ω–∏—Ö —É –∑–º—ñ–Ω–Ω—ñ –ø—Ä–æ—Ü–µ—Å—É
set_transient_variable('payload', payload)
set_variable('availableRoles', availableRoles)
----

== –ü—Ä–∏–∫–ª–∞–¥

–û—Å—å —Ä–µ—Ñ–µ—Ä–µ–Ω—Ç–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥, —è–∫–∏–π –ø–æ–∫–∞–∑—É—î, —è–∫ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π –¥–µ–ª–µ–≥–∞—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —É –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—ñ:

.–†–µ—Ñ–µ—Ä–µ–Ω—Ç–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥. –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä–æ–ª–µ–π —Ç–∞ –∑–∞–ø—É—Å–∫ –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—É –∑–∞ –ø—Ä—è–º–∏–º –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º
image::best-practices/bp-assign-role-via-url/assign-role-via-url-3.png[]

[TIP]
====
[%collapsible]
.–î–µ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥ –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—É?
=====
include::partial$snippets/demo-reg-reference-examples-ua.adoc[]

–ü—Ä–∏–∫–ª–∞–¥ BPMN-—Å—Ö–µ–º–∏ –ø—Ä–æ—Ü–µ—Å—É –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π —É —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—ñ –¥–µ–º–æ-—Ä–µ—î—Å—Ç—Ä—É –∑–∞ –ø–æ—à—É–∫–æ–º –ø–æ –∫–ª—é—á–æ–≤–∏–º —Å–ª–æ–≤–∞–º -- *_reference-assign-role-officer_ —Ç–∞ _reference-assign-role_*.

–ù–∞–∑–≤–∏ —Ñ–æ—Ä–º –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏—Ö –∑–∞–¥–∞—á (User Task) –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—ñ–≤ —É –ø–æ–ª—ñ *`Form key`*:

* _reference-assign-role-start-form.json_
* _reference-role-assigned-info-form.json_
* _reference-role-not-assigned-error-info-form.json_

–£ –ö–∞–±—ñ–Ω–µ—Ç—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π —É —Ä–æ–∑–¥—ñ–ª—ñ menu:–î–æ—Å—Ç—É–ø–Ω—ñ –ø–æ—Å–ª—É–≥–∏[üìÇ –ë—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å–∏ –ø–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—é —Ä–æ–ª–µ–π —á–µ—Ä–µ–∑ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è].

image::best-practices/bp-assign-role-via-url/assign-role-via-url-06.png[]
=====
====

== –ü–æ–≤'—è–∑–∞–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏

* xref:best-practices/bp-launch-via-url.adoc#get-keycloak-roles-from-user[–†–µ—Ñ–µ—Ä–µ–Ω—Ç–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥. –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä–æ–ª–µ–π —Ç–∞ –∑–∞–ø—É—Å–∫ –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—É –∑–∞ –ø—Ä—è–º–∏–º –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º]
* xref:bp-modeling/bp/element-templates/service-task-templates/user-roles/save-user-roles.adoc[]
* xref:bp-modeling/bp/element-templates/service-task-templates/user-roles/get-keycloak-roles-by-realm.adoc[]