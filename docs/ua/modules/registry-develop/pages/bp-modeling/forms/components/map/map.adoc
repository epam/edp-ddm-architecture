= Компонент Map
include::platform:ROOT:partial$templates/document-attributes/default-set-ua.adoc[]

include::platform:ROOT:partial$admonitions/language-ua.adoc[]

== Опис компонента

Компонент *Map* (Мапа) дозволяє використовувати картографічні дані з різних картографічних сервісів, наприклад, OpenStreetMap та інших, а також додавати власні шари та дані геопросторових об'єктів.

CAUTION: Використовуйте *Map* з переліку _Оновлених_ компонентів.

Налаштувати компонент *Map* можна у [.underline]#Кабінеті адміністратора регламентів#, у розділі [.underline]#UI-форми#.

. Створіть нову форму.
. Перейдіть на вкладку [.underline]#Конструктор#.
. Відкрийте [.underline]#Компоненти# > [.underline]#Оновлені#, оберіть компонент `*Map*` та перетягніть його до панелі моделювання.
+
image:bp-modeling/forms/components/map/map-01.png[]

. У налаштуваннях компонента відкрийте вкладку *Display* та у полі `*Label*` вкажіть бізнес-назву поля для вашої мапи. Наприклад, `Map`.
+
image:bp-modeling/forms/components/map/map-1.png[]

. Перейдіть на вкладку *Data* та виконайте наступні налаштування:

* У секції *`Base Layers`* вкажіть URL-адресу картографічного сервісу, наприклад, `OpenStreetMap`, та додаткову інформацію про цей сервіс. Зокрема, ви вказуєте назву шару (`Name`), максимальний масштаб (`Max Zoom`), на якому будуть відображені дані, а також URL-адресу для завантаження зображень плиток (`tiles`) із сервера OpenStreetMap (`https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png`).

* Параметри *`Overlay Search Field`* та `*Search Zoom*` використовуються для пошуку геоданих на карті. Ви можете вказати назву поля для пошуку введеного користувачем значення та масштаб, на якому будуть показані результати пошуку.

* У секції `*Overlay Layers*` ви можете вказати свої власні шари, які будуть накладатися на базовий шар OpenStreetMap. Наприклад, ви можете використовувати дані із власної бази даних, щоб показати місця розташування певних об'єктів на карті. У цьому випадку ви вказуєте URL-адресу GeoServer, де зберігаються ваші геодані, а також назви таблиці та представлення у БД для відображення геоданих на карті.
+
[NOTE]
====
URL-адресу геосервера можна вказати як відносну, так і повну:

* Відносна адреса -- *`/geoserver/registry/ows`*.

* Повна адреса -- `https://geo-server-<назва-реєстру>.apps.envone.dev.registry.eua.gov.ua/geoserver/registry/ows`.

Якщо вказати повну адресу геосервера, то ви зможете переглядати точки та шукати об'єкти на мапі прямо у конструкторі UI-форм.
====
+
image:bp-modeling/forms/components/map/map-2.png[]
+
Поле `*Details Title Path*` використовується для відображення детальної інформації про геопросторові об'єкти, які ви показуєте на карті. Ви можете вказати шлях до поля у вашій базі даних, яке містить назву об'єкта (`Name`), щоб відобразити цю інформацію в детальному вікні при натисканні на об'єкт на карті. Параметр `Address` використовується для відображення адреси геопросторового об'єкта.
+
image:bp-modeling/forms/components/map/map-2-1.png[]

. На вкладці *Data* налаштуйте геокодування:
+

[TIP]
==== 
[%collapsible]
.Що таке геокодування? 
=====
Геокодування -- це процес конвертації адреси або інших описів місць у географічні координати (широта та довгота). У нашому випадку, функціональність геокодування використовує сервіс Nominatim, який базується на даних OpenStreetMap. [[geocoding_link]]
=====
====

* *`Enable Geocode`* -- активація геокодування та підключення Nominatim. Ця опція дозволяє увімкнути чи вимкнути функцію геокодування у додатку.

* *`Geocode Search Placeholder`* -- це текст, який відображається у полі пошуку геокодування за замовчуванням. У цьому випадку користувачів просять ввести адресу або місце для пошуку, використовуючи плейсхолдер `Search`.

* *`Geocode Search Url`* -- це URL-адреса, яка використовується для відправлення запитів на сервер Nominatim для геокодування: +
https://nominatim.openstreetmap.org/search?format=json&q={s}
+
Змінна `{s}` замінюється на текст, введений користувачем у полі пошуку.
+
[NOTE]
====
Ви можете використати будь-який інший сервіс.
====

* *`Geocode Search Zoom`* -- це значення масштабування карти після успішного геокодування. Значення `12`, наприклад, означає, що карта буде збільшена на середній рівень деталізації, забезпечуючи користувачам загальний огляд області.

* *`Geocode Marker Radius`* -- це радіус маркера на карті, який відображає результати геокодування. Значення `10`, наприклад, вказує на середній розмір маркера, що допомагає користувачам легко його розгледіти на карті.

+
image:bp-modeling/forms/components/map/map-4.png[]

. Перейдіть на вкладку *API* та у полі `Property Name` вкажіть назву властивості, яка буде використовуватися в API-запитах. Наприклад, `entityLocation`.
+
image:bp-modeling/forms/components/map/map-3.png[]

. Натисніть kbd:[Save], щоб зберегти зміни, та вийдіть із налаштувань компонента.

. Перевірте, чи працює мапа належним чином. Ви можете знайти певний об'єкт на карті вручну, а також скористатися опціями пошуку та геокодування.
+
image:bp-modeling/forms/components/map/map-5.png[]
+
image:bp-modeling/forms/components/map/map-6.png[]
+
image:bp-modeling/forms/components/map/map-7.png[]

== Основні функції

[tabs]
====
Display ::
include::../general/common-descriptions/display/index.adoc[]
include::../general/common-descriptions/table/table-view.adoc[]
Data ::
* *`Component mode`*: задає режим роботи компонента. Доступні для вибору 2 значення *Edit* та *Select*
** *`Edit`*: режим редагування або створення об'єкта чи об'єктів на мапі
** *`Select`*: режим вибору попередньо нанесених нанесених об'єктів (вимикає елементи редагування об'єктів)
* *`Single value`*: контролює режимом одного об'єкту чи багатьох, які можуть обрані чи відредаговані
* *`Base Layers`*: керує налаштуваннями шарів мапи. Шари для мапи поставляються картографічними сервісами, наприклад `Open Street Map`. Налаштовано може бути один або більше шарів. Для кожного шару, необхідно налаштувати такі параметри:
** *`Url`*: адреса серверу плиток (`tile`) картографічного сервера
** *`Name`*: назва шару, яку користувач буде бачити при виборі шару
** *`Attribution`*: атрибути шару (необов'язковий параметр)
** *`Max Zoom`*: максимальний зум, який може обрати користувач для цього шару
* *`Overlay Search Field`*: поле в даних, по якому буде відбуватись пошук
* *`Search Zoom`*: значення зуму, яке буде автоматично задане після переходу до результату пошуку
* *`Overlay Layers`*: використовується для налаштування власних шарів для мапи, які будуть накладені на основний шар, налаштований в розділі *`Base Layers`*
Для кожного налаштованого власного шару, потрібно задати наступні параметри
** *`Name`*: ім'я шару, яке користувач буде бачити в меню налаштування шарів мапи
** *`Url`*: адреса гео-сервера
** *`Type`*: тип даних гео-сервера (ім'я набору даних)
** *`Custom color`*: колір міток для об'єктів отриманих з гео-сервера (необов'язковий параметр)
** *`Details Title Path`*: шлях в об'єкті даних гео-сервера, де зберігається назва об'єкту, яка буде відображена при натисканні на маркер об'єкту
** *`Details Params`*: додаткові параметри в об'єкті даних гео-сервера, які можуть бути відображені при натисканні на маркер об'єкту
*** *`Title`*: назва для поля, яка буду відображена поруч з його значенням
*** *`Path`*: шлях в об'єкті даних гео-сервера, де зберігається значення для цього параметра
* *`Enable Geocode`*: додає додаткову строку пошуку, в якій можна шукати об'єкти на карті шляхом <<geocoding_link, геокодування>>
** *`Geocode Search Placeholder`*: строка яка буде відображена в пустому полі пошуку
** *`Geocode Search Url`*: url адреса сервера гео-кодування. Для прикладу і за замовчуванням використовується сервер від *Open street map* - `https://nominatim.openstreetmap.org/search?format=json&q={s}`. Де `s`, це значення, яке вводить користувач у поле пошуку. Це значення буде підставлене в url у відповідне місце, замість `{s}`
** *`Geocode Search Zoom`*: значення масштабування після успішного пошуку
** *`Geocode Marker Radius`*: задає розмір маркера для найденого об'єкту
** *`Custom Radius`*: додає ще одне текстове поле, яке відображається між картою і полем пошуку, яке дозволяє задавати радіус маркера користувачу
** *`Redraw On`*: перемальовує компонент, якщо інший компонент змінюється
include::../general/common-descriptions/data/clear-value-when-hidden.adoc[]
include::../general/common-descriptions/data/custom-default-value.adoc[]
include::../general/common-descriptions/data/calculated-value.adoc[]
include::../general/common-descriptions/data/allow-manual-override.adoc[]
Validation ::
include::../general/common-descriptions/validation/required.adoc[]
include::../general/common-descriptions/validation/custom-error-message.adoc[]
include::../general/common-descriptions/validation/custom-validation.adoc[]
Api ::
include::../general/common-descriptions/api/index.adoc[]
Conditional ::
include::../general/common-descriptions/conditional/index.adoc[]

====

== Формат даних
Компонент, в якості даних, використовує спеціальний об'єкт з координатами, або масив таких об'єктів, в залежності від обраної опції *Single* на вкладці *Data* в налаштуваннях компонента. Також структура цього об'єкта залежить від виду об'єкта карти - *Point*, *Polygon* чи *Line*

.Submission
[source,typescript]
----
// Приклад точки (point)
{
  "geometry": {
    "type": "point",
    "longitude": "29.992676",
    "latitude": "50.289449"
  }
}

// Приклад для полігону
{
  "geometry": {
    "type": "polygon",
    "dots": [
      {
        "longitude": "30.047607",
        "latitude": "49.993726"
      },
      {
        "longitude": "30.091553",
        "latitude": "48.958693"
      },
      {
        "longitude": "31.376953",
        "latitude": "49.066781"
      },
      {
        "longitude": "30.047607",
        "latitude": "49.993726"
      }
    ]
  }
}

// Приклад прямої
{
  "geometry": {
    "type": "line",
    "dots": [
      {
        "longitude": "30.563965",
        "latitude": "50.436625"
      },
      {
        "longitude": "36.23291",
        "latitude": "49.993726"
      }
    ]
  }
}
----


== Пов'язані сторінки

* xref:registry-admin/geoserver.adoc[]