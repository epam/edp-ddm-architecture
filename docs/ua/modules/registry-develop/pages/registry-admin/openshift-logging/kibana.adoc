:toc-title: ЗМІСТ
:toc: auto
:toclevels: 5
:experimental:
:important-caption:     ВАЖЛИВО
:note-caption:          ПРИМІТКА
:tip-caption:           ПІДКАЗКА
:warning-caption:       ПОПЕРЕДЖЕННЯ
:caution-caption:       УВАГА
:example-caption:           Приклад
:figure-caption:            Зображення
:table-caption:             Таблиця
:appendix-caption:          Додаток
:sectnums:
:sectnumlevels: 5
:sectanchors:
:sectlinks:
:partnums:

= Робота із журналами подій в інтерфейсі застосунку Kibana

== Інструкція з користування

*Kibana* є інструментом для візуалізації журналів усіх додатків.
Журнали у будь-якому віртуальному середовищі записуються до консолі
й дублюються в *Elasticsearch*.

Отримати доступ до журналів можна в додатку https://kibana-openshift-logging.apps.envone.dev.registry.eua.gov.ua/app/kibana#/management/kibana/index?_g=()[Kibana].

[TIP]
====
Посилання до сервісу технічних логів *Kibana* можливо отримати в адміністративній панелі Control Plane:

Відкрийте вкладку +++<b style="font-weight: 600">Швидкі посилання<b>+++ > розділ +++<b style="font-weight: 600">Операційна зона Платформи<b>+++ та перейдіть за посиланням до +++<b style="font-weight: 600">Вебінтерфейс перегляду журналу подій Платформи (Kibana)<b>+++.

image:bp-modeling/bp/kibana/kibana-section1-figure0.png[]

====

Для цього слід виконати наступні кроки:

.	Відкрийте додаток, перейдіть до секції *Management*.
. Натисніть `Create index pattern`, щоб отримати можливість прочитати журнали з індексів,
що потрапляють до *Elasticsearch*.
+
image:bp-modeling/bp/kibana/kibana-section1-figure1.png[]

.	У полі *Define Index Pattern*, створіть свій індекс-паттерн
згідно з шаблоном. Наприклад, якщо всі журнали починаються з *app-*,
створіть індекс-паттерн *app-**, щоб відобразити відповідні журнали.

.	Натисніть `Next step`, щоб перейти до наступного кроку.
+
image:bp-modeling/bp/kibana/kibana-section1-figure2.png[]

.	Скористуйтеся фільтром на вкладці *Configure Settings*,
щоб обрати період, дані за який слід відобразити.
+
TIP: За замовчуванням, будуть відображені журнали за останні 15 хвилин.

.	Натисніть `Create Index Pattern`.
+
image:bp-modeling/bp/kibana/kibana-section1-figure3.png[]

.	Після створення індекс-паттерну `app-*`, перейдіть на вкладку
**Discover**, щоб отримати наступну інформацію:
*	кількість журналів, що були створені за обраний період;
*	список журналів.

+
image:bp-modeling/bp/kibana/kibana-section1-figure4.png[]

.	Натисніть значок зліва, біля відповідного рядка, щоб подивитися
параметри події:
*	час, коли відбулася подія;
*	місце, де вона відбулася;
*	тип (_info/warning/error_);
*	повідомлення.

+
image:bp-modeling/bp/kibana/kibana-section1-figure5.png[]

== Помилки

=== Фільтрування даних
Якщо при виконанні запиту виникла помилка, отримати інформацію
щодо цієї помилки можна кількома способами за допомогою
*trace id* – ідентифікатора.

Спосіб I. ::

Щоб дістатися до журналів, що містять інформацію про подію,
необхідно скопіювати *trace id* у Реєстрі на порталі або в Openshift
і додати його у строку пошуку на вкладці *Discover*.
Також необхідно обрати період, дані за який слід отримати.
+
image:bp-modeling/bp/kibana/kibana-section2.1-figure1.png[]


Спосіб II. :: На вкладці *Discover*, у вікні *Filter*, оберіть `X-B3-Traceid`,
потім is, додайте *trace id* і натисніть `Save`.
+
image:bp-modeling/bp/kibana/kibana-section2.1-figure2.png[]

Журнали, що з’являться на сторінці, відповідатимуть даному *trace id*.
Щоб скоротити обсяг інформації, яку буде відображено, і отримати лише
необхідну, слід налаштувати відповідні поля, обравши `Message` і `Level`
зі списку ліворуч.

image:bp-modeling/bp/kibana/kibana-section2.1-figure3.png[]

=== Візуалізація даних
Kibana дозволяє візуалізувати інформацію за допомогою різних чартів.
Для цього здійсніть наступні кроки:

.	Оберіть вкладку *Visualize*;
.	Натисніть `Create visualization`;
.	Оберіть тип візуалізації;
.	Оберіть час, за який слід отримати дані.

+
image:bp-modeling/bp/kibana/kibana-section2.2-figure1.png[]

Візуалізації можуть бути об’єднані й розміщені на одній дошці за
допомогою вкладки *Dashboard*.

image:bp-modeling/bp/kibana/kibana-section2.2-figure2.png[]

=== Імпорт дашборду

Для імпортування дашборду, завантажте файл https://epam-my.sharepoint.com/personal/kateryna_rozhkovska_epam_com/_layouts/15/AccessDenied.aspx?Source=https%3A%2F%2Fepam%2Dmy%2Esharepoint%2Ecom%2Fpersonal%2Fkateryna%5Frozhkovska%5Fepam%5Fcom%2FDocuments%2FMicrosoft%20Teams%20Chat%20Files%2Fkibana%2Dlogs%2Ddashboard%2Ejson&correlation=652e3fa0%2D90b5%2D4000%2D546e%2Df4ace3ac0b89&Type=item&name=9ecbc264%2D8c0e%2D4366%2Dbe60%2Df8d3b916840a&listItemId=42[kibana-logs-dashboard.json.]

Далі зробіть наступні кроки:

.	Оберіть вкладку *Management*.
.	Натисніть `Saved Objects`.
.	Натисніть `Import`.
.	У вкладці, що відкрилася, знов натисніть `Import`.
.	Після завантаження, зайдіть в папку Downloads і оберіть файл *_kibana-logs-dashboard.json_*.
.	Натисніть `Import` і `Done`, щоб імпортувати всі об’єкти, серед яких є:
*	дашборд;
*	індекс-паттерн, що був створений;
*	всі візуалізації.

+
image:bp-modeling/bp/kibana/kibana-section2.3-figure1.png[]

Після здійснення імпорту, для отримання доступу до консолідованої
інформації з усіх журналів виконайте наступні дії.

.	Перейдіть на вкладку *Dashboard*.
.	Оберіть `Logs Dashboard` зі списку.
image:bp-modeling/bp/kibana/kibana-section2.3-figure2.png[]
.	Оберіть середовище за допомогою фільтрів.
.	Натисніть `Apply changes` та отримайте агреговану інформацію по даному
середовищу за останні 15 хвилин.
.	Скористайтеся фільтром, щоб зазначити час, за який потрібна інформація.
image:bp-modeling/bp/kibana/kibana-section2.3-figure3.png[]

=== Робота з чартами
Інформація, яку відображено на чартах і в таблицях містить:

.	загальну кількість запитів за обраний період:
* вихідних;
* вхідних.
.	кількість вхідних запитів, що надійшли в те чи інше середовище.
+
image:bp-modeling/bp/kibana/kibana-section2.4-figure1.png[]
.	загальну кількість:
* помилок;
* відповідей.
.	кількість відповідей, що надійшли в те чи інше середовище;
+
image:bp-modeling/bp/kibana/kibana-section2.4-figure2.png[]
+
[TIP]
====
Запити й відповіді є окремі події, що пишуться в окремі журнали.
Кількість відповідей повинна сходитися з кількістю запитів.

Відповідь вважається успішною, якщо код відповіді не перевищує 500.
Якщо значення сягає 500 і більше, це вказує на наявність помилки.
====
.	*http трафік* (перелік запитів, що надійшли та відповідей,
що були отримані);
+
image:bp-modeling/bp/kibana/kibana-section2.4-figure3.png[]
.	всі журнали з інформацією, яка дозволяє провести детальне
розслідування падіння запиту;
+
image:bp-modeling/bp/kibana/kibana-section2.4-figure4.png[]
.	далі фільтруємо інформацію за конкретним *trace id*;
+
image:bp-modeling/bp/kibana/kibana-section2.4-figure5.png[]
.	ми бачимо скільки запитів і відповідей було за цим trace id,
всі журнали, а також повідомлення в журналах, що містять такі дані:
* час тривання запиту;
* хедери;
* статус-код відповіді;
* повідомлення;
* всі журнали, що відповідають цьому ідентифікатору.

+
image:bp-modeling/bp/kibana/kibana-section2.4-figure6.png[]
.	виключення  є сортовані за кількістю (зменшується знизу вверх)  і містять наступну інформацію:
* які то були виключення;
* на якому сервісі виникли.

+
image:bp-modeling/bp/kibana/kibana-section2.4-figure7.png[]

Для отримання більш детальної інформації щодо виключення:

.	оберіть час;
.	перейдіть до поля `container` і оберіть ім’я сервісу, на якому трапилася помилка;
.	натисніть `Apply changes`.
+
image:bp-modeling/bp/kibana/kibana-section2.4-figure8.png[]

Якщо помилка трапилася не у рамках якогось сервісу:

. Скопіюйте назву помилки.
+
image:bp-modeling/bp/kibana/kibana-section2.4-figure9.png[]

. Додайте назву у рядок пошуку (повинна бути у подвійних лапках
з метою фільтрування за точним співпадінням всіх символів).
+
image:bp-modeling/bp/kibana/kibana-section2.4-figure10.png[]
+
У таблиці нижче, наведені такі дані:

* час;
* рівень;
* повідомлення.

+
image:bp-modeling/bp/kibana/kibana-section2.4-figure11.png[]

Розділ *повідомлення* містить детальну інформацію про помилку та причини,
за яких вона сталася.

image:bp-modeling/bp/kibana/kibana-section2.4-figure12.png[]

На вкладці `Dashboard`, ми бачимо кількість помилок,
що виникли за обраний період часу.

image:bp-modeling/bp/kibana/kibana-section2.4-figure13.png[]

Якщо натиснути на цифру, буде створено фільтр з кодами відповідей:
501, 502, 503, 504, 505.

image:bp-modeling/bp/kibana/kibana-section2.4-figure14.png[]

Нижче ми можемо побачити інформацію відносно цих кодів відповідей.
Якщо скопіювати trace id запита, де сталася помилка і вставити в строку
пошуку на вкладці Dashboard, можна отримати інформацію за цим ідентифікатором.

image:bp-modeling/bp/kibana/kibana-section2.4-figure15.png[]

Зараз ми маємо змогу бачити кількість запитів, відповідей та помилок за даним trace id.

image:bp-modeling/bp/kibana/kibana-section2.4-figure16.png[]

Далі переходимо до таблиці, яка містить інформацію по запиту де сталася помилка.
Таблицю слід починати дивитися знизу оскільки дані сортовані за часом.

image:bp-modeling/bp/kibana/kibana-section2.4-figure17.png[]

Таблиця дозволяє прослідкувати весь шлях проходження запиту і знайти місце
де сталася помилка, а також з’ясувати її причини.

Запит з помилкою завжди має виключення, за допомогою якого ми можемо
зрозуміти чому сталася помилка. Для цього треба звернути увагу на розділ
*level*, який може мати одне з трьох значень:

* *info* – інформація про стан подій;
* *warning* – застереження;
* *error* - помилка.

Перші два значення не є критичними та не потребують особливої уваги.

Щоб знайти помилку скористуйтеся фільтром на вкладці `Dashboard` і оберіть err.

image:bp-modeling/bp/kibana/kibana-section2.4-figure18.png[]

У журналах помилок, що відкрилися, натисніть на стрілку справа,
щоб подивитися детальну інформацію.

image:bp-modeling/bp/kibana/kibana-section2.4-figure19.png[]

Дана інформація містить дані про помилку і причину.

image:bp-modeling/bp/kibana/kibana-section2.4-figure20.png[]






