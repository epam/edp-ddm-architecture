= Візуалізація стану запитів у Kibana при роботі реєстру
include::platform:ROOT:partial$templates/document-attributes/default-set-ua.adoc[]

include::platform:ROOT:partial$admonitions/language-ua.adoc[]

== Зовнішній вигляд

Дашборд *_Стан запитів_* надає оглядову інформацію про роботу реєстру, зокрема статуси виконання зовнішніх запитів і аналіз виниклих помилок. Він дозволяє оперативно оцінювати загальний стан системи, виявляти потенційні проблеми, а також забезпечує детальний аналіз запитів до API, використання кваліфікованого електронного підпису (КЕП) і помилок у роботі різних компонентів реєстру.

Дашборд включає візуалізації для моніторингу запитів до мікросервісів, відстеження помилок у Rest API, оцінки продуктивності API Gateway, а також інструменти для динамічної фільтрації даних за мікросервісами. Завдяки зручному візуальному представленню інформації, користувачі можуть швидко ідентифікувати проблеми та вживати необхідних заходів для їх усунення.

.Візуалізації дашборда
[cols="1,3", options="header"]
|===
|Назва візуалізації |Опис

|*Запити до мікросервісів реєстрів*
|Відображає загальну кількість запитів до мікросервісів реєстрів із розподілом за HTTP-кодами відповіді та контейнерами.

|*Запити до API Gateway*
|Показує загальну кількість зовнішніх HTTP-запитів, які надійшли до реєстру, з розподілом за статусами відповідей.

|*Використання КЕП у реєстрі*
|Показує загальну кількість операцій із використанням кваліфікованого електронного підпису (КЕП), виконаних на криптосервісі, з розподілом за типом та статусом виконання.

|*Помилки у Rest API фабрики даних*
|Відображає кількість помилок, що виникли в процесі обробки запитів до Rest API фабрики даних, із деталізацією за типами винятків.

|*Виклики з Трембіти*
|Показує запити, що проходять через інтеграційну платформу "Трембіта", із розподілом за кодами відповідей.

|*Unexpected EOF on client connection*
|Візуалізує кількість помилок при неочікуваних збоях з'єднання з базою даних.

|*Помилки реплікації аналітичної БД*
|Відображає помилки реплікації аналітичної бази даних.

|*Фільтр для мікросервісів*
|Дозволяє користувачам фільтрувати дані за іменем контейнера, щоб спростити аналіз конкретного мікросервісу.
|===

Зразки деяких візуалізацій представлені на знімках екрана нижче: ::
+
.Запити до API Gateway, помилки в Rest API фабрики даних, та використання КЕП у реєстрі
image::registry-admin/kibana/dashboard-1.png[]
+
.Запити до мікросервісів
image::registry-admin/kibana/dashboard-2.png[]

== Налаштування

Щоб встановити цей дашборд, виконайте наступні кроки:

//Updated 01/10/2025
. Завантажте файл xref:attachment$registry-admin/openshift-logging/request-dashboard.json[request-dashboard.json].

. Замініть у файлі всі плейсхолдери із назвою *`YOUR_REGISTRY_NAME`* на назву потрібного реєстру у пошукових запитах за допомогою зручного для вас текстового редактора. Таких плейсхолдерів наразі 8 шт.
+
image:registry-admin/kibana/file-prep-1.png[]
+
image:registry-admin/kibana/file-prep-2.png[]
+
image:registry-admin/kibana/file-prep-3.png[]

. Створіть через вебінтерфейс Kibana _2 index pattern_: **``app-* ``**та *`app-<REGISTRY-NAME>-*`*.
+
TIP: *`<REGISTRY-NAME>`* -- назва вашого реєстру. Наприклад, *`app-test-registry-*`*.
+
.Створення index pattern. Крок 1/2
image::registry-admin/kibana/index-pattern-1.png[]
+
.Створення index pattern. Крок 2/2
image::registry-admin/kibana/index-pattern-2.png[]

. Імпортуйте підготовлений на 2 кроці файл через вебінтерфейс Kibana.
+
image:registry-admin/kibana/import-dashboard-1.png[]
+
image:registry-admin/kibana/import-dashboard-2.png[width=60%]
+
При імпорті оберіть відповідний _index pattern_ для візуалізацій (*`app-REGISTRY-NAME-*`*).
+
image:registry-admin/kibana/import-dashboard-3.png[width=50%]

. Налаштуйте динамічний фільтр.
+
Для правильної роботи *Фільтра для мікросервісів*, оновіть значення
*`indexPattern` ID*. Для цього:

.. Відкрийте візуалізацію *Запити до API Gateway*.
+
image:registry-admin/kibana/filter-setup-1.png[]

.. Скопіюйте значення параметра `*index*` у секції *`kibanaSavedObjectMeta.searchSourceJSON`*.
+
image:registry-admin/kibana/filter-setup-2.png[]

.. Відкрийте візуалізацію *Фільтр для мікросервісів* та змініть значення поля *`params.controls[0].indexPattern`* у секції *`visState`* на значення із попереднього пункту.
+
TIP: Значення *`indexPattern`* за замовчуванням:
*`APP-*_INDEX_ID`*.
+
image:registry-admin/kibana/filter-setup-3.png[]
+
image:registry-admin/kibana/filter-setup-4.png[]
+
image:registry-admin/kibana/filter-setup-5.png[]

. Натисніть *Save visualization Object*.

. У розділі menu:Dashboard[Стан запитів] ви можете переглянути стан запитів під час роботи реєстру.
+
image:registry-admin/kibana/final-result-1.png[]







