:toc-title: ЗМІСТ
:toc: auto
:toclevels: 5
:experimental:
:important-caption:     ВАЖЛИВО
:note-caption:          ПРИМІТКА
:tip-caption:           ПІДКАЗКА
:warning-caption:       ПОПЕРЕДЖЕННЯ
:caution-caption:       УВАГА
:example-caption:           Приклад
:figure-caption:            Зображення
:table-caption:             Таблиця
:appendix-caption:          Додаток
:sectnums:
:sectnumlevels: 5
:sectanchors:
:sectlinks:
:partnums:

= Візуалізація стану запитів у Kibana при роботі реєстру

== Зовнішній вигляд

Цей дашборд надає оглядову інформацію про роботу реєстру, зокрема статуси виконання зовнішніх запитів. Він включає декілька візуалізацій:

Запити до API Gateway: ::
Показує загальну кількість зовнішніх HTTP-запитів, які надійшли до реєстру.

Помилки в Rest API фабрики даних ::
Показує кількість помилок, що виникли в процесі обробки запитів до Rest API фабрики даних.

Використання КЕП у реєстрі: ::
Показує загальну кількість операцій, виконаних на криптосервісі, з розподілом за типом та статусом виконання.

Запити до мікросервісів реєстрів: ::
Відображає загальну кількість запитів до мікросервісів реєстрів з розподілом за HTTP-кодом відповіді.

.Запити до API Gateway, помилки в Rest API фабрики даних та використання КЕП у реєстрі
image::registry-admin/kibana/dashboard-1.png[]

.Запити до мікросервісів реєстрів
image::registry-admin/kibana/dashboard-2.png[]

//TODO: HERE
== Налаштування
Для встановлення даного дашборда необхідно виконати наступне:

1. Завантажити файл за link:{attachmentsdir}/kibana/request-dashboard.json[посиланням]

2. Замінити в файлі всі плейсхолдери з назвою *YOUR_REGISTRY_NAME* на назву потрібного реєстру в пошукових запитах (5 шт)
в зручному для Вас текстовому редакторі
image:registry-admin/kibana/file-prep-1.png[]
image:registry-admin/kibana/file-prep-2.png[]
image:registry-admin/kibana/file-prep-3.png[]

3. Створіть через веб інтерфейс Kibana 2 index pattern: _app-*_ та _app-REGISTRY-NAME-*_,
де _REGISTRY-NAME_ - назва вашого реєстру
image:registry-admin/kibana/index-pattern-1.png[]
image:registry-admin/kibana/index-pattern-2.png[]

4. Імпортуйте підготовлений на 2 кроці файл через веб інтерфейс Kibana
image:registry-admin/kibana/import-dashboard-1.png[]
image:registry-admin/kibana/import-dashboard-2.png[]
При імпорті оберіть відповідний індекс паттерн для візуалізацій (_app-REGISTRY-NAME-*_)
image:registry-admin/kibana/import-dashboard-3.png[]

5. Налаштування динамічного фільтру. Для коректної роботи фільтра "Фільтр для мікросервісів" потрібно оновити значення
index pattern id. Для цього потрібно:

* Зайти у візуалізацію "Запити до API Gateway"
image:registry-admin/kibana/filter-setup-1.png[]
* Cкопіювати значення у полі index у секції "kibanaSavedObjectMeta.searchSourceJSON"
image:registry-admin/kibana/filter-setup-2.png[]
* Зайти у візуалізацію "Фільтр для мікросервісів" та Змінити значення поля params.controls[0].indexPattern (default value
APP-*_INDEX_ID) у секції "visState" на значення з попереднього пункту
image:registry-admin/kibana/filter-setup-3.png[]
image:registry-admin/kibana/filter-setup-4.png[]
image:registry-admin/kibana/filter-setup-5.png[]

6. На сторінці Dashboard/Стан запитів
image:registry-admin/kibana/final-result-1.png[]






