= Використання єдиного облікового запису в системі
include::platform:ROOT:partial$templates/document-attributes/default-set-ua.adoc[]

== Огляд

Впроваджено нову логіку автентифікації "Єдиний обліковий запис" для кабінетів користувачів, яка забезпечує унікальність облікового запису на основі атрибутів `fullName` та `drfo`. Це дозволяє уникнути конфліктів під час автентифікації різних типів користувачів (фізичних осіб, ФОП та юридичних осіб), які можуть мати однакові атрибути.

== Основні функції

* У файлі `deploy-templates/values.yaml` використовується параметр `SingleIdentityEnabled`, який дозволяє вмикати або вимикати логіку "Єдиний обліковий запис".
* Логіка автентифікації передбачає:
- Використання одного облікового запису Keycloak для користувачів із ролями `legal`, `entrepreneur`, `individual`.
- Збереження незмінних атрибутів в обліковому записі Keycloak, незалежно від типу користувача.
- Блокування автентифікації, якщо в системі Keycloak є кілька облікових записів з однаковими `fullName` та `drfo`.

== Кроки налаштування

. Відкрийте адміністративну панель *Control Plane*.
. Перейдіть у розділ *Реєстри*, оберіть потрібний реєстр і натисніть *Редагувати*.
. У секції *Кабінет надавача послуг* у розділі *Управління доступом* активуйте перемикач *Дозволити використання єдиного облікового запису в системі*.
+
image:registry-admin/cp-auth-setup-officers/enable-single-identity/single-identity-2.png[]
+
image:registry-admin/cp-auth-setup-officers/enable-single-identity/single-identity-1.png[]

. Збережіть зміни та перейдіть до *Запитів на оновлення*.
. Відкрийте потрібний запит для перегляду змін у файл конфігурації `deploy-templates/values.yaml`. У списку змін буде відображено параметр `SingleIdentityEnabled: true`, який відповідає налаштуванням `KeycloakAuthFlow`.
+
image:registry-admin/cp-auth-setup-officers/enable-single-identity/single-identity-3.png[]
+
image:registry-admin/cp-auth-setup-officers/enable-single-identity/single-identity-4.png[]

. Підтвердьте зміни та дочекайтеся завершення збірки реєстру *MASTER-Build*.

== Переваги

. Забезпечено унікальність облікових записів у Keycloak.
. Підвищено безпеку та надійність процесу автентифікації.
. Зменшено ризик помилок через дублювання облікових записів з однаковими атрибутами.
. Покращено досвід автентифікації для користувачів, які використовують різні ключі (фізична особа, ФОП чи представник юридичної особи).

== Приклад

Зображення нижче демонструє обліковий запис користувача "Сидоренко Василь Леонідович" з атрибутами `drfo` та `fullName`, створений у Keycloak.

image:registry-admin/cp-auth-setup-officers/enable-single-identity/single-identity-5.png[]

Після активації логіки "Єдиний обліковий запис" цей користувач буде ідентифікований як одна особа, незалежно від того, який КЕП він використовує для автентифікації. Це забезпечує збереження його налаштувань доступу до бізнес-процесів та ролей, що робить систему зручнішою та інтуїтивнішою для користувача.

Для перевірки правильності налаштувань виконайте наступні кроки: ::

. У *Control Plane* перейдіть до menu:Швидкі посилання[Операційна зона реєстру] та відкрийте *Кабінет користувача*.
+
image:registry-admin/cp-auth-setup-officers/enable-single-identity/single-identity-6.png[]

. Виконайте автентифікацію з використанням різних КЕП-ключів по черзі:

* КЕП посадової особи, яка є співробітником певної організації:
 +
image:registry-admin/cp-auth-setup-officers/enable-single-identity/single-identity-7.png[]

* КЕП фізичної особи-підприємця (ФОП):
 +
image:registry-admin/cp-auth-setup-officers/enable-single-identity/single-identity-8.png[]

* КЕП фізичної особи:
 +
image:registry-admin/cp-auth-setup-officers/enable-single-identity/single-identity-9.png[]

У цьому прикладі, незалежно від типу використаного КЕП, користувач Сидоренко Василь Леонідович успішно увійшов до Кабінету під своїм єдиним обліковим записом.



