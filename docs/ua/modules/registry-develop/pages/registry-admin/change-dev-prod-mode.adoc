:toc-title: ЗМІСТ
//:toc: auto
:toclevels: 5
:experimental:
:important-caption:     ВАЖЛИВО
:note-caption:          ПРИМІТКА
:tip-caption:           ПІДКАЗКА
:warning-caption:       ПОПЕРЕДЖЕННЯ
:caution-caption:       УВАГА
:example-caption:           Приклад
:figure-caption:            Зображення
:table-caption:             Таблиця
:appendix-caption:          Додаток
:sectnums:
:sectnumlevels: 5
:sectanchors:
:sectlinks:
:partnums:

= Зміна deploymentMode з production на development

Щоб змінити `*deploymentMode*` із `production` на `development`, виконайте наступні кроки:

. Знайдіть змінну `deploymentMode: production` у файлі _deploy-templates/values.yaml_ та змініть її значення на `deploymentMode: development`.

. Виконайте `git commit` зі змінами, підтвердьте його у мастер-гілці та запустіть розгортання реєстру.

[NOTE]
Налаштування *Redash admin* та *Pgadmin* є опційними й потрібні лише як додаткові кроки при виникненні проблем зі зміною режиму. Ми рекомендуємо ознайомитися з ними, але врахуйте, що вони не є обов'язковими для зміни `deploymentMode`.

[tabs]
====
Redash admin::
+
--
Компонент *`redash-admin`* доступний виключно в режимі *`development`* і не буде розгортатися при первинній інсталяції в режимі *`production`*. При повторному оновленні реєстру зі зміною режиму на `development`, компонент `redash-admin` стає доступним, але не виконається post-install скрипт _admin-hook-install-job.yaml_, який створює початкові налаштування бази даних *Redash admin*, зокрема таблиці. Така поведінка є очікуваною, оскільки насправді відбувається оновлення (update) реєстру, а не його установка (install).

. Запустіть наступний скрипт вручну з поди *`redash-admin`*:
+
[source,bash]
----
bash /config/install-upgrade.sh install
----

. Після успішного завершення конфігурування `redash-admin` бази даних, перезапустіть пайплайн розгортання реєстру, якщо попередня спроба закінчилася неуспішно через `redash-chart deploy`.
--

Pgadmin::
+
--
. Перевірте останню доступну версію PgAdmin у *`control-plane-gerrit`*.
+
image:registry-admin/change-dev-prod-mode/change-mode-1.png[image,width=468,height=208]

. Додайте наступний чарт до _deploy-templates/helmfile.yaml_, у розділі `releases` із версією компонента з попереднього кроку:
+
[source,yaml]
----
- name: pgadmin-chart
  namespace: '{{ env "NAMESPACE" }}'
  labels:
    type: remote
    update_scc: true
    repoURL: ssh://jenkins@gerrit.mdtu-ddm-edp-cicd:32114/mdtu-ddm/data-architecture/devops-application/pgadmin-chart.git
    path: components/registry/
    branch: 0.0.1-SNAPSHOT.69
  chart: /opt/repositories/pgadmin-chart/deploy-templates
  version: 0.0.1-SNAPSHOT.69
  values:
    - values.yaml
    - values.gotmpl
  missingFileHandler: Warn
  needs:
    - '{{ env "NAMESPACE"}}/istio-configuration'
    - '{{ env "NAMESPACE"}}/network-management'
    - '{{ env "NAMESPACE"}}/citus'
----
--

====
