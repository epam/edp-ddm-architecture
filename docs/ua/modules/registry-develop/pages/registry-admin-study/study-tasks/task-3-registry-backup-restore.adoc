= Завдання 3. Резервне копіювання та відновлення реєстру та його компонентів
include::platform:ROOT:partial$templates/document-attributes/default-set-ua.adoc[]

== Мета завдання

Виконання цього завдання має на меті: ::

* Створити резервну копію реєстру.
* Внести контрольні зміни до реєстру.
* Відновити попередню версію реєстру із втратою внесених змін.
* Налаштувати автоматичне резервне копіювання.

== Завдання

=== Створення резервної копії реєстру

. Ознайомтеся з інструкцією по резервному копіюванню та відновленню екземпляра реєстру та виконайте кроки, описані в розділі xref:admin:backup-restore/control-plane-backup-restore.adoc["Створення резервної копії реєстру (backup)"].

. Оберіть опцію *Console Output* в меню зліва та переконайтеся, що процес створення резервної копії в Jenkins звершився успішно.

. Не виходячи з Console Output, визначте назву створеної резервної копії. Назву буде представлено в наступному форматі:
+
....
[INFO] Velero backup - <назва реєстру>-<дата>-<час> done with Completed status
....
Наприклад:
+
image:registry-develop:registry-admin-study/task-3/task-3-01-backup-name.png[]

=== Внесення контрольних змін до реєстру

Для перевірки результату відновлення реєстру з резервної копії треба внести контрольні зміни до реєстру після того, як створено резервну копію. В якості таких змін можна створити версію-кандидат та додати до неї просту форму.

. Ознайомтеся з інструкцією по створенню запитів на внесення змін та виконайте кроки, описані в розділі xref:registry-admin/admin-portal/version-control/create-new-change-request.adoc["Створення запиту"].
+
При створенні запиту використовуйте наступні налаштування:
+
* Назва версії: зміна-01
* Опис зміни: Зміна перед відновленням резервної копії
+
image:registry-develop:registry-admin-study/task-3/task-3-02-create-merge-request.png[]

. Відкрийте Кабінет адміністратора регламентів та створіть форму за допомогою Конструктора.
+
[TIP]
====
Щоб дізнатися більше про моделювання UI-форм та поле File, ознайомтеся із наступними інструкціями:

* xref:registry-develop:bp-modeling/forms/registry-admin-modelling-forms.adoc[]
* xref:registry-develop:bp-modeling/forms/components/file/file.adoc[]
====
+
При створенні форми використовуйте наступні налаштування:
+
* Бізнес-назва форми: форма для демонстрації процесу відновлення з бекапу
* Службова назва форми: restore-test-form
+
image:registry-develop:registry-admin-study/task-3/task-3-03-create-form.png[]

. Додайте до форми одне поле File.
+
image:registry-develop:registry-admin-study/task-3/task-3-04-add-file-field.png[]

. В результаті у версії-кандидаті `зміна-01` має бути створено форму `restore-test-form`.
+
image:registry-develop:registry-admin-study/task-3/task-3-05-form-added.png[]

=== Відновлення попередньої версії реєстру із втратою внесених змін

. Ознайомтеся з інструкцією по резервному копіюванню та відновленню екземпляра реєстру та виконайте кроки, описані в розділі xref:admin:backup-restore/control-plane-backup-restore.adoc["Відновлення реєстру (Restore)"].

. Переконайтеся, що процес *`Restore-registry-backup-test`* в Jenkins завершився успішно.
+
image:registry-develop:registry-admin-study/task-3/task-3-06-restore-pipeline-success.png[]

. Відкрийте Кабінет адміністратора регламентів та переконайтеся в наступному:
+
* Зміни, внесені після створення резервної копії, втрачено.
* Реєстр відновлено до стану, коли версії-кандидату та форми не було створено.

=== Налаштування автоматичного резервного копіювання

[TIP]
====
Перш ніж виконувати цю частину завдання, рекомендуємо ознайомитися із форматом утиліти Unix cron:

* https://uk.wikipedia.org/wiki/Cron[Стаття cron у Вікіпедії]
* https://crontab.guru/[Сервіс Cronitor, редактор виразів cron]
====

. Ознайомтеся з інструкцією по керуванню розкладом резервного копіювання реєстру та виконайте кроки, описані в розділі xref:admin:backup-restore/backup-schedule-registry-components.adoc["Налаштування розкладу резервного копіювання"].
+
При створенні розкладу додайте 20 хвилин до поточного часу та встановіть це значення для годин та хвилин у полі Розклад.
+
[NOTE]
====
Також зазначте, що резервування потрібно створювати тільки протягом робочих днів. Приклад розкладу:

image:registry-develop:registry-admin-study/task-3/task-3-07-cronitor.png[]
====

. Підтвердьте зміни та застосуйте налаштування розкладу, як показано у розділах "Резервне копіювання реплікацій об'єктів S3" та "Застосування конфігурації розкладу" xref:admin:backup-restore/backup-schedule-registry-components.adoc[інструкції по керуванню розкладом резервного копіювання реєстру].
+
CAUTION: Зверніть увагу, що час для реплікації у S3 задається за іншим часовим поясом! Зробіть відповідні зміни до секції "Резервне копіювання реплікацій об'єктів S3".

. Після успішної зборки коду переконайтеся, що у процесі *Create-registry-backup-`<registry-name>`* додався автоматичній розклад у секції *Build Triggers*.
+
.. Відкрийте процес та натисніть опцію *Configure* в меню зліва.
+
image:registry-develop:registry-admin-study/task-3/task-3-08-configure-backup-pipeline.png[]

.. Відкрийте вкладку *Build Triggers*.
+
image:registry-develop:registry-admin-study/task-3/task-3-09-build-triggers.png[]

. У зазначений час (n+20 хвилин) переконайтеся, що процес  *Create-registry-backup-`<registry-name>`* почав роботу за розкладом.
+
image:registry-develop:registry-admin-study/task-3/task-3-10-started-by-timer.png[]