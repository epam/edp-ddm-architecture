= Завдання 2. Створення та видалення адміністраторів реєстру
include::platform:ROOT:partial$templates/document-attributes/default-set-ua.adoc[]

== Мета завдання

Виконання цього завдання має на меті: ::

* Отримати практичні навички додавання та видалення адміністраторів реєстру.

* Навчитися додавати групи та ролі для користувачів у Keycloak.

== Корисні матеріали

Перш ніж виконувати це завдання, рекомендуємо ознайомитися із наступною документацією:

* xref:arch:architecture/platform/operational/user-management/platform-actors-roles.adoc[]

* xref:registry-admin-study/registry-admin-study.adoc[], розділ "Створення та видалення адміністраторів реєстру"

== Завдання

NOTE: Завдання виконується у тестовому реєстрі.

=== Створення адміністратора реєстру

. Створіть адміністратора реєстру, керуючись інструкцією xref:registry-admin/create-users/create-registry-admins.adoc[] (розділ 2, кроки 1-6).
+
При створенні адміністратора використовуйте наступні налаштування:
+
* Ім'я: Петр
+
>>ВИКОРИСТОВУЄМО ЧЕСЬКЕ НАПИСАННЯ ЧИ ЗМІНЕМО НА "ПЕТРО" (+ EMAIL)?<<
* Прізвище: Петренко
* Електронна пошта: petr@petrenko.com
* Тимчасовий пароль: 123
+
image:registry-develop:registry-admin-study/task-2/task-2-02-administrator-details.png[]
+
TIP: Зверніть увагу на альтернативний шлях підтвердження змін через систему рецензування коду Gerrit.

. Перейдіть з Control Plane до інтерфейсу Jenkins.
+
[TIP]
====
Ви можете знайти посилання на Jenkins в наступних розділах тестового реєстру у Control Plane:

* У розділі швидких посилань: АДМІНІСТРАТИВНА ЗОНА ПЛАТФОРМИ > Сервіс розгортання конфігурації (Jenkins).

* У розділі ІНФОРМАЦІЯ ПРО РЕЄСТР > КОНФІГУРАЦІЯ > колонка *CI*.
+
image:registry-develop:registry-admin-study/task-2/task-2-04-jenkins-ci-link.png[]
====

. В інтерфейсі Jenkins знайдіть та відкрийте процес із назвою *MASTER-Build-`<registry-name>`*, де `<registry-name>` -- це назва тестового реєстру.

. Оберіть опцію *Console Output* у меню зліва та дочекайтеся успішного завершення процесу:
+
image:registry-develop:registry-admin-study/task-2/task-2-05-console-output.png[]

* Процес має завершитися зі статусом `Finished: SUCCESS`.
+
image:registry-develop:registry-admin-study/task-2/task-2-06-pipeline-success.png[]

* Всі етапи процесу мають бути позначені зеленим кольором.
+
image:registry-develop:registry-admin-study/task-2/task-2-07-pipeline-green.png[]

. Перейдіть до загальної інформації про тестовий реєстр у консолі Control Plane та впевніться, що нового адміністратора додано.
+
image:registry-develop:registry-admin-study/task-2/task-2-08-admin-added.png[]

=== Аутентифікація новоствореного адміністратора в консолі OKD

. Перейдіть у режим інкогніто у браузері для створення середовища для виконання завдання.
+
[TIP]
====
* Google Chrome: kbd:[CTRL]+kbd:[SHIFT]+kbd:[N]
* Microsoft Edge: kbd:[CTRL]+kbd:[SHIFT]+kbd:[N]
* Mozilla Firefox: kbd:[CTRL]+kbd:[SHIFT]+kbd:[P]
====

. Відкрийте консоль OKD за наступним посиланням:
+
https://console-openshift-console.apps.envtwo.dev.registry.eua.gov.ua/

. На сторінці входу оберіть аутентифікацію за допомогою Keycloak.
+
image:registry-develop:registry-admin-study/task-2/task-2-09-login-keycloak.png[]

. Введіть дані, вказані при додаванні адміністратора.
+
* *Username or email*: `petr@petrenko.com`
* *Password*: `123`
+
image:registry-develop:registry-admin-study/task-2/task-2-10-sign-in.png[]

. Змініть тимчасовий пароль на такий, що відповідає вимогам безпеки.
+
image:registry-develop:registry-admin-study/task-2/task-2-11-update-password.png[]

. У консолі OKD змініть представлення на *Administrator*.
+
image:registry-develop:registry-admin-study/task-2/task-2-12-okd-administrator.png[]

. Переконайтеся в тому, що адміністратор реєстру бачить лише один проект із назвою тестового реєстру.
+
image:registry-develop:registry-admin-study/task-2/task-2-13-okd-projects.png[]

=== Аутентифікація новоствореного адміністратора в консолі Control Plane

. Відкрийте консоль Control Plane за наступним посиланням:
+
https://control-plane-console-control-plane-platform-main.apps.envtwo.dev.registry.eua.gov.ua/

. На сторінці входу оберіть аутентифікацію за допомогою Keycloak.
+
image:registry-develop:registry-admin-study/task-2/task-2-14-control-plane-authentication.png[]
+
image:registry-develop:registry-admin-study/task-2/task-2-15-control-plane-keycloak.png[]

. Переконайтеся в тому, що адміністратор реєстру бачить свій реєстр та має змогу редагувати його налаштування.
+
image:registry-develop:registry-admin-study/task-2/task-2-16-registry-check.png[]
+
image:registry-develop:registry-admin-study/task-2/task-2-17-registry-check-edit.png[]

=== Перевірка доступу до інтерфейсу управління виконанням бізнес-процесів

. Спробуйте відкрити інтерфейс управління виконанням бізнес-процесів.
+
[TIP]
====
Ви можете знайти посилання на інтерфейс у розділі швидких посилань Control Plane: АДМІНІСТРАТИВНА ЗОНА РЕЄСТРУ > Вебінтерфейс управління виконанням бізнес-процесів (Business Process Administration Portal) або використати посилання за наступним шаблоном:

`https://business-proc-admin-<openshift-project-name>.<dns-wildcard>`

Наприклад, https://business-proc-admin-admin-test-main.apps.envtwo.dev.registry.eua.gov.ua/camunda/app/welcome/default/#!/welcome
====

. Очікуваний результат: новостворений адміністратор не зможе потрапити до *Applications* > *Cockpit*.

=== Додавання груп та ролей у Keycloak

. Перейдіть до Keycloak.
+
>>ЯК САМЕ?<<

. Надайте новоствореному адміністратору petr@petrenko.com роль `camunda-admin` та додайте його до групи `camunda-admin`. Для цього виконайте розділ 3, кроки 1-7 цієї інструкції: xref:registry-admin/create-users/create-registry-admins.adoc[].
+
image:registry-develop:registry-admin-study/task-2/task-2-18-camunda-admin-role.png[]
+
image:registry-develop:registry-admin-study/task-2/task-2-19-camunda-admin-group.png[]

. Відкрийте профіль користувача petr@petrenko.com.
+
NOTE: Для того, щоб користувач з'явився у реалмі, йому потрібно автентифікуватися в одному з сервісів, перелічених у розділі швидких посилань -- наприклад, Веб-інтерфейс моделювання регламенту (Admin Portal).

. Переконайтеся в тому, що до користувача petr@petrenko.com додалися група та роль `camunda-admin`.
+
image:registry-develop:registry-admin-study/task-2/task-2-20-role-assigned.png[]
+
image:registry-develop:registry-admin-study/task-2/task-2-21-group-added.png[]

. Переконайтеся в тому, що користувач petr@petrenko.com має доступ до інтерфейсу управління виконанням бізнес-процесів.
+
image:registry-develop:registry-admin-study/task-2/task-2-22-camunda-welcome.png[]
+
image:registry-develop:registry-admin-study/task-2/task-2-23-camunda-cockpit.png[]

=== Видалення адміністратора реєстру

. Перейдіть до консолі Control Plane.

. Перейдіть до редагування налаштувань тестового реєстру та відкрийте вкладку АДМІНІСТРАТОРИ.

. Натисніть іконку видалення поряд із адміністратором petr@petrenko.com.
+
image:registry-develop:registry-admin-study/task-2/task-2-24-registry-edit-administrators.png[]

. Натисніть кнопку ПІДТВЕРДИТИ.

. Відкрийте запит на оновлення.
+
image:registry-develop:registry-admin-study/task-2/task-2-25-view-update-request.png[]

. Підтвердьте видалення адміністратора.
+
image:registry-develop:registry-admin-study/task-2/task-2-26-confirm-deletion.png[]

. Перейдіть до Jenkins за посиланням у розділі ІНФОРМАЦІЯ ПРО РЕЄСТР > КОНФІГУРАЦІЯ > колонка *CI*.
+
image:registry-develop:registry-admin-study/task-2/task-2-27-jenkins-ci-link.png[]

. В інтерфейсі Jenkins знайдіть та відкрийте процес із назвою *MASTER-Build-`<registry-name>`*, де `<registry-name>` -- це назва тестового реєстру.
+
image:registry-develop:registry-admin-study/task-2/task-2-28-jenkins-master-build.png[]

. Дочекайтеся успішного завершення процесу.
+
image:registry-develop:registry-admin-study/task-2/task-2-29-pipeline-success.png[]

. Переконайтеся, що адміністратора було видалено. Для цього виконайте такі кроки:
.. Перейдіть до консолі Control Plane.
.. Відкрийте тестовий реєстр та зайдіть у розділ ІНФОРМАЦІЯ ПРО РЕЄСТР > ЗАГАЛЬНА ІНФОРМАЦІЯ.
.. У переліку адміністраторів не має бути користувача petr@petrenko.com.

image:registry-develop:registry-admin-study/task-2/task-2-30-admin-removed.png[]

>>СКРІНШОТ ЗРОБЛЕНИЙ ВІД ІМЕНІ ПЕТРА ПЕТРЕНКО - МОЖЕ, КРАЩЕ ЦЕ ОБРІЗАТИ?<<

Після видалення адміністратора буде неможливо зайти до консолі та інших сервісів за допомогою даних цього користувача.