= Завдання 1. Оновлення реєстру
include::platform:ROOT:partial$templates/document-attributes/default-set-ua.adoc[]

== Мета завдання

Виконання цього завдання має на меті: ::

* [*] Отримати практичні навички оновлення реєстру з `версії n-1` до `версії n`.
Наприклад, `1.9.4.x` -> `1.9.5.х`.

* [*] Ознайомитися з прикладом виконання спеціальних кроків для оновлення з урахуванням специфіки відповідної версії.

* [*] Навчитися перевіряти версії образів ключових подів для контролю при оновленні.

== Передумови

NOTE: Спочатку адміністратор Платформи має виконати оновлення інфраструктурних компонентів Платформи. Лише після цього можна переходити до оновлення реєстру.

. Створіть запит на розгортання тестового реєстру з версією для подальшого оновлення -- `версія n-1`.

. Перевірте поточну версію реєстру, створеного для цього завдання, в адміністративній панелі Control Plane.
+
image:registry-develop:registry-admin-study/task-1/task-1-01-registry-version.png[]

== Процес виконання завдання

//TODO: Переробити послідовність та логічність структури: відштовхнутися від спеціальних кроків.
//ToDO: У спеціальних кроках вони знайдуть посилання на відповідний процес оновлення реєстру.
//TODO: Спеціальних кроків може і не бути. Тоді варто перейти одразу до

=== Налаштування в адміністративній панелі Control Plane

. Ознайомтеся з інструкцією по оновленню компонентів реєстру та виконайте кроки, описані у розділі xref:admin:update/update-registry-components.adoc#cp-settings[Налаштування в адміністративній панелі Control Plane].

. На кроці вибору версії для оновлення виберіть `версію n`.
+
image:registry-develop:registry-admin-study/task-1/task-1-02-registry-update-confirm.png[]

=== Перевірка коду в системі Gerrit

. Перейдіть з Control Plane до системи рецензування коду Gerrit.
+
//TODO: Вказати підтвердження змін у Control Plane як основний флоу
image:registry-develop:registry-admin-study/task-1/task-1-03-registry-update-gerrit.png[]

. Підтвердьте внесення змін до коду.

//TODO: Вказати підтвердження змін у Gerrit як альтернативний шлях
TIP: Детальніше дивіться інструкцію по оновленню компонентів реєстру, розділ xref:admin:update/update-registry-components.adoc#code-review-gerrit[Перевірка коду в Gerrit].

=== Перевірка збірки коду в Jenkins

. Перейдіть з Control Plane до інтерфейсу Jenkins.

. Відкрийте процес *MASTER-Build-`<registry-name>`*, де `<registry-name>` -- це назва реєстру, який ви оновлюєте.

. Переконайтесь, що процес почав виконуватись та успішно завершився.
+
image:registry-develop:registry-admin-study/task-1/task-1-04-jenkins-build-success.png[]

TIP: Детальніше дивіться інструкцію по оновленню компонентів реєстру, розділ xref:admin:update/update-registry-components.adoc[Контроль за виконанням збірки коду в Jenkins].

=== Спеціальні кроки

Після того, як реєстр оновлено до версії n та процес збірки пройшов успішно, потрібно додатково перевірити та виконати певні налаштування в рамках спеціальних кроків.

Як приклад, ознайомтеся з інструкцією по оновленню для версії 1.9.5, починаючи з розділу xref:admin:update/special-steps-for-update/special-steps.adoc[Оновлення реєстру].

[CAUTION]
====
Для кожної версії реєстру додаються окремі спеціальні кроки для виконання.

Ця операція робиться спільно с адміністратором Платформи, оскільки у адміністратора реєстру може не вистачити прав на виконання всіх кроків.
====

=== Перевірка версії образів для подів

Перевірте, що після оновлення реєстру оновилися версії образів для подів.

Для цього виконайте наступні кроки:

. Перейдіть з Control Plane до сервісу Gerrit.
+
[TIP]
====
Ви можете знайти посилання на Gerrit у розділі швидких посилань.

image:registry-develop:registry-admin-study/task-1/task-1-07-quick-links-gerrit.png[]
====

. Виконайте вхід, якщо це не було зроблено.
+
image:registry-develop:registry-admin-study/task-1/task-1-08-gerrit-sign-in.png[]

. Перейдіть в розділ *CHANGES* > *Merged*.
+
image:registry-develop:registry-admin-study/task-1/task-1-09-gerrit-merged-changes.png[]

. Знайдіть зміну із оновленням реєстру. Вона матиме назву *Update registry to `<version>`*, де `<version>` -- це версія, до якої ви оновлюєте реєстр.
+
image:registry-develop:registry-admin-study/task-1/task-1-10-gerrit-change-update.png[]

. Всередині зміни з оновленням реєстру знайдіть наступний файл: _deploy-templates/helmfile.yaml_.
+
image:registry-develop:registry-admin-study/task-1/task-1-11-gerrit-helmfile-location.png[]

. Всередині _helmfile.yaml_ відшукайте зміни версій образів для наступних подів:

* *`Bpms`*
+
image:registry-develop:registry-admin-study/task-1/task-1-12-helmfile-bpms.png[]

* *`digital-signature-ops`*
+
image:registry-develop:registry-admin-study/task-1/task-1-13-helmfile-digital-signature-ops.png[]

* *`registry-regulation-management`*
+
image:registry-develop:registry-admin-study/task-1/task-1-14-helmfile-registry-regulation-management.png[]

. Перейдіть до консолі OKD та відкрийте розділ *Workloads* > *Pods*.

. З випадного списку *Project* оберіть проєкт з назвою реєстру, який ви оновлюєте.
+
image:registry-develop:registry-admin-study/task-1/task-1-15-okd-pods-project.png[]

. Виконайте пошук по кожному поду та переконайтеся, що версія образу збігається з версією, що вказана в оновленнях _helmfile.yaml_.
+
* *`bpms`*
* *`digital-signature-ops`*
* *`registry-regulation-management`*
+
image:registry-develop:registry-admin-study/task-1/task-1-16-okd-pods-bpms.png[]
+
image:registry-develop:registry-admin-study/task-1/task-1-17-okd-pods-bpms-version.png[]

[[task-result]]
== Результат виконання завдання

Результатом виконання завдання є реєстр, оновлений до `версії n`.

image:registry-develop:registry-admin-study/task-1/task-1-18-task-result.png[]