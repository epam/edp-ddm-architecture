= Завдання 1. Оновлення реєстру
include::platform:ROOT:partial$templates/document-attributes/default-set-ua.adoc[]

== Мета завдання

Виконання цього завдання має на меті: ::

* Отримати практичні навички оновлення реєстру.

* Ознайомитися з прикладом виконання спеціальних кроків.

== Попередні кроки

NOTE: Спочатку адміністратор Платформи має виконати оновлення інфраструктурних компонентів Платформи. Лише після цього можна приступати до оновлення реєстру.

. Створіть запит на розгортання тестового реєстру з версією для подальшого оновлення (версія n-1).

. Перевірте поточну версію створеного для цього завдання реєстру у консолі:
+
image:registry-develop:registry-admin-study/task-1/task-1-01-registry-version.png[]

== Завдання

=== Налаштування в адміністративній панелі Control Plane

. Ознайомтеся з інструкцією по оновленню компонентів реєстру та виконайте кроки, описані у розділі xref:admin:update/update-registry-components.adoc["Налаштування в адміністративній панелі керування кластером та реєстрами Control Plane"].

. На кроці вибору версії для оновлення виберіть `1.9.5.33`.
+
image:registry-develop:registry-admin-study/task-1/task-1-02-registry-update-confirm.png[]

=== Перевірка коду в системі Gerrit

. Перейдіть з Control Plane до системи рецензування коду Gerrit.
+
image:registry-develop:registry-admin-study/task-1/task-1-03-registry-update-gerrit.png[]

. Підтвердьте внесення змін до коду.

TIP: Детальніше дивіться інструкцію по оновленню компонентів реєстру, розділ xref:admin:update/update-registry-components.adoc["Проходження процедури перевірки коду в системі рецензування коду Gerrit"].

=== Перевірка збірки коду в Jenkins

. Перейдіть з Control Plane до інтерфейсу Jenkins.

. Відкрийте процес *MASTER-Build-`<registry-name>`*, де `<registry-name>` -- це назва реєстру, який ви оновлюєте.

. Переконайтесь, що він почав виконуватись та успішно завершився.
+
image:registry-develop:registry-admin-study/task-1/task-1-04-jenkins-build-success.png[]

TIP: Детальніше дивіться інструкцію по оновленню компонентів реєстру, розділ xref:admin:update/update-registry-components.adoc["Контроль за виконанням збірки коду в Jenkins"].

=== Спеціальні кроки

Після того, як реєстр оновлено до версії 1.9.5 та процес збірки пройшов успішно, потрібно додатково перевірити та виконати певні налаштування в рамках спеціальних кроків.

[NOTE]
====
Для кожної версії реєстру додаються окремі спеціальні кроки для виконання.

Ця операція робиться спільно с адміністратором Платформи, оскільки у адміністратора реєстру може не вистачити прав на виконання всіх кроків.
====

==== Перевірка полів машин-сету реєстру

В рамках даного завдання ознайомтеся з інструкцією по оновленню для версії 1.9.5, починаючи з розділу xref:admin:update/special-steps-for-update/special-steps.adoc["Оновлення реєстру"].

Вам потрібно впевнитися, що після оновлення підтягнулись коректні значення у машин-сеті, і якщо ні, то оновити екземпляри для цього реєстру.

Для цього виконайте наступні кроки:

. Перейдіть до консолі OKD.

. Відкрийте розділ *Compute* > *machineSets*.
+
image:registry-develop:registry-admin-study/task-1/task-1-05-okd-machinesets-search.png[]

. Знайдіть свій реєстр за допомогою пошуку та відкрийте його.

. Відкрийте вкладку *YAML* та перевірте значення полів `ami.id` та `apiVersion`:
+
image:registry-develop:registry-admin-study/task-1/task-1-06-okd-fields.png[]

* *`ami.id`*: `ami-094fe1584439e91dd`
* *`apiVersion`*: `machine.openshift.io/v1beta1`

. Якщо значення полів співпадають з тими, що вказані вище, переходьте до xref:task-result[перевірки результатів завдання].
+
Якщо значення полів відрізняються від вказаних вище, виконайте крок xref:admin:update/special-steps-for-update/special-steps.adoc["Видалення машин для машин-сету реєстру"] з інструкції по оновленню для версії 1.9.5.

TIP: Також ознайомтеся з пунктом xref:admin:update/special-steps-for-update/special-steps.adoc["Відомі проблеми"] інструкції по оновленню для версії 1.9.5.

==== Перевірка версії образів для подів

Перевірте, що після оновлення реєстру оновилися версії образів для подів.

Для цього виконайте наступні кроки:

. Перейдіть з Control Plane до системи рецензування коду Gerrit.
+
[TIP]
====
Ви можете знайти посилання на Gerrit у розділі швидких посилань.

image:registry-develop:registry-admin-study/task-1/task-1-07-quick-links-gerrit.png[]
====

. Виконайте вхід, якщо це не було зроблено.
+
image:registry-develop:registry-admin-study/task-1/task-1-08-gerrit-sign-in.png[]

. Перейдіть в розділ *CHANGES* > *Merged*.
+
image:registry-develop:registry-admin-study/task-1/task-1-09-gerrit-merged-changes.png[]

. Знайдіть зміну із оновленням реєстру. Вона матиме назву *Update registry to `<version>`*, де `<version>` -- це версія, до якої ви оновлюєте реєстр.
+
image:registry-develop:registry-admin-study/task-1/task-1-10-gerrit-change-update.png[]

. Всередині зміни з оновленням реєстру знайдіть наступний файл: _deploy-templates/helmfile.yaml_.
+
image:registry-develop:registry-admin-study/task-1/task-1-11-gerrit-helmfile-location.png[]

. Всередині _helmfile.yaml_ відшукайте зміни версій образів для наступних подів:

* *`Bpms`*
+
image:registry-develop:registry-admin-study/task-1/task-1-12-helmfile-bpms.png[]

* *`digital-signature-ops`*
+
image:registry-develop:registry-admin-study/task-1/task-1-13-helmfile-digital-signature-ops.png[]

* *`registry-regulation-management`*
+
image:registry-develop:registry-admin-study/task-1/task-1-14-helmfile-registry-regulation-management.png[]

. Перейдіть до консолі OKD та відкрийте розділ *Workloads* > *Pods*.

. З випадаючого списку *Project* оберіть проект з назвою реєстру, який ви оновлюєте.
+
image:registry-develop:registry-admin-study/task-1/task-1-15-okd-pods-project.png[]

. Виконайте пошук по кожному поду та переконайтеся, що версія образу співпадає з версією, що вказана в оновленнях _helmfile.yaml_.
+
* *`Bpms`*
* *`digital-signature-ops`*
* *`registry-regulation-management`*
+
image:registry-develop:registry-admin-study/task-1/task-1-16-okd-pods-bpms.png[]
+
image:registry-develop:registry-admin-study/task-1/task-1-17-okd-pods-bpms-version.png[]

[[task-result]]
== Результат виконання завдання

В результаті виконання завдання ви маєте отримати реєстр з оновленою версією:

image:registry-develop:registry-admin-study/task-1/task-1-18-task-result.png[]