:toc-title: On this page:
:toc: auto
:toclevels: 5
:experimental:
:sectnums:
:sectnumlevels: 5
:sectanchors:
:sectlinks:
:partnums:

= Asynchronous data loading

NOTE: üåê This document is available in both English and Ukrainian. Use the language toggle in the top right corner to switch between versions.

== General description

//–í –ø–æ—Ç–æ—á–Ω—ñ–π —ñ–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü—ñ—ó —ñ—Å–Ω—É—î –º–µ—Ö–∞–Ω—ñ–∑–º —è–∫–∏–π –¥–æ–∑–≤–æ–ª—è—î –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ csv —Ñ–∞–π–ª –∑ –¥–∞–Ω–∏–º —è–∫—ñ –±—É–¥—É—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –¥–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—ó —Ç–∞–±–ª–∏—Ü—ñ. –¶–µ–π –ø—Ä–æ—Ü–µ—Å –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, —Ç–æ–º—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å –∫–ª—ñ—î–Ω—Ç –º–∞—î –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑–∞ 30 —Å–µ–∫—É–Ω–¥ (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π –¥–æ–ø—É—Å—Ç–∏–º–∏–π —Ç–∞–π–º–∞—É—Ç). –û–∫—Ä—ñ–º —Ç–æ–≥–æ –æ—Å–∫—ñ–ª—å–∫–∏ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è –º—ñ–∂ —Å–µ—Ä–≤—ñ—Å–∞–º–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ —Ç–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–∞–Ω–∏–º–∏ —Ä–µ—î—Å—Ç—Ä—É –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ –±—Ä–æ–∫–µ—Ä –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å, —ñ—Å–Ω—É—î –ª—ñ–º—ñ—Ç –≤ –æ–¥–∏–Ω –º–µ–≥–∞–±–∞–π—Ç –¥–ª—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å. –¢–æ–º—É –±—É–ª–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —à—Ç—É—á–Ω–∏–π –ª—ñ–º—ñ—Ç –≤ 50 —Ä—è–¥–∫—ñ–≤. –í –ø—Ä–æ—Ü–µ—Å—ñ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó –≤–∏–Ω–∏–∫–ª–∞ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ—Å—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ –±—ñ–ª—å—à—ñ –æ–±'—î–º–∏ –¥–∞–Ω–∏—Ö, –∑–∞ —Ä–æ–∑–º—ñ—Ä–æ–º –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —è–∫–∏—Ö –º–æ–∂–µ –∑–∞–π–º–∞—Ç–∏ –∑–Ω–∞—á–Ω–æ –¥–æ–≤—à–∏–π —á–∞—Å.
In the current implementation, there is a mechanism that allows you to download a csv file with data that will be uploaded to the corresponding table. This process occurs synchronously, so the client should receive a response within 30 seconds (the maximum allowable timeout). In addition, since the communication between the synchronous and asynchronous registry data management services takes place through a message broker, there is a limit of one megabyte for messages. Therefore, an artificial limit of 50 lines was set. In the process of operation, it became necessary to download larger volumes of data, the size of which can take a much longer time to download.

//== –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó
== Functional scenarios

////
* –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ —Ñ–∞–π–ª—É —è–∫–∏–π –±—ñ–ª—å—à–µ –æ–¥–Ω–æ–≥–æ –º–µ–≥–∞–±–∞–π—Ç–∞ —ñ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —è–∫–æ–≥–æ –º–æ–∂–µ —Ç—Ä–∏–≤–∞—Ç–∏ –¥–æ–≤—à–µ –Ω—ñ–∂ 30 —Å–µ–∫—É–Ω–¥.
* –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ —Ñ–∞–π–ª—É —É –¥–µ–∫—ñ–ª—å–∫–∞ —Ç–∞–±–ª–∏—Ü—å.
////
* Saving data from a file that is larger than one megabyte and may take longer than 30 seconds to save.
* Saving data from a file to several tables.

== User roles

////
* –†–æ–∑—Ä–æ–±–Ω–∏–∫ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—É
* –ù–∞–¥–∞–≤–∞—á –ø–æ—Å–ª—É–≥
////

* Developer of regulations
* Service provider

//== –ó–∞–≥–∞–ª—å–Ω—ñ –ø—Ä–∏–Ω—Ü–∏–ø–∏ —Ç–∞ –ø–æ–ª–æ–∂–µ–Ω–Ω—è
== General provisions

////
* –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ —Ñ–∞–π–ª—É –≤—ñ–¥–±—É–≤–∞—é—Ç—å—Å—è –≤ –æ–¥–Ω—ñ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó.
* –û–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è —Ñ–∞–π–ª—É –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –ø–æ —Ä—è–¥–∫–∞—Ö.
* –ë—ñ–∑–Ω–µ—Å –ø—Ä–æ—Ü–µ—Å –±—É–¥—É—î—Ç—å—Å—è –Ω–∞ –ø–æ–¥—ñ—è—Ö —è–∫—ñ –≤–∏–Ω–∏–∫–∞—é—Ç—å –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–æ –±—Ä–æ–∫–µ—Ä–∞.
* –ü–æ–¥—ñ—ó –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤ –±—ñ–∑–Ω–µ—Å –ø—Ä–æ—Ü–µ—Å –º–∞—é—Ç—å –æ–±—Ä–æ–±–ª—è—Ç—å—Å—è –≥–æ–ª–æ–≤–Ω–∏–º –ø—Ä–æ—Ü–µ—Å–æ–º —ñ –Ω–µ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –ø—Ä–æ–∞—Å–æ—Ü—ñ–π–æ–≤–∞–Ω—ñ —ñ–∑ —Å–∞–±-–ø—Ä–æ—Ü–µ—Å–æ–º.
* –û–ø–µ—Ä–∞—Ü—ñ—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ.
* –ü—Ä–æ–≥—Ä–µ—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–µ –≤—ñ–¥—Å–ª—ñ–¥–∫–æ–≤—É—î—Ç—å—Å—è.
* –í —è–∫–æ—Å—Ç—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ—Ö—ñ–¥–Ω–∏–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –≤—Å—ñ—Ö —Å—É—Ç–Ω–æ—Å—Ç–µ–π –±—É–¥–µ –æ–¥–∏–Ω –∫–ª—é—á –Ω–∞ –≤–µ—Å—å —Ñ–∞–π–ª –±–µ–∑ –≤–∫–∞–∑–∞–Ω–Ω—è –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π —Ä—è–¥–æ–∫.
* –§–∞–ª–∏ —â–æ –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å –ø—Ä–∞–≤–∏–ª–∞–º –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–º –º–æ–¥–µ–ª—é–≤–∞–ª—å–Ω–∏–∫–∞–º –Ω–µ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ.
* –û–±–º–µ–∂–µ–Ω–Ω—è –ø–æ —Ä–æ–∑–º—ñ—Ä—É —Ñ–∞–π–ª—É –∫–µ—Ä—É—î—Ç—å—Å—è –Ω–∞ —Ä—ñ–≤–Ω—ñ control plane
////

* Saving data from a file takes place in one transaction.
* The file is processed line by line.
* The business process is built on events that occur when a message is sent to the broker.
* Events loaded into a business process must be processed by the main process and cannot be associated with a sub-process.
* The save operation is asynchronous.
* Download progress is not tracked.
* As a reference to the derived document for all entities, there will be one key for the entire file without specifying a specific line.
* Files that do not comply with the rules of the installed simulators cannot be loaded.
* The file size limit is managed at the control plane level

//== –í–∏—Å–æ–∫–æ—Ä—ñ–≤–Ω–µ–≤–∏–π –¥–∏–∑–∞–π–Ω —Ä—ñ—à–µ–Ω–Ω—è
== High-level solution design

image:architecture/registry/operational/registry-management/platform-evolution/async-load/context.svg[]

image:architecture/registry/operational/registry-management/platform-evolution/async-load/context-details.svg[]


//=== –ö–ª—é—á–æ–≤—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó –≤–∑–∞—î–º–æ–¥—ñ—ó —Å–µ—Ä–≤—ñ—Å—ñ–≤
=== Key scenarios of services interaction
////
.–û–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è —Ñ–∞–π–ª—É
[plantuml, req, svg]
----
!theme plain
participant "–ö–∞–±—ñ–Ω–µ—Ç" as portal
participant "–°–µ—Ä–≤—ñ—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è\n –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤" as dds
box "BPMS" #LightBlue
participant "–ë—ñ–∑–Ω–µ—Å –ø—Ä–æ—Ü–µ—Å" as bpms
participant "Kafka –¥–µ–ª–µ–≥–∞—Ç " as delegate
participant "Kafka Listener" as listener
end box
participant "Registry Rest API" as restApi
queue "Kafka" as kafka
collections "Ceph" as ceph
participant "Registry Kafka API" as kafkaApi
database "–û–ø–µ—Ä–∞—Ü—ñ–π–Ω–∞\n–±–∞–∑–∞ –¥–∞–Ω–∏—Ö" as db
participant "Keycloak" as keycloak

== –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ ==
portal -> dds: –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É
dds -> restApi: –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –≤–º—ñ—Å—Ç—É —Ñ–∞–π–ª—É –ø–æ –≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—é –¥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —Ç–∞ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Å—É—Ç–Ω–æ—Å—Ç–µ–π
return —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞ –≤–º—ñ—Å—Ç –≤–∞–ª—ñ–¥–Ω—ñ
dds -> ceph: –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç—É
return –¥–æ–∫—É–º–µ–Ω—Ç –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ
dds --> portal: –∫–ª—é—á ceph –¥–æ –¥–æ–∫—É–º–µ–Ω—Ç—É
portal -> bpms: –≤—ñ–¥–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º–∏ –∑ –∫–ª—é—á–µ–º —Ñ–∞–π–ª—É
group –æ–ø—Ü—ñ–π–Ω–∏–π –∫—Ä–æ–∫
bpms -> bpms: –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è csv —Ñ–∞–π–ª—É
bpms -> ceph: –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –æ–±—Ä–æ–±–∫–∏
return –∫–ª—é—á
end
bpms -> delegate: —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—É

== –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö ==
delegate -> kafka: –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è \n [–≤—Ö—ñ–¥–Ω–∞ —á–µ—Ä–≥–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å]
kafkaApi -> kafka: –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—É –Ω–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É
kafkaApi -> keycloak: –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —Ç–æ–∫–µ–Ω—É
return –ø—É–±–ª—ñ—á–Ω–∏–π —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É
kafkaApi -> kafkaApi: –≤–∞–ª—ñ–¥–∞—Ü—ñ—è —Ç–æ–∫–µ–Ω—É
kafkaApi -> ceph: –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É
return —Ñ–∞–π–ª –∑–∞ –¥–∞–Ω–Ω–∏–º–∏
kafkaApi -> kafkaApi: –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –≤–º—ñ—Å—Ç—É —Ñ–∞–π–ª—É –ø–æ –≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—é –¥–æ\n—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —Ç–∞ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Å—É—Ç–Ω–æ—Å—Ç–µ–π
kafkaApi -> ceph: –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É –≤ –æ–∫—Ä–µ–º–µ —Å—Ö–æ–≤–∏—â–µ
return
group —Ü–∏–∫–ª [–∫–æ–∂–µ–Ω —Ä—è–¥–æ–∫]
kafkaApi -> db: –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–º —Å–µ—Ä–≤—ñ—Å–æ–º
return —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
end
kafkaApi -> kafkaApi: —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
kafkaApi --> kafka: –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –æ–±—Ä–æ–±–∫–∏ \n [–≤–∏—Ö—ñ–¥–Ω–∞ —á–µ—Ä–≥–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å]
listener -> kafka
listener -> listener: –∫–æ—Ä–µ–ª—è—Ü—ñ—è –∑ –∑–∞–ø–∏—Ç–æ–º,\n —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è –ø–æ–¥—ñ—ó –∑–≥—ñ–¥–Ω–æ –∑—ñ —Å—Ç–∞—Ç—É—Å–æ–º
listener -> bpms: —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è –ø–æ–¥—ñ—ó
bpms --> portal: —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è
----
////

.File processing
[plantuml, req, svg]
----
!theme plain
participant "Portal" as portal
participant "Document upload\n service" as dds
box "BPMS" #LightBlue
participant "Business process" as bpms
participant "Kafka delegate " as delegate
participant "Kafka Listener" as listener
end box
participant "Registry Rest API" as restApi
queue "Kafka" as kafka
collections "Ceph" as ceph
participant "Registry Kafka API" as kafkaApi
database "Operational\n database" as db
participant "Keycloak" as keycloak

== Saving files ==
portal -> dds: uploading a file
dds -> restApi: validation of the file content in relation to the structure and number of entities
return structure and content are valid
dds -> ceph: saving the document
return the document has been uploaded
dds --> portal: ceph key to the document
portal -> bpms: sending a form with a file key
group optional step
bpms -> bpms: csv file conversion
bpms -> ceph: saving the processing result
return key
end
bpms -> delegate: forming a request

== Loading data ==
delegate -> kafka: loading message \n [incoming message queue]
kafkaApi -> kafka: receiving a request to save the file
kafkaApi -> keycloak: obtaining a certificate for token validation
return public certificate
kafkaApi -> kafkaApi: token validation
kafkaApi -> ceph: uploading a file
return file by data
kafkaApi -> kafkaApi: validating file contents against the\nstructure and number of entities
kafkaApi -> ceph: saving the file to a separate storage
return
group cycle [each row]
kafkaApi -> db: saving by the corresponding service
return saving result
end
kafkaApi -> kafkaApi: forming an answer
kafkaApi --> kafka: message with processing result \n [outgoing message queue]
listener -> kafka
listener -> listener: correlation with the request,\n event formation according to the status
listener -> bpms: formation of the event
bpms --> portal: processing result
----


//== –ú–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—É —Ä–µ—î—Å—Ç—Ä—É
== Simulation of the registry regulations

//=== –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è –¥–ª—è –º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è
=== Simulation extension

//–î–ª—è —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—É—Ç–Ω–æ—Å—Ç–µ–π –¥–æ –ë–î, –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ –¥–µ–∫—ñ–ª—å–∫–∞ —á–∞—Å—Ç–∏–Ω:

//–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –Ω–∞ —Ä—ñ–≤–Ω—ñ –º–æ–¥–µ–ª—ñ –¥–∞–Ω–∏—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è liquibase, –º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è —Ñ–æ—Ä–º–∏ –ø–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—é —Ñ–∞–π–ª—ñ–≤ —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –¥–µ–ª–µ–≥–∞—Ç—É –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—ó –≤–∑–∞—î–º–æ–¥—ñ—ó –ø—Ä–∏ –º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—ñ –ë–ü.

To implement the possibility of asynchronous loading of entities to the database, the configuration consists of several parts:

Configuration at the level of the data model using the liquibase extension, modeling the file upload form, and using the asynchronous interaction delegate for BP modeling.

////
.–†–æ–∑—à–∏—Ä–µ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ liquibase
[source, xml]
----
<changeSet>
    <createTable name="item">
        <!-- –û–ø–∏—Å –ø–æ–ª—ñ–≤ —Ç–∞–±–ª–∏—Ü—ñ !-->
    </createTable>
    <createTable name="demo_entity">
        <!-- –û–ø–∏—Å –ø–æ–ª—ñ–≤ —Ç–∞–±–ª–∏—Ü—ñ !-->
    </createTable>

    <createCompositeEntity name="item_with_references">
        <!-- –û–ø–∏—Å –ø–æ–ª—ñ–≤ —Å–∫–ª–∞–¥–Ω–æ—ó —Å—É—Ç–Ω–æ—Å—Ç—ñ !-->
    </createCompositeEntity>

    <createAsyncLoad name="allowedAsyncLoads">
        <entityList>
            <entity name="item" limit="100"/>
            <entity name="item_with_references" limit="1000"/>
            <entity name="demo_entity" limit="1000000"/>
        </entityList>
    </createAsyncLoad>

    <deleteAsyncLoad name="removeEntities">
        <entityList>
            <entity name="demo_entity"/>
        </entityList>
    </deleteAsyncLoad>

</changeSet>
----
////

.An extension of the liquibase library
[source, xml]
----
<changeSet>
    <createTable name="item">
        <!-- Description of table fields !-->
    </createTable>
    <createTable name="demo_entity">
        <!-- Description of table fields !-->
    </createTable>

    <createCompositeEntity name="item_with_references">
        <!-- Description of the fields of a complex entity !-->
    </createCompositeEntity>

    <createAsyncLoad name="allowedAsyncLoads">
        <entityList>
            <entity name="item" limit="100"/>
            <entity name="item_with_references" limit="1000"/>
            <entity name="demo_entity" limit="1000000"/>
        </entityList>
    </createAsyncLoad>

    <deleteAsyncLoad name="removeEntities">
        <entityList>
            <entity name="demo_entity"/>
        </entityList>
    </deleteAsyncLoad>

</changeSet>
----


//–ê—Ç—Ä–∏–±—É—Ç `limit` —î –æ–±–æ–≤ º—è–∑–∫–æ–≤–∏–º –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ `createAsyncLoad`
The `limit` attribute is required when creating `createAsyncLoad`

image:architecture/registry/operational/registry-management/platform-evolution/async-load/business-process.png[]

//.–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –¥–µ–ª–µ–≥–∞—Ç—É –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
.Configuring a delegate for asynchronous loading
====
image:architecture/registry/operational/registry-management/platform-evolution/async-load/delegateConfiguration.png[]
====

//–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ –æ–±—Ä–æ–±–∫–∏, –º–æ–∂–ª–∏–≤–µ –≤–∏–Ω–∏–∫–Ω–µ–Ω–Ω—è –¥–µ–∫—ñ–ª—å–∫–æ—Ö –ø–æ–¥—ñ–π, –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ —Å—Ç–∞—Ç—É—Å—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É.
//–¢–∏–ø –ø–æ–¥—ñ—ó —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ –Ω–∞–∑–≤–∏ —Å—É—Ç–Ω–æ—Å—Ç—ñ —Ç–∞ —Å—Ç–∞—Ç—É—Å—É.

As a result of processing, several events may occur, depending on the status of the result.
An event type consists of an entity name and a status.


//.–ü—Ä–∏–∫–ª–∞–¥–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –æ–±—Ä–æ–±–∫–∏ –ø–æ–¥—ñ–π —É—Å–ø—ñ—à–Ω–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—É—Ç–Ω–æ—Å—Ç—ñ item
.Examples of setting event handling of successful loading of the item entity
====
image:architecture/registry/operational/registry-management/platform-evolution/async-load/succesEvent.png[]
====

//.–ü—Ä–∏–∫–ª–∞–¥–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –æ–±—Ä–æ–±–∫–∏ –ø–æ–¥—ñ–π –¥–ª—è –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ —Å—É—Ç–Ω–æ—Å—Ç—ñ item
.Examples of setting event processing for when saving the item entity
====
image:architecture/registry/operational/registry-management/platform-evolution/async-load/constraintViolation.png[]
====

//–ó–∞–≥–∞–ª—å–Ω–µ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è –ø–æ–¥—ñ–π –ø—Ä–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ–π –≤–∑–∞—î–º–æ–¥—ñ—ó —Ñ–æ—Ä–º—É—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `camel case` —ñ —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ `–Ω–∞–∑–≤–∏ —Å—É—Ç–Ω–æ—Å—Ç—ñ –Ω–∞–¥ —è–∫–æ—é –∑–¥—ñ–π—Å–Ω—é—î—Ç—å—Å—è –æ–ø–µ—Ä–∞—Ü—ñ—è + –Ω–∞–∑–≤–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è + —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü—ñ—ó`
The general rule for forming events during asynchronous interaction is formed using `camel case' and consists of `the name of the entity on which the operation is performed + the name of the operation + the result of the operation'

//.–ú–æ–∂–ª–∏–≤—ñ —Å—Ç–∞—Ç—É—Å–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è
.Possible statuses of the processing result

////
|===
|–†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü—ñ—ó |–û–ø–∏—Å |–ü—Ä–∏–∫–ª–∞–¥ –ø–æ–¥—ñ—ó –Ω–∞ –±—ñ–∑–Ω–µ—Å –ø—Ä–æ—Ü–µ—Å—ñ

|SUCCESS
|–û–ø–µ—Ä–∞—Ü—ñ—è  –∑–∞–∫—ñ–Ω—á–∏–ª–∞—Å—å —É—Å–ø—ñ—à–Ω–æ.
|%item%DataLoadCsvSuccess

|CONSTRAINT_VIOLATION
|–î–∞–Ω—ñ –∑ —Ñ–∞–π–ª—É –Ω–µ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –æ—Å–∫—ñ–ª—å–∫–∏ –æ–¥–∏–Ω –∑ –Ω–∏—Ö –ø–æ—Ä—É—à—É—î —ñ—Å–Ω—É—é—á—ñ –ø—Ä–∞–≤–∏–ª–∞ –ë–î.
|%item%DataLoadCsvConstraintViolation

|OPERATION_FAILED
|–ü—ñ–¥ —á–∞—Å –æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è —Ñ–∞–π–ª—É –≤–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞.
|%item%DataLoadCsvOperationFailed
|===
////

|===
|The result of the operation |Description |An example of an event on a business process

|SUCCESS
|The operation ended successfully.
|%item%DataLoadCsvSuccess

|CONSTRAINT_VIOLATION
|Data from the file cannot be loaded because one of them violates existing database rules.
|%item%DataLoadCsvConstraintViolation

|OPERATION_FAILED
|An error occurred while processing the file.
|%item%DataLoadCsvOperationFailed
|===


//== –ù–∏–∑—å–∫–æ—Ä—ñ–≤–Ω–µ–≤–∏–π –¥–∏–∑–∞–π–Ω —Å–µ—Ä–≤—ñ—Å—ñ–≤
== Low-level service design

//=== –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ Liquibase-—Ä–æ–∑—à–∏—Ä–µ–Ω—å –¥–ª—è –º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è –¥–∞—Ç–∞ –º–æ–¥–µ–ª—ñ —Ä–µ—î—Å—Ç—Ä—É
=== Library of Liquibase-extensions for modeling the date model of the registry

//–†–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –æ–±—Ä–æ–±–∫–∏ —Ç–µ–≥—ñ–≤ `createAsyncLoad` `deleteAsyncLoad` —î —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è –ø–µ—Ä–µ–ª—ñ–∫—É —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–ª—è —è–∫–∏—Ö –¥–æ–∑–≤–æ–ª–µ–Ω–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ —Ñ–∞–π–ª—ñ–≤ –≤ —Ç–∞–±–ª–∏—Ü—ñ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö.
The result of processing the `createAsyncLoad` `deleteAsyncLoad` tags is the formation of a list of structures for which asynchronous loading of data from files in the metadata table is allowed.

//=== –î–µ–ª–µ–≥–∞—Ç –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
=== Delegate for sending asynchronous messages

//–ü—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –¥–µ–ª–µ–≥–∞—Ç–∞, —Ä–∞–∑–æ–º –∑ —Ç—ñ–ª–æ–º –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª—è—é—Ç—å—Å—è —Å–ª—É–∂–±–æ–≤—ñ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è —Ç—Ä–∞—Å—É–≤–∞–Ω–Ω—è.
When sending a message using a delegate, service headers for tracing are sent along with the message body.

//–ü–æ–ª—è –¥–µ–ª–µ–≥–∞—Ç–∞ —è–∫—ñ –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –ø—Ä–∏ –º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—ñ.
Delegate fields that are filled in during modeling.
////
_–ù–∞–∑–≤–∞ —Å—É—Ç–Ω–æ—Å—Ç—ñ_ - –Ω–∞–∑–≤–∞ –æ–± º—î–∫—Ç—É –¥–∞—Ç–∞ –º–æ–¥–µ–ª—ñ (—Ç–∞–±–ª–∏—Ü—è –∞–±–æ —Å–∫–ª–∞–¥–Ω–∏–π –æ–± º—î–∫—Ç) +
_–§–∞–π–ª_ - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —è–∫–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î —Ñ–∞–π–ª —ñ —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ –∫–ª—é—á–∞ –¥–æ —Ñ–∞–π–ª—É —ñ —á–µ–∫—Å—É–º–∏. +
_–ü—ñ–¥–ø–∏—Å_ - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —è–∫–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î —Ñ–æ—Ä–º—É —è–∫–∞ –±—É–ª–∞ –ø—ñ–¥–ø–∏—Å–∞–Ω–∞ –∑ –≤–º—ñ—Å—Ç–æ–º —Ñ–∞–π–ª—É. +
__–ü–æ—Ö—ñ–¥–Ω–∏–π —Ñ–∞–π–ª (–æ–ø—Ü—ñ–π–Ω–æ) __- —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —è–∫–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î —Ñ–∞–π–ª, —è–∫–∏–π –±—É–≤ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –≤ –±—ñ–∑–Ω–µ—Å –ø—Ä–æ—Ü–µ—Å—ñ –∞–±–æ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ –æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª—É. +
_–ó–º—ñ–Ω–Ω–∞_ - –ù–∞–∑–≤–∞ –∑–º—ñ–Ω–Ω–æ—ó –≤ —è–∫—É –±—É–¥–µ –∑–±–µ—Ä–µ–∂–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–æ–±–∫–∏ —Ñ–∞–π–ª—É. +
_JWT —Ç–æ–∫–µ–Ω_ - —Ç–æ–∫–µ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. +
////

Entity name_ - name of the object date of the model (table or complex object) +
_File_ is a structure that represents a file and consists of a key to the file and a checksum. +
_Signature_ - a structure that represents the form that was signed with the contents of the file. +
__Derived file (optional) __- a structure that represents a file that was created in a business process or as a result of processing the original file. +
_Variable_ - the name of the variable in which the result of file processing will be saved. +
_JWT token_ - user token. +

//.–ü—Ä–∏–∫–ª–∞–¥ —Ç—ñ–ª–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ —Ñ–∞–π–ª—É
.An example of a message body for saving data from a file
[source,json]
----
{
  "payload": {
    "file": {
      "checksum": "....",
      "id": "process/bp-instance-id/uuid"
    },
    "derivedFile": {
      "checksum": "...",
      "id": "process/bp-instance-id/uuid"
    }
  }
}
----
–í—Å—ñ –º–µ—Ç–∞–¥–∞–Ω—ñ –¥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö –¥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —Ä–∞–∑–æ–º –∑ —Ç–∏–ø–æ–≤–∏–º–∏ –¥–ª—è –ë–ü "X-Digital-*" –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏.

_X-Digital-Signature_ - –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏–π –ø—ñ–¥–ø–∏—Å. +
_X-Digital-Signature-Derived_ - –ø—ñ–¥–ø–∏—Å —è–∫–∏–π –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è –Ω–∞ –ø—ñ–¥—Å—Ç–∞–≤—ñ —Ñ—ñ–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è. +
_EntityName_ - –Ω–∞–∑–≤–∞ –æ–± º—î–∫—Ç—É –¥–∞—Ç–∞ –º–æ–¥–µ–ª—ñ. +
_ResultVariable_ - –Ω–∞–∑–≤–∞ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω–æ—ó –∑–º—ñ–Ω–Ω–æ—ó –≤ —è–∫—É –±—É–¥–µ –∑–±–µ—Ä–µ–∂–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–æ–±–∫–∏ —Ñ–∞–π–ª—É. +


//=== –°–µ—Ä–≤—ñ—Å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–∞–Ω–∏–º–∏ —Ä–µ—î—Å—Ç—Ä—É
=== Synchronous registry data management service

//–í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –∑–≥—ñ–¥–Ω–æ —ñ—Å–Ω—É—é—á–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É –∑–∞ —Ä–∞—Ö—É–Ω–æ–∫ –ø—Ä–æ–∫—Å—é–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ —Å–µ—Ä–≤—ñ—Å—É —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–∞–Ω–∏–º–∏, –ø—Ä–∞–≤–∏–ª–∞ —â–æ–¥–æ –¥–æ–∑–≤–æ–ª–µ–Ω–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Å—É—Ç–Ω–æ—Å—Ç–µ–π –≤–∏—Å—Ç–∞–≤–ª–µ–Ω–∏—Ö –º–æ–¥–µ–ª—é–≤–∞–ª—å–Ω–∏–∫–æ–º —Ñ–æ—Ä–º—É—î—Ç—å—Å—è –Ω–∞ –µ—Ç–∞–ø—ñ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó —Å–µ—Ä–≤—ñ—Å—É.
Validation takes place according to the existing process by proxying requests to the synchronous data management service, the rules regarding the permitted number of entities exposed by the modeler are formed at the service generation stage.

//=== –°–µ—Ä–≤—ñ—Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–∞–Ω–∏–º–∏ —Ä–µ—î—Å—Ç—Ä—É
=== Asynchronous registry data management service

//–ü—Ä–æ—Ü–µ—Å –æ–±—Ä–æ–±–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑–¥—ñ–π—Å–Ω—é—î—Ç—å—Å—è —ñ—Å–Ω—É—é—á–∏–º–∏ –æ–±—Ä–æ–±–Ω–∏–∫–∞–º–∏ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å—É—Ç–Ω–æ—Å—Ç–µ–π (`createEntity`, `createCompositeEntity`) —è–∫–∏–π –æ–±–∏—Ä–∞—î—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –ø–æ —Ç—É–ø–∏ —Å—É—Ç–Ω–æ—Å—Ç—ñ –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ –∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ–ª—è `entityName`, —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è –ø–µ—Ä–µ–ª—ñ–∫—É –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—ó `entityName`  –¥–æ –æ–±—Ä–æ–±–Ω–∏–∫–∞ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –Ω–∞ –µ—Ç–∞–ø—ñ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó.
The process of processing the message is carried out by existing handlers for saving entities (`createEntity`, `createCompositeEntity`) which is dynamically selected according to the entity name depending on the value of the `entityName` field, the formation of the routing list of `entityName` to the handler takes place at the generation stage.

//–†–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –æ–±—Ä–æ–±–∫–∏ –±—É–¥–µ —Å—Ç–∞—Ç—É—Å —Ç–∞ –¥–µ—Ç–∞–ª—ñ –¥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.
The processing result will be the status and details for the message.

[source, json]
----
{
  "status": "SUCCESS",
  "details": "OK"
}
----

[source, json]
----
{
  "status": "CONSTRAINT_VIOLATION",
  "details": "error: {%s} in line: {%d}"
}
----

//–¢–µ–∫—Å—Ç –∑ –ø–æ–º–∏–ª–∫–∏ –ø—Ä–æ –ø–æ—Ä—É—à–µ–Ω–Ω—è –ø—Ä–∞–≤–∏–ª –ë–î, –±–µ—Ä–µ—Ç—å—Å—è –∑ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏, –∞ –Ω–æ–º–µ—Ä —Ä—è–¥–∫–∞ –∑–∞ —Ä–∞—Ö—É–Ω–æ–∫ –≤–µ–¥–µ–Ω–Ω—è –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞ –≤ —Å–µ—Ä–µ–¥–∏–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó.
The text from the error about the violation of the database rules is taken from the procedure, and the line number is due to keeping a counter in the middle of the transaction.

//=== –û–±—Ä–æ–±–Ω–∏–∫ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø–æ–¥—ñ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –¥–ª—è —Å–µ—Ä–≤—ñ—Å—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—ñ–≤
=== Handler of data loading results event messages for the business process execution service

//–ö–æ—Ä–µ–ª—è—Ü—ñ—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –∑ –±—ñ–∑–Ω–µ—Å –ø—Ä–æ—Ü–µ—Å–æ–º –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –∑–∞ —Ä–∞—Ö—É–Ω–æ–∫ `BusinessProcessInstanceId` –∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É.
//–ê —Ç–∏–ø –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —Ñ–æ—Ä–º—É—î—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –Ω–∞ –ø—ñ–¥—Å—Ç–∞–≤—ñ —Ç–∏–ø—É —Å—É—Ç–Ω–æ—Å—Ç—ñ —Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É.

Correlation of the result with the business process occurs due to `BusinessProcessInstanceId` from the context.
The message type is generated dynamically based on the entity type and the result.

//.–ü—Ä–∏–∫–ª–∞–¥ –º–æ–∂–ª–∏–≤–æ—ó –∫–æ—Ä–µ–ª—è—Ü—ñ—ó
.An example of a possible correlation
[source, java]
----
@Component
public class AsyncDataLoadResponseKafkaListener {
    private static final String ACTION = "DataLoadCsv";
    @Autowired
    private RuntimeService runtimeService;

    @KafkaListener("data-load.csv.outbound")
    public void processAsyncMessages(
            @Payload AsyncDataLoadResponse message,
            MessageHeaders headers) {
        AsyncDataLoadResult payload = message.geyPayload();

        RequestContext requestContext = message.getRequestContext();
        Result result = new Result(message.getStatus(), message.getDetails());
        runtimeService.createMessageCorrelation(payload.getEntityName() + ACTION + message.getStatus())
          .processInstanceId(requestContext.getProcessInstanceId())
          .setVariable(payload.getResultVariable(), result)
          .correlate();
    }

}
----

//== –í–∏—Å–æ–∫–æ—Ä—ñ–≤–Ω–µ–≤–∏–π –ø–ª–∞–Ω —Ä–æ–∑—Ä–æ–±–∫–∏
== High-level development plan

//=== –¢–µ—Ö–Ω—ñ—á–Ω—ñ –µ–∫—Å–ø–µ—Ä—Ç–∏–∑–∏
=== Technical examinations

* BE
* FE

//=== –ü–ª–∞–Ω —Ä–æ–∑—Ä–æ–±–∫–∏
=== Development plan
////
* –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ—ó —Ñ–æ—Ä–º–∏ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ CSV —Ñ–∞–π–ª—ñ–≤
* –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ Liquibase –¥–æ–¥–∞—Ç–∫–æ–≤–∏–º–∏ —Ç–µ–≥–∞–º–∏.
* –†–æ–∑—Ä–æ–±–∫–∞ –Ω–æ–≤–æ–≥–æ –¥–µ–ª–µ–≥–∞—Ç—É –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å.
* –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å—É –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–∞–Ω–∏–º–∏ —Ä–µ—î—Å—Ç—Ä—É –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏ –ø—Ä–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö.
* –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—ñ–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ—é –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –≤—Ö—ñ–¥–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å.
* –†–æ–∑—Ä–æ–±–∫–∞ —Ä–µ—Ñ–µ—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–∏–∫–ª–∞–¥—É –ë–ü.
* –ó–º—ñ–Ω–∞ —ñ—Å–Ω—É—é—á–æ—ó —Ñ–æ—Ä–º–∏ –≤ —á–∞—Å—Ç–∏–Ω—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –≤–∫–∞–∑–∞–Ω–Ω—è —Å—É—Ç–Ω–æ—Å—Ç—ñ –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó (–ø–æ–ª–µ —Å—Ç–∞—î –Ω–µ –æ–±–æ–≤ º—è–∑–∫–æ–≤–∏–º —ñ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –∑–¥—ñ–π—Å–Ω—é—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ —Ü—å–æ–º—É –ø–æ–ª—ñ)
* –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ CSV —è–∫ —Ñ–∞–π–ª—ñ–≤ –≤ —Å–µ—Ä–≤—ñ—Å–∞—Ö —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–∞–Ω–∏–º–∏ —Ä–µ—î—Å—Ç—Ä—É
////
* Creation of a new form for uploading data from CSV files
* Liquibase library extension with additional tags.
* Development of a new delegate for sending asynchronous messages.
* Extension of the asynchronous registry data management service to work with data download notifications.
* Extension of the business process execution service with a component for processing incoming messages.
* Development of an abstract example of BP.
* Changing the existing form in terms of the need to specify the entity for validation (the field becomes optional and validation is carried out only if there is a value in this field)
* Expanding the ability to save CSV files as files in registry data management services
