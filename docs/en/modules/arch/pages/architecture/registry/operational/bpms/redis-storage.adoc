= Non-relational data storage
include::platform:ROOT:partial$templates/document-attributes/arch-set-en.adoc[]

include::platform:ROOT:partial$admonitions/language-en.adoc[]

== Overview

//_xref:arch:architecture/registry/operational/bpms/overview.adoc[Підсистема виконання бізнес-процесів]_ використовує розподілену _in-memory_ базу даних xref:arch:architecture/platform-technologies.adoc#redis[Redis] з  xref:arch:architecture/registry/operational/nonrelational-data-storage/overview.adoc[_Підсистеми управління нереляційними базами даних_] для зберігання проміжних даних, породжених у межах виконання бізнес-процесів та даних, необхідних для побудови UI-форм кабінетів користувачів.
The xref:arch:architecture/registry/operational/bpms/overview.adoc[_Business processes management subsystem_] uses a distributed in-memory xref:arch:architecture/platform-technologies.adoc#redis[Redis] database from the xref:arch:architecture/registry/operational/nonrelational-data-storage/overview.adoc[_Non-relational databases management subsystem_] to store intermediate data generated by business processes and data required for building UI forms in user portals.

//== Структури даних
== Data structures

=== bpm-form-submissions

//Зберігання даних, внесених користувачами через UI-форми, цифрових підписів та даних, переданих у якості вхідних параметрів бізнес-процесу зовнішніми системами.
Provides storage for data entered by users through UI forms, digital signatures, and data obtained as input parameters for business processes from external systems.

[NOTE]
--
//Під ключем _bpm-form-submissions_ зберігається перелік унікальних ключів (_set_) під якими зберігаються безпосередньо дані у вигляді hash-таблиці за окремими ключами які мають префікс _bpm-form-submissions_.
The _bpm-form-submissions_ key contains a set of unique keys, which stores data as a hash table with individual keys prefixed with _bpm-form-submissions_.
--

//.Паттерн генерації ключа для запису даних UI-форми
.Key generation pattern for storing UI form data
[source]
----
bpm-form-submissions:process/{processInstanceId}/task/{taskDefinitionKey}
----

//.Паттерн генерації ключа для запису даних стартової UI-форми бізнес-процесу
.Key generation pattern for storing data of the initial UI form of a business process
[source]
----
bpm-form-submissions:process-definition/{processDefinitionKey}/start-form/{UUID}
----

//.Паттерн генерації ключа для запису з даними цифрової печатки реєстру
.Key generation pattern for storing data with the registry digital seal
[source]
----
bpm-form-submissions:lowcode_{rootProcessInstanceId}_{processInstanceId}_system_signature_ceph_key
----

//.Паттерн генерації ключа для запису з даними цифрової печатки реєстру для батч-операцій
.Key generation pattern for storing data with the registry digital seal for batch operations
[source]
----
bpm-form-submissions:lowcode_{processInstanceId}_system_signature_ceph_key_{index}"
----

//.Опис структури для зберігання даних
.Data storage structure
|===
//|Ключ |Тип даних|Опис
|Key |Data type |Description

|`id`
|_String_
|Unique ID

|`accessToken`
|_String_
|_JWT_ user token

|`data`
|_String_ (_JSON_)
|Data

|`signature`
|_String_
|Digital signature
|===

=== bpm-message-payloads

//Зберігання даних, переданих у якості вхідних параметрів з повідомленням для ініціювання бізнес-процесу.
Provides storage for data provided as input parameters with messages for initiating business processes.

[NOTE]
--
//Під ключем _bpm-message-payloads_ зберігається перелік унікальних ключів (_set_) під якими зберігаються безпосередньо дані у вигляді hash-таблиці за окремими ключами які мають префікс _bpm-message-payloads_.
The _bpm-message-payloads_ key contains a set of unique keys, which stores data as a hash table with individual keys prefixed with _bpm-message-payloads_.
--

//.Паттерн генерації ключа для запису
.Storage key generation pattern
[source]
----
bpm-message-payloads:process-definition/{processDefinitionKey}/start-message/{UUID}
----

.Data storage structure
|===
|Key |Data type |Description

|`id`
|_String_
|Unique ID

|`data`
|_String_ (_JSON_)
|Input parameter data (message body)
|===

=== bpm-form-schemas

//Зберігання описів структур UI-форм в JSON-форматі, сумісному з _Form.IO_.
Provides storage for UI form structure descriptions in JSON format compatible with _Form.io_.

[NOTE]
--
//Дані зберігаються у вигляді _Hash_-таблиці з сегрегацією об’єктів на рівні префіксів в ідентифікаторах (_<keyspace>:<key>_).
The data is stored in the form of a hash table with objects segregation at the level of ID prefixes (_<keyspace>:<key>_).
--

//.Паттерн генерації ключа для запису
.Storage key generation pattern
[source]
----
bpm-form-schemas:{formKey}
----

.Data storage structure
|===
|Key |Data type |Description

|`id`
|_String_
|Unique ID of the UI form

|`formData`
|_String_ (_JSON_)
|UI form structure description in JSON format
|===

//TODO: Hiding the "update required" section for now
////
=== bpm-form-scripts

[WARNING]
--
Дана секція потребує уточнення по результату реалізації технічного дизайну xref:arch:architecture/registry/administrative/regulation-management/platform-evolution/form-scripts/form-scripts.adoc[].
--

Зберігання коду скриптів для використання в UI-формах кабінетів користувачів.

[NOTE]
--
Дані зберігаються у вигляді _Hash_-таблиці з сегрегацією об’єктів на рівні префіксів в ідентифікаторах (_<keyspace>:<key>_).
--

.Паттерн генерації ключа для запису
[source]
----
bpm-form-scripts:{scriptName}
----

.Опис структури для зберігання
|===
|Ключ |Тип даних|Опис

|`id`
|_String_
|Унікальний ідентифікатор - назва файлу зі скриптом в регламенті

|`formScript`
|_String_
|Контент файлу зі скриптом в регламенті
|===