= Registry regulations modeling
include::platform:ROOT:partial$templates/document-attributes/arch-set-en.adoc[]

include::platform:ROOT:partial$admonitions/language-en.adoc[]

//== –ú–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è —à–∞–±–ª–æ–Ω—ñ–≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
== Message template modeling

//=== –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—É
=== Regulations repository structure

//–î–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –≤–∏–º–æ–≥ –ø–æ –ø—ñ–¥—Ç—Ä–∏–º—Ü—ñ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º, —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—É —Ä–æ–∑—à–∏—Ä–µ–Ω–æ –¥–æ–¥–∞—Ç–∫–æ–≤–æ—é –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—î—é _<registry-regulation>/notifications_:
To meet the requirements for supporting message delivery to users, the regulations structure has been expanded with an additional directory _<registry-regulation>/notifications_:

[plantuml, notification-regulation-structure, svg]
----
include::partial$architecture/registry/operational/notifications/general/notification-regulation-structure.puml[]
----

//–†–µ–≥–ª–∞–º–µ–Ω—Ç –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ–π —Ä–µ–∞–ª—ñ–∑—É—î –Ω–∞—Å—Ç—É–ø–Ω—ñ –∞—Å–ø–µ–∫—Ç–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è:
The notification regulation encompasses the following administration aspects:

//- _notifications/_ - –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —à–∞–±–ª–æ–Ω—ñ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–∞ —Ä—ñ–≤–Ω—ñ –æ–∫—Ä–µ–º–∏—Ö –≤–∏–∑–Ω–∞—á–µ–Ω–∏—Ö –∫–∞–Ω–∞–ª—ñ–≤
- _notifications/_ - Configuration of templates for message generation at the level of individual designated channels

//=== –®–∞–±–ª–æ–Ω–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –Ω–∞ —Ä—ñ–≤–Ω—ñ –æ–∫—Ä–µ–º–∏—Ö –∫–∞–Ω–∞–ª—ñ–≤ –∑–≤'—è–∑–∫—É
== Channel-specific message templates

[NOTE]
//–î–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –º–æ–∂–ª–∏–≤–æ—Å—Ç–µ–π —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞ –∫–∞—Å—Ç–æ–º—ñ–∑–∞—Ü—ñ—ó —à–∞–±–ª–æ–Ω—ñ–≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å, —è–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—é —à–∞–±–ª–æ–Ω—ñ–∑–∞—Ü—ñ—ó –æ–±—Ä–∞–Ω–æ https://freemarker.apache.org/[Apache FreeMarker] (—Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ "_*.ftlh_" —Ç–∞ "_*.ftl_" –¥–ª—è HTML —Ç–∞ —Ç–µ–∫—Å—Ç–æ–≤–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ).
To facilitate the creation and customization of message templates, https://freemarker.apache.org/[Apache FreeMarker] has been chosen as the templating technology (using "_.ftlh_" and "_.ftl_" extensions for HTML and text documents, respectively).

//–ó —Ü—ñ–ª–ª—é –ø–æ–¥–∞–ª—å—à–æ–≥–æ —Ä–æ–∑–≤–∏—Ç–∫—É, –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—É –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ–π –∑–∞–∫–ª–∞–¥–µ–Ω–æ –ø—ñ–¥—Ç—Ä–∏–º–∫—É —à–∞–±–ª–æ–Ω—ñ–≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –∫–∞–Ω–∞–ª—ñ–≤ –∑–≤'—è–∑–∫—É:
With the aim of further development, the regulations notification structure incorporates support for message templates depending on the following communication channels:

//- _inbox_ - –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —É —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –≤–∏–≥–ª—è–¥—ñ —É –∫–∞–±—ñ–Ω–µ—Ç –≥—Ä–æ–º–∞–¥—è–Ω–∏–Ω–∞
//- _email_ - –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —É HTML-–≤–∏–≥–ª—è–¥—ñ –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ—é –ø–æ—à—Ç–æ—é
//- _diia_ - –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —É —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –≤–∏–≥–ª—è–¥—ñ —á–µ—Ä–µ–∑ –º–æ–±—ñ–ª—å–Ω–∏–π –¥–æ–¥–∞—Ç–æ–∫ _–î—ñ—è_
- _inbox_ - Sending text-based messages to the citizen portal
- _email_ - Sending HTML-formatted messages via email
- _diia_ - Sending text-based messages through the mobile application "Diia" (Ukrainian citizen-facing solution, UA-specific)

//=== –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —à–∞–±–ª–æ–Ω—É in-app –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
=== In-app notification template structure

//–¢–∏–ø–æ–≤–∏–π —à–∞–±–ª–æ–Ω push-–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –º–∞—î –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
A typical push notification template has the following structure:

[plantuml, inbox-notification-structure, svg]
----
include::partial$architecture/registry/operational/notifications/inbox/inbox-notification-structure.puml[]
----

//- _<template-directory>_ - –î–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è –∑ —Ä–µ—Å—É—Ä—Å–∞–º–∏ —à–∞–±–ª–æ–Ω—É, —è–∫–∞ –º–∞—î —É–Ω—ñ–∫–∞–ª—å–Ω–µ —ñ–º'—è –¥–ª—è –∑–∞–¥–∞–Ω–æ–≥–æ –∫–∞–Ω–∞–ª—É –∑–≤'—è–∑–∫—É (_email_ —É –¥–∞–Ω–æ–º—É —Ä–∞–∑—ñ)
- _<template-directory>_ - Directory containing template resources with a unique name for the specified communication channel (_email_ in this case)
//- _<template-directory>/notification.yml_ - –ú–µ—Ç–∞-–¥–∞–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (–∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —Ç–æ—â–æ.)
- _<template-directory>/notification.yml_ - Message metadata (message title, etc.)
//- _<template-directory>/notification.ftl_ - –¢–µ–∫—Å—Ç–æ–≤–∏–π _Freemarker_-—à–∞–±–ª–æ–Ω –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó —Ç—ñ–ª–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- _<template-directory>/notification.ftl_ - Textual _Freemarker_ template for generating the message body

//.–ü—Ä–∏–∫–ª–∞–¥ —Ñ–∞–π–ª—É –º–µ—Ç–∞-–¥–∞–Ω–∏—Ö _notification.yml_
.Example _notification.yml_ metadata file:
//title: "<–ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è>"
[source, yaml]
----
title: "<Message title>"
----

//–ü—Ä–∏–∫–ª–∞–¥ —à–∞–±–ª–æ–Ω—É _notification.ftl_:
Example _notification.ftl_ template:
include::ROOT:partial$admonitions/ua-specific.adoc[]
////
"–£ –∫—Ä–µ–¥–∏—Ç–Ω—É —ñ—Å—Ç–æ—Ä—ñ—é –Ω–∞–¥—ñ–π—à–ª–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –Ω–æ–≤–∏–π –∫—Ä–µ–¥–∏—Ç–Ω–∏–π –¥–æ–≥–æ–≤—ñ—Ä:\n
–¥–∞—Ç–∞ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è - ${dateCredOpen},\n–∫—Ä–µ–¥–∏—Ç–æ—Ä - ${creditor}.\n
üì• –û—Ç—Ä–∏–º–∞—Ç–∏ –∫—Ä–µ–¥–∏—Ç–Ω—É —ñ—Å—Ç–æ—Ä—ñ—é –º–æ–∂–Ω–∞ –Ω–∞ —Å–∞–π—Ç—ñ –£–∫—Ä–∞—ó–Ω—Å—å–∫–æ–≥–æ –±—é—Ä–æ –∫—Ä–µ–¥–∏—Ç–Ω–∏—Ö —ñ—Å—Ç–æ—Ä—ñ–π - ubki.ua.\n
‚õîÔ∏è –£ —Ä–∞–∑—ñ –≤–∏—è–≤–ª–µ–Ω–Ω—è —à–∞—Ö—Ä–∞–π—Å—å–∫–∏—Ö –¥—ñ–π —â–æ–¥–æ –≤–∞—Å –∞–±–æ –ø–æ–º–∏–ª–∫–∏ –∫—Ä–µ–¥–∏—Ç–æ—Ä–∞ - –æ—Å–∫–∞—Ä–∂—ñ—Ç—å –¥–∞–Ω—ñ —É –∫—Ä–µ–¥–∏—Ç–Ω—ñ–π —ñ—Å—Ç–æ—Ä—ñ—ó."
////
[source, text]
----
"Information about a new credit agreement has been added to your credit history:\n
Opening date - ${dateCredOpen},\nCreditor - ${creditor}.\n
üì• You can obtain your credit history on the website of the Ukrainian Credit Bureau - ubki.ua.\n
‚õîÔ∏è In case of fraudulent actions concerning you or creditor errors - "
----

//=== –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —à–∞–±–ª–æ–Ω—É –ø–æ—à—Ç–æ–≤–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
=== Email message template structure

//–¢–∏–ø–æ–≤–∏–π —à–∞–±–ª–æ–Ω –ø–æ—à—Ç–æ–≤–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –º–∞—î –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
A typical email message template follows this structure:

[plantuml, email-notification-structure, svg]
----
include::partial$architecture/registry/operational/notifications/email/email-notification-structure.puml[]
----

//- _<template-directory>_ - –î–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è –∑ —Ä–µ—Å—É—Ä—Å–∞–º–∏ —à–∞–±–ª–æ–Ω—É, —è–∫–∞ –º–∞—î —É–Ω—ñ–∫–∞–ª—å–Ω–µ —ñ–º'—è –¥–ª—è –∑–∞–¥–∞–Ω–æ–≥–æ –∫–∞–Ω–∞–ª—É –∑–≤'—è–∑–∫—É (_email_ —É –¥–∞–Ω–æ–º—É —Ä–∞–∑—ñ)
- _<template-directory>_ - Directory containing template resources with a unique name for the specified communication channel (_email_ in this case)
//- _<template-directory>/notification.yml_ - –ú–µ—Ç–∞-–¥–∞–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (–∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —Ç–æ—â–æ.)
- _<template-directory>/notification.yml_ - Message metadata (message title, etc.)
//- _<template-directory>/notification.ftlh_ - HTML-–¥–æ–∫—É–º–µ–Ω—Ç Freemarker-—à–∞–±–ª–æ–Ω—É –¥–ª—è  –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó —Ç—ñ–ª–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- _<template-directory>/notification.ftlh_ - HTML document Freemarker template for generating the message body
//- _<template-directory>/css/style.css_ - "–Ñ–¥–∏–Ω–∏–π CSS-—Ñ–∞–π–ª —Å—Ç–∏–ª—ñ–≤, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –≤ HTML-–¥–æ–∫—É–º–µ–Ω—Ç—ñ (–ü—Ä–∏–∫–ª–∞–¥: _<link rel="stylesheet" href="css/style.css">_)
- _<template-directory>/css/style.css_ - Single CSS style file used in the HTML document (Example: _<link rel="stylesheet" href="css/style.css">_)
//- _<template-directory>/images/*.*_ - –ü–µ—Ä–µ–ª—ñ–∫ —Ñ–∞–π–ª—ñ–≤ –∑–æ–±—Ä–∞–∂–µ–Ω—å, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –≤ HTML-–¥–æ–∫—É–º–µ–Ω—Ç—ñ (–ü—Ä–∏–∫–ª–∞–¥: _<img src="images/image.jpg">_)
- _<template-directory>/images/*.*_ - List of image files used in the HTML document (Example: _<img src="images/image.jpg">_)

//.–ü—Ä–∏–∫–ª–∞–¥ —Ñ–∞–π–ª—É –º–µ—Ç–∞-–¥–∞–Ω–∏—Ö _notification.yml_
.Example _notification.yml_ metadata file:
//title: "<–ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è>"
[source, yaml]
----
title: "<Message title>"
----

//.–ü—Ä–∏–∫–ª–∞–¥ —à–∞–±–ª–æ–Ω—É _notification.ftlh_:
.Example _notification.ftlh_ template:

////
<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="css/style.css">
</head>
<body>
<div class="center">
<img src="images/image.jpg" class="trinity"/>
</div>
<p>
–¥–∞—Ç–∞ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è - ${dateCredOpen}, –∫—Ä–µ–¥–∏—Ç–æ—Ä - ${creditor}.
</p>
</body>
</html>
////

[source, html]
----
<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="center">
        <img src="images/image.jpg" class="trinity"/>
    </div>
    <p>
      opening date - ${dateCredOpen}, creditor - ${creditor}.
    </p>
</body>
</html>
----

////
=== –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —à–∞–±–ª–æ–Ω—É push-–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —É –º–æ–±—ñ–ª—å–Ω–∏–π –¥–æ–¥–∞—Ç–æ–∫ –î—ñ—è

–¢–∏–ø–æ–≤–∏–π —à–∞–±–ª–æ–Ω push-–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –º–∞—î –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

[plantuml, diia-notification-structure, svg]
----
include::partial$architecture/registry/operational/notifications/diia/diia-notification-structure.puml[]
----

- _<template-directory>_ - –î–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è –∑ —Ä–µ—Å—É—Ä—Å–∞–º–∏ —à–∞–±–ª–æ–Ω—É, —è–∫–∞ –º–∞—î —É–Ω—ñ–∫–∞–ª—å–Ω–µ —ñ–º'—è –¥–ª—è –∑–∞–¥–∞–Ω–æ–≥–æ –∫–∞–Ω–∞–ª—É –∑–≤'—è–∑–∫—É (_email_ —É –¥–∞–Ω–æ–º—É —Ä–∞–∑—ñ)
- _<template-directory>/notification.yml_ - –ú–µ—Ç–∞-–¥–∞–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (–∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —Ç–∏–ø –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —Ç–æ—â–æ.)
- _<template-directory>/notification.diia_ - –¢–µ–∫—Å—Ç–æ–≤–∏–π —à–∞–±–ª–æ–Ω –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó —Ç—ñ–ª–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

.–ü—Ä–∏–∫–ª–∞–¥ —Ñ–∞–π–ª—É –º–µ—Ç–∞-–¥–∞–Ω–∏—Ö _notification.yml_
[source, yaml]
----
title: "<–ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è>"
attributes:
  actionType: "<action-type: message>"
  templateType: "<template-type: attention>"
  shortText : "<–ö–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è>"
----

.–ü—Ä–∏–∫–ª–∞–¥ —à–∞–±–ª–æ–Ω—É _notification.diia_:
[source, text]
----
"–£ –∫—Ä–µ–¥–∏—Ç–Ω—É —ñ—Å—Ç–æ—Ä—ñ—é –Ω–∞–¥—ñ–π—à–ª–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –Ω–æ–≤–∏–π –∫—Ä–µ–¥–∏—Ç–Ω–∏–π –¥–æ–≥–æ–≤—ñ—Ä:\n
–¥–∞—Ç–∞ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è - {dateCredOpen},\n–∫—Ä–µ–¥–∏—Ç–æ—Ä - {creditor}.\n
üì• –û—Ç—Ä–∏–º–∞—Ç–∏ –∫—Ä–µ–¥–∏—Ç–Ω—É —ñ—Å—Ç–æ—Ä—ñ—é –º–æ–∂–Ω–∞ –Ω–∞ —Å–∞–π—Ç—ñ –£–∫—Ä–∞—ó–Ω—Å—å–∫–æ–≥–æ –±—é—Ä–æ –∫—Ä–µ–¥–∏—Ç–Ω–∏—Ö —ñ—Å—Ç–æ—Ä—ñ–π - ubki.ua.\n
‚õîÔ∏è –£ —Ä–∞–∑—ñ –≤–∏—è–≤–ª–µ–Ω–Ω—è —à–∞—Ö—Ä–∞–π—Å—å–∫–∏—Ö –¥—ñ–π —â–æ–¥–æ –≤–∞—Å –∞–±–æ –ø–æ–º–∏–ª–∫–∏ –∫—Ä–µ–¥–∏—Ç–æ—Ä–∞ - –æ—Å–∫–∞—Ä–∂—ñ—Ç—å –¥–∞–Ω—ñ —É –∫—Ä–µ–¥–∏—Ç–Ω—ñ–π —ñ—Å—Ç–æ—Ä—ñ—ó."
----
////

//=== –í–∞–ª—ñ–¥–∞—Ü—ñ—è –∑–º—ñ–Ω –¥–æ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—É —à–∞–±–ª–æ–Ω—ñ–≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
=== Validation of changes to message template regulations

//–í —Ä–∞–º–∫–∞—Ö —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ä—ñ—à–µ–Ω–Ω—è, –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ —Ä–æ–∑—à–∏—Ä–∏—Ç–∏ CLI-—É—Ç–∏–ª—ñ—Ç—É _registry-regulations-validator-cli_ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—É –¥–æ–¥–∞—Ç–∫–æ–≤–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏:
As part of the solution implementation, it's necessary to enhance the _registry-regulations-validator-cli_ CLI utility for validating regulations with additional rules:

//- –í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —à–∞–±–ª–æ–Ω—É –∑–≥—ñ–¥–Ω–æ –ø—Ä–∞–≤–∏–ª –æ–∫—Ä–µ–º–æ–≥–æ –∫–∞–Ω–∞–ª—É –∑–≤'—è–∑–∫—É
//- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ñ–∞–π–ª—ñ–≤ –º–µ—Ç–∞-–¥–∞–Ω–∏—Ö —à–∞–±–ª–æ–Ω—ñ–≤ _notification.yml_ –Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å JSON-—Å—Ö–µ–º—ñ
- Validation of template structure conformity according to specific communication channel rules.
- Checking _notification.yml_ metadata files for compliance with JSON schema

//.JSON-—Å—Ö–µ–º–∞ –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —à–∞–±–ª–æ–Ω—É –¥–ª—è –∫–∞–Ω–∞–ª—É –∑–≤'—è–∑–∫—É _inbox_
.JSON schema for validating templates for the _inbox_ communication channel:
[source, json]
----
{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "type": "object",
  "properties": {
    "title": {
      "type": "string",
      "minLength": 1
    }
  },
  "additionalProperties": false,
  "required": [
    "title"
  ]
}
----

//.JSON-—Å—Ö–µ–º–∞ –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —à–∞–±–ª–æ–Ω—É –¥–ª—è –∫–∞–Ω–∞–ª—É –∑–≤'—è–∑–∫—É _email_
.JSON schema for validating template for the email communication channel:
[source, json]
----
{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "type": "object",
  "properties": {
    "title": {
      "type": "string",
      "minLength": 1
    }
  },
  "additionalProperties": false,
  "required": [
    "title"
  ]
}
----

.JSON-—Å—Ö–µ–º–∞ –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —à–∞–±–ª–æ–Ω—É –¥–ª—è –∫–∞–Ω–∞–ª—É –∑–≤'—è–∑–∫—É _diia_
.JSON schema for validating template for the _diia_ (Ukrainian citizen-facing solution, UA-specific) communication channel:
[source, json]
----
{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "type": "object",
  "properties": {
    "title": {
      "type": "string",
      "minLength": 1
    },
    "attributes": {
      "type": "object",
      "properties": {
        "actionType": {
          "type": "string",
          "enum": [
            "message"
          ]
        },
        "templateType": {
          "type": "string",
          "enum": [
            "attention"
          ]
        },
        "shortText": {
          "type": "string",
          "minLength": 1
        }
      },
      "additionalProperties": false,
      "required": [
        "actionType", "templateType", "shortText"
      ]
    }
  },
  "additionalProperties": false,
  "required": [
    "title"
  ]
}
----

//=== –ü—É–±–ª—ñ–∫–∞—Ü—ñ—è –∑–º—ñ–Ω –¥–æ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—É —à–∞–±–ª–æ–Ω—ñ–≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
=== Publishing changes to the message template regulations

//–î–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑—Ñ–æ—Ä–º–æ–≤–∞–Ω–∏—Ö/–≤—ñ–¥–∫–æ—Ä–µ–≥–æ–≤–∞–Ω–∏—Ö –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º —à–∞–±–ª–æ–Ω—ñ–≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å, –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ —Ä–æ–∑—à–∏—Ä–∏—Ç–∏ –ø–∞–π–ø–ª–∞–π–Ω –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—É –µ—Ç–∞–ø–æ–º '_publish-notification-templates_' –∑ –≤–∏–∫–ª–∏–∫–æ–º —É—Ç–∏–ª—ñ—Ç–∏ _notification-template-publisher_ –Ω–∞ –∫—à—Ç–∞–ª—Ç:
To upload the generated/adjusted message templates by the administrator, it's necessary to expand the publication pipeline of regulations with the '_publish-notification-templates_' stage, calling the _notification-template-publisher_ utility as follows:

[source, bash]
----
java -jar
  -NOTIFICATION_SERVICE_URL=<notification-service.url>
  /home/jenkins/notification-template-publisher/notification-template-publisher.jar --notification_templates=notifications/templates
----

//–ù–∞ –¥–∞–Ω—ñ–π –¥—ñ–∞–≥—Ä–∞–º—ñ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–æ –¥–µ—Ç–∞–ª—ñ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –∫—Ä–æ–∫—É –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–º—ñ–Ω —Ç–∞ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó —à–∞–±–ª–æ–Ω—ñ–≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å:
The sequence diagram illustrates the implementation details of the step for uploading changes and publishing message templates:
[plantuml, notification-template-publication, svg]
----
include::partial$architecture/registry/operational/notifications/general/notification-template-publication.puml[]
----

//== –ú–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—ñ–≤ –∑ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è–º –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º
== Modeling business processes with user message sending

//–ó–∞–¥–ª—è —Å–ø—Ä–æ—â–µ–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –º–æ–∂–ª–∏–≤–æ—Å—Ç–µ–π –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º —É –º–µ–∂–∞—Ö –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—ñ–≤, –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –Ω–∞–¥–∞—î _–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—É —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—É_ –æ–∫—Ä–µ–º–µ —Ç–∏–ø–æ–≤–µ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è "_Send User Notification_" —É –∫–∞—Ç–∞–ª–æ–∑—ñ –º–æ–¥–µ–ª—é–≤–∞–ª—å–Ω–∏–∫–∞.
For simplifying the utilization of user message sending capabilities within business process execution, the platform provides the Regulations administrator with a distinct default extension named "_Send User Notification_" in the modeler catalog.

[NOTE]
//–ö–∞–Ω–∞–ª –∑–≤'—è–∑–∫—É, —è–∫–∏–π –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
The communication channel used for sending the message depends on user settings.

image::architecture/registry/operational/notifications/bpm/send-notification-element-template.png[send-notification-element-template, 300]

//=== –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ç–∏–ø–æ–≤–æ–≥–æ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É "_Send User Notification_"
=== Configuration of the default "_Send User Notification_" extension

//*–°–ª—É–∂–±–æ–≤–∞ –Ω–∞–∑–≤–∞ –¥–µ–ª–µ–≥–∞—Ç–∞*: _SendUserNotificationDelegate_

//*–ù–∞–∑–≤–∞ —Ç–∏–ø–æ–≤–æ–≥–æ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è*: '_–í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É_'

*Delegate technical name*: _SendUserNotificationDelegate_

*Default extension name*: '_Send User Notification_'

|===
//|–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä|–í—Ö—ñ–¥–Ω–∏–π/–í–∏—Ö—ñ–¥–Ω–∏–π|–°–ª—É–∂–±–æ–≤–∞ –Ω–∞–∑–≤–∞|–¢–∏–ø|–û–ø–∏—Å
|Configuration parameter|Input/Output|Technical name|Type|Description

//|*–û—Ç—Ä–∏–º—É–≤–∞—á –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (_Recipient_)*
|*Notification recipient (_Recipient_)*
|in
|notificationRecipient
|_string_
//|–£–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä _<username>_ –æ—Ç—Ä–∏–º—É–≤–∞—á–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
|Unique identifier _<username>_ of the message recipient

//|*–®–∞–±–ª–æ–Ω –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (_Notification message template_)*
|*Notification message template (_Notification message template_)*
|in
|notificationTemplate
|_string_
//|–£–Ω—ñ–∫–∞–ª—å–Ω–∞ –Ω–∞–∑–≤–∞ _FreeMarker_-—à–∞–±–ª–æ–Ω—É –¥–ª—è —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è —Ç—ñ–ª–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —è–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –Ω–∞–∑–≤—ñ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó —à–∞–±–ª–æ–Ω—É –∑–≥—ñ–¥–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ _<registry-regulation>/notifications/<channel>/<template_name>/*.*_
|Unique name of the _FreeMarker_ template used to generate the message body. It corresponds to the template directory name within the structure _<registry-regulation>/notifications/<channel>/<template_name>/*.*_

//|*–í—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó —Ç—ñ–ª–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (_Notification template model_)*
|*Input data for message body generation (_Notification template model_)*
|in
|notificationTemplateModel
|_map<string, object>_
//|–ù–∞–±—ñ—Ä –¥–∞–Ω–∏—Ö –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó —Ç—ñ–ª–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–∞ –±–∞–∑—ñ —à–∞–±–ª–æ–Ω–∞
|Dataset used to generate the message body based on the template
|===

[NOTE]
//–î–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –æ—Ç—Ä–∏–º—É–≤–∞—á–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è _notificationRecipient_ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –Ω–∞–¥–∞—î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å–ª—É–∂–±–æ–≤–∏—Ö _JUEL_-—Ñ—É–Ω–∫—Ü—ñ–π: ${_completer_('<user-task-id>')._userName_} –∞–±–æ ${_initiator_()._userName_}.
To define the _notificationRecipient_, the platform offers the use of built-in _JUEL_ functions: ${_completer_('<user-task-id>')._userName_} –∞–±–æ ${_initiator_()._userName_}.

//=== –†–µ—Ñ–µ—Ä–µ–Ω—Ç–Ω—ñ –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å–∏ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º —Ç–∏–ø–æ–≤–æ–≥–æ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
=== Reference business processes using the default extension for sending a message

//–£ —è–∫–æ—Å—Ç—ñ —Ä–µ—Ñ–µ—Ä–µ–Ω—Ç–Ω–∏—Ö, —Ä–æ–∑–≥–ª—è–¥–∞—é—Ç—å—Å—è –¥–≤–∞ —Å—Ü–µ–Ω–∞—Ä—ñ—ó –º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —É –º–µ–∂–∞—Ö –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—É:
Two modeling scenarios involving message sending within a business process execution are considered as references:

//- –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
- Sending a notification to a user

image::architecture/registry/operational/notifications/bpm/send-single-notification.png[send-single-notification,300]

//- –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è _N_ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º
- Sending a Message to _N_ Users

image::architecture/registry/operational/notifications/bpm/send-multi-notifications.png[send-multi-notifications,500]

//=== –ö–æ–¥ –æ–ø–∏—Å—É —Ç–∏–ø–æ–≤–æ–≥–æ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É "_Send User Notification_"
=== Code description of the standard "_Send User Notification_" extension

[source, json]
----
{
  "$schema": "https://unpkg.com/@camunda/element-templates-json-schema/resources/schema.json",
  "name": "Send User Notification",
  "id": "sendUserNotification",
  "appliesTo": [
    "bpmn:SendTask"
  ],
  "properties": [
    {
      "label": "Implementation Type",
      "type": "Hidden",
      "value": "${sendUserNotificationDelegate}",
      "editable": false,
      "binding": {
        "type": "property",
        "name": "camunda:delegateExpression"
      }
    },
    {
      "label": "Recipient",
      "description": "Notification recipient username <br/>(${initiator().userName or completer('taskDefinitionId').userName})",
      "type": "String",
      "binding": {
        "type": "camunda:inputParameter",
        "name": "notificationRecipient"
      },
      "constraints": {
        "notEmpty": true
      }
    },
    {
      "label": "Notification message template",
      "description": "Notification message template <br/>(<registry-regulation>/notifications/<channel>/<template_name>/*.*)",
      "type": "String",
      "binding": {
        "type": "camunda:inputParameter",
        "name": "notificationTemplate"
      },
      "constraints": {
        "notEmpty": true
      }
    },
    {
      "label": "Notification template model",
      "description": "Notification template model <br/>(${templateModel} variable to be used for template processing)",
      "type": "String",
      "binding": {
        "type": "camunda:inputParameter",
        "name": "notificationTemplateModel"
      },
      "constraints": {
        "notEmpty": true
      }
    }
  ]
}
----