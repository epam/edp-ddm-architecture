:toc-title: On this page:
:toc: auto
:toclevels: 5
:experimental:
:sectnums:
:sectnumlevels: 5
:sectanchors:
:sectlinks:
:partnums:

= Registry operational database

NOTE: üåê This document is available in both English and Ukrainian. Use the language toggle in the top right corner to switch between versions.

//== –ó–∞–≥–∞–ª—å–Ω–∏–π –æ–ø–∏—Å
== General description
////
–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö `registry` –º—ñ—Å—Ç–∏—Ç—å —è–∫ —Å–ª—É–∂–±–æ–≤—ñ —Ç–∞–±–ª–∏—Ü—ñ —Å–µ—Ä–≤—ñ—Å—ñ–≤ —Ç–∞–∫ —ñ –≤—Å—ñ —Ç–∞–±–ª–∏—Ü—ñ —Ä–µ—î—Å—Ç—Ä—É –∑–º–æ–¥–µ–ª—å–æ–≤–∞–Ω—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—É.

–°–ª—É–∂–±–æ–≤—ñ —Ç–∞–±–ª–∏—Ü—ñ —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è –≤ —Å—Ö–µ–º—ñ public –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ —Ä–µ—î—Å—Ç—Ä—É. –¢–∞–±–ª–∏—Ü—ñ —Ä–µ—î—Å—Ç—Ä—É —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è –≤ —Å—Ö–µ–º—ñ `registry` –ø—Ä–∏ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—ñ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—É.

–£ —Ü—å–æ–º—É –¥–æ–∫—É–º–µ–Ω—Ç—ñ —Ä–æ–∑–≥–ª—è–Ω—É—Ç—ñ —Å–ª—É–∂–±–æ–≤—ñ —Ç–∞–±–ª–∏—Ü—ñ —Å–µ—Ä–≤—ñ—Å—ñ–≤.
////

The `registry` database contains both official service tables and all registry tables modeled by the regulation administrator.

Service tables are created in the public schema when the registry is created. Registry tables are created in the `registry' scheme when deploying the regulation.

This document deals with service tables.

//== –°—Ö–µ–º–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
== Database schema

[plantuml, registry-public-schema, svg]
----
@startuml
hide circle
skinparam linetype ortho
skinparam monochrome true

entity "**ddm_liquibase_metadata**" {
  + ""metadata_id"": //integer [PK]//
  --
  *""change_type"": //text //
  *""change_name"": //text //
  *""attribute_name"": //text //
  *""attribute_value"": //text //
  *""created_at"": //timestamp with time zone //
}

entity "**ddm_rls_metadata**" {
  + ""rls_id"": //integer [PK]//
  --
  *""name"": //text //
  *""type"": //text //
  *""type"": //text //
  *""jwt_attribute"": //text //
  *""check_column"": //text //
  *""check_table"": //text //
}

entity "**ddm_role_permission**" {
  + ""permission_id"": //integer [PK]//
  --
  *""role_name"": //text //
  *""object_name"": //text //
  ""column_name"": //text //
  *""operation"": //type_operation //
  *""created_at"": //timestamp with time zone //
}

entity "**ddm_source_application**" {
  + ""application_id"": //uuid [PK]//
  --
  *""application_name"": //text //
  *""created_by"": //text //
  *""created_at"": //timestamp with time zone //
}

entity "**ddm_source_business_process**" {
  + ""business_process_id"": //uuid [PK]//
  --
  *""business_process_name"": //text //
  *""created_by"": //text //
  *""created_at"": //timestamp with time zone //
}

entity "**ddm_source_system**" {
  + ""system_id"": //uuid [PK]//
  --
  *""system_name"": //text //
  *""created_by"": //text //
  *""created_at"": //timestamp with time zone //
}
@enduml
----
//.–£–º–æ–≤–Ω—ñ –ø–æ–∑–Ω–∞—á–µ–Ω–Ω—è
.Legend
[%collapsible]
====
include::partial$architecture-workspace/documentation-templates/component-design-template/db-schema-legend.adoc[]
====

//== –°—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö
== Data structure

=== ddm_liquibase_metadata
////
–ú–µ—Ç–∞–¥–∞–Ω—ñ –æ—Ç—Ä–∏–º–∞–Ω—ñ –∑ –º–æ–¥–µ–ª—ñ –¥–∞–Ω–∏—Ö —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—É. –ù–∞ —ó—Ö –æ—Å–Ω–æ–≤—ñ –±—É–¥—É—î—Ç—å—Å—è API –¥–∞–Ω–∏—Ö.

–ù–∞—Ä–∞–∑—ñ –∫–æ–∂–µ–Ω —Ç–∏–ø –∑–º—ñ–Ω–∏ –º–æ–¥–µ–ª—ñ –¥–∞–Ω–∏—Ö –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å–≤—ñ–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø–∏—Å—É –º–µ—Ç–∞–¥–∞–Ω–∏—Ö, —Ç–æ–º—É –≤ –±—ñ–ª—å—à–æ—Å—Ç—ñ –≤–∏–ø–∞–¥–∫—ñ–≤ –≤–º—ñ—Å—Ç –∫–æ–ª–æ–Ω–æ–∫ –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —ó—Ö –ø–æ—á–∞—Ç–∫–æ–≤–æ–º—É –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—é.
////
The metadata is obtained from the data model of the regulation. Data API is built on their basis.

Currently, each type of data model change uses its own metadata recording format, so in most cases the contents of the columns do not correspond to their original purpose.

////
[options="header",cols="a"]
|======
|–Ü–º'—è –∫–æ–ª–æ–Ω–∫–∏ +
–û–ø–∏—Å
| `*metadata_id* _integer_ *(PK)*` + 
–Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä —Ä—è–¥–∫–∞ 
| `*change_type* _text_` + 
–¢–∏–ø –∑–º—ñ–Ω–∏ 
| `*change_name* _text_` + 
–ù–∞–∑–≤–∞ –∑–º—ñ–Ω–∏
| `*attribute_name* _text_` + 
–Ü–º'—è –∞—Ç—Ä–∏–±—É—Ç—É
| `*attribute_value* _text_` + 
–ó–Ω–∞—á–µ–Ω–Ω—è –∞—Ç—Ä–∏–±—É—Ç—É
| `*created_at* _timestamp with time zone_` + 
–ß–∞—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É
////

[options="header",cols="a"]
|======
|Column name +
Description
Row ID
| `*change_type* _text_` +
Type of change
| `*change_name* _text_` +
Name of change
| `*attribute_name* _text_` +
Attribute name
| `*attribute_value* _text_` +
Attribute value
| `*created_at* _timestamp with time zone_` +
Record creation time



|======
[options="header",cols="a"]
|======
|Uniqueness constraint

|`change_name, change_type, attribute_name, attribute_value`
|======



=== ddm_rls_metadata

//–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–∞–≤–∏–ª Row-Level Security –¥–ª—è –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ API –¥–∞–Ω–∏—Ö
Configuring Row-Level Security Rules for Data API Requests

////
[options="header",cols="a"]
|======
|–Ü–º'—è –∫–æ–ª–æ–Ω–∫–∏ +
–û–ø–∏—Å
| `*rls_id* _integer_ *(PK)*` + 
–Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä —Ä—è–¥–∫–∞ 
| `*name* _text_` + 
–ù–∞–∑–≤–∞ –ø—Ä–∞–≤–∏–ª–∞ 
| `*type* _text_` + 
–¢–∏–ø –æ–ø–µ—Ä–∞—Ü—ñ—ó

* read
* write
| `*jwt_attribute* _text_` + 
–Ü–º'—è –∞—Ç—Ä–∏–±—É—Ç—É jwt-—Ç–æ–∫–µ–Ω—É, –≤ —è–∫–æ–º—É –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ —è–∫–∏–º–∏ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è 
| `*check_column* _text_` + 
–Ü–º'—è –∫–æ–ª–æ–Ω–∫–∏-–¥–∏—Å–∫—Ä–∏–º—ñ–Ω–∞—Ç–æ—Ä—É –ø–æ —è–∫—ñ–π –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è
| `*check_table* _text_` + 
–ù–∞–∑–≤–∞ —Ç–∞–±–ª–∏—Ü—ñ –∞–±–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –∫—Ä–∏—Ç–µ—Ä—ñ—é –ø–æ—à—É–∫—É, –¥–æ —è–∫–∏—Ö –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª–æ 
|======
////

[options="header",cols="a"]
|======
|Column name +
Description
| `*rls_id* _integer_ *(PK)*` +
Row ID
| `*name* _text_` +
Name of rule
| `*type* _text_` +
Type of operation

* read
* write
| `*jwt_attribute* _text_` +
The name of the attribute of the jwt-token, in which the values by which the filtering takes place are transferred
| `*check_column* _text_` +
The name of the discriminator column on which the filtering takes place
| `*check_table* _text_` +
The name of the table or representation of the search criteria to which the rule applies
|======

////
[options="header",cols="a"]
|======
|–û–±–º–µ–∂–µ–Ω–Ω—è —É–Ω—ñ–∫–∞–ª—å–Ω–æ—Å—Ç—ñ
|`name, type`
|`check_table, type`
|======
////

[options="header",cols="a"]
|======
|Uniqueness constraint
|`name, type`
|`check_table, type`
|======


=== ddm_role_permission

//–ö–∞—Ç–∞–ª–æ–≥ –ø—Ä–∞–≤ –≤–∏–¥–∞–Ω–∏—Ö –¥–ª—è —Ä–æ–ª—ñ. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —Ä–æ–ª—å–æ–≤–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—é –¥–æ—Å—Ç—É–ø—É (RBAC) –¥–æ –¥–∞–Ω–∏—Ö —Ä–µ—î—Å—Ç—Ä—É.
Catalog of rights issued for the role. Used for role-based access control (RBAC) to registry data.

////
[options="header",cols="a"]
|======
|–Ü–º'—è –∫–æ–ª–æ–Ω–∫–∏ +
–û–ø–∏—Å
| `*permission_id* _integer_ *(PK)*` + 
–Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä —Ä—è–¥–∫–∞ 
| `*role_name* _text_` + 
–ù–∞–∑–≤–∞ —Ä–æ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ 
| `*object_name* _text_` + 
–Ü–º'—è —Ç–∞–±–ª–∏—Ü—ñ —á–∏ –∫—Ä–∏—Ç–µ—Ä—ñ—é –ø–æ—à—É–∫—É –¥–ª—è —è–∫–∏—Ö –Ω–∞–¥–∞—î—Ç—å—Å—è –¥–æ–∑–≤—ñ–ª
| `column_name _text_` + 
–Ü–º'—è –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è —è–∫–æ—ó –Ω–∞–¥–∞—î—Ç—å—Å—è –¥–æ–∑–≤—ñ–ª
| `*operation* _enum_` + 
–¢–∏–ø –æ–ø–µ—Ä–∞—Ü—ñ—ó –Ω–∞ —è–∫—É –Ω–∞–¥–∞—î—Ç—å—Å—è –¥–æ–∑–≤—ñ–ª

* S - —á–∏—Ç–∞–Ω–Ω—è
* I - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è
* U - –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
* D - –≤–∏–¥–∞–ª–µ–Ω–Ω—è
| `*created_at* _timestamp with time zone_` + 
–ß–∞—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–æ–∑–≤–æ–ª—É 
////

[options="header",cols="a"]
|======
|Column name +
Description
| `*permission_id* _integer_ *(PK)*` +
Row ID
| `*role_name* _text_` +
User role name
| `*object_name* _text_` +
The name of the table or search criteria for which the permission is granted
| `column_name _text_` +
The name of the column for which permission is granted
| `*operation* _enum_` +
The type of operation for which permission is granted

* S - reading
* I - creating
* U - updating
* D - deleting
| `*created_at* _timestamp with time zone_` +
Permission creation time


|======
[options="header",cols="a"]
|======
|Uniqueness constraint
|`role_name,object_name,operation,column_name`
|======


=== ddm_source_application

//–ö–∞—Ç–∞–ª–æ–≥ –¥–æ–¥–∞—Ç–∫—ñ–≤ - –¥–∂–µ—Ä–µ–ª –¥–∞–Ω–∏—Ö. –ó–∞–ø–∏—Å–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥ –¥–æ–¥–∞—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–æ–ª–∏ –≤—ñ–¥ –¥–æ–¥–∞—Ç–∫–∞ –≤–ø–µ—Ä—à–µ –Ω–∞–¥—Ö–æ–¥—è—Ç—å –¥–∞–Ω—ñ –¥–æ —Ä–µ—î—Å—Ç—Ä—É.
Catalog of applications - data sources. Entries to the directory are added automatically when data is first sent to the registry from the application.

////
[options="header",cols="a"]
|======
|–Ü–º'—è –∫–æ–ª–æ–Ω–∫–∏ +
–û–ø–∏—Å
| `*application_id* _uuid_ *(PK)*` + 
–Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä —Ä—è–¥–∫–∞ 
| `*application_name* _text_` + 
–ù–∞–∑–≤–∞ –¥–æ–¥–∞—Ç–∫—É 
| `*created_by* _text_` + 
–Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ –∑–∞–ø–∏—Ç–æ–º —è–∫–æ–≥–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ –∑–∞–ø–∏—Å 
| `*created_at* _timestamp with time zone_` + 
–ß–∞—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É 

|======
[options="header",cols="a"]
|======
|–û–±–º–µ–∂–µ–Ω–Ω—è —É–Ω—ñ–∫–∞–ª—å–Ω–æ—Å—Ç—ñ
|`application_name`
|======
////

[options="header",cols="a"]
|======
|Column name +
Description
| `*application_id* _uuid_ *(PK)*` +
Row ID
| `*application_name* _text_` +
Application name
| `*created_by* _text_` +
The ID of the user at whose request the record was created
| `*created_at* _timestamp with time zone_` +
Record creation time

|======
[options="header",cols="a"]
|======
|Uniqueness constraint
|`application_name`
|======


=== ddm_source_business_process

//–ö–∞—Ç–∞–ª–æ–≥ –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—ñ–≤ - –¥–∂–µ—Ä–µ–ª –¥–∞–Ω–∏—Ö. –ó–∞–ø–∏—Å–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥ –¥–æ–¥–∞—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–æ–ª–∏ –≤—ñ–¥ –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—É –≤–ø–µ—Ä—à–µ –Ω–∞–¥—Ö–æ–¥—è—Ç—å –¥–∞–Ω—ñ –¥–æ —Ä–µ—î—Å—Ç—Ä—É.
Catalog of business processes - data sources. Entries to the directory are added automatically when data is first sent to the registry from the business process.

////
[options="header",cols="a"]
|======
|–Ü–º'—è –∫–æ–ª–æ–Ω–∫–∏ +
–û–ø–∏—Å
| `*business_process_id* _uuid_ *(PK)*` + 
–Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä —Ä—è–¥–∫–∞ 
| `*business_process_name* _text_` + 
–ù–∞–∑–≤–∞  –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—É
| `*created_by* _text_` + 
–Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ –∑–∞–ø–∏—Ç–æ–º —è–∫–æ–≥–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ –∑–∞–ø–∏—Å 
| `*created_at* _timestamp with time zone_` + 
–ß–∞—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É 

|======
[options="header",cols="a"]
|======
|–û–±–º–µ–∂–µ–Ω–Ω—è —É–Ω—ñ–∫–∞–ª—å–Ω–æ—Å—Ç—ñ
|`business_process_name`
|======
////

[options="header",cols="a"]
|======
|Column name +
Description
| `*business_process_id* _uuid_ *(PK)*` +
Row ID
| `*business_process_name* _text_` +
Business process name
| `*created_by* _text_` +
The ID of the user at whose request the record was created
| `*created_at* _timestamp with time zone_` +
Record creation time

|======
[options="header",cols="a"]
|======
|Uniqueness constraint
|`business_process_name`
|======

=== ddm_source_system

//–ö–∞—Ç–∞–ª–æ–≥ —Å–∏—Å—Ç–µ–º - –¥–∂–µ—Ä–µ–ª –¥–∞–Ω–∏—Ö. –ó–∞–ø–∏—Å–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥ –¥–æ–¥–∞—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–æ–ª–∏ –≤—ñ–¥ —Å–∏—Å—Ç–µ–º–∏ –≤–ø–µ—Ä—à–µ –Ω–∞–¥—Ö–æ–¥—è—Ç—å –¥–∞–Ω—ñ –¥–æ —Ä–µ—î—Å—Ç—Ä—É.
Catalog of systems - data sources. Entries in the catalog are added automatically when data is first received from the system to the registry.
////
[options="header",cols="a"]
|======
|–Ü–º'—è –∫–æ–ª–æ–Ω–∫–∏ +
–û–ø–∏—Å
| `*system_id* _uuid_ *(PK)*` + 
–Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä —Ä—è–¥–∫–∞ 
| `*system_name* _text_` + 
–ù–∞–∑–≤–∞ —Å–∏—Å—Ç–µ–º–∏
| `*created_by* _text_` + 
–Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ –∑–∞–ø–∏—Ç–æ–º —è–∫–æ–≥–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ –∑–∞–ø–∏—Å 
| `*created_at* _timestamp with time zone_` + 
–ß–∞—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É 

|======
[options="header",cols="a"]
|======
|–û–±–º–µ–∂–µ–Ω–Ω—è —É–Ω—ñ–∫–∞–ª—å–Ω–æ—Å—Ç—ñ
|`system_name`
|======
////

[options="header",cols="a"]
|======
|Column name +
Description
| `*system_id* _uuid_ *(PK)*` +
Row ID
| `*system_name* _text_` +
System name
| `*created_by* _text_` +
The ID of the user at whose request the record was created
| `*created_at* _timestamp with time zone_` +
Record creation time

|======
[options="header",cols="a"]
|======
|Uniqueness constraint
|`system_name`
|======