= Registry regulations deployment subsystem
include::platform:ROOT:partial$templates/document-attributes/arch-set-en.adoc[]

include::platform:ROOT:partial$admonitions/language-en.adoc[]

== Overview

//Підсистема, що забезпечує функції перевірки цілісності внесених змін до xref:architecture/registry/administrative/regulation-management/registry-regulation/registry-regulation.adoc[_цифрового регламенту реєстру_] та їх автоматичне застосування до підсистем xref:architecture/registry/operational/overview.adoc[_операційної зони реєстру_].
The registry regulations deployment subsystem verifies the integrity of the changes made to the xref:architecture/registry/administrative/regulation-management/registry-regulation/registry-regulation.adoc[registry regulations] and automatically applies them to the subsystems of the xref:architecture/registry/operational/overview.adoc[registry operational zone].

== Subsystem functions

//* Відстеження змін до регламенту реєстру
* Tracking changes to the registry regulations
//* Валідація цілісності регламенту реєстру
* Validating the integrity of the registry regulations
//* Розгортання тимчасових баз даних для версій кандидатів
* Deploying temporary databases for version candidates
//* Застосування змін до схеми бази даних реєстру
* Applying changes to the registry database schema
//* Генерація коду сервісів доступу до даних реєстру
* Generating code for registry data access services
//* Розгортання сервісів доступу до даних реєстру
* Deploying registry data access services
//* Розгортання змін до бізнес-процесів та UI-форм
* Deploying changes to business processes and UI forms
//* Створення ролей користувачів реєстру
* Creating user roles for the registry
//* Налаштування прав доступу до бізнес-процесів
* Configuring access rights to business processes
//* Застосування змін до налаштувань зовнішніх інтеграцій та між-реєстрової взаємодії
* Applying changes to external integration and cross-registry interaction settings
//* Розгортання змін до шаблонів витягів та звітів
* Deploying changes to report and excerpt templates
//* Розгортання змін до шаблонів повідомлень користувачів
* Deploying changes to user notification templates
//* Застосування змін до налаштувань та кастомізацій реєстру
* Applying changes to registry settings and customization
//* Зберігання артефактів сервісів доступу до даних реєстру
* Storing artifacts of registry data access services
//* Приведення підсистем операційної зони реєстру до стану за замовчуванням (очищення регламенту)
* Resetting operational zone subsystems to the default state (regulations cleanup)
//* Налаштування правил симуляції зовнішніх інтеграцій
* Configuring simulation rules for external integrations
//* Налаштування підсистеми управління геоданими
* Configuring geodata management subsystem

//== Технічний дизайн підсистеми
== Technical design

//.Компонентна діаграма підсистеми публікації регламенту
.A component diagram of the regulations deployment subsystem
image::architecture/registry/administrative/regulation-publication/registry-publication-design.drawio.svg[]

//* _(1)_ - Відбувається тільки при першому розгортанні регламенту реєстру включно з відновленням після очищення
* _(1)_ - Occurs only on the first deployment of the registry regulations, including post-cleanup recovery.

//== Складові підсистеми
[#subsystem-components]
== Subsystem components
//TODO: Do we need the Repository column for en version?

|===
//|Назва компоненти|Представлення в реєстрі|Походження|Репозиторій|Призначення
|Component name |Registry representation |Source |Repository |Function

//|_Сервіс розгортання регламенту_
|_Regulations deployment service_
a|
* `jenkins`
* `jenkins-operator`
|3rd-party
a|
* https://gerrit-mdtu-ddm-edp-cicd.apps.cicd2.mdtu-ddm.projects.epam.com/admin/repos/mdtu-ddm/devops/operators/jenkins-operator[gerrit:/mdtu-ddm/.../jenkins-operator]
* https://github.com/jenkinsci/jenkins[github:/jenkinsci/jenkins]
//|Програмний комплекс, що забезпечує автоматизацію в життєвому циклі розгортання регламенту Реєстру
|A software suite that provides automation throughout the registry regulations deployment lifecycle.

//|_Пайплайни розгортання реглменту_
|_Regulations deployment pipeline_
a|
* `registry-regulations-publications-pipelines`
* `registry-regulations-publication-stages` (DEPRECATED)
|origin
a|
* https://gerrit-mdtu-ddm-edp-cicd.apps.cicd2.mdtu-ddm.projects.epam.com/admin/repos/mdtu-ddm/devops/registry-regulations-publications/registry-regulations-publication-pipelines[gerrit:/mdtu-ddm/.../registry-regulations-publication-pipelines]
* https://gerrit-mdtu-ddm-edp-cicd.apps.cicd2.mdtu-ddm.projects.epam.com/admin/repos/mdtu-ddm/devops/registry-regulations-publications/registry-regulations-publication-stages[gerrit:/mdtu-ddm/.../registry-regulations-publication-stages]
//| Groovy пайплайни для виконання різноманітних кроків підсистеми розгортання регламенту. Побудовано на базі
//https://epam.github.io/edp-install/user-guide/pipeline-framework/[EDP Pipeline Framework]
|Groovy pipelines to execute the various steps of the regulations deployment subsystem. Built on the https://epam.github.io/edp-install/user-guide/pipeline-framework/[EDP Pipeline Framework].

//|_Агент розгортання регламенту_
|_Regulations deployment agent_
|`dataplatform-jenkins-agent`
|origin
|https://gerrit-mdtu-ddm-edp-cicd.apps.cicd2.mdtu-ddm.projects.epam.com/admin/repos/mdtu-ddm/data-architecture/devops-application/dataplatform-jenkins-agent[gerrit:/mdtu-ddm/.../dataplatform-jenkins-agent]
//|Jenkins агент, який використовується для запуску пайплайнів підсистеми розгортання регламенту і містить всі необхідні залежності для цього. Детальніше з концепцією Jenkins агентів можна ознайомитись https://www.jenkins.io/doc/book/using/using-agents[в офіційній документації]
|A Jenkins agent that runs the pipelines of the regulations deployment subsystem and has all the necessary dependencies. To learn more about Jenkins agents, refer to Jenkins documentation: https://www.jenkins.io/doc/book/using/using-agents[Using Jenkins agents].

//|_Сховище артефактів реєстру_
|_Registry artifacts storage_
|`nexus`
|3rd-party
a|
* https://gerrit-mdtu-ddm-edp-cicd.apps.cicd2.mdtu-ddm.projects.epam.com/admin/repos/mdtu-ddm/data-architecture/devops-application/nexus[gerrit:/mdtu-ddm/data-architecture/devops-application/nexus]
* https://github.com/sonatype/nexus-public[github:/sonatype/nexus-public]
//|Збереження згенерованих в підсистемі артефактів
|Storing the artifacts generated in the subsystem.

//|_Утиліта валідації регламенту_
|_Regulations validation utility_
|`registry-regulations-validator-cli`
|origin
|https://gerrit-mdtu-ddm-edp-cicd.apps.cicd2.mdtu-ddm.projects.epam.com/admin/repos/mdtu-ddm/low-code-platform/platform/backend/utilities/registry-regulations-validator-cli[gerrit:/mdtu-ddm/.../registry-regulations-validator-cli]
//|_Command line interface (CLI)_ для валідації складників регламенту на етапі перевірки потенційних змін
|A _command line interface (CLI)_ for validating the regulations components at the stage of checking potential changes.

//|_Утиліта генерації сервісів доступу до даних реєстру_
|_Registry data access services generation utility_
|`service-generation-utility`
|origin
|https://gerrit-mdtu-ddm-edp-cicd.apps.cicd2.mdtu-ddm.projects.epam.com/admin/repos/mdtu-ddm/data-architecture/libraries/service-generation-utility[gerrit:/mdtu-ddm/.../service-generation-utility]
//|_CLI_ для генерації коду сервісів доступу до даних реєстру на основі опису _Liqubase_ скриптів
//TODO: "Liqubase" typo in ua version
|A _CLI_ for generating registry data access services code based on the _Liquibase_ script descriptions.

//|_Утиліта публікації аналітичних звітів та витягів_
|_Reports and excerpts publishing utility_
|`report-publisher`
|origin
|https://gerrit-mdtu-ddm-edp-cicd.apps.cicd2.mdtu-ddm.projects.epam.com/admin/repos/mdtu-ddm/data-architecture/libraries/report-publisher[gerrit:/mdtu-ddm/.../report-publisher]
//|_CLI_ для публікації аналітичних звітів та витягів у відповідні підсистеми
|A _CLI_ for publishing reports and excerpts to the corresponding subsystems.

//|_Утиліта управління доступом до БП_
|_BP access management utility_
|`camunda-auth-cli`
|origin
|https://gerrit-mdtu-ddm-edp-cicd.apps.cicd2.mdtu-ddm.projects.epam.com/admin/repos/mdtu-ddm/low-code-platform/platform/backend/utilities/camunda-auth-cli[gerrit:/mdtu-ddm/.../camunda-auth-cli]
//|_CLI_ для налаштування прав доступу до БП для відповідних ролей користувачів
|A _CLI_ for managing access rights to BP for the corresponding user roles.

//|_Утиліта публікації шаблонів нотифікацій_
|_Notification templates publishing utility_
|`notification-template-publisher`
|origin
|https://gerrit-mdtu-ddm-edp-cicd.apps.cicd2.mdtu-ddm.projects.epam.com/admin/repos/mdtu-ddm/data-architecture/libraries/notification-template-publisher[gerrit:/mdtu-ddm/.../notification-template-publisher]
//|_CLI_ для публікації шаблонів нотифікацій у відповідну підсистему
|A _CLI_ for publishing notification templates to the corresponding subsystems.

//|_Утиліта завантаження геошарів_
|_Geolayers loading utility_
|`geoserver-publisher`
|origin
|https://gerrit-mdtu-ddm-edp-cicd.apps.cicd2.mdtu-ddm.projects.epam.com/admin/repos/mdtu-ddm/data-architecture/libraries/geoserver-publisher[gerrit:/mdtu-ddm/.../geoserver-publisher]
//|_CLI_ для налаштування підсистеми управління геоданими
|A _CLI_ for configuring the geodata management subsystem.

//|_Тимчасові бази даних реєстру_
|_Temporary registry databases_
|`operational:registry-dev-*`
|origin
|https://gerrit-mdtu-ddm-edp-cicd.apps.cicd2.mdtu-ddm.projects.epam.com/gitweb?p=mdtu-ddm/devops/registry-regulations-publications/registry-regulations-publication-pipeline.git;a=blob;f=src/com/epam/digital/data/platform/pipelines/stages/impl/dataplatform/CreateSchemaVersionCandidate.groovy;h=38bb68710a40a192bc52a9620aa249cd6d3010bd;hb=refs/heads/master[gerrit:/mdtu-ddm/.../dataplatform/CreateSchemaVersionCandidate.groovy]
//|Тимчасові бази даних реєстру для версій-кандидатів, які використовуються при моделюванні регламенту для перевірки потенційних змін у _Liquibase_ скриптах
|Temporary registry databases for version candidates are used when modeling the regulations to test potential changes in _Liquibase_ scripts.

|===

//== Технологічний стек
== Technological stack

//При проєктуванні та розробці підсистеми, були використані наступні технології:
The following technologies were used when designing and developing the subsystem:

* xref:arch:architecture/platform-technologies.adoc#java[Java]
* xref:arch:architecture/platform-technologies.adoc#groovy[Groovy]
* xref:arch:architecture/platform-technologies.adoc#spring[Spring]
* xref:arch:architecture/platform-technologies.adoc#spring-boot[Spring Boot]
* xref:arch:architecture/platform-technologies.adoc#postgresql[PostgreSQL]
* xref:arch:architecture/platform-technologies.adoc#liquibase[Liquibase]
* xref:arch:architecture/platform-technologies.adoc#ceph[Ceph]
* xref:arch:architecture/platform-technologies.adoc#helm[Helm]
* xref:arch:architecture/platform-technologies.adoc#okd[OKD]
* xref:arch:architecture/platform-technologies.adoc#jenkins[Jenkins]
* xref:arch:architecture/platform-technologies.adoc#edp-jenkins-operator[EDP Jenkins Operator]
* xref:arch:architecture/platform-technologies.adoc#nexus[Nexus]
* xref:arch:architecture/platform-technologies.adoc#keycloak[Keycloak]
* xref:arch:architecture/platform-technologies.adoc#edp-keycloak-operator[EDP Keycloak Operator]
* xref:arch:architecture/platform-technologies.adoc#kafka[Kafka]
* xref:arch:architecture/platform-technologies.adoc#camunda[Camunda]
* xref:arch:architecture/platform-technologies.adoc#geoserver[GeoServer]

//== Атрибути якості підсистеми
== Subsystem quality attributes

=== _Deployability_
//Основна задача підсистеми - це швидке розгортання внесених до регламенту змін у відповідні підсистеми операційної зони реєстру відразу після їх створення. Для реалізації розгортання використовуються загально поширені технології скриптування та автоматизації розгортання, такі як _Groovy_, _Jenkins_, _Helm_.
The main task of the subsystem is to deploy the regulations changes to the corresponding subsystems of the registry operational zone as soon as they are made. The deployment is implemented using common scripting and deployment automation technologies such as _Groovy_, _Jenkins_, and _Helm_.

=== _Integrability_
//Перед підсистемою стоїть задача інтеграції з іншими підсистемами операційної зони реєстру. Для цього використовуються _Groovy_ скрипти або CLI адаптери, які містять складну логіку інтеграції та розроблені за допомогою мови програмування _Java_ та поширених фреймворків _Spring_ та _Spring Boot_.
The subsystem must be integrated with other subsystems of the registry operational zone. For this, the system uses _Groovy_ scripts and CLI adapters that contain complex integration logic and are developed using the _Java_ programming language and common frameworks such as _Spring_ and _Spring Boot_.

=== _Modifiability_
//Пайплайн публікації регламенту реєстру розділений на окремі кроки, які слабо пов'язані один з одним. Це дозволяє більш безпечно вносити зміни в існуючу реалізацію та розробляти нові функції по застосуванню змін до нових підсистем при розширенні xref:architecture/registry/operational/overview.adoc[операційної зони реєстру].
The registry regulations deployment pipeline is divided into separate, loosely connected steps. This enables you to safely modify the existing implementation and develop features to update new subsystems when expanding the xref:architecture/registry/operational/overview.adoc[registry operational zone].