:toc-title: On this page:
:toc: preamble
:toclevels: 5
:experimental:
:sectnums:
:sectnumlevels: 5
:sectanchors:
:sectlinks:
:partnums:

= Verifying QES signature and signer in API-received business process content

NOTE: üåê This document is available in both English and Ukrainian. Use the language toggle in the top right corner to switch between versions.

== General description

When integrating with third-party systems at the business process level, there is a need to work with signed files that are downloaded or transferred to a business process by these systems.
//–ü—Ä–∏ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –∑—ñ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ –Ω–∞ —Ä—ñ–≤–Ω—ñ –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—ñ–≤ —î –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ—Å—Ç—å —Ä–æ–±–æ—Ç–∏ –∑ –ø—ñ–¥–ø–∏—Å–∞–Ω–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏ —è–∫—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –∞–±–æ –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è –≤ –±—ñ–∑–Ω–µ—Å –ø—Ä–æ—Ü–µ—Å —Ü–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏.
Namely, there is a need to ensure the integrity of these files by checking the QES applied to these files. Get information about the signatory for further processing or entry into registers. There is also a need to view the contents of container files.
//–ê —Å–∞–º–µ, —î –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ—Å—Ç—å –≤–ø–µ–≤–Ω–∏—Ç–∏—Å—å –≤ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ —Ü–∏—Ö —Ñ–∞–π–ª—ñ–≤ —à–ª—è—Ö–æ–º –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ö–ï–ü –Ω–∞–∫–ª–∞–¥–µ–Ω–æ–≥–æ –Ω–∞ —Ü—ñ —Ñ–∞–π–ª–∏. –û—Ç—Ä–∏–º–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø—ñ–¥–ø–∏—Å–∞–Ω—Ç–∞ –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ—ó –æ–±—Ä–æ–±–∫–∏ –∞–±–æ –≤–Ω–µ—Å–µ–Ω–Ω—è –≤ —Ä–µ—î—Å—Ç—Ä–∏. –¢–∞–∫–æ–∂ —î –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ—Å—Ç—å –ø–µ—Ä–µ–≥–ª—è–¥—É –≤–º—ñ—Å—Ç—É —Ñ–∞–π–ª—ñ–≤-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤.

== Functional scenarios
//== –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó

* Verification of data integrity by validating the signature indicating the container type.
//* –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö —à–ª—è—Ö–æ–º –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—ñ–¥–ø–∏—Å—É –∑ –≤–∫–∞–∑–∞–Ω–Ω—è–º —Ç–∏–ø—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
* Getting information about all data signatories.
//* –û—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –≤—Å—ñ—Ö –ø—ñ–¥–ø–∏—Å–∞–Ω—Ç—ñ–≤ –¥–∞–Ω–∏—Ö
* Getting content from a signed data array.
//* –û—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ–Ω—Ç–µ–Ω—Ç—É –∑ –ø—ñ–¥–ø–∏—Å–∞–Ω–æ–≥–æ –º–∞—Å–∏–≤—É –¥–∞–Ω–∏—Ö.

== User Roles
//== –†–æ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

* Modeler

== General provisions
//== –ó–∞–≥–∞–ª—å–Ω—ñ –ø—Ä–∏–Ω—Ü–∏–ø–∏ —Ç–∞ –ø–æ–ª–æ–∂–µ–Ω–Ω—è

* Data is processed in the script-tasks of a business process.
//* –î–∞–Ω—ñ –æ–ø—Ä–∞—Ü—å–æ–≤—É—é—Ç—å—Å—è –≤ —Å–∫—Ä–∏–ø—Ç-–∑–∞–¥–∞—á–∞—Ö –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—É.
* Getting data from third-party sources outside of this design.
//* –û—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ—Ö –¥–∂–µ—Ä–µ–ª –ø–æ–∑–∞ –º–µ–∂–∞–º–∏ —Ü—å–æ–≥–æ –¥–∏–∑–∞–π–Ω—É.
* Byte data between systems is transmitted encoded using Base64.
//* –ë–∞–π—Ç–æ–≤—ñ –¥–∞–Ω—ñ –º—ñ–∂ —Å–∏—Å—Ç–µ–º–∞–º–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è –∑–∞–∫–æ–¥–æ–≤–∞–Ω–∏–º–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Base64
* The default format is CAdES-X-Long.
//* –§–æ—Ä–º–∞—Ç –∑–∞ –∑–∞–º–æ–≤—á–µ–Ω–Ω—è–º  –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è CAdES-X-Long.
* Data and signature in a given iteration always arrive in the same data array.
//* –î–∞–Ω—ñ —ñ –ø—ñ–¥–ø–∏—Å –≤ –¥–∞–Ω—ñ–π —ñ—Ç–µ—Ä–∞—Ü—ñ—ó –∑–∞–≤–∂–¥–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç—å –≤ –æ–¥–Ω–æ–º—É –º–∞—Å–∏–≤—ñ –¥–∞–Ω–∏—Ö.
* Implementation of different validation formats outside of this design.
//* –Ü–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü—ñ—è —Ä—ñ–∑–Ω–∏—Ö —Ñ–æ—Ä–º–∞—Ç—ñ–≤ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –ø–æ–∑–∞ –º–µ–∂–∞–º–∏ —Ü—å–æ–≥–æ –¥–∏–∑–∞–π–Ω—É
* Signing files outside of this design.
//* –ü—ñ–¥–ø–∏—Å–∞–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ –ø–æ–∑–∞ –º–µ–∂–∞–º–∏ —Ü—å–æ–≥–æ –¥–∏–∑–∞–π–Ω—É.
* Implementation of algorithms for working with signatures undergoes using the `IIT` library.
//* –Ü–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü—ñ—è –∞–ª–≥–æ—Ä–∏—Ç–º—ñ–≤ –ø–æ —Ä–æ–±–æ—Ç—ñ –∑ –ø—ñ–¥–ø–∏—Å–∞–º–∏ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `–Ü–Ü–¢`-–±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏

== Glossary and acronyms
//== –ì–ª–æ—Å–∞—Ä—ñ–π —Ç–∞ –∞–∫—Ä–æ–Ω—ñ–º–∏

*Container* is the resulting file type. The following containers are distinguished: XAdES (xml), PAdES (pdf), CAdES (p7s), ASiC (asic). The most modern and recommended is the ASiC container type. +
//*–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä* - —Ç–∏–ø —Ä–µ–∑—É–ª—å—Ç—É—é—á–æ–≥–æ —Ñ–∞–π–ª—É. –†–æ–∑—Ä—ñ–∑–Ω—è—é—Ç—å—Å—è —Ç–∞–∫—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ XAdES (xml), PAdES (pdf), CAdES (p7s),  ASiC (asic). –ù–∞–π–±—ñ–ª—å—à —Å—É—á–∞—Å–Ω–∏–º —ñ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–º  —î –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç–∏–ø—É ASiC. +

*ASiC*: a feature of this container is that it is built as an archive for storing files, and the only one from the listed ones allows you to store several files in different formats. +
//*ASiC* - –æ—Å–æ–±–ª–∏–≤—ñ—Å—Ç—é –¥–∞–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É —î —Ç–µ —â–æ –≤—ñ–Ω –ø–æ–±—É–¥–æ–≤–∞–Ω–∏–π —è–∫ –∞—Ä—Ö—ñ–≤ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ —ñ —î–¥–∏–Ω–∏–π –∑ –ø–µ—Ä–µ–ª—ñ—á–µ–Ω–∏—Ö –¥–æ–∑–≤–æ–ª—è—î –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –¥–µ–∫—ñ–ª—å–∫–∞ —Ñ–∞–π–ª—ñ–≤ –≤ —Ä—ñ–∑–Ω–∏—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö. +

*Format* is an algorithm used for data signing (XAdES-B-LT/CAdES-X-Long/CAdES-BASE/PAdES-B-LT). The recommended format is CAdES-X-Long. +
//*–§–æ—Ä–º–∞—Ç* - –∞–ª–≥–æ—Ä–∏—Ç–º —è–∫–∏–π –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –ø—ñ–¥–ø–∏—Å–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö (XAdES-B-LT/CAdES-X-Long/CAdES-BASE/PAdES-B-LT) —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–º —Ñ–æ—Ä–º–∞—Ç–æ–º —î CAdES-X-Long +

*Signature type*: THere are two types of signatures: separated (detached) and enveloped (embedded). +
//*–¢–∏–ø –ø—ñ–¥–ø–∏—Å—É* - —Ä–æ–∑—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è –¥–≤–∞ —Ç–∏–ø–∏ –ø—ñ–¥–ø–∏—Å—É –≤—ñ–¥–æ–∫—Ä–µ–º–ª–µ–Ω–∏–π (detached) —Ç–∞ enveloped (–≤–±—É–¥–æ–≤–∞–Ω–∏–π). +

[NOTE]
The file and data terms in this design are interchangeable.
//–¢–µ—Ä–º—ñ–Ω–∏ —Ñ–∞–π–ª —ñ –¥–∞–Ω—ñ –≤ –¥–∞–Ω–æ–º—É –¥–∏–∑–∞–π–Ω—ñ –≤–∑–∞—î–º–æ–∑–∞–º—ñ–Ω–Ω—ñ.

== Modeling examples
//== –ü—Ä–∏–∫–ª–∞–¥–∏ –º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è

=== An example of a BP simulation with an ASiC container as an input parameter that contains several files
//=== –ü—Ä–∏–∫–ª–∞–¥ –º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è –ë–ü –∑ ASiC –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º –≤ —è–∫–æ—Å—Ç—ñ –≤—Ö—ñ–¥–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ —è–∫–∏–π –º—ñ—Å—Ç–∏—Ç—å –¥–µ–∫—ñ–ª—å–∫–∞ —Ñ–∞–π–ª—ñ–≤

image:architecture/registry/administrative/regulation-management/platform-evolution/sign-validation/submission_form.png[]

.Example of a script task
//.–ü—Ä–∏–∫–ª–∞–¥ —Å–∫—Ä–∏–ø—Ç–æ–≤–æ—ó –∑–∞–¥–∞—á—ñ
[source, groovy]
----
def formData = submission('start_event').formData
def file = formData.prop('signed_data').value()

def allSignInfo = signature_details(file, SignFormat.ASiC).getAllSignInfo()
for (signInfo in allSignInfo) {
    if (signInfo.subjDRFOCode == null) {
        println "DRFO should be present"
    }
}

def allFiles = get_content(file, SignFormat.ASiC).getAllContent()
for (singleFile in allFiles) {
    set_variable(singleFile.getReference(), singleFile.getReferenceData())
}

----

=== Example of a BP modeling to get a p7s container with an embedded signature as part of the data from an external API
//=== –ü—Ä–∏–∫–ª–∞–¥ –º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è –ë–ü –∑ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è–º p7s –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∑ –≤–±—É–¥–æ–≤–∞–Ω–∏–º –ø—ñ–¥–ø–∏—Å–æ–º —è–∫ —á–∞—Å—Ç–∏–Ω–∞ –¥–∞–Ω–∏—Ö —ñ–∑ –∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ API

image:architecture/registry/administrative/regulation-management/platform-evolution/sign-validation/external_system.png[]

.Example of an external system response
//.–ü—Ä–∏–∫–ª–∞–¥ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —Å—Ç–æ—Ä–æ–Ω–Ω—å–æ—ó —Å–∏—Å—Ç–µ–º–∏
[source, json]
----
{
    "name": "Ololow",
    "day-of-birth": "01/01/01",
    "request": "dGVzdCBkYXRh",
    "request_received": "20/02/14"
}
----

.Example of a script task
//.–ü—Ä–∏–∫–ª–∞–¥ —Å–∫—Ä–∏–ø—Ç–æ–≤–æ—ó –∑–∞–¥–∞—á—ñ
[source, groovy]
----

def containerType = validationResult.prop('container').value()

def info = signature_details(request, containerType).getSignInfo()

if (info.subjDRFOCode == null) {
    println "DRFO should be present"
}

originRequestDate = signature_content(request, containerType).getContent().getData()

def requestBytes = Base64.decode(originRequestDate)

save_digital_document(requestBytes, 'request.pdf')

set_variable('fileContent', originRequestDate)
----



== Delegate for validation
//== –î–µ–ª–µ–≥–∞—Ç –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó

=== Delegate parameters
//=== –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –¥–µ–ª–µ–≥–∞—Ç—É
|===
|Parameter |Description |Type |Data type
//|–ù–∞–∑–≤–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—É |–û–ø–∏—Å |–¢–∏–ø |–¢–∏–ø –¥–∞–Ω–∏—Ö

|data
| Data containing a signature in Base64 format
//|–î–∞–Ω—ñ —è–∫—ñ –≤–∫–ª—é—á–∞—é—Ç—å –≤ —Å–µ–±–µ –ø—ñ–¥–ø–∏—Å –≤ —Ñ–æ—Ä–º–∞—Ç—ñ Base64
|Input
//|–í—Ö—ñ–¥–Ω–∏–π
|String

|container
| List of available file types
//|–ü–µ—Ä–µ–ª—ñ–∫ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ç–∏–ø—ñ–≤ —Ñ–∞–π–ª—ñ–≤
|Input
//|–í—Ö—ñ–¥–Ω–∏–π
|Enum (ASiC/CAdES)

|result
| Validation result
//|–†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
|Output
//|–í–∏—Ö—ñ–¥–Ω–∏–π
|ValidatioResult
|===

=== REST API

_POST /api/esignature/validate_

.Example of the request body
//.–ü—Ä–∏–∫–ª–∞–¥ —Ç—ñ–ª–∞ –∑–∞–ø–∏—Ç—É
[source,json]
----
{
  "data": "dGVzdCBkYXRh",
  "container": "CAdES/ASiC/XdES/..."
}
----

.Structure of the response body
//.–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç—ñ–ª–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
|===
|Json Path|Type|Description
//|Json Path|–¢–∏–ø|–û–ø–∏—Å

|*$result.isValid*
|boolean
|Result of data validation
//|–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥–∞–Ω–∏—Ö
|*$result.container*
|String
|Container type
//|–¢–∏–ø –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É
|*$.error.code*
|String
| Corresponding status code
//|–í—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π –∫–æ–¥ —Å—Ç–∞—Ç—É—Å—É
|*$.error.message*
|String
| Error details and description
//|–î–µ—Ç–∞–ª—ñ —Ç–∞ –æ–ø–∏—Å –ø–æ–º–∏–ª–∫–∏
|*$.error.localizedMessage*
|String
| Localized details and error description
//|–õ–æ–∫–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –¥–µ—Ç–∞–ª—ñ —Ç–∞ –æ–ø–∏—Å –ø–æ–º–∏–ª–∫–∏
|===

=== Low-level design
//=== –ù–∏–∑—å–∫–æ—Ä—ñ–≤–Ω–µ–≤–∏–π –¥–∏–∑–∞–π–Ω

To validate the signatures of ASiC containers, the number of signatories is obtained using `EndUser::ASiCGetSignsCount(base64Data)`, and then the validity of each `EndUser::ASiCVerify(index, base64Data)` is checked.
//–î–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –ø—ñ–¥–ø–∏—Å—ñ–≤ ASiC –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –ø—ñ–¥–ø–∏—Å–∞–Ω—Ç—ñ–≤ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `EndUser::ASiCGetSignsCount(base64Data)`, –∞ –¥–∞–ª—ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –≤–∞–ª—ñ–¥–Ω—ñ—Å—Ç—å –∫–æ–∂–Ω–æ–≥–æ `EndUser::ASiCVerify(index, base64Data)`

`EndUser::VerifyInternal(base64Data)` is used for CAdES.
//–î–ª—è CAdES –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `EndUser::VerifyInternal(base64Data)`


== signature_details(<string|data>, <enum|dataFormat>)

=== JUEL function
//=== JUEL —Ñ—É–Ω–∫—Ü—ñ—è
|===
|Parameter |Description |Type |Data type
//|–ù–∞–∑–≤–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—É |–û–ø–∏—Å |–¢–∏–ø |–¢–∏–ø –¥–∞–Ω–∏—Ö

|data
| Data containing signature in Base64 format
//|–î–∞–Ω—ñ —è–∫—ñ –≤–∫–ª—é—á–∞—é—Ç—å –≤ —Å–µ–±–µ –ø—ñ–¥–ø–∏—Å –≤ —Ñ–æ—Ä–º–∞—Ç—ñ Base64
|Input
//|–í—Ö—ñ–¥–Ω–∏–π
|String

|container
| List of available file types
//|–ü–µ—Ä–µ–ª—ñ–∫ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ç–∏–ø—ñ–≤ —Ñ–∞–π–ª—ñ–≤
|Input
//|–í—Ö—ñ–¥–Ω–∏–π
|Enum (ASiC/CAdES)

|signInfo
|Signature details
//|–î–µ—Ç–∞–ª—ñ –ø—Ä–æ –ø—ñ–¥–ø–∏—Å
|Output
//|–í–∏—Ö—ñ–¥–Ω–∏–π
|SignatureInfo
|===


.Structures for receiving content in a BP
//.–°—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ–Ω—Ç–µ–Ω—Ç—É –≤ –ë–ü
[plantuml]
----
class SignatureInfo {
- List<SignDetails> data
+ SignDetails getSignInfo()
+ List<SignDetails> getAllSignInfo()
}

----
.SignDetails structure
//.–°—Ç—Ä—É–∫—Ç—É—Ä–∞ SignDetails
|===
|Json Path|Type|Description
//|Json Path|–¢–∏–ø|–û–ø–∏—Å

|*issuer*
|String
| Certificate issuer
//|–í–∏–¥–∞–≤–µ—Ü—å —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É
|*issuerCN*
|String
| Certificate issuer name
//|–ù–∞–∑–≤–∞ –≤–∏–¥–∞–≤—Ü—è —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É
|*serial*
|String
| Certificate serial number
//|–°–µ—Ä—ñ–π–Ω–∏–π –Ω–æ–º–µ—Ä —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É
|*subject*
|String
| General information about the certificate owner
//|–ó–∞–≥–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –≤–ª–∞—Å–Ω–∏–∫–∞ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É
|*subjCN*
|String
| Certificate owner name
//|–Ü–º‚Äô—è –≤–ª–∞—Å–Ω–∏–∫–∞ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É
|*subjOrg*
|String
| Organization of the certificate owner
//|–û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è –≤–ª–∞—Å–Ω–∏–∫–∞ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É
|*subjOrgUnit*
|String
| Unit of the certificate owner
//|–ü—ñ–¥—Ä–æ–∑–¥—ñ–ª –≤–ª–∞—Å–Ω–∏–∫–∞ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É
|*subjTitle*
|String
| Position of the certificate owner
//|–ü–æ—Å–∞–¥–∞ –≤–ª–∞—Å–Ω–∏–∫–∞ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É
|*subjState*
|String
| Certificate owner region/province
//|–†–µ–≥—ñ–æ–Ω/–æ–±–ª–∞—Å—Ç—å –≤–ª–∞—Å–Ω–∏–∫–∞ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É
|*subjLocality*
|String
| Signatory locale
//|–õ–æ–∫–∞–ª—å –ø—ñ–¥–ø–∏—Å–∞–Ω—Ç–∞
|*subjFullName*
|String
|Signatory full name
//|–ü–Ü–ë –ø—ñ–¥–ø–∏—Å–∞–Ω—Ç–∞
|*subjAddress*
|String
|Signatory address
//|–ê–¥—Ä–µ—Å–∞ –ø—ñ–¥–ø–∏—Å–∞–Ω—Ç–∞
|*subjPhone*
|String
|Signatory phone number
//|–¢–µ–ª–µ—Ñ–æ–Ω –ø—ñ–¥–ø–∏—Å–∞–Ω—Ç–∞
|*subjDNS*
|String
|DNS or other name of a device
//|DNS-—ñ–º'—è —á–∏ —ñ–Ω—à–µ —Ç–µ—Ö–Ω—ñ—á–Ω–æ–≥–æ –∑–∞—Å–æ–±—É
|*subjEDRPOUCode*
|String
|Signatory EDRPOU
//|–Ñ–î–†–ü–û–£ –ø—ñ–¥–ø–∏—Å–∞–Ω—Ç–∞
|*subjDRFOCode*
|String
|Signatory DRFO
//|–î–†–§–û –ø—ñ–¥–ø–∏—Å–∞–Ω—Ç–∞
|===

=== REST API

_POST /api/esignature/info_

.Example of the request body
//.–ü—Ä–∏–∫–ª–∞–¥ —Ç—ñ–ª–∞ –∑–∞–ø–∏—Ç—É
[source,json]
----
{
  "data": "dGVzdCBkYXRh",
  "container": "CAdES/ASiC/XdES/..."
}
----

.Structure of the response body
//.–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç—ñ–ª–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
|===
|Json Path|Type|Description
//|Json Path|–¢–∏–ø|–û–ø–∏—Å

|*$.info[]*
|array[SignatureInfo]
| Data array containing details about each signature
//|–ú–∞—Å–∏–≤ –¥–∞–Ω–∏—Ö —â–æ –º—ñ—Å—Ç–∏—Ç—å –≤ —Å–µ–±–µ –¥–µ—Ç–∞–ª—ñ –ø—Ä–æ –∫–æ–∂–µ–Ω –ø—ñ–¥–ø–∏—Å
|*$.error.code*
|String
| Corresponding status code
//|–í—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π –∫–æ–¥ —Å—Ç–∞—Ç—É—Å—É
|*$.error.message*
|String
| Error details and description
//|–î–µ—Ç–∞–ª—ñ —Ç–∞ –æ–ø–∏—Å –ø–æ–º–∏–ª–∫–∏
|*$.error.localizedMessage*
|String
| Localized description
//|–õ–æ–∫–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –æ–ø–∏—Å
|===

=== Low-level design
//=== –ù–∏–∑—å–∫–æ—Ä—ñ–≤–Ω–µ–≤–∏–π –¥–∏–∑–∞–π–Ω

For data in ASiC format, it is possible to put several signatures, therefore, when receiving information about a signature, an array with details about each signature on the data is returned.
//–î–ª—è –¥–∞–Ω–∏—Ö —É —Ñ–æ—Ä–º–∞—Ç—ñ ASiC –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–æ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –Ω–∞–∫–ª–∞–¥–∞–Ω–Ω—è –¥–µ–∫—ñ–ª—å–∫–æ—Ö –ø—ñ–¥–ø–∏—Å—ñ–≤, —Ç–æ–º—É –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –ø—ñ–¥–ø–∏—Å, –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –º–∞—Å–∏–≤ –∑ –¥–µ—Ç–∞–ª—è–º–∏ –ø—Ä–æ –∫–æ–∂–µ–Ω –Ω–∞–∫–ª–∞–¥–µ–Ω–∏–π –Ω–∞ –¥–∞–Ω—ñ –ø—ñ–¥–ø–∏—Å.

.Example of ASiC logics validation
//.–ü—Ä–∏–∫–ª–∞–¥ –ª–æ–≥—ñ–∫–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó ASiC
[source, java]
----
IntStream.rangeClosed(0, endUser.ASiCGetSignsCount(data))
                .mapToObj(index -> endUser.ASiCVerify(index, data))
                .collect(Collectors.toList());
----

For CAdES data, `EndUser::VerifyInternal(base64Data)` is used, and the details from the 'EndUserSignInfo' object are returned as a single element in the array.
//–î–ª—è –¥–∞–Ω–∏—Ö –≤ —Ñ–æ—Ä–º–∞—Ç—ñ CAdES –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `EndUser::VerifyInternal(base64Data)` —Ç–∞ –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –¥–µ—Ç–∞–ª—ñ –∑ –æ–±'—î–∫—Ç—É `EndUserSignInfo` —è–∫ —î–¥–∏–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç –≤ –º–∞—Å–∏–≤—ñ.

== signature_content((<string|data>, <enum|dataFormat>)

=== JUEL function
//=== JUEL —Ñ—É–Ω–∫—Ü—ñ—è

|===
|Parameter |Description |Type |Data type
//|–ù–∞–∑–≤–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—É |–û–ø–∏—Å |–¢–∏–ø |–¢–∏–ø –¥–∞–Ω–∏—Ö

|data
| Data containing signature in Base64 format
//|–î–∞–Ω—ñ —è–∫—ñ –≤–∫–ª—é—á–∞—é—Ç—å –≤ —Å–µ–±–µ –ø—ñ–¥–ø–∏—Å –≤ —Ñ–æ—Ä–º–∞—Ç—ñ Base64
|Input
//|–í—Ö—ñ–¥–Ω–∏–π
|String

|container
| List of available file types
//|–ü–µ—Ä–µ–ª—ñ–∫ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ç–∏–ø—ñ–≤ —Ñ–∞–π–ª—ñ–≤
|Input
//|–í—Ö—ñ–¥–Ω–∏–π
|Enum (ASiC/CAdES)

|response
|Object with data
//|–û–± º—î–∫—Ç –∑ –¥–∞–Ω–∏–º–∏
|Output
//|–í–∏—Ö—ñ–¥–Ω–∏–π
|SignData
|===

.Structures for getting content in a BP
//.–°—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ–Ω—Ç–µ–Ω—Ç—É –≤ –ë–ü
[plantuml]
----
class SignData {
- List<Content> data
+ Content getContent()
+ List<Content> getAllContent()
}

class Content {
- String data
+ String getData() //Base64 string
}
----

=== REST API

_POST /api/esignature/content_

.Example of the request body
//.–ü—Ä–∏–∫–ª–∞–¥ —Ç—ñ–ª–∞ –∑–∞–ø–∏—Ç—É
[source,json]
----
{
  "data": "dGVzdCBkYXRh",
  "container": "CAdES/ASiC/XdES/..."
}
----

.Structure of the response body
//.–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç—ñ–ª–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
|===
|Json Path|Type|Description
//|Json Path|–¢–∏–ø|–û–ø–∏—Å

|*$.content[]*
|array[Content]
| Container contents
//|–í–º—ñ—Å—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É
|*$.error.code*
|String
| Corresponding status code
//|–í—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π –∫–æ–¥ —Å—Ç–∞—Ç—É—Å—É
|*$.error.message*
|String
| Error details and description
//|–î–µ—Ç–∞–ª—ñ —Ç–∞ –æ–ø–∏—Å –ø–æ–º–∏–ª–∫–∏
|*$.error.localizedMessage*
|String
| Localized details and error description
//|–õ–æ–∫–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –¥–µ—Ç–∞–ª—ñ —Ç–∞ –æ–ø–∏—Å –ø–æ–º–∏–ª–∫–∏
|===

=== Low-level design
//=== –ù–∏–∑—å–∫–æ—Ä—ñ–≤–Ω–µ–≤–∏–π –¥–∏–∑–∞–π–Ω

For an ASiC container, `EndUser::ASiCGetSignReferences(index, base64Data)` is used to get a list of all files in a container for each index, and `EndUser::ASiCGetReference(reference)` is used to get the content.
//–î–ª—è ASiC –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–µ—Ä–µ–ª—ñ–∫—É –≤—Å—ñ—Ö —Ñ–∞–π–ª—ñ–≤ –≤ –∫–æ–Ω—Ç–µ–Ω–π–µ—Ä—ñ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `EndUser::ASiCGetSignReferences(index, base64Data)` –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —ñ–Ω–¥–µ–∫—Å—É, –∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ–Ω—Ç–µ–Ω—Ç—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `EndUser::ASiCGetReference(reference)`

For CAdES containers, the data is a part of the `EndUser::VerifyInternal(base64Data)::GetData()` output parameter.
//–î–ª—è CAdES –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤ –¥–∞–Ω—ñ —î —á–∞—Å—Ç–∏–Ω–∞ –≤–∏—Ö—ñ–¥–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—É `EndUser::VerifyInternal(base64Data)::GetData()`

== Updating IIT library
//== –û–Ω–æ–≤–ª–µ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –Ü–Ü–¢

1. The crypto library is provided as a link to the https://iit.com.ua/download/EUSignCP-Java-20230629.zip archive.
//1. –ö—Ä–∏–ø—Ç–æ–±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –Ω–∞–¥–∞—î—Ç—å—Å—è —É –≤–∏–≥–ª—è–¥—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∞—Ä—Ö—ñ–≤
//https://iit.com.ua/download/EUSignCP-Java-20230629.zip
2. The archive with library consists of the folders:
//2. –ê—Ä—Ö—ñ–≤ –∑ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–æ—é —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ –ø–∞–ø–æ–∫
- Documentation: Up-to-date documentation for the current version of the crypto library.
//- Documentation ‚Äì –∞–∫—Ç—É–∞–ª—å–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –¥–ª—è –ø–æ—Ç–æ—á–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó –∫—Ä–∏–ø—Ç–æ–±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏;
- Modules and\or Installs: Up-to-date modules and\or installation packages of the current version of the crypto library.
//- Modules —Ç–∞\–∞–±–æ Installs ‚Äì –∞–∫—Ç—É–∞–ª—å–Ω—ñ –º–æ–¥—É–ª—ñ —Ç–∞\–∞–±–æ —ñ–Ω—Å—Ç–∞–ª—è—Ü—ñ–π–Ω—ñ –ø–∞–∫–µ—Ç–∏ –ø–æ—Ç–æ—á–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó –∫—Ä–∏–ø—Ç–æ–±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏;
- Usage: A real example of the crypto library usage.
//- Usage ‚Äì –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–∫–ª–∞–¥—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∫—Ä–∏–ø—Ç–æ–±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏.
The documentation includes a manual for a system programmer (contains general information on the library: how to connect, configure and use the library), and an application (contains a description of functions and parameters).
//–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ –Ω–∞—Å—Ç–∞–Ω–æ–≤–∏ –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º—ñ—Å—Ç–∞ (–º—ñ—Å—Ç–∏—Ç—å –∑–∞–≥–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø–æ –±—ñ–±–ª—ñ–æ—Ç–µ—Ü—ñ: —è–∫ –ø—ñ–¥–∫–ª—é—á–∞—Ç–∏, –Ω–∞–ª–∞—à—Ç–æ–≤—É–≤–∞—Ç–∏ —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É) —Ç–∞ –¥–æ–¥–∞—Ç–∫—É (–º—ñ—Å—Ç–∏—Ç—å –æ–ø–∏—Å —Ñ—É–Ω–∫—Ü—ñ–π —Ç–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤).

3. Updates containing non-critical improvements can be provided upon request to supp@iit.com.ua (in the letter it is necessary to indicate the number of the actual technical support contract).
//3. –û–Ω–æ–≤–ª–µ–Ω–Ω—è, —â–æ –º—ñ—Å—Ç—è—Ç—å –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ñ –¥–æ–æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è, –Ω–∞–¥–∞—é—Ç—å—Å—è –∑–∞ –∑–∞–ø–∏—Ç–æ–º –Ω–∞ –ø–æ—à—Ç—É supp@iit.com.ua (–≤ –ª–∏—Å—Ç—ñ —Ç—Ä–µ–±–∞ –≤–∫–∞–∑–∞—Ç–∏ –Ω–æ–º–µ—Ä –¥—ñ—é—á–æ–≥–æ –¥–æ–≥–æ–≤–æ—Ä—É —Ç–µ—Ö. –ø—ñ–¥—Ç—Ä–∏–º–∫–∏).
We inform you about critical updates by mail, to the address specified in the contacts for your organization.
//–ü—Ä–æ –∫—Ä–∏—Ç–∏—á–Ω—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º—É—î–º–æ –ª–∏—Å—Ç–æ–º –Ω–∞ –ø–æ—à—Ç—É, —è–∫–∞ –≤–∫–∞–∑–∞–Ω–∞ –≤ –∫–æ–Ω—Ç–∞–∫—Ç–∞—Ö –¥–ª—è –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó

== High level development plan
//== –í–∏—Å–æ–∫–æ—Ä—ñ–≤–Ω–µ–≤–∏–π –ø–ª–∞–Ω —Ä–æ–∑—Ä–æ–±–∫–∏

== Technical expertise
//== –¢–µ—Ö–Ω—ñ—á–Ω—ñ –µ–∫—Å–ø–µ—Ä—Ç–∏–∑–∏

* BE (java)

== Development Plan
//== –ü–ª–∞–Ω —Ä–æ–∑—Ä–æ–±–∫–∏

* IIT library update.
//* –û–Ω–æ–≤–ª–µ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –Ü–Ü–¢
* Extension of DSO with appropriate integration points.
//* –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è DSO –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–º–∏ —Ç–æ—á–∫–∞–º–∏ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó
* Creation of a delegate for validation.
//* –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–µ–ª–µ–≥–∞—Ç—É –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
* Adding JUEL functions.
//* –î–æ–¥–∞–≤–∞–Ω–Ω—è JUEL-—Ñ—É–Ω–∫—Ü—ñ–π
* Adding a utility function for Base64 encoding and decoding.
//* –î–æ–¥–∞–≤–∞–Ω–Ω—è —É—Ç—ñ–ª—ñ—Ç–∞—Ä–Ω–æ—ó —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –∫–æ–¥—É–≤–∞–Ω–Ω—è —ñ –¥–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è Base64
* Development of reference examples.
//* –†–æ–∑—Ä–æ–±–∫–∞ —Ä–µ—Ñ–µ—Ä–µ–Ω—Ç–Ω–∏—Ö –ø—Ä–∏–∫–ª–∞–¥—ñ–≤
