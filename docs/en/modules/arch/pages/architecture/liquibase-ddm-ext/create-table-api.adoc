:toc-title: On this page:
:toc: auto
:toclevels: 5
:experimental:
:sectnums:
:sectnumlevels: 5
:sectanchors:
:sectlinks:
:partnums:

= createTable

NOTE: üåê This document is available in both English and Ukrainian. Use the language toggle in the top right corner to switch between versions.

//== –ó–∞–≥–∞–ª—å–Ω–∏–π –æ–ø–∏—Å
== Overview

//–¢–µ–≥, –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–π –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å —É –ë–î, —î —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–º –¥–ª—è Liquibase, –ø—Ä–æ—Ç–µ —É *liquibase-ddm-ext* –¥–æ–¥–∞—î—Ç—å—Å—è –æ–±—Ä–æ–±–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤, —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏—Ö –¥–ª—è _–ü–ª–∞—Ç—Ñ–æ—Ä–º–∏_
The tag required for the creation of tables in the DB is standard for Liquibase, but in *liquibase-ddm-ext*, _Platform_-specific parameters processing is added.

//== Liquibase-—Å—Ö–µ–º–∞
== Liquibase-scheme

//–ó–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —É –æ–¥–Ω—ñ–π —Å—Ö–µ–º—ñ –∑ —ñ–Ω—à–∏–º–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–º–∏ —Ç–µ–≥–∞–º–∏ Liquibase, —É –æ—Ñ—ñ—Ü—ñ–π–Ω—ñ–π https://www.liquibase.org/xml/ns/dbchangelog/[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó] (–Ω–∞—Ä–∞–∑—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤–µ—Ä—Å—ñ—è 4.15)
It is stored in one scheme with other standard Liquibase tags, in the official https://www.liquibase.org/xml/ns/dbchangelog/[documentation] (currently, version 4.15 is used)

//–ê—Ç—Ä–∏–±—É—Ç–∏, —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ –¥–ª—è *liquibase-ddm-ext*:
*liquibase-ddm-ext*-specific attributes:

[source, xml]
----
<xsd:attribute name="historyFlag" type="xsd:boolean"/>
<xsd:attribute name="readMode" type="readType" default="sync"/>
<xsd:attribute name="distribution" type="distributionType" default="local"/>
<xsd:attribute name="classify" type="classifyType"/>
<xsd:attribute name="autoGenerate" type="xsd:string"/>
<xsd:attribute name="bulkLoad" type="xsd:boolean"/>
----

//== –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
== Usage example
[source, xml]
----
<changeSet id="table pd_processing_consent" author="registry owner">
    <comment>CREATE TABLE pd_processing_consent</comment>
    <ext:createTable tableName="pd_processing_consent" ext:historyFlag="true" ext:bulkLoad="true">
        <column name="consent_id" type="UUID">
            <constraints nullable="false" primaryKey="true" primaryKeyName="pk_pd_processing_consent"/>
        </column>
        <column name="consent_date" type="TIMESTAMPTZ">
            <constraints nullable="false"/>
        </column>
        <column name="person_gender" type="type_gender">
            <constraints nullable="false"/>
        </column>
        <column name="person_full_name" type="TEXT">
            <constraints nullable="false"/>
        </column>
        <column name="person_pass_number" type="TEXT">
            <constraints nullable="false"/>
        </column>
        <column name="auto_generated_number" type="TEXT" ext:autoGenerate="–ê–ê-{DDMMYYYY}-{SEQ}">
            <constraints nullable="false" unique="true"/>
        </column>
    </ext:createTable>
</changeSet>
----

//== –û–ø–∏—Å –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
== Parameters description

//–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–µ–≥—É



////
[cols="2,2,6"]
|===
| –ù–∞–∑–≤–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—É | –ú–æ–∂–ª–∏–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è | –û–ø–∏—Å
| *historyFlag* | true | —Å—Ç–≤–æ—Ä—é—î –¥–ª—è –≤–∫–∞–∑–∞–Ω–æ—ó —Ç–∞–±–ª–∏—Ü—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—É —ñ—Å—Ç–æ—Ä–∏—á–Ω—É –∑ —Å—É—Ñ—ñ–∫—Å–æ–º _hst, –≤ —è–∫—É –∑–∞–ø–∏—Å—É—é—Ç—å—Å—è —É—Å—ñ –∑–º—ñ–Ω–∏ —É –∑–∞–ø–∏—Å–∞—Ö —Ç–∞–±–ª–∏—Ü—ñ
| *bulkLoad* | true/false | –¥–ª—è –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó API –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤, –≤–∏–∑–Ω–∞—á–∞—î, —á–∏ –±—É–¥–µ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –µ–Ω–¥–ø–æ—ñ–Ω—Ç, —â–æ –¥–æ–∑–≤–æ–ª—è—î —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –¥–µ–∫—ñ–ª—å–∫–∞ —Å—É—Ç–Ω–æ—Å—Ç–µ–π –≤ –æ–¥–Ω–æ–º—É –∑–∞–ø–∏—Ç—ñ
| *readMode* | sync/async | –¥–ª—è –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó API –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤, –≤–∏–∑–Ω–∞—á–∞—î,—è–∫ –±—É–¥–µ –≤—ñ–¥–±—É–≤–∞—Ç–∏—Å—å –æ–ø–µ—Ä–∞—Ü—ñ—è —á–∏—Ç–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö, —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —á–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ - –Ω–∞ —Ä—ñ–≤–Ω—ñ _registry-rest_api_, –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ - —à–ª—è—Ö–æ–º rest-api-> _registry-kafka-api_ -> rest-api)
| *isObject* | true/false | –≤–∏–∑–Ω–∞—á–∞—î —Ç–∞–±–ª–∏—Ü—é —è–∫ –æ–±'—î–∫—Ç (–¥–æ–¥–∞—î—Ç—å—Å—è –∑–≤'—è–∑–æ–∫ –∑ —Ç–∞–±–ª–∏—Ü–µ—é _subject_)
|===
////

[cols="2,2,6"]
|===
| Parameter name | Allowed values | Description
| *historyFlag* | true | for the selected table, this parameter creates a corresponding historical table with _hst suffix, where all table changes are logged
| *bulkLoad* | true/false | defines if the endpoint, which allows for the transactional storing of several entities in one request, will be generated for the modification of generated services API
| *readMode* | sync/async | for the modification of generated services API, defines how the data reading will be performed, synchronously or asynchronously (sync - on the _registry-rest_api_ level, async - via rest-api-> _registry-kafka-api_ -> rest-api)
| *isObject* | true/false | defines a table as an object (connection with the _subject_ table is added)
|===


//–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –¥–ª—è –≤–∫–ª–∞–¥–µ–Ω–∏—Ö —Ç–µ–≥—ñ–≤ *column*



////
[cols="2,2,6"]
|===
| –ù–∞–∑–≤–∞ –∞—Ç—Ä–∏–±—É—Ç—É (name) | –ú–æ–∂–ª–∏–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è (value) | –û–ø–∏—Å
| *classify* | private/confidential | –∫–ª–∞—Å–∏—Ñ—ñ–∫—É—î –¥–∞–Ω—ñ –≤ –∫–æ–ª–æ–Ω—Ü—ñ —è–∫ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ
| *autoGenerate* | –ü–∞—Ç–µ—Ä–Ω –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∑–Ω–∞—á–µ–Ω—å —É –∫–æ–ª–æ–Ω—Ü—ñ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, _–ê–ê-{dd-MM-yyyy}-{SEQ}_) | –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω—å —É –∫–æ–ª–æ–Ω–∫—É –∑–∞ –≤–∫–∞–∑–∞–Ω–∏–º –ø–∞—Ç–µ—Ä–Ω–æ–º
|===
////

[cols="2,2,6"]
|===
| Attribute name | Allowed values | Description
| *classify* | private/confidential | classifies data in a column as personal
| *autoGenerate* | A pattern for the value generation in a column (for example, _–ê–ê-{dd-MM-yyyy}-{SEQ}_) | for the generation of unique values in the column with a defined pattern
|===

//== –ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ –∑–∞–ø–∏—Ç–∏ –¥–æ –ë–î
== Generated requests to the DB

//–ó–∞–ø–∏—Ç–∏ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ñ, –Ω–∞–≤–µ–¥–µ–Ω–æ—ó —É –ø—Ä–∏–∫–ª–∞–¥—ñ
Requests, generated for the table from the example
[source, sql]
----
CREATE TABLE registry.pd_processing_consent_hst (consent_id UUID NOT NULL, consent_date TIMESTAMP WITH TIME ZONE NOT NULL, person_gender TYPE_GENDER NOT NULL, person_full_name TEXT NOT NULL, person_pass_number TEXT NOT NULL, auto_generated_number TEXT NOT NULL, ddm_created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL, ddm_created_by TEXT NOT NULL, ddm_dml_op CHAR(1) NOT NULL, ddm_system_id UUID NOT NULL, ddm_application_id UUID NOT NULL, ddm_business_process_id UUID, ddm_business_process_definition_id TEXT, ddm_business_process_instance_id TEXT, ddm_business_activity TEXT, ddm_business_activity_instance_id TEXT, ddm_digital_sign TEXT, ddm_digital_sign_derived TEXT, ddm_digital_sign_checksum TEXT, ddm_digital_sign_derived_checksum TEXT, CONSTRAINT pk_pd_processing_consent PRIMARY KEY (consent_id), CONSTRAINT ui_pd_processing_consent_hst UNIQUE (consent_id, ddm_created_at));

ALTER TABLE registry.pd_processing_consent_hst DROP CONSTRAINT pk_pd_processing_consent;

REVOKE ALL PRIVILEGES ON TABLE pd_processing_consent_hst FROM PUBLIC;

GRANT SELECT ON pd_processing_consent_hst TO application_role;

CREATE TABLE registry.pd_processing_consent (consent_id UUID NOT NULL, consent_date TIMESTAMP WITH TIME ZONE NOT NULL, person_gender TYPE_GENDER NOT NULL, person_full_name TEXT NOT NULL, person_pass_number TEXT NOT NULL, auto_generated_number TEXT NOT NULL, ddm_created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL, ddm_created_by TEXT NOT NULL, ddm_updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW() NOT NULL, ddm_updated_by TEXT NOT NULL, CONSTRAINT pk_pd_processing_consent PRIMARY KEY (consent_id), UNIQUE (auto_generated_number));

REVOKE ALL PRIVILEGES ON TABLE pd_processing_consent FROM PUBLIC;

GRANT SELECT ON pd_processing_consent TO application_role;

CREATE SEQUENCE IF NOT EXISTS pd_processing_consent_auto_generated_number_seq INCREMENT BY 1 OWNED BY pd_processing_consent.auto_generated_number;

GRANT USAGE ON SEQUENCE pd_processing_consent_auto_generated_number_seq TO application_role;

insert into ddm_liquibase_metadata(change_type, change_name, attribute_name, attribute_value) values ('autoGenerate', 'pd_processing_consent', 'auto_generated_number', '–ê–ê-{DDMMYYYY}-{SEQ}');

insert into ddm_liquibase_metadata(change_type, change_name, attribute_name, attribute_value) values ('bulkLoad', 'pd_processing_consent', 'bulkLoad', 'true');

INSERT INTO public.ddm_db_changelog (ID, AUTHOR, FILENAME, DATEEXECUTED, ORDEREXECUTED, MD5SUM, DESCRIPTION, COMMENTS, EXECTYPE, CONTEXTS, LABELS, LIQUIBASE, DEPLOYMENT_ID) VALUES ('table pd_processing_consent', 'registry owner', 'main-liquibase.xml', NOW(), 55, '8:1d833a79f2d827609a61ac1df5354bd4', 'createTable tableName=pd_processing_consent', 'CREATE TABLE pd_processing_consent', 'EXECUTED', NULL, NULL, '4.5.0', '7604867906');

----