= Вбудований підпроцес
:toc:
:toclevels: 5
:toc-title: ЗМІСТ
:sectnums:
:sectnumlevels: 5
:sectanchors:

== Загальний опис

Вбудований підпроцес (*Embedded subprocess*) -- це підпроцес, що налаштовується та запускається всередині основного (батьківського) бізнес-процесу.

[TIP]
====
Вбудований підпроцес дозволяє НЕ виконувати два бізнес-процеси окремо, щоразу виходячи до Кабінету користувача та запускаючи кожний послідовно. Натомість вбудований підпроцес покликаний забезпечити плавний перехід між бізнес-процесами, без розриву основного процесу та підпроцесу, і повернення назад до основного процесу.

Наприклад, основний процес має на меті внести дані про заяву, але він також вимагає попередньо погодити внесення змін уповноваженою особою. Погодження змін логічно і зручно винести в окремий вбудований процес, таким чином розділяючи два процеси між собою, і водночас не порушуючи єдиний потік послідовності.
====

image:bp-modeling/bp/subprocesses/embedded-subprocess/embedded-subprocess-1.png[]

Вбудований підпроцес повинен мати тільки одну подію none startfootnote:[*None events* є невизначеними подіями, які також називаються «порожніми».].

При активації вбудованого підпроцесу, ініціюється старт цього підпроцесу подією *Start event*. Підпроцес залишається активним, допоки активним залишається хоча б один елемент у контейнері з підпроцесом. Коли останній елемент підпроцесу, тобто фінальна подія виконується, підпроцес завершується, і продовжується вихідний потік послідовності у батьківськомуfootnote:[_Батьківський_ або _основний_ процес (*Parent process*) -- процес, що ініціює запуск підпроцесу. Відносно батьківського процесу підпроцес є *Child*-процесом (*Child process*).] процесі.

////
TODO: Дати посилання на приклад із boundary event або interrupting boundary event, коли буде готова відповідна інструкція
Вбудовані підпроцеси часто використовуються разом із граничними подіями (Boundary events). До підпроцесу можна приєднати одну або кілька граничних подій. Наприклад, коли ініціюється переривальна гранична подія, весь підпроцес (включаючи всі активні елементи) припиняється.
////

== Використання вбудованого підпроцесу при моделюванні

Розглянемо застосування BPMN-елемента Embedded subprocess на прикладі бізнес-процесу внесення даних (_далі -- основний або батьківський процес_) та вбудованого підпроцесу погодження змін (_далі -- підпроцес_).

[TIP]
====
На етапі моделювання необхідно створити 1 пул із бізнес-процесом та зберегти його в рамках одного файлу _.bpmn_.
====

=== Етапи моделювання процесів

Для того, щоб змоделювати 2 процеси (у нашому випадку -- це основний процес та підпроцес), використовуючи елемент Embedded subprocess, необхідно пройти наступні етапи:

. xref:#create-pool-bp[].
. xref:#bp-start-event[].
. xref:#bp-user-form-insert-data[].
. xref:#create-expanded-subprocess[].
* xref:#bp-start-event-subprocess[].
* xref:#bp-user-form-approval-decision[].
* xref:#bp-end-event-subprocess[].
. xref:#bp-end-event[].

[#create-pool-bp]
=== Створення пулу для бізнес-процесу

Найперше, _змоделюйте пул для основного бізнес-процесу_. Для цього виконайте кроки, подані нижче:

NOTE: Моделювання діаграми бізнес-процесу має відбуватися в рамках елемента *Create Pool/Participant*.

. Відкрийте додаток *Camunda Modeler* та створіть нову діаграму BPMN. Для цього у лівому верхньому куті натисніть меню *File* -> *New File* -> *BPMN Diagram*.
+
image:registry-develop:bp-modeling/bp/modeling-instruction/bp-1.png[]

. На панелі інструментів зліва знайдіть елемент *Create pool/Participant* та перетягніть його до панелі моделювання.
+
image:registry-develop:bp-modeling/bp/modeling-instruction/bp-2.png[]

. Заповніть наступні поля відповідними значеннями:

* У полі `Participant Name` введіть назву пулу, що відображатиметься у моделері -- `Бізнес-процес внесення даних`.
* У полі `Process id` введіть ідентифікатор бізнес-процесу (наприклад, `processId`).
* У полі `Process Name` вкажіть бізнес-назву процесу -- `Бізнес-процес внесення даних`.

+
image:bp-modeling/bp/subprocesses/embedded-subprocess/embedded-subprocess-2.png[]

[#bp-start-event]
=== Моделювання стартової події основного процесу

_Створіть початкову подію_. Для цього виконайте наступні кроки:

. На панелі інструментів, зліва, знайдіть елемент (коло) *CreateStartEvent* та перетягніть його до панелі моделювання.
. На панелі налаштувань справа заповніть наступні параметри відповідними значеннями:
* У полі `Name` введіть назву початкової події -- `Старт процесу`.
* У полі `Initiator` введіть `initiator`.

+
TIP: `initiator` -- спеціальна змінна, що встановлюється для користувача, який розпочав процес.

+
image:bp-modeling/bp/subprocesses/embedded-subprocess/embedded-subprocess-3.png[]

[#bp-user-form-insert-data]
=== Моделювання користувацької задачі внесення даних

Далі _створіть користувацьку задачу, призначену для внесення даних користувачем_. Для цього виконайте наступні кроки:

. Створіть нову задачу, вкажіть її тип, натиснувши іконку ключа та обравши з меню пункт *User Task* (Користувацька задача).

. На панелі налаштувань справа натисніть `Open Catalog`, оберіть шаблон *User Form* (Користувацька форма) та натисніть `Apply` для підтвердження.

. На панелі налаштувань справа заповніть наступні поля:

* У полі `Name` вкажіть назву задачі -- `Внесення даних про заяву`.
* У полі `Form key` введіть ключ форми, що відповідатиме службовій назві форми для внесення даних -- `add-application`.
* У полі `Assignee` вкажіть змінну, що використовується для зберігання користувача, який запустив екземпляр процесу, -- `${initiator}`.

image:bp-modeling/bp/subprocesses/embedded-subprocess/embedded-subprocess-4.png[]

[#create-expanded-subprocess]
=== Моделювання вбудованого підпроцесу

На цьому етапі необхідно _змоделювати вбудований підпроцес_. Він налаштовується всередині окремого контейнера в рамках цього ж пулу.

. На панелі інструментів зліва знайдіть елемент *Create expanded SubProcess* та перетягніть його в середину пулу.

+
image:bp-modeling/bp/subprocesses/embedded-subprocess/embedded-subprocess-5.png[]

. Далі змоделюйте 3 елементи в рамках підпроцесу:

* стартову подію підпроцесу;
* користувацьку задачу для погодження змін;
* подію завершення підпроцесу.

[#bp-start-event-subprocess]
==== Моделювання стартової події підпроцесу
_Налаштуйте стартову подію підпроцесу_.

[NOTE]
На відміну від налаштувань основного процесу, подія старту підпроцесу додається автоматично, разом із контейнером *Create expanded SubProcess*.

На панелі налаштувань справа заповніть поле `Name` назвою початкової події -- `Старт підпроцесу`.

image:bp-modeling/bp/subprocesses/embedded-subprocess/embedded-subprocess-6.png[]

[#bp-user-form-approval-decision]
==== Створення користувацької задачі для погодження змін

_Створіть користувацьку задачу для погодження змін_. Для цього виконайте кроки, подані нижче:

. Створіть нову задачу, вкажіть її тип, натиснувши іконку ключа та обравши з меню пункт *User Task* (Користувацька задача).

. На панелі налаштувань справа натисніть `Open Catalog`, оберіть шаблон *User Form* (Користувацька форма) та натисніть `Apply` для підтвердження.

. На панелі налаштувань справа заповніть наступні поля:

* У полі `Name` вкажіть назву задачі -- `Прийняття рішення про погодження заяви`.
* У полі `Form key` введіть ключ форми, що відповідатиме службовій назві форми для внесення даних -- `add-applicationsecond`.
* У полі `Assignee` вкажіть змінну, що використовується для зберігання користувача, який запустив екземпляр процесу, -- `${initiator}`.

+
image:bp-modeling/bp/subprocesses/embedded-subprocess/embedded-subprocess-7.png[]

[#bp-end-event-subprocess]
==== Моделювання події завершення підпроцесу

На цьому етапі необхідно _створити подію, яка завершуватиме підпроцес_.

. Створіть подію завершення бізнес-процесу.

. На панелі налаштувань справа для параметра `Name` вкажіть значення `Завершення підпроцесу`.

+
image:bp-modeling/bp/subprocesses/embedded-subprocess/embedded-subprocess-8.png[]

[#bp-end-event]
=== Моделювання події завершення основного процесу

На цьому етапі необхідно _створити подію, яка завершуватиме процес_.

. Створіть подію завершення бізнес-процесу.

. На панелі налаштувань справа для параметра `Name` вкажіть значення `Завершення процесу`.

+
image:bp-modeling/bp/subprocesses/embedded-subprocess/embedded-subprocess-9.png[]

