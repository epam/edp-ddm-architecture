:toc-title: On this page:
:toc: auto
:toclevels: 5
:experimental:
:sectnums:
:sectnumlevels: 5
:sectanchors:
:sectlinks:
:partnums:

= Task 3. Modeling a business process with integration

//== Мета завдання
== Objective of the task

//Виконання цього завдання має на меті: ::
The execution of this task aims to: ::

//* Навчити моделювати бізнес-процес, що має інтеграцію з фабрикою даних.
* Teach modeling a business process that involves integration with a data factory.
//* Навчити моделювати гілки у бізнес-процесі.
* Teach modeling branches within a business process.
//* Навчити моделювати уніфіковані кроки у бізнес-процесах  за допомогою `Call Activity`.
* Teach modeling unified steps in business processes using `Call Activity`.
//* Навчити моделювати форми та налаштовувати компоненти `Select` для отримання даних із фабрики даних.
* Teach modeling forms and configuring `Select` components to retrieve data from the data factory.

//== Передумови
== Prerequisites

//Перед проходженням завдання необхідно виконати наступні передумови:
Before proceeding with the task, the following prerequisites must be fulfilled:

. xref:bp-modeling/bp/element-templates/bp-element-templates-installation-configuration.adoc#business-process-modeler-extensions-installation[Встановіть додаток Camunda Modeler і типові розширення до нього].
. xref:registry-develop:bp-modeling/forms/bp-modeling-forms-general-description.adoc[Ознайомтеся із компонентами FormIO для моделювання форм].
+
//. Більш детально ознайомтеся із компонентами бізнес-процесу за xref:registry-develop:bp-modeling/bp/bp-modeling-general-description.adoc[посиланням]
. Gain a more detailed understanding of business process components through the provided xref:registry-develop:bp-modeling/bp/bp-modeling-general-description.adoc[link].
+
//. Ознайомтеся з логікою роботи Call Activity за xref:registry-develop:bp-modeling/bp/bpmn/subprocesses/call-activities.adoc[посиланням].
. Familiarize yourself with the functioning logic of Call Activity through the provided xref:registry-develop:bp-modeling/bp/bpmn/subprocesses/call-activities.adoc[посиланням].

//== Процес виконання завдання
== Task execution process

[#bp-modeling]
//=== Моделювання бізнес-процесу
=== Business process modeling

[TIP]
====
//На етапі моделювання бізнес-процесу необхідно створити та зберегти відповідну BPMN-діаграму.
During the business process modeling phase, it is necessary to create and save the corresponding BPMN diagram.

//Використовуйте файл _link:{attachmentsdir}/study-project/task-3/bp-schema/add-lab.bpmn[add-lab.bpmn]_ із готовою схемою бізнес-процесу для прикладу.
Please use the _link:{attachmentsdir}/study-project/task-3/bp-schema/add-lab.bpmn[add-lab.bpmn]_ file with the pre-designed business process schema as an example.
====

//==== Етапи моделювання бізнес-процесу
==== Stages of business process modeling

//В рамках цього завдання моделювальник має створити бізнес-процес, що складається з наступних етапів:
In the context of this task, the modeler must create a business process consisting of the following stages:

. xref:#create-pool-bp[].
. xref:#create-start-event[].
. xref:#create-task-add-lab-data[].
. xref:#create-service-task-bp-key[].
. xref:#create-service-task-search-lab-data[].
. xref:#create-xor-gateway[].
. xref:#create-validation-error-branch[].
. xref:#create-service-task-save-data-to-data-factory[].
. xref:#create-service-task-create-entity-end[].
. xref:#create-task-entity-finish[].

//CAUTION: *Важливо!* Після проходження всіх етапів, не забудьте зберегти змодельовану схему бізнес-процесу до відповідної папки з регламентом реєстру (_див. xref:#save-bp-schema[Збереження змодельованої схеми бізнес-процесу]_).
CAUTION: *Important!* After completing all stages, remember to save the modeled business process diagram to the appropriate folder in the registry regulations (_see xref:#save-bp-schema[Saving the modeled business process schema]_).

[#create-pool-bp]
//==== Створення пулу для бізнес-процесу
==== Creating a pool for the business process

//Найперше, _змоделюйте пул для бізнес-процесу_. Для цього виконайте кроки, подані нижче:
First, _model a pool for the business process_. Follow the steps below:

//NOTE: Моделювання діаграми бізнес-процесу має відбуватися в рамках елемента *Create Pool/Participant*.
NOTE: Business process diagram modeling should take place within the *Create Pool/Participant* element.

//. Відкрийте додаток *Camunda Modeler* та створіть нову діаграму BPMN. Для цього у лівому верхньому куті натисніть меню *File* -> *New File* -> *BPMN Diagram*:
. Open the *Camunda Modeler* application and create a new BPMN diagram. To do this, click on the *File* → *New File* → *BPMN Diagram* option in the top left corner:
+
image:registry-develop:bp-modeling/bp/modeling-instruction/bp-1.png[]
+
//. На панелі інструментів зліва знайдіть елемент *Create pool/Participant* та перетягніть його до панелі моделювання:
. On the toolbar on the left, find the *Create Pool/Participant* element and drag it to the modeling panel:
+
image:registry-develop:bp-modeling/bp/modeling-instruction/bp-2.png[]
+
//. Заповніть наступні поля відповідними значеннями:
. Fill in the following fields with appropriate values:

//** у полі `Name` введіть `Створення лабораторії`;
//** у полі `Process id` введіть `add-lab`;
//** у полі `Process name` вкажіть `Створення лабораторії`.
** In the *Name* field, enter `Lab creation`.
** In the *Process id* field, enter `add-lab`.
** In the *Process name* field, specify `Lab creation`.

+
image:registry-develop:study-project/task-3/task-3-1-bp.png[]

[#create-start-event]
//==== Створення початкової події
==== Creating a start event

//_Створіть початкову подію_. Для цього виконайте наступні кроки:
_Create a start event_. Follow the steps below:

//. На панелі інструментів, зліва, знайдіть елемент (коло) *CreateStartEvent* та перетягніть його до панелі моделювання:
. On the toolbar on the left, find the *CreateStartEvent* element (a circle) and drag it to the modeling panel:
+
image::registry-develop:bp-modeling/bp/bp-keys/bp-keys-create-start-event.png[]
+
image::registry-develop:bp-modeling/bp/bp-keys/bp-keys-create-start-event-1.png[]
+
//. На панелі налаштувань справа заповніть наступні параметри відповідними значеннями:
. In the settings panel on the right, fill in the following parameters with appropriate values:
//** у полі `Name` введіть `Початок`;
//** у полі `Initiator` введіть `initiator`.
** In the *Name* field, enter `Start`.
** In the *Initiator* field, enter `initiator`.

+
image:registry-develop:study-project/task-3/task-3-2-bp.png[]

[#create-task-add-lab-data]
//==== Створення користувацької задачі для внесення даних про лабораторію
==== Creating a user task for entering laboratory data

//Далі _створіть користувацьку задачу, призначену для додавання даних користувачем_. Для цього виконайте наступні кроки:
Next, _create a user task intended for users to entering data by the user_. Follow the steps below:

//. Оберіть коло з початковою подією, змодельованою на xref:#create-start-event[попередньому етапі], та приєднайте нову задачу, натиснувши іконку *Append Task*:
. Select the circle with the start event, modeled in the previous stage, and attach a new task by clicking the *Append Task* icon:
+
image:study-project/task-3/task-3-3-bp-append-task.png[]

[start=2]
//. Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *User Task* (Користувацька задача):
. Specify the task type by clicking the key icon and choosing *User Task* from the menu:
+
image:study-project/task-3/task-3-3-bp-user-task.png[]
+
//. На панелі налаштувань справа натисніть `Open Catalog`, оберіть шаблон *User Form* (*Користувацька форма*) та натисніть `Apply` для підтвердження:
. In the settings panel on the right, click `Open Catalog`, select the *User Form* template from the menu, and click `Apply` to confirm:
+
image:study-project/task-3/task-3-3-bp-open-catalog.png[]
+
image:study-project/task-3/task-3-3-bp-user-form.png[]

[start=4]
//. На панелі налаштувань справа заповніть наступні поля:
. On the settings panel on the right, fill in the following fields:
+
//* у полі `Id` зазначте `addLabFormActivity`;
//* у полі `Name` введіть `Додати інформацію про лабораторію`;
//* у полі `Form key` введіть `add-lab-bp-add-lab`;
//* у полі `Assignee` вкажіть `${initiator}`.
* In the *Id* field, specify `addLabFormActivity`.
* In the *Name* field, enter `Add Laboratory Information`.
* In the *Form key* field, enter `add-lab-bp-add-lab`.
* In the *Assignee* field, specify `${initiator}`.

+
image:registry-develop:study-project/task-3/task-3-3-bp.png[]

[#create-service-task-bp-key]
//==== Моделювання сервісної задачі для створення бізнес ключа
==== Modeling a service task for creating a business key

//. Створіть новий Service Task (Сервісна задача):
. Create a new Service Task:
+
image:registry-develop:study-project/task-3/task-3-create-service-task.png[0,400]
+
//. Із каталогу розширень (`Open Catalog`) виберіть шаблон *Define process business key*.
. From the extensions catalog (`Open Catalog`), select the *Define process business key* template.
+
image:registry-develop:study-project/task-3/task-3-04.png[]
+
//.	На панелі налаштувань задайте наступні поля (назву задачі та скрипт для генерування бізнес ключа):
. In the settings panel, define the following fields (task name and script for generating the business key):
+
--
//* у полі `Name` введіть Встановити бізнес ключ;
//* у полі `Business key` введіть:
* In the *Name* field, enter `Set business Key`.
* In the *Business key* field, enter the following script:

 ${submission('addLabFormActivity').formData.prop('name').value().concat(' ').concat(submission('addLabFormActivity').formData.prop('edrpou').value())}
--
+
[TIP]
====
//Детальніше ознайомитися з процесом налаштування бізнес-ключів можна за xref:registry-develop:bp-modeling/bp/modeling-facilitation/bp-business-keys.adoc[посиланням].
For more detailed information on configuring business keys, you can follow the xref:registry-develop:bp-modeling/bp/modeling-facilitation/bp-business-keys.adoc[link].
====

+
image:registry-develop:study-project/task-3/task-3-05.png[]

+
[NOTE]
====
//За допомогою бізнес-ключа користувач може відрізнити один бізнес-процес від іншого (або одну користувацьку задачу від іншої) в переліку бізнес-задач особистих Кабінетів посадової особи та отримувача послуг.
Using the business key, users can differentiate one business process from another (or one user task from another) in the list of business tasks in the User portals of the official and service recipient.

image:bp-modeling/bp/bp-keys/bp-keys-officer-portal-task.png[]
====

[#create-service-task-search-lab-data]
//==== Створення сервісної задачі для пошуку даних про лабораторію
==== Creating a service task for searching laboratory data

//Далі необхідно _створити сервісну задачу (*Service Task*) для пошуку даних про лабораторію_. Для цього виконайте наступні кроки:
Next, it is necessary to _create a *Service Task* for searching laboratory data_. Follow these steps:

//. Створіть новий `Service Task` (Сервісна задача):
. Create a new Service Task:
+
image:registry-develop:study-project/task-3/task-3-create-service-task.png[0,400]
+
//. Із каталогу розширень (`Open Catalog`) виберіть шаблон *Search for entities in data factory* (Пошук значень у фабриці даних) та натисніть `Apply` для підтвердження:
. From the extensions catalog (`Open Catalog`), select the *Search for entities in data factory* template, and press *Apply* to confirm.
+
image:registry-develop:study-project/task-3/task-3-06.png[]
+
//. На панелі налаштувань справа заповніть наступні поля:
. On the settings panel on the right, fill in the following fields:
//* у полі `Id` введіть `searchForLabByNameAndEdrpouActivity`;
* In the *Id* field, enter `searchForLabByNameAndEdrpouActivity`.
//* у полі `Name` має бути вказано `Пошук даних про лабораторію (transient var)`;
* In the *Name* field, it should be specified as `Search for laboratory data (transient var)`.
+
//* у розділі *Input Parameters* -> *Resource* зазначте наступне:
* In the *Input Parameters* section → *Resource*, specify the following:
//** у полі `Variable Assignment Type` вкажіть `String or Expression`;
** In the *Variable Assignment Type* field, select `String or Expression`.
//** у полі `Variable Assignment Value` вкажіть `laboratory-equal-edrpou-name-count`.
** In the *Variable Assignment Value* field, enter `laboratory-equal-edrpou-name-count`.

+
image:registry-develop:study-project/task-3/task-3-07.png[]
//* у розділі *Input Parameters* -> *Search Variables* вкажіть наступне:
* In the *Input Parameters* → *Search Variables* section, provide the following:
//** у полі `Variable Assignment type` вкажіть `Map`.
** In the *Variable Assignment type* field, select `Map`.
//** у полі `Add Entry` додайте параметри `name` та `edrpou`, натиснувши на позначку плюса (`+`) та вкажіть для них відповідні значення:
** In the *Add Entry* field, add entries for parameters `name` and `edrpou` (UA-specific) by clicking the plus (+) sign and specifying their corresponding values:
+
|===
|Key |Value

|`name` |`${submission('addLabFormActivity').formData.prop('name').value()}`

|`edrpou`
|`${submission('addLabFormActivity').formData.prop('edrpou').value()}`
|===

+
image:registry-develop:study-project/task-3/task-3-08.png[]
//* у розділі *Input Parameters* -> *X-Access-Token* вкажіть наступне:
* In the *Input Parameters* → *X-Access-Token* section, specify the following:
//** у полі `Variable Assignment Type` вкажіть `String or Expression`;
** In the *Variable Assignment Type* field, select `String or Expression`.
//** у полі `Variable Assignment Value` вкажіть `${completer('addLabFormActivity').accessToken}`.
** In the *Variable Assignment Value* field, enter `${completer('addLabFormActivity').accessToken}`.
+
[WARNING]
====
//Після відпрацювання першої користувацької задачі (User Task), намагайтеся використовувати функцію *`completer('<task_id>')`* для отримання даних користувача, замість `initiator()`.
After the completion of the first User Task, try using the *`completer('<task_id>')`* function to retrieve user data, instead of `initiator()`.

//Токен доступу береться з АБО ініціатора (наприклад, `$initiator().accessToken}`), АБО виконавця останньої користувацької задачі (наприклад, `${completer('taskDefinitionId').accessToken}`).
The access token is taken from either the initiator (e.g., `$initiator().accessToken}` OR the executor of the last User Task (e.g., `${completer('taskDefinitionId').accessToken}`).

//JWT-токен має свій термін дії, який триває 300 секунд. Якщо вказати токен ініціатора, який запустив бізнес-процес, а користувач довго не виконував задачу, то термін дії токена спливе, й бізнес-процес необхідно буде запускати повторно.
The JWT token has a validity period of 300 seconds. If the token of the initiator who started the business process is specified, and the user does not perform the task for a long time, the token will expire, and the business process will need to be restarted.

//Детальніше про JUEL-функції ви можете переглянути на сторінці xref:registry-develop:bp-modeling/bp/modeling-facilitation/modelling-with-juel-functions.adoc[].
For more details on JUEL functions, you can refer to the JUEL functions:  xref:registry-develop:bp-modeling/bp/modeling-facilitation/modelling-with-juel-functions.adoc[].
====

+
image:registry-develop:study-project/task-3/task-3-6-bp.png[]

+
//* У розділі *Output Parameters* -> *Result Variable* параметр `Assign to Process Variable` заповніть значенням `response`:
* In the *Output Parameters* → *Result Variable* section, fill the `Assign to Process Variable` parameter with the value `response`.
+
image:registry-develop:study-project/task-3/task-3-7-bp.png[]

[#create-xor-gateway]
//==== Створення та заповнення XOR-шлюзу
==== Creating and configuring an XOR gateway

//Далі необхідно _приєднати XOR-шлюз_. Для цього виконайте кроки, подані нижче:
Next, it is necessary to _attach an XOR gateway_. Follow the steps below:

//. Оберіть прямокутник із сервісною задачею `Пошук даних про лабораторію (transient var)`, змодельованою на xref:#create-service-task-search-lab-data[попередньому етапі], та приєднайте XOR-шлюз, натиснувши іконку *Append Gateway*:
. Select the rectangle with the service task `Search for laboratory data (transient var)` modeled in the previous stage and attach the XOR gateway by clicking the *Append Gateway* icon.
+
image:study-project/task-3/task-3-create-xor.png[]
+
//. На панелі налаштувань справа вкажіть ID та назву шлюзу:
. In the settings panel on the right, specify the ID and name of the gateway:
+
//** у полі `Id` введіть значення `isLaboratoryExistGateway`;
** In the *Id* field, enter `isLaboratoryExistGateway`.
//** у полі `Name` введіть значення `Дані присутні?`.
** In the *Name* field, enter `Are data present?`

+
image:registry-develop:study-project/task-3/task-3-8-bp.png[]

[#create-validation-error-branch]
//==== Створення гілки з валідаційною помилкою
==== Creating a branch with a validation error

//На цьому етапі необхідно _створити гілку з валідаційною помилкою_. Для цього виконайте кроки, подані нижче:
At this stage, it is necessary to create a branch with a validation error. Follow the steps below:

//. Оберіть ромб із XOR-шлюзом `Дані присутні?`, змодельованим на xref:#create-xor-gateway[попередньому етапі], та створіть нову сервісну задачу, натиснувши іконку *Append Task*:
. Select the rhombus with the XOR gateway "Are data present?" modeled in the xref:#create-xor-gateway[previous stage] and create a new service task by clicking the *Append Task* icon.
+
image:registry-develop:study-project/task-3/task-3-9-bp-append-task.png[]
+
//. Зазначте тип задачі, натиснувши іконку ключа та обравши з меню пункт *Service Task* (Сервісна задача):
. Specify the task type by clicking the key icon and choosing *Service Task* from the menu.
+
image:registry-develop:study-project/task-3/task-3-9-bp-service-task.png[]
+
//. Натисніть `Open Catalog`, оберіть шаблон *Throw validation error* та натисніть `Apply` для підтвердження:
. Click `Open Catalog`, select the *Throw validation error* template, and press *Apply* to confirm.
+
image:registry-develop:study-project/task-3/task-3-9-bp-choose-temp.png[]
+
--
//TODO: Please help me restore the proper numbering sequence below
//. На панелі налаштувань справа заповніть наступні поля:
. In the settings panel on the right, fill in the following fields:
//* у полі `Id` введіть `throwDuplicateLabValidationError`;
//* In the `Id` field, enter `throwDuplicateLabValidationError`.
* у полі *Name* введіть `Формування валідаційної помилки`.
* In the *Name* field, enter `Generating validation error`.
+
//* У розділі *Input Parameters* -> *Validation Errors* зазначте наступне:
* In the *Input Parameters* → *Validation Errors* section, provide the following:
+
//** у полі `Variable Assignment Type` вкажіть тип `List`;
//** для поля `Value` додайте наступні значення:
** In the *Variable Assignment Type* field, select `List`.
** Add the following values for the *Value* field:
+
.Значення 1
.Value 1
[source,json]
----
{"field": "name", "value": "${submission('addLabFormActivity').formData.prop('name').stringValue().replaceAll("\"", "\\\\\"")}", "message": "Data for this laboratory already exists"}
----
+
.Значення 2
.Value 2
[source,json]
----
{"field": "edrpou", "value": "${submission('addLabFormActivity').formData.prop('edrpou').value()}", "message": "Data for this laboratory already exists"}
----
--
+
image:registry-develop:study-project/task-3/task-3-9-bp.png[]

+
[NOTE]
====
//Делегат *Throw validation error* має можливість виводити декілька повідомлень одночасно.
The *Throw validation error* delegate has the ability to display multiple messages simultaneously.

//У разі формування цієї валідаційно помилки користувач побачить два спливних повідомлення (pop-up) приблизно наступного виду:
In the event of generating this validation error, the user will see two pop-up messages approximately in the following format:

//* *name:* <введене значення name на формі> _"Дані про цю лабораторію вже присутні"._
* *name*: <entered value for name on the form> "_Data for this laboratory already exists_".

//* *edrpou:* <введене значення edrpou на формі> _"Дані про цю лабораторію вже присутні"._
* *edrpou* (UA-specific): <entered value for edrpou on the form> "_Data for this laboratory already exists_".
====
+
//. На гілці, що прямує від шлюзу `Дані присутні?` до сервісної задачі `Формування валідаційної помилки`, потрібно налаштувати наступне:
. On the branch that goes from the "Are Data Present?" gateway to the user task `Formation of validation error`, configure the following parameters:
//** у полі `Id` введіть `isLaboratoryAlreadyExistFlow`;
//** у полі `Name` введіть `так`;
//** у полі `Condition Type` введіть тип `Expression`;
//** у полі `Expression` введіть `${!response.value.responseBody.elements().isEmpty()}`.
** In the *Id* field, enter `isLaboratoryAlreadyExistFlow`.
** In the *Name* field, enter `yes`.
** In the *Condition Type* field, enter `Expression`.
** In the *Expression* field, enter `${!response.value.responseBody.elements().isEmpty()}`.

+
image:registry-develop:study-project/task-3/task-3-10-bp.png[]

[#create-branch-continue-bp]
//==== Створення гілки з подальшим продовженням бізнес-процесу
==== Configuring the branch with continuing the business process

//Необхідно на гілці, що прямує від шлюзу `Дані присутні?` до користувацької задачі `Підписати дані про лабораторію` (_див. нижче xref:#create-user-task-lab-data-signing[]_) налаштуйте такі параметри:
On the branch that goes from the `Are data present?` gateway to the user task `Sign laboratory data` (see xref:#create-user-task-lab-data-signing[]_ below), configure the following parameters:

//. У полі `Id` лишіть значення за замовчуванням.
//. У полі `Name` вкажіть `ні`.
//. у полі `Condition Type` вкажіть `Expression`.
//. У полі `Expression` вкажіть `${response.value.responseBody.elements().isEmpty()}`.
. Leave the *Id* field with its default value.
. In the *Name* field, enter `no`.
. In the *Condition Type* field, select `Expression`.
. In the *Expression* field, enter `${response.value.responseBody.elements().isEmpty()}`.

+
image:study-project/task-3/task-3-create-branch-continue-bp.png[]

[#create-user-task-lab-data-signing]
//==== Створення користувацької задачі для підпису даних
==== Creating the user task for data signing

//Необхідно _створити користувацьку задачу для підпису даних_. Для цього виконайте наступні кроки:
Create a _User Task for data signing_. Follow these steps:

//. Визначте тип задачі, натиснувши іконку ключа та обравши з меню пункт *User Task* `(Користувацька задача).`
. Define the task type by clicking the key icon and choosing *User Task* from the menu.
//. Натисніть `Open Catalog`, оберіть шаблон *Officer Sign Task* та натисніть `Apply` для підтвердження.
. Click `Open Catalog`, select the *Officer Sign Task* template, and press *Apply* to confirm.
//. На панелі налаштувань справа заповніть наступні поля:
. In the settings panel on the right, fill in the following fields:
+
//* у полі `Id` вкажіть `signLabFormActivity`;
//* у полі `Name` введіть `Підписати дані про лабораторію`;
//* у полі `Form key` введіть `add-lab-sign-lab-data`;
//* у полі `Assignee` вкажіть `${initiator}`;
//* у полі `Form data pre-population` введіть `${submission('addLabFormActivity').formData}`.
* In the *Id* field, enter `signLabFormActivity`.
* In the *Name* field, enter `Sign laboratory data`.
* In the *Form  key* field, enter `add-lab-sign-lab-data`.
* In the *Assignee* field, enter `${initiator`}.
* In the *Form data pre-population* field, enter `${submission('addLabFormActivity').formData}`.

+
image:study-project/task-3/task-3-create-user-task-lab-data-signing.png[]

[#create-script-task-prepare-data-record-transient-var]
//==== Створення задачі скриптування "Підготовка даних до запису (transient var)"
==== Creating the script task "Preparing data for record (transient var)"

//Створіть нову задачу скриптування для підготовки даних до запису. Для цього виконайте подальші налаштування:
Create a new Script Task to prepare data for record. Follow these further configurations:

//. Оберіть прямокутник із користувацькою задачею, змодельованою на xref:#create-user-task-lab-data-signing[попередньому етапі], та приєднайте нову задачу, натиснувши іконку *Append Task*.
. Select the rectangle with the User Task created in the xref:#create-user-task-lab-data-signing[previous step] and append a new task by clicking the *Append Task* icon.
+
//. Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *Script Task* (Задача скриптування).
. Define the task type by clicking the key icon and choosing *Script Task* from the menu.
+
//. Виділіть додану задачу скриптування та налаштуйте наступні параметри:
. Select the added Script Task and configure the following parameters:
+
//* у полі `Id` вкажіть `convertSignFormDataToDataFactoryFormatActivity`;
//* у полі `Name` вкажіть `Підготовка даних для запису (transient var)`;
//* у полі `Script Format` вкажіть тип (мову) скриптування -- `groovy`;
//* у полі `Script Type` вкажіть тип скрипту `InlineScript`;
//* у полі `Script` вставте безпосередньо groovy-скрипт:
* In the *Id* field, enter `convertSignFormDataToDataFactoryFormatActivity`.
* In the *Name* field, enter `Preparing Data for Record (transient var`).
* In the *Script Format* field, select `groovy` as the scripting language.
* In the *Script Type* field, choose `InlineScript`.
* Insert the groovy script directly into the *Script* field.
+
====
[%collapsible]
.Натисніть, щоб розгорнути або згорнути
.Click to expand
=====
[source,groovy]
----
def signedFormData = submission('signLabFormActivity').formData

signedFormData.prop('oblast', signedFormData.prop('oblast').prop('code').value())

signedFormData.prop('koatuuId', signedFormData.prop('koatuu').prop('koatuuId').value())
signedFormData.deleteProp('koatuu')
signedFormData.prop('ownershipId', signedFormData.prop('ownership').prop('ownershipId').value())
signedFormData.deleteProp('ownership')

if (signedFormData.hasProp('premisesFile')
    && !signedFormData.prop('premisesFile').isNull()
    && !signedFormData.prop('premisesFile').elements().isEmpty()) {
    signedFormData.prop('premisesFile', signedFormData.prop('premisesFile').elements()[0])
} else {
    signedFormData.prop('premisesFile', null as String)
}

if(signedFormData.hasProp('accreditationFile')
    && !signedFormData.prop('accreditationFile').isNull()
    && !signedFormData.prop('accreditationFile').elements().isEmpty()) {
    signedFormData.prop('accreditationFile', signedFormData.prop('accreditationFile').elements()[0])
} else {
    signedFormData.prop('accreditationFile', null as String)
}
set_transient_variable('dataPayload', signedFormData)
----
=====
====

+
image:study-project/task-3/task-3-create-script-task-prepare-data-record-transient-var.png[]

[#create-call-activity-sign-data-by-system-key]
//==== Моделювання сервісної задачі для підпису даних системним ключем
==== Modeling the service task for data signing with the system key

//Створіть сервісну задачу (Service Task) для підпису даних системним ключем та налаштуйте відповідне інтеграційне розширення. Для цього виконайте кроки, подані нижче:
Create a service task for data signing with the system key and configure the corresponding integration extension. Follow these steps:

//. Оберіть прямокутник зі [.underline]#скриптовою задачею#, змодельованою на попередньому етапі, та приєднайте нову задачу, натиснувши іконку *Append Task*.
. Select the rectangle with the [.underline]#script task# modeled in the previous step and append a new task by clicking the *Append Task* icon.
+
//. Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *Service Task*.
. Define the task type by clicking the key icon and choosing *Service Task* from the menu.
+
//. На панелі налаштувань справа натисніть `*Open Catalog*`, щоб відкрити список доступних шаблонів делегатів.
. In the settings panel on the right, click `*Open Catalog*` to open the list of available delegate templates.
+
//. З отриманого переліку оберіть шаблон *System signature by DSO service*, який необхідно використовувати для підписання даних системним ключем.
. From the list received, select the *System signature by DSO service* template, which should be used for data signing with the system key.
+
//. На панелі налаштувань справа, відкрийте вкладку *General* та сконфігуруйте параметри делегата:
. In the settings panel on the right, go to the *General* tab and configure the delegate parameters:
+
//* у полі `Name` вкажіть назву задачі -- "Підписати дані системним ключем";
* In the *Name* field, enter the task name as `Sign data with system key`;
//* у полі `Payload` передайте дані, на які треба накласти системний підпис -- ${dataPayload};
* In the *Payload* field, pass the data that needs to be signed with the system signature as `${dataPayload}`.
//•	у полі `X-Access-Token source` передайте токен доступу особи, яка наразі виконує задачу з ID `'signLabFormActivity'` -- `${completer('signLabFormActivity').accessToken}`;
•	In the *X-Access-Token source* field, pass the access token of the person currently executing the task with the ID `'signLabFormActivity'` as `${completer('signLabFormActivity').accessToken}`.
+
[WARNING]
====
//Після відпрацювання першої користувацької задачі (User Task), намагайтеся використовувати функцію *`completer('<task_id>')`* для отримання даних користувача, замість `initiator()`.
After the completion of the first User Task, try using the *`completer('<task_id>')`* function to retrieve user data, instead of `initiator()`.

//Токен доступу береться з АБО ініціатора (наприклад, `$initiator().accessToken}`), АБО виконавця останньої користувацької задачі (наприклад, `${completer('taskDefinitionId').accessToken}`).
The access token is taken from either the initiator (e.g., `$initiator().accessToken`) OR the executor of the last User Task (e.g., `${completer('taskDefinitionId').accessToken}`).

//JWT-токен має свій термін дії, який триває 300 секунд. Якщо вказати токен ініціатора, який запустив бізнес-процес, а користувач довго не виконував задачу, то термін дії токена спливе, й бізнес-процес необхідно буде запускати повторно.
The JWT token has a validity period of 300 seconds. If the token of the initiator who started the business process is specified, and the user does not perform the task for a long time, the token will expire, and the business process will need to be restarted.

//Детальніше про JUEL-функції ви можете переглянути на сторінці xref:registry-develop:bp-modeling/bp/modeling-facilitation/modelling-with-juel-functions.adoc[].
For more details on JUEL functions, you can refer to the JUEL functions at xref:registry-develop:bp-modeling/bp/modeling-facilitation/modelling-with-juel-functions.adoc[].
====
//•	у полі `Result variable` зазначте назву змінної, до якої запишеться цифровий підпис вказаних даних -- `system_signature_ceph_key`.
•	In the *Result variable* field, specify the name of the variable to which the digital signature of the specified data will be recorded as `system_signature_ceph_key`.

+
image:study-project/task-3/task-3-create-call-activity-sign-data-by-system-key.png[]

[#create-service-task-save-data-to-data-factory]
//==== Створення сервісної задачі для збереження даних до Фабрики даних
==== Creating the service task for saving data to the data factory

//На цьому етапі необхідно _створити та налаштувати нову сервісну задачу для збереження даних до фабрики даних_. Для цього виконайте кроки, зазначені нижче:
At this stage, you need to _create and configure a new service task for saving data to the data factory_. Follow the steps below:

//. На прикладі xref:#create-service-task-search-lab-data[] створіть нову сервісну задачу `Зберегти дані до Фабрики даних`, натиснувши іконку ключа та обравши з меню пункт *Service Task*.
. Using the example from xref:#create-service-task-search-lab-data[], create a new service task `Save data to data factory` by clicking the key icon and choosing *Service Task* from the menu.
//. Натисніть `Open Catalog`, оберіть шаблон *Create entity in data factory* та натисніть `Apply` для підтвердження:
. Click `Open Catalog`, select the *Create entity in data factory* template, and press *Apply* to confirm.
+
image:study-project/task-3/task-3-24-bp-choose-temp.png[]

//. На панелі налаштувань справа сконфігуруйте наступні параметри:
. In the settings panel on the right, configure the following parameters:
//* у полі `Id` введіть `sendLabToDataFactoryActivity`;
//* у полі `Name` введіть `Зберегти дані до Фабрики даних`;
//* у полі `Resource` вкажіть `laboratory`;
* In the *Id* field, enter `sendLabToDataFactoryActivity`.
* In the *Name* field, enter `Save data to data factory`.
* In the *Resource* field, specify `laboratory`.
+
[NOTE]
====
//У цьому прикладі назва ресурсу = назві таблиці `laboratory` у БД.
In this example, the resource name corresponds to the table name `laboratory` in the database.

//Поле `Resource` використовується для визначення назви ресурсу (ендпоінт) у фабриці даних, до якого передаються дані.
The *Resource* field is used to determine the name of the resource (endpoint) in the data factory to which the data will be sent.

//Зверніть увагу, що при моделюванні бізнес-процесу необхідно використовувати назви ресурсів через дефіс `"-"`(замість нижнього підкреслювання `“_”`, як у БД), що складаються з 2-х і більше слів.
Please note that when modeling the business process, you should use resource names with a dash `"-"` (instead of an underscore `"_"`) that consist of two or more words.

//Наприклад: ::
For example: ::

//Назва ресурсу у бізнес-процесі:
Resource name in the business process:
`laboratory-test`
====
//* у полі `Payload` введіть `${dataPayload}` дані для збереження;
* In the *Payload* field, enter `${dataPayload}` as the data to be saved;
//* у полі `X-Access-Token` введіть `${completer('signLabFormActivity').accessToken}`;
* In the *X-Access-Token* field, enter `${completer('signLabFormActivity').accessToken}`.
+
[WARNING]
====
//Після відпрацювання першої користувацької задачі (User Task), намагайтеся використовувати функцію *`completer('<task_id>')`* для отримання даних користувача, замість `initiator()`.
After the completion of the first user task, try using the *`completer('<task_id>')*` function to retrieve user data, instead of `initiator()`.

//Токен доступу береться з АБО ініціатора (наприклад, `$initiator().accessToken}`), АБО виконавця останньої користувацької задачі (наприклад, `${completer('taskDefinitionId').accessToken}`).
The access token is taken from either the initiator (e.g., `$initiator().accessToken)` or the executor of the last user task (e.g., `${completer('taskDefinitionId').accessToken}`).

//JWT-токен має свій термін дії, який триває 300 секунд. Якщо вказати токен ініціатора, який запустив бізнес-процес, а користувач довго не виконував задачу, то термін дії токена спливе, й бізнес-процес необхідно буде запускати повторно.
The JWT token has a validity period of 300 seconds. If the token of the initiator who started the business process is specified, and the user does not perform the task for a long time, the token will expire, and the business process will need to be restarted.

//Детальніше про JUEL-функції ви можете переглянути на сторінці xref:registry-develop:bp-modeling/bp/modeling-facilitation/modelling-with-juel-functions.adoc[].
For more details on JUEL functions, you can refer to xref:registry-develop:bp-modeling/bp/modeling-facilitation/modelling-with-juel-functions.adoc[].
====
//* у полі `X-Digital-Signature source` введіть `${sign_submission('signLabFormActivity').signatureDocumentId}`;
* In the *X-Digital-Signature source* field, enter `${sign_submission('signLabFormActivity').signatureDocumentId}`.
//* у полі `X-Digital-Signature-Derived source` введіть `${system_signature_ceph_key}`;
* In the *X-Digital-Signature-Derived source* field, enter `${system_signature_ceph_key}`.
//* у полі `Result Variable` вкажіть `response`, змінна, до якої записуються відповідь від сервера, якщо така буде.
* In the *Result Variable* field, specify `response`, the variable to which the server's response will be recorded, if applicable.

+
image:registry-develop:study-project/task-3/task-3-24-bp.png[]

[#create-service-task-create-entity-end]
//==== Створення сервісної задачі для встановлення результату бізнес-процесу
==== Creating the service task for setting the business process result

//На цьому етапі необхідно _створити та налаштувати сервісну задачу, що встановлюватиме результат бізнес-процесу_.
At this stage, you need to _create and configure a service task that will set the result of the business process_.

//. На прикладі xref:#create-service-task-save-data-to-data-factory[] змоделюйте нову сервісну задачу `Результат виконання "Лабораторія створена"`, натиснувши іконку ключа та обравши з меню пункт *Service Task*.
. Using the example from xref:#create-service-task-save-data-to-data-factory[], model a new service task `Execution result: Laboratory created` by clicking the key icon and choosing *Service Task* from the menu.
//. Натисніть `Open Catalog`, оберіть шаблон *Define business process status* та натисніть `Apply` для підтвердження:
. Click *Open Catalog*, select the *Define business process status* template, and press *Apply* to confirm.

+
image:study-project/task-3/task-3-25-bp-choose-temp.png[]
+
//. На панелі налаштувань справа сконфігуруйте наступні параметри:
. In the settings panel on the right, configure the following parameters:
//** у полі `Name` вкажіть `Результат виконання "Лабораторія створена"`;
//** у полі `Status` вкажіть `Лабораторія створена!`.
** In the *Name* field, enter `Execution result: Laboratory created`.
** In the *Status* field, enter `Laboratory created`!.

+
image:registry-develop:study-project/task-3/task-3-25-bp.png[]

[NOTE]
====
//Поле `Name` має інформативне значення. _«Результат виконання "Лабораторія створена!"»_ буде показано на порталі у полі `Статус виконаного бізнес-процесу`, повідомляючи нам як завершилось виконання певного бізнес-процесу.
The *Name* field has an informative value. "Execution result: Laboratory created!" will be displayed on the portal in the *Status  of the completed business process* field, informing us about the completion of a certain business process.

Приклад: ::
image:user:notifications/notifications-success-01.png[]
====

[#create-task-entity-finish]
//==== Створення події завершення бізнес-процесу
==== Creating the business process completion event

//На цьому етапі необхідно _створити подію, яка завершуватиме основний бізнес-процес_.
At this stage, you need to _create an event that will mark the completion of the main business process_.

//. На прикладі xref:#create-end-event-call-activity[] (зовнішнього підпроцесу Call Activity) приєднайте та налаштуйте подію завершення бізнес-процесу.
. Using the example from xref:#create-end-event-call-activity[] (external subprocess Call Activity), attach and configure the event for completing the business process.
+
//. На панелі налаштувань справа для параметра `Name` вкажіть значення `Лабораторія створена`.
. In the settings panel on the right, for the `Name` parameter, enter `Laboratory created`.

image:registry-develop:study-project/task-3/task-3-26-bp.png[]

//TIP: В результаті маємо змодельований складний бізнес-процес із налаштуванням та викликом зовнішнього підпроцесу Call Activity.
TIP: As a result, you will have a complex business process modeled with the configuration and invocation of an external subprocess Call Activity.

[#save-bp-schema]
//==== Збереження змодельованої схеми бізнес-процесу
==== Saving the modeled business process schema

//Після завершення процесу моделювання збережіть отриману схему бізнес-процесу із назвою _add-lab.bpmn_ до регламентної папки *_bpmn_* проєкту в Gerrit-репозиторії. Для цього у лівому верхньому куті відкрийте меню *File* -> *Save File As..*, введіть відповідну назву та шлях.
After completing the modeling process, save the obtained business process schema with the name _add-lab.bpmn_ to the *_bpmn_* folder in the Gerrit repository. To do this, in the top-left corner, open the *File* menu, select *Save File As..*., and enter the corresponding name and path.

[#forms-modeling]
//=== Моделювання форм
=== Form modeling

[TIP]
====
//На етапі моделювання форм необхідно створити та прив'язати JSON-форми до попередньо змодельованих задач в рамках бізнес-процесу.
During the form modeling stage, you need to create and link JSON forms to the previously modeled tasks within the business process.

//Форми прив'язуються до бізнес-процесів за службовою назвою.
Forms are linked to business processes by the service name.

//Використовуйте файли _link:{attachmentsdir}/study-project/task-3/bp-forms/add-lab-bp-add-lab.json[add-lab-bp-add-lab.json]_ та _link:{attachmentsdir}/study-project/task-3/bp-forms/add-lab-sign-lab-data.json[add-lab-sign-lab-data.json]_ зі змодельованими формами для прикладу.
Use the files _link:{attachmentsdir}/study-project/task-3/bp-forms/add-lab-bp-add-lab.json[add-lab-bp-add-lab.json]_ and _link:{attachmentsdir}/study-project/task-3/bp-forms/add-lab-sign-lab-data.json[add-lab-sign-lab-data.json]_  with the modeled forms as examples.
====

[#form-insert-data]
//==== Створення форми для внесення даних
==== Creating the data entry form

//Найперше, необхідно _створити форму для внесення даних_ користувачем. Для цього виконайте наступні кроки:
First, _create a form for data entry by the user_. Follow these steps:

//. Увійдіть до застосунку [blue]#Кабінет адміністратора регламентів#:
. Access the Regulations administrator portal.

+
image::registry-develop:bp-modeling/forms/admin-portal-form-modeling-step-1.png[]
+
//. Створіть нову кандидат-версію _Завдання 3_:
. Create a new candidate version for _Task 3_:
+
image:registry-develop:study-project/task-3/task-3-011.png[]
+
image:registry-develop:study-project/task-3/task-3-012.png[]
+
//. Перейдіть до розділу `UI-форм`. Щоб створити нову форму для бізнес-процесу, натисніть кнопку `Створити нову форму`:
. Go to the *UI forms* section. To create a new form for the business process, click the *`Create new form`* button:

+
image:registry-develop:study-project/task-3/task-3-013.png[]
+
//* У новому вікні, у полі `Бізнес-назва форми` вкажіть назву, що відповідає назві змодельованої xref:#create-task-add-lab-data[користувацької задачі] -- `Додати інформацію про лабораторію`.
* In the new window, in the *Business form name* field, enter the name corresponding to the modeled xref:#create-task-add-lab-data[user task] -- `Add laboratory information`.
//* Заповніть поле `Службова назва форми` значенням `add-lab-bp-add-lab` (має відповідати значенню поля `Form key` тієї ж xref:#create-task-add-lab-data[користувацької задачі]).
* Fill in the *Form name* field with the value `add-lab-bp-add-lab` (must match the value in the *Form key* field of the same user task).
+
image:study-project/task-3/task-3-27-forms-name.png[]
+
//. Перейдіть до вкладки `Конструктор`.
. Go to the *Constructor* tab.
+
//. З панелі компонентів зліва перетягніть компонент *Text Field* до панелі моделювання та виконайте подальші налаштування:
. From the components panel on the left, drag the *Text Field* component to the modeling panel and perform further settings:
+
image:study-project/task-3/task-3-27-forms-drag-text-field.png[]
+
//* У новому вікні перейдіть на вкладку *Display*, заповніть поле `Label` значенням `Назва лабораторії`:
* In the new window, go to the *Display* tab and fill in the *Label* field with `Laboratory name`:

+
image:registry-develop:study-project/task-3/task-3-27-forms.png[]
+
//* Перейдіть на вкладку *Validation* та встановіть прапорець для параметра  `Required` -- `true`:
* Go to the *Validation* tab and set the `Required` parameter to `true`:

+
image:registry-develop:study-project/task-3/task-3-28-forms.png[]
+
//* Перейдіть на вкладку *API* та заповніть поле `Property Name` значенням `name`.
* Go to the *API* tab and fill in the *Property Name* field with `name`.
+
[IMPORTANT]
====
//Значення поля `Property Name` повинно бути унікальним.
The *Property Name* field value must be unique.
====
//* Натисніть кнопку `Save` для збереження змін:
* Click the *`Save`* button to save the changes:

+
image:registry-develop:study-project/task-3/task-3-29-forms.png[]

+
[IMPORTANT]
====
//Аналогічно змоделюйте текстові поля (*Text Field*) для `Код ЄДРПОУ або РНОКПП`, `Адреса`, `Телефон`, `Керівник`.
Similarly, model text fields (*Text Field*) for `EDRPOU or RNOKPP Code` (UA-specific), `Address`, `Phone`, and `Manager`.

//Поле `Код ЄДРПОУ або РНОКПП` повинен бути обов'язковим та мати `Property name` = `edrpou`.
====

+
//. З панелі компонентів зліва перетягніть компонент *Checkbox* до панелі моделювання та виконайте подальші налаштування:
. From the components panel on the left, drag the *Checkbox* component to the modeling panel and perform further settings:
+
image:study-project/task-3/task-3-30-forms-drag-checkbox.png[]
+
//* Перейдіть на вкладку *Display* та заповніть поле `Label` значенням `Наявність акредитації`:
* Go to the *Display* tab and fill in the *Label* field with `Accreditation available`:
+
image:registry-develop:study-project/task-3/task-3-30-forms.png[]
+
//* Перейдіть на вкладку *API* та заповніть поле `Property Name` значенням `accreditationFlag`.
* Go to the *API* tab and fill in the *Property Name* field with `accreditationFlag`.
//* Натисніть кнопку `Save` для збереження змін:
* Click the *`Save`* button to save the changes:
+
image:registry-develop:study-project/task-3/task-3-31-forms.png[]
+
//. З панелі компонентів зліва перетягніть компонент *File* до панелі моделювання та виконайте подальші налаштування:
. From the components panel on the left, drag the *File* component to the modeling panel and perform further settings:

+
image:study-project/task-3/task-3-32-forms-drag-file.png[]
+
//* Перейдіть на вкладку *Display* та заповніть поле `Label` значенням `Документи про приміщення`:
* Go to the *Display* tab and fill in the *Label* field with `Premises documents`:
+
image:registry-develop:study-project/task-3/task-3-32-forms.png[]
+
//* Перейдіть на вкладку *File* та заповніть наступні поля:
* Go to the *File* tab and fill in the following fields:
+
//** у полі `Storage` вкажіть `Url`;
//** у полі `Url` вкажіть `/documents`;
** In the *Storage* field, specify `Url`.
** In the *Url* field, specify `/documents`.
+
image:registry-develop:study-project/task-3/task-3-33-forms.png[]
+
//** у полі вкажіть `File Pattern` вкажіть `application/pdf,image/jpeg,image/png`;
//** у полі `File Minimum size` вкажіть `0KB`;
//** у полі `File Maximum size` вкажіть `50MB`.
** In the *File Pattern* field, specify `application/pdf,image/jpeg,image/png`.
** In the *File Minimum size* field, specify `0KB`.
** In the *File Maximum size* field, specify `50MB`.
+
image:registry-develop:study-project/task-3/task-3-34-forms.png[]
+
//* Перейдіть на вкладку *Data* та залишіть поле `Multiple Values` порожнім, тобто зі значенням `False`:
* Go to the *Data* tab and leave the *Multiple Values* field empty, i.e., with the value `False`:
+
image:registry-develop:study-project/task-3/task-3-35-forms.png[]
+
//* Перейдіть на вкладку *API* та заповніть поле `Property Name` значенням `premisesFile`.
* Go to the *API* tab and fill in the *Property Name* field with `premisesFile`.
//* Натисніть кнопку `Save` для збереження змін:
* Click the *`Save`* button to save the changes:
+
image:registry-develop:study-project/task-3/task-3-36-forms.png[]
+
//. З панелі компонентів зліва перетягніть компонент *Select* до панелі моделювання та виконайте подальші налаштування для отримання інформації з довідника:
. From the components panel on the left, drag the *Select* component to the modeling panel and perform further settings to obtain information from the directory:
+
image:study-project/task-3/task-3-37-forms-drag-select.png[]
+
//* Перейдіть на вкладку *Display* та заповніть поле `Label` значенням `Форма власності`:
* Go to the *Display* tab and fill in the *Label* field with `Ownership form`:
+
image:registry-develop:study-project/task-3/task-3-37-forms.png[]
+
//* Перейдіть на вкладку *Data* та заповніть наступні поля:
* Go to the *Data* tab and fill in the following fields:
+
//** у полі `Data Source Type` вкажіть значення `URL`;
** In the *Data Source Type* field, specify `URL`.
//** у полі `Data Source URL` вкажіть `/officer/api/data-factory/ownership-contains-name`,
** In the *Data Source URL* field, specify `/officer/api/data-factory/ownership-contains-name`, where:
+
[TIP]
====
де:

//* `/officer` -- вказує, що запит до довідника буде виконано із Кабінету посадової особи;
//* `/api/data-factory/` -- вказує шлях до фабрики даних;
//* `ownership-contains-name` -- назва критерію пошуку (search condition) для отримання даних із довідника форм власності, що був змодельований та доданий до репозиторію.
* `/officer` indicates that the request to the directory will be executed from the Officer portal.
* `/api/data-factory/` indicates the path to the data factory.
* `ownership-contains-name` is the name of the search condition to obtain data from the ownership directory that was modeled and added to the repository.
====

//** у полі `Value Property` вкажіть `ownershipId`;
** In the *Value Property* field, specify `ownershipId`.
+
image:registry-develop:study-project/task-3/task-3-38-forms.png[]

//** у полі `Item Template` вкажіть `<span>{{ item.name }}</span>`,
** In the *Item Template* field, specify `<span>{{ item.name }}</span>`,
+
[TIP]
====
//де `name` -- назва параметра, що повертає критерій пошуку (search condition) та відображатиметься на формі.
where `name` is the name of the parameter that returns the search condition and will be displayed on the form.
====
+
image:registry-develop:study-project/task-3/task-3-39-forms.png[]
+
//* На вкладці *Validation* встановіть прапорець для параметра `Required` -- `true`;
* Go to the *Validation* tab and set the `Required` parameter to `true`.
+
//* На вкладці *API* заповніть поле `Property Name` значенням `ownership`:
* Go to the *API* tab and fill in the *Property Name* field with `ownership`:

+
image:registry-develop:study-project/task-3/task-3-40-forms.png[]

+
//** Натисніть кнопку `Save` для збереження змін.
* Click the *`Save`* button to save the changes.

[START=9]
//TODO: Please help provide the numbering starting with 9 below:
//. За аналогією до попереднього кроку, виконайте налаштування для отримання інформації з довідника "Область". З панелі компонентів зліва перетягніть компонент *Select* до панелі моделювання:

. By analogy, perform the settings to obtain information from the *Region* directory. From the components panel on the left, drag the Select component to the modeling panel.
+
image:study-project/task-3/task-3-37-forms-drag-select.png[]
//* Перейдіть на вкладку *Display* та заповніть поле `Label` значенням `Область`:

* Go to the *Display* tab and fill in the Label field with the value `Region`:

+
image:registry-develop:study-project/task-3/task-3-41-forms.png[]
+
//* Перейдіть на вкладку *Data* та заповніть наступні поля:
* Go to the *Data* tab and fill in the following fields:

** у полі `Data Source Type` вкажіть значення `URL`;
** у полі `Data Source URL` вкажіть `/officer/api/data-factory/koatuu-obl-contains-name`,
** In the *Data Source Type* field, specify the value `URL`.
** In the *Data Source URL* field, enter `/officer/api/data-factory/koatuu-obl-contains-name`,

+
[TIP]
====
//де:
where:

//* `/officer` -- вказує, що запит до довідника буде виконано із Кабінету посадової особи;
//* `/api/data-factory/` -- вказує шлях до фабрики даних;
//* `koatuu-obl-contains-name` -- назва критерію пошуку (search condition) для отримання даних із довідника областей, що був змодельований та доданий до репозиторію.
* `/officer indicates` that the query to the directory will be executed from the Officer portal;
* `/api/data-factory/` indicates the path to the data factory;
* `koatuu-obl-contains-name` is the search condition to obtain data from the directory of regions that was modeled and added to the repository.
====
//** у полі `Value Property` введіть значення `code`;
** In the *Value Property* field, enter the value `code`.
+
image:registry-develop:study-project/task-3/task-3-42-forms.png[]
** у полі `Item Template` вкажіть `<span>{{ item.name }}</span>`,
** In the *Item Template* field, enter `<span>{{ item.name }}</span>`,
+
[TIP]
====
//де `name` -- назва параметра, що повертає критерій пошуку (search condition) та відображатиметься на формі.
where `name` is the parameter name that returns the search condition and will be displayed on the form.
====
+
//** у полі `Refresh Options On` зазначте `Область` (поточне значення буде видалено, коли значення в полі `Область` зміниться);
** In the *Refresh Options On* field, specify (the current value will be removed when the value in the Region field changes);
//** для поля `Clear Value On Refresh Options` встановіть прапорець -- `True`.
** Set the flag to `True` for the `Clear Value On Refresh Options` parameter.
+
image:registry-develop:study-project/task-3/task-3-43-forms.png[]
+
//* Перейдіть на вкладку *Validation* та встановіть прапорець для параметра `Required` -- `True`.
* Go to the *Validation* tab and set the flag for the `Required` parameter to `True`.
+
//* Перейдіть на вкладку *API* та заповніть поле `Property Name` значенням `oblast`:
* Go to the *API* tab and fill in the *Property Name* field with the value `region`:

+
image:registry-develop:study-project/task-3/task-3-44-forms.png[]
//* Натисніть кнопку `Save` для збереження змін.
* Click the *`Save`* button to save the changes.
+
//. Налаштуйте залежний компонент *Select*. З панелі компонентів зліва перетягніть компонент *Select* до панелі моделювання та виконайте подальші налаштування для отримання інформації з довідника:
. Configure the dependent component *Select*. Drag the *Select* component from the component panel on the left to the modeling panel and perform further settings to obtain information from the directory:

+
image:study-project/task-3/task-3-37-forms-drag-select.png[]

+
//* Перейдіть на вкладку *Display* та заповніть поле `Label` значенням `Назва населеного пункту`:
* Go to the *Display* tab and fill in the *Label* field with the value `Settlement name`:

+
image:registry-develop:study-project/task-3/task-3-45-forms.png[]

+
//* Перейдіть на вкладку *Data* та заповніть наступні поля:
* Go to the *Data* tab and fill in the following fields:
+
//** у полі `Data Source Type` введіть `URL`;
//** у полі `Data Source URL` введіть `/officer/api/data-factory/koatuu-np-starts-with-name-by-obl`,
** In the *Data Source Type* field, enter `URL`.
** In the *Data Source URL* field, enter `/officer/api/data-factory/koatuu-np-starts-with-name-by-obl`,
+
[TIP]
====
//де:
where:

//* `/officer` -- вказує, що запит до довідника буде виконано із Кабінету посадової особи;
//* `/api/data-factory/` -- вказує шлях до фабрики даних;
//* `koatuu-np-starts-with-name-by-obl` -- назва критерію пошуку (search condition) для отримання даних із довідника населених пунктів, що був змодельований та доданий до репозиторію.
* `/officer` indicates that the query to the directory will be executed from the Officer portal;
* `/api/data-factory/` indicates the path to the data factory;
* `koatuu-np-starts-with-name-by-obl` is the search condition to obtain data from the directory of settlements that was modeled and added to the repository.
====
+
//** у полі `Value Property` вкажіть `koatuuId`;
** In the *Value Property* field, enter `koatuuId`.
+
image:registry-develop:study-project/task-3/task-3-46-forms.png[]
+
//** у полі `Filter Query` вкажіть `level1={{data.oblast.code}}`,
** In the `Filter Query` field, enter `level1={{data.oblast.code}}`,
+
[TIP]
====
//де:
where:

//* `level1` -- вхідний параметр для ендпоінту `koatuu-np-starts-with-name-by-obl`;
//* `{{data.oblast.code}}`-- шлях для отримання даних `data.Property name.Value Property` із попереднього компонента *Select*.
* `level1` is the input parameter for the endpoint `koatuu-np-starts-with-name-by-obl`;
* `{{data.oblast.code}}` is the path to obtain data from `data.Property name.Value Property` from the previous Select component.
====
+
//** у полі `Item Template` вкажіть `<span>{{ item.name }}</span>`,
** In the *Item Template* field, enter `<span>{{ item.name }}</span>`,
+
[TIP]
====
//де `name` -- назва параметру, що повертає search condition та буде відображений на формі.
where `name` is the parameter name that returns the search condition and will be displayed on the form.
====
+
//** у полі `Refresh options On` введіть значення `Область`  (поточне значення буде видалено, коли значення в полі `Область` зміниться);
** In the *Refresh Options On* field, enter `Region` (the current value will be removed when the value in the Region field changes);
//** встановіть прапорець для параметра `Clear Value On Refresh Options` -- `True`:
** Set the flag for the `Clear Value On Refresh Options` parameter to `True`.
+
image:registry-develop:study-project/task-3/task-3-47-forms.png[]
+
//* Перейдіть на вкладку *Validation* та встановіть прапорець для параметра  `Required` -- `True`.
* Go to the *Validation* tab and set the flag for the `Required` parameter to `True`.
//* Перейдіть на вкладку *API* та заповніть поле `Property Name` значенням `koatuu`.
* Go to the *API* tab and fill in the *Property Name* field with the value `koatsu` (UA-specific).
//* Натисніть кнопку `Save`, щоб зберегти зміни.
* Click the *`Save`* button to save the changes.
+
//. Збережіть форму, натиснувши кнопку `Створити форму` у правому верхньому куті:
. Save the form by clicking the *`Create form`* button in the upper right corner:

+
image:registry-develop:study-project/task-3/task-3-48-forms.png[]

[#form-data-signing]
//==== Створення форми для підпису даних
==== Creating a form for data signature

//Після завершення xref:#form-insert-data[попереднього етапу] зі створенням форми для внесення даних, _створіть ще одну форму для підпису даних_.
After completing the xref:#form-insert-data[previous stage] of creating a form for data entry, _create another form for data signature_.

//Для цього скопіюйте xref:#form-insert-data[попередньо змодельовану форму], натиснувши **іконку копіювання** -- це дозволить створити форму із готового шаблону.
To do this, copy the xref:#form-insert-data[previously modeled form] by clicking the *copy icon* -- this will allow you to create a form from a ready-made template.

image:registry-develop:study-project/task-3/task-3-49-forms.png[]

//_Налаштуйте параметри форми_:
_Configure the form parameters_:

//. Введіть назву відповідної xref:#create-task-lab-data-signing[користувацької задачі] `Підписати дані про лабораторію` в полі `Бізнес-назва форми`;
. Enter the name of the corresponding xref:#create-task-lab-data-signing[user task] `Sign laboratory data` in the *Business form name* field;
//. Заповніть поле `Службова назва форми` значенням `add-lab-sign-lab-data` (відповідає значенню поля `Form key` тієї ж xref:#create-task-lab-data-signing[користувацької задачі]);
. Fill in the *Form name* field with the value `add-lab-sign-lab-data` (corresponding to the *Form key* field value of the same user task);
+
//. В усіх компонентах:
. In all components:
+
//* На вкладці *Display* встановіть прапорець для параметра *Disabled*.
//* Натисніть кнопку `Save` для збереження змін.
* On the *Display* tab, set the flag for the `Disabled` parameter.
* Click the *`Save`* button to save the changes.
+
image:registry-develop:study-project/task-3/task-3-50-forms.png[]
+
//. Збережіть форму, натиснувши кнопку `Зберегти зміни` у правому верхньому куті.
. Save the form by clicking the *`Save changes`* button in the upper right corner.

//==== Завантаження змодельованих форм бізнес-процесу до локальної директорії
==== Uploading modeled forms of the business process to the local directory

//Завантажте форми, натиснувши _іконку завантаження_, та помістіть їх до регламентної папки *_forms_* проєкту в локальному Gerrit-репозиторії.
Upload the forms by clicking the _upload icon_ and place them in the regulatory folder *_forms_* of the project in the local Gerrit repository.

image:registry-develop:study-project/task-3/task-3-51-forms.png[]

[#bp-access]
//=== Моделювання доступу до бізнес-процесу
=== Modeling access to the business process

[TIP]
====

//На цьому етапі необхідно надати доступ до бізнес-процесу в Кабінеті посадової особи для стандартної ролі `officer`  .
At this stage, it is necessary to provide access to the business process in the Officer portal for the standard `officer` role.

//Параметри доступу налаштовуються у конфігураційному файлі, що має назву _link:{attachmentsdir}/study-project/task-3/bp-access/officer.yml[officer.yml]_ із директорії _bp-auth_.
Access parameters are configured in the configuration file named _link:{attachmentsdir}/study-project/task-3/bp-access/officer.yml[officer.yml]_ in the _bp-auth_ directory.
====

//Відредагуйте файл  _bp-auth/officer.yml_ додавши наступні параметри:
Edit the file _bp-auth/officer.yml_ by adding the following parameters:

//.Приклад. Налаштування доступу до бізнес-процесу в Кабінеті посадової особи
.Example. Configuring access to the business process in the Officer portal
[source,yaml]
----
authorization:
  realm: 'officer'
  process_definitions:
    - process_definition_id: 'add-lab-test'
      process_name: 'Laboratory creation'
      process_description: 'Regulation for creating laboratories'
      roles:
        - officer
    - process_definition_id: 'add-lab'
      process_name: 'Laboratory creation'
      process_description: 'Regulation for creating laboratories'
      roles:
        - officer
----

[save-officer-yml]
//==== Збереження файлу з налаштуваннями доступу
==== Saving the access configuration file

//Збережіть файл _officer.yml_ до регламентної папки *_bp-auth_* проєкту в локальному Gerrit-репозиторії.
Save the _officer.yml_ file to the regulatory folder *_bp-auth_* of the project in the local Gerrit repository.

//== Завантаження файлів регламенту до віддаленого репозиторію Gerrit
== Uploading regulation files to the remote Gerrit repository

//Для успішного розгортання бізнес-процесу, форм, а також застосування правильних налаштувань доступу до бізнес-процесу у цільовому середовищі, адміністратор регламенту має завантажити збережені локально файли регламенту реєстру до віддаленого сховища коду Gerrit.
For successful deployment of the business process, forms, and applying the correct access settings to the business process in the target environment, the regulation administrator needs to upload the saved local regulation files to the remote Gerrit code repository.

//Для цього виконайте кроки з інструкції xref:registry-develop:registry-admin/regulations-deploy/registry-admin-deploy-regulation.adoc[].
To do this, follow the steps: xref:registry-develop:registry-admin/regulations-deploy/registry-admin-deploy-regulation.adoc[].

