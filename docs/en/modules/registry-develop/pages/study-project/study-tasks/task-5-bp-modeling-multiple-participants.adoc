= Task 5. Modeling a business process with multiple participants
include::ROOT:partial$templates/document-attributes/default-set-en.adoc[]

include::ROOT:partial$admonitions/language-en.adoc[]

//== Мета завдання
== Objective of the task

//Мета завдання: ::
The objective of the task is to: ::
//* [*] навчити моделювати бізнес-процес, що має декількох учасників.
* [*] Learn how to model a business process with multiple participants.
//* [*] навчити моделювати форми та налаштовувати їх за допомогою *formVariables*.
* [*] Learn how to model forms and customize them using *formVariables*.

//В рамках цього завдання моделювальники мають: ::
Within the scope of this task, the modelers are required to:

[%interactive]
//* [ ] змоделювати 1 бізнес-процес;
//* [ ] змоделювати 5 форм внесення даних до бізнес-процесу;
//* [ ] створити ролі, необхідні для функціонування у бізнес-процесі;
//* [ ] надати доступи до бізнес-процесу для відповідних ролей;
//* [ ] зберегти створені артефакти до локального git-репозиторію;
//* [ ] перенести локальні зміни до віддаленого Gerrit-репозиторію.
* [ ] Model 1 business process.
* [ ] Model 5 data entry forms for the business process.
* [ ] Create roles necessary for the functioning of the business process.
* [ ] Provide access to the business process for respective roles.
* [ ] Save the created artifacts to the local git repository.
* [ ] Transfer local changes to the remote Gerrit repository.

//== Передумови
== Prerequisites

//Перед проходженням завдання необхідно виконати наступні передумови:
Before proceeding with the task, the following prerequisites must be completed:

//. xref:bp-modeling/bp/element-templates/bp-element-templates-installation-configuration.adoc#business-process-modeler-extensions-installation[Встановіть додаток Camunda Modeler і типові розширення до нього].
//. xref:registry-develop:bp-modeling/forms/bp-modeling-forms-general-description.adoc[Ознайомтеся із компонентами FormIO для моделювання форм].
. xref:bp-modeling/bp/element-templates/bp-element-templates-installation-configuration.adoc#business-process-modeler-extensions-installation[Install the Camunda Modeler application and its standard extensions].
. xref:registry-develop:bp-modeling/forms/bp-modeling-forms-general-description.adoc[Familiarize yourself with the components of FormIO for form modeling].

//== Процес виконання завдання
== Task execution process

//=== Моделювання бізнес-процесу
=== Modeling the business process

[TIP]
====
//На етапі моделювання бізнес-процесу необхідно створити та зберегти відповідну BPMN-діаграму.
During the modeling phase of the business process, it is necessary to create and save the corresponding BPMN diagram.

//Використовуйте файл _link:{attachmentsdir}/study-project/task-3/bp-schema/citizen-add-lab.bpmn[citizen-add-lab.bpmn]_ із готовою схемою бізнес-процесу як приклад.
Use the file _link:{attachmentsdir}/study-project/task-5/bp-schema/citizen-add-lab.bpmn[citizen-add-lab.bpmn]_ with a ready-made business process schema as an example.
====

[checklist-bp-modeling]
//==== Чекліст моделювання бізнес-процесу
==== Business process modeling checklist

//Використовуйте наведений чекліст із переліком кроків для створення бізнес-процесу:
Use the provided checklist with a list of steps to create the business process:

[%interactive]
* [ ] xref:#create-pool-participant[]
* [ ] xref:#create-start-event[]
* [ ] xref:#create-script-task-prepare-data-view[]
* [ ] xref:#create-user-task-add-lab-data[]
* [ ] xref:#create-service-task-search-lab-data-transient-var[]
* [ ] xref:#create-xor-gateway[]
* [ ] xref:#create-branch-validation-error[]
* [ ] xref:#create-branch-continue-bp[]
* [ ] xref:#create-user-task-sign-lab-data[]
* [ ] xref:#create-service-task-get-users-officer-role[]
* [ ] xref:#create-user-task-set-executor-validate-docs[]
* [ ] xref:#create-script-task-prepare-doc-data-view[]
* [ ] xref:#create-user-task-check-uniqueness-lab-record[]
* [ ] xref:#create-xor-gw-lab-unique[]
* [ ] xref:#create-branch-negative-bp-result[]
* [ ] xref:#create-branch-continue-bp-1[]
* [ ] xref:#create-user-task-sign-lab-data[]
* [ ] xref:#create-script-task-prepare-data-record-transient-var[]
* [ ] xref:#create-call-activity-sign-data-by-system-key[]
* [ ] xref:#create-service-task-save-data-to-data-factory[]
* [ ] xref:#create-error-intermediate-boundary-event[]
* [ ] xref:#create-service-task-bp-result-lab-created[]
* [ ] xref:#create-end-event[]
* [ ] xref:#save-bp-schema[]

//CAUTION: *Важливо!* Після проходження всіх етапів, не забудьте зберегти змодельовану схему бізнес-процесу до відповідної папки з регламентом реєстру (_див. xref:#save-bp-schema[]_)
CAUTION: *Important!* After completing all the stages, do not forget to save the modeled business process schema to the respective folder with the registry regulations (_see xref:#save-bp-schema[]_).

[#create-pool-participant]
//==== Створення пулу для бізнес-процесу
==== Creating a pool for the business process

//Найперше, _змоделюйте пул для бізнес-процесу_. Для цього виконайте кроки, подані нижче:
First, _model a pool for the business process_. To do this, follow the steps below:

//NOTE: Моделювання діаграми бізнес-процесу має відбуватися в рамках елемента *Create Pool/Participant*.
NOTE: The modeling of the business process diagram should take place within the *Create Pool/Participant* element.


//. Відкрийте додаток *Camunda Modeler* та створіть нову діаграму BPMN. Для цього у лівому верхньому куті натисніть меню *File* -> *New File* -> *BPMN Diagram*:
. Open the *Camunda Modeler* application and create a new BPMN diagram. To do this, click on the menu *File* → *New File* → *BPMN Diagram* in the upper left corner:
+
image:registry-develop:bp-modeling/bp/modeling-instruction/bp-1.png[]
+
//. На панелі інструментів зліва знайдіть елемент *Create pool/Participant* та перетягніть його до панелі моделювання:
. On the left toolbar, find the element *Create pool/Participant* and drag it to the modeling panel:
+
image:registry-develop:bp-modeling/bp/modeling-instruction/bp-2.png[]
+
//. Заповніть наступні поля відповідними значеннями:
. Fill in the following fields with respective values:
+
//* у полі `Name` введіть значення `Створення лабораторії`;
//* у полі `Process id` вкажіть `citizen-add-lab`;
//* у полі `Process name` вкажіть `Процес створення лабораторії`:
* In the *Name* field, enter `Lab creation`;
* In the *Process id* field, specify `citizen-add-lab`;
* In the *Process name* field, enter `Lab creation process`.

+
image:study-project/task-5/task-5-bp-1.png[]

[#create-start-event]
//=== Створення початкової події
==== Creating the initial event

//_Створіть початкову подію_. Для цього виконайте наступні кроки:
_Create the initial event_. To do this, follow these steps:

//. На панелі інструментів, зліва, знайдіть елемент (коло) *CreateStartEvent* та перетягніть його до панелі моделювання:
. On the left toolbar, find the *CreateStartEvent* element (circle) and drag it to the modeling panel:
+
image::registry-develop:bp-modeling/bp/bp-keys/bp-keys-create-start-event.png[]
+
image::registry-develop:bp-modeling/bp/bp-keys/bp-keys-create-start-event-1.png[]
+
//. На панелі налаштувань справа заповніть наступні параметри відповідними значеннями:
. On the settings panel on the right, fill in the following parameters with respective values:
//** у полі `Name` введіть `Початок`;
//** у полі `Initiator` введіть `initiator`.
** In the *Name* field, enter `Start`;
** In the *Initiator* field, enter `initiator`.

+
image:study-project/task-5/task-5-bp-2.png[]

[#create-script-task-prepare-data-view]
//==== Створення задачі скриптування "Підготовка даних для показу"
=== Creating a script task "Prepare data for display"

//На цьому етапі необхідно _змоделювати задачу скриптування для підготовки даних до показу_. Для цього виконайте наступні кроки:
At this stage, it is necessary to _model a script task for preparing data for display_. To do this, follow these steps:

//. Оберіть коло із початковою подією, змодельованою на xref:#create-start-event[попередньому етапі], та приєднайте нову задачу, натиснувши іконку *Append Task*:
. Select the circle with the start event modeled on the xref:#create-start-event[previous stage] and attach a new task by clicking the *Append Task* icon:
+
image:study-project/task-5/task-5-bp-03.png[]
+
//. Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *Script Task* (Задача скриптування):
. Specify the task type by clicking the key icon and selecting *Script Task* from the menu:
+
image:study-project/task-5/task-5-bp-03-1.png[]
+
//. Виділіть додану задачу скриптування та налаштуйте наступні параметри:
. Highlight the added script task and configure the following parameters:
+
//* у полі `Id` вкажіть `convertSignFormDataToDataFactoryFormatActivity`;
//* у полі `Name` введіть `Підготовка даних для показу`;
//* у полі `Script Format` зазначте формат (мову) скриптування `groovy`;
//* у полі `Script type` вкажіть тип скрипту `InlineScript`;
//* у полі `Script` вставте безпосередньо groovy-скрипт:
* In the *Id* field, enter `convertSignFormDataToDataFactoryFormatActivity`;
* In the *Name* field, enter `Prepare data for display`;
* In the *Script Format* field, specify the format (language) of the script as `groovy`;
* In the *Script type* field, select `InlineScript`;
* In the *Script* field, insert the actual groovy script.
+
====
[%collapsible]
//.Натисніть, щоб розгорнути або згорнути
.Click to expand or collapse
=====
[source,groovy]
----
def cephData = [:]

cephData['edrpou'] = initiator().edrpou

execution.removeVariable('payload')
set_transient_variable('payload', S(cephData, 'application/json'))
----
=====
====
+
image:study-project/task-5/task-5-bp-3.png[]

[#create-user-task-add-lab-data]
//==== Створення користувацької задачі "Додати інформацію про лабораторію"
==== Creating a user task "Add laboratory information"

//На цьому етапі необхідно _змоделювати користувацьку задачу_ `Додати інформацію про лабораторію`.
At this stage, it is necessary to _model a user task_ `Add laboratory information` for data entry by the user. To do this, follow these steps:

//На прикладі xref:study-project/study-tasks/task-backup-restore-bp-modeling-with-integration.adoc#create-task-add-lab-data[Завдання 3] створіть користувацьку задачу, призначену для внесення даних користувачем. Для цього виконайте наступні кроки:
Using the example from xref:study-project/study-tasks/task-3-bp-modeling-with-integration.adoc#create-task-add-lab-data[Task 3], create a new user task for data entry by the user. To do this, follow these steps:

//. Оберіть прямокутник із задачею скриптування, змодельованою на xref:#create-script-task-prepare-data-view[попередньому етапі], та приєднайте нову задачу.
. Select the rectangle with the script task modeled on the xref:#create-script-task-prepare-data-view[previous stage] and attach a new task.
+
//. Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *User Task* (Користувацька задача).
. Specify the task type by clicking the key icon and selecting *User Task* from the menu.
+
//. На панелі налаштувань справа натисніть `Open Catalog`, оберіть шаблон *User Form* із каталогу та натисніть `Apply` для підтвердження.
. On the settings panel on the right, click *`Open Catalog`*, select the *User Form* template from the catalog, and click *`Apply`* to confirm.
+
//. На панелі налаштувань справа заповніть наступні поля:
. Fill in the following fields on the settings panel on the right:
+
//* у полі `Id` зазначте `addLabCitizenActivity`;
//* у полі `Name` введіть `Додати інформацію про лабораторію`;
//* у полі `Form key` введіть `citizen-add-lab-bp-add-lab`;
//* у полі `Assignee` вкажіть `${initiator}`;
//* у полі `Form data pre-population` вкажіть `${payload}`.
* In the *Id* field, specify `addLabCitizenActivity`;
* In the *Name* field, enter `Add laboratory information`;
* In the *Form key* field, enter `citizen-add-lab-bp-add-lab`;
* In the *Assignee* field, enter `${initiator}`;
* In the *Form data pre-population* field, enter `${payload}`.

+
image:study-project/task-5/task-5-bp-4.png[]

[#create-service-task-search-lab-data-transient-var]
//==== Створення сервісної задачі "Пошук даних про лабораторію (transient var)"
==== Creating a service task "Search for laboratory data (transient var)"

//На цьому етапі необхідно _створити сервісну задачу_ `Пошук даних про лабораторію (transient var)`.
At this stage, it is necessary to _create a service task_ `Search for laboratory data (transient var)` for searching laboratory data. To do this, follow these steps:

//На прикладі xref:study-project/study-tasks/task-backup-restore-bp-modeling-with-integration.adoc#create-service-task-search-lab-data[Завдання 3] змоделюйте сервісну задачу для пошуку даних про лабораторію. Для цього виконайте наступні кроки:
Using the example from xref:study-project/study-tasks/task-3-bp-modeling-with-integration.adoc#create-service-task-search-lab-data[Task 3] model a service task for searching for laboratory data. To do this, follow these steps:

//. Оберіть прямокутник із користувацькою задачею `Додати інформацію про лабораторію`, змодельованою на xref:#create-user-task-add-lab-data[попередньому етапі], та приєднайте нову задачу, натиснувши іконку *Append Task*.
. Select the rectangle with the user task `Add laboratory information` modeled in the xref:#create-user-task-add-lab-data[previous stage] and attach a new task by clicking the *Append Task* icon.
+
//. Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *Service Task* (Сервісна задача).
. Specify the task type by clicking the key icon and selecting *Service Task* from the menu.
+
//. На панелі налаштувань справа натисніть `Open Catalog`, оберіть шаблон *Search for entities in data factory* (Пошук значень у фабриці даних) та натисніть `Apply` для підтвердження.
. On the settings panel on the right, click *`Open Catalog`*, select the *Search for entities in data factory* template from the catalog, and click *`Apply`* to confirm.
+
//. На панелі налаштувань справа заповніть наступні поля:
. Fill in the following fields on the settings panel on the right:
+
//* у полі `Name` має бути вказано `Пошук даних про лабораторію (transient var)`;
* In the *Name* field, specify `Search for laboratory data (transient var)`;
//* у розділі *Input Parameters* -> *Resource* зазначте наступне:
* In the section *Input Parameters* → *Resource*, specify the following:
//** у полі `Variable Assignment Type` вкажіть `String or Expression`;
//** у полі `Variable Assignment Value` вкажіть `laboratory-equal-edrpou-name-count`;
** In the *Variable Assignment Type* field, select `String or Expression`;
** In the *Variable Assignment Value* field, specify `laboratory-equal-edrpou-name-count`.

+
image:study-project/task-5/task-5-bp-5.png[]

+
//* у розділі *Input Parameters* -> *Search Variables* вкажіть наступне:
* In the section *Input Parameters* → *Search Variables*, specify the following:
//** у полі `Variable Assignment type` вкажіть `Map`.
//** у полі `Add Entry` додайте параметри `name` та `edrpou`, натиснувши на позначку плюса (`+`) та вкажіть для них відповідні значення:
** In the *Variable Assignment Type* field, select *Map*.
** In the *Add Entry* section, add parameters `name` and `edrpou` (UA-specific) by clicking the plus (+) icon and provide their corresponding values as follows:
+
|===
|Key |Value

|`name` |`${submission('addLabCitizenActivity').formData.prop('name').value()}`

|`edrpou`
|`${submission('addLabCitizenActivity').formData.prop('edrpou').value()}`
|===
+
image:study-project/task-5/task-5-bp-6.png[]

+
//* у розділі *Input Parameters* -> *X-Access-Token* вкажіть наступне:
* In the section *Input Parameters* → *X-Access-Token*, specify the following:
//** у полі `Variable Assignment Type` вкажіть `String or Expression`;
//** у полі `Variable Assignment Value` вкажіть `${completer('addLabCitizenActivity').accessToken}`.
** In the *Variable Assignment Type* field, select `String or Expression`;
** In the *Variable Assignment Value* field, specify `${completer('addLabCitizenActivity').accessToken}`.
+
[WARNING]
====
//Після відпрацювання першої користувацької задачі (User Task), намагайтеся використовувати функцію *`completer('<task_id>')`* для отримання даних користувача, замість `initiator()`.
After completing the first user task, try to use the function *`completer('<task_id>')`* to obtain user data instead of `initiator()`.

//Токен доступу береться з АБО ініціатора (наприклад, `$initiator().accessToken}`), АБО виконавця останньої користувацької задачі (наприклад, `${completer('taskDefinitionId').accessToken}`).
The access token can be obtained either from the initiator (e.g.,`` $initiator().accessToken}``) or the executor of the last user task (e.g., `${completer('taskDefinitionId').accessToken}`).

//JWT-токен має свій термін дії, який триває 300 секунд. Якщо вказати токен ініціатора, який запустив бізнес-процес, а користувач довго не виконував задачу, то термін дії токена спливе, й бізнес-процес необхідно буде запускати повторно.
The JWT token has a validity period of 300 seconds. If you specify the initiator's token, who initiated the business process, and the user takes a long time to complete the task, the token's validity will expire, and the business process will need to be restarted.

//Детальніше про JUEL-функції ви можете переглянути на сторінці xref:registry-develop:bp-modeling/bp/modeling-facilitation/modelling-with-juel-functions.adoc[].
For more information about JUEL functions, you can refer to xref:registry-develop:bp-modeling/bp/modeling-facilitation/modelling-with-juel-functions.adoc[].
====
+
//* У розділі *Output Parameters* -> *Result Variable* параметр `Assign to Process Variable` заповніть значенням `response`:
* In the *Output Parameters* section -> *Result Variable*, fill in the parameter `Assign to Process Variable` with the value response:

+
image:study-project/task-5/task-5-bp-7.png[]

[#create-xor-gateway]
//==== Створення та заповнення XOR-шлюзу "Дані присутні?"
==== Creating and configuring an XOR gateway "Are data present?"

//На прикладі xref:study-project/study-tasks/task-backup-restore-bp-modeling-with-integration.adoc#create-xor-gateway[Завдання 3] приєднайте XOR-шлюз. Для цього виконайте кроки, подані нижче:
Using the example from xref:study-project/study-tasks/task-3-bp-modeling-with-integration.adoc#create-xor-gateway[Task 3] attach an XOR Gateway. Follow the steps below:

//. Оберіть прямокутник із сервісною задачею `Пошук даних про лабораторію (transient var)`, змодельованою на xref:#create-service-task-search-lab-data-transient-var[попередньому етапі], та приєднайте XOR-шлюз, натиснувши іконку *Append Gateway*.
. Select the rectangle with the service task `Search for laboratory data (transient var)` modeled on the xref:#create-service-task-search-lab-data-transient-var[previous stage] and attach an XOR Gateway by clicking the *Append Gateway* icon.
+
//. На панелі налаштувань справа, у полі `Name` вкажіть назву шлюзу -- `Дані присутні?`.
. On the settings panel on the right, in the *Name* field, enter the name of the gateway -- `Are Data Present?`

+
image:study-project/task-5/task-5-bp-8.png[]

[#create-branch-validation-error]
//==== Створення гілки з валідаційною помилкою
==== Creating a branch with a validation error

//На прикладі xref:study-project/study-tasks/task-backup-restore-bp-modeling-with-integration.adoc#create-validation-error-branch[Завдання 3] створіть гілку з валідаційною помилкою. Для цього виконайте кроки, подані нижче:
Using the example from xref:study-project/study-tasks/task-3-bp-modeling-with-integration.adoc#create-validation-error-branch[Task 3] create a branch with a validation error. Follow the steps below:

//. Оберіть ромб із XOR-шлюзом `Дані присутні?`, змодельованим на xref:#create-xor-gateway[попередньому етапі], та створіть нову сервісну задачу, натиснувши іконку *Append Task*.
. Select the diamond with the `Are Data Present?` XOR Gateway modeled in the previous stage and create a new service task by clicking the "Append Task" icon.
+
//. Визначте тип задачі, натиснувши іконку ключа та обравши з меню пункт *Service Task* (Сервісна задача).
. Specify the task type by clicking the key icon and selecting *Service Task* from the menu.
+
//. Натисніть `Open Catalog`, оберіть шаблон *Throw validation error* та натисніть `Apply` для підтвердження.
. Click *`Open Catalog`*, select the *Throw validation error* template, and click *`Apply`* to confirm.
+
//. На панелі налаштувань справа заповніть наступні поля:
. On the settings panel on the right, fill in the following fields:
+
//* у полі `Name` введіть `Формування валідаційної помилки`.
* In the *Name* field, enter `Generating a validation error`;
//* У розділі *Input Parameters* -> *Validation Errors* зазначте наступне:
* In the section *Input Parameters* → *Validation Errors*, specify the following:
//** у полі `Variable Assignment Type` вкажіть тип `List`;
//** для поля `Value` додайте наступне значення:
** In the *Variable Assignment Type* field, select `List`;
** For the *Value* field, add the following value:
+
.Значення
[source,json]
----
{"field": "name", "value": "${submission('addLabCitizenActivity').formData.prop('name').stringValue().replaceAll("\"", "\\\\\"")}", "message": "Data for this laboratory already exists"}
----

+
image:study-project/task-5/task-5-bp-9.png[]

+
//. На гілці, що прямує від шлюзу `Дані присутні?` до сервісної задачі `Формування валідаційної помилки`, потрібно налаштувати наступне:
. On the branch that goes from the `Are data present?` gateway to the `Generating a Validation Error` service task, you need to configure the following:
//** у полі `Name` введіть `так`;
//** у полі `Condition Type` введіть тип `Expression`;
//** у полі `Expression` введіть `${!response.value.responseBody.elements().isEmpty()}`.
** In the *Name* field, enter `yes`;
** In the *Condition Type* field, enter `Expression`;
** In the *Expression* field, enter `${!response.value.responseBody.elements().isEmpty()}`.

+
image:study-project/task-5/task-5-bp-10.png[]

[#create-branch-continue-bp]
//==== Створення гілки з подальшим продовженням бізнес-процесу
==== Creating a branch with continuing the business process

//На прикладі xref:registry-develop:study-project/study-tasks/task-backup-restore-bp-modeling-with-integration.adoc#create-continuation-of-bp-branch[Завдання 3] необхідно _створити гілку, що продовжить бізнес-процес_.
Using the example from xref:registry-develop:study-project/study-tasks/task-3-bp-modeling-with-integration.adoc#create-continuation-of-bp-branch[Task 3] _create a branch that continues the business process_.

//Для цього на гілці, що прямує від шлюзу `Дані присутні?` до користувацької задачі `Підписати дані про лабораторію` (_див. нижче xref:#create-user-task-lab-data-signing[]_) налаштуйте такі параметри:
To do this, on the branch that goes from the `Are data present?` gateway to the `Sign laboratory data` user task (_see xref:#create-user-task-lab-data-signing[]_), configure the following:

//. У полі `Id` лишіть значення за замовчуванням.
//. У полі `Name` вкажіть `ні`.
//. у полі `Condition Type` вкажіть `Expression`.
//. У полі `Expression` вкажіть `${response.value.responseBody.elements().isEmpty()}`.
. Leave the *Id* field with the default value.
. In the *Name* field, enter `No`.
. In the *Condition Type* field, enter `Expression`.
. In the *Expression* field, enter `${response.value.responseBody.elements().isEmpty()}`.

+
image:study-project/task-5/task-5-bp-11.png[]

[#create-user-task-lab-data-signing]
//==== Створення користувацької задачі для підпису даних
==== Creating a user task for data signing

//На прикладі xref:study-project/study-tasks/task-backup-restore-bp-modeling-with-integration.adoc#create-task-lab-data-signing[Завдання 3] необхідно _створити користувацьку задачу для підпису даних_. Для цього виконайте наступні кроки:
Using the example from xref:study-project/study-tasks/task-3-bp-modeling-with-integration.adoc#create-task-lab-data-signing[Task 3],_create a user task for data signing_. Follow these steps:

//. Визначте тип задачі, натиснувши іконку ключа та обравши з меню пункт *User Task* (Користувацька задача).
. Specify the task type by clicking the key icon and selecting *User Task* from the menu.
+
//. Натисніть `Open Catalog`, оберіть шаблон *Citizen Sign Task* та натисніть `Apply` для підтвердження.
. Click *`Open Catalog`*, select the *Citizen Sign Task* template, and click *`Apply`* to confirm.
+
//. На панелі налаштувань справа заповніть наступні поля:
. On the settings panel on the right, fill in the following fields:
+
//* у полі `Id` вкажіть `signLabCitizenActivity`;
//* у полі `Name` введіть `Підписати дані про лабораторію`;
//* у полі `Form key` введіть `shared-citizen-sign-lab`;
//* у полі `Assignee` вкажіть `${initiator}`;
//* у полі `Form data pre-population` введіть `${submission('addLabCitizenActivity').formData}`.
* In the *Id* field, enter `signLabCitizenActivity`;
* In the *Name* field, enter `Sign laboratory data`;
* In the **Form ke**y field, enter `shared-citizen-sign-lab`;
* In the *Assignee* field, enter `${initiator}`;
* In the *Form data pre-population* field, enter `${submission('addLabCitizenActivity').formData}`.
+
image:study-project/task-5/task-5-bp-12.png[]
+
//* поле `INDIVIDUAL` залиште у значенні `disabled` (за замовчуванням);
//* для поля `ENTREPRENEUR` оберіть значення `enabled`;
//* для поля `LEGAL` оберіть значення -- `enabled`.
* Leave the *INDIVIDUAL* field with the value `disabled` (default);
* For the *ENTREPRENEUR* field, choose the value `enabled`;
* For the *LEGAL* field, choose the value `enabled`.
+
image:study-project/task-5/task-5-bp-12-1.png[]


[#create-service-task-get-users-officer-role]
//==== Створення сервісної задачі "Отримання користувачів із роллю 'officer' "
==== Creating a service task "Get users with the  Officer role"

//На прикладі xref:#create-service-task-search-lab-data-transient-var[] необхідно _створити сервісну задачу для отримання користувачів із роллю "Посадова особа" із сервісу управління ідентифікацію та доступом Keycloak_. Для цього виконайте наступні кроки:
Using the example of xref:#create-service-task-search-lab-data-transient-var[], you need to _create a service task to get users with the role "Officer" from the Keycloak identity and access management service_. Follow these steps:

//. Оберіть прямокутник із користувацькою задачею `Підписати дані про лабораторію`, змодельованою на xref:#create-user-task-lab-data-signing[попередньому етапі], та приєднайте нову задачу, натиснувши іконку *Append Task*.
. Select the rectangle with the user task `Sign laboratory data` modeled on the xref:#create-user-task-lab-data-signing[previous stage], and attach a new service task by clicking the *Append Task* icon.
+
//. Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *Service Task* (Сервісна задача).
. Specify the task type by clicking the key icon and selecting *Service Task* from the menu.
+
//. На панелі налаштувань справа натисніть `Open Catalog`, оберіть шаблон *Get users by role from keycloak* (Отримання користувачів у Keycloak за роллю) та натисніть `Apply` для підтвердження.
. Click `Open Catalog`, select the *Get users by role from Keycloak* template, and click *`Apply`* to confirm.
+
//. На панелі налаштувань справа заповніть наступні поля:
. On the settings panel on the right, fill in the following fields:
+
//* у полі `Name` введіть `Отримання користувачів з роллю 'officer'`;
//* у полі `Result Variable` вкажіть `officerUsers`.
* In the *Name* field, enter `Get users with role 'officer'`;
* In the *Result Variable* field, enter `officerUsers`.

+
image:study-project/task-5/task-5-bp-13.png[]

[#create-user-task-set-executor-validate-docs]
//==== Створення користувацької задачі "Призначення виконавця задачі "Перевірка документів на відповідність"
==== Creating a user task "Assign a task executor for document validation"

//На прикладі xref:#create-user-task-lab-data-signing[] необхідно _створити користувацьку задачу, що дозволить призначати виконавця іншої задачі._ Для цього виконайте наступні кроки:
Using the example of xref:#create-user-task-lab-data-signing[], _create a new user task that allows assigning a executor for another task_. Follow these steps:

//. Оберіть прямокутник із користувацькою задачею `Отримання користувачів із роллю 'officer'`, змодельованою на xref:#create-service-task-get-users-officer-role[попередньому етапі], та приєднайте нову задачу, натиснувши іконку *Append Task*.
. Select the rectangle with the user task `Get users with role 'officer'` modeled on the xref:#create-service-task-get-users-officer-role[previous stage], and attach a new user task by clicking the *Append Task* icon.
+
//. Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *User Task* (Користувацька задача).
. Specify the task type by clicking the key icon and selecting *User Task* from the menu.
+
//. На панелі налаштувань справа натисніть `Open Catalog`, оберіть шаблон *User Form* та натисніть `Apply` для підтвердження.
. Click `Open Catalog`, select the *User Form* template, and click *`Apply`* to confirm.
+
//. На панелі налаштувань справа заповніть наступні поля:
. On the settings panel on the right, fill in the following fields:
+
//* у полі `Id` введіть `dispatchTaskActivity`;
//* у полі `Name` введіть `Призначення виконавця задачі "Перевірка документів на відповідність"`;
//* у полі `Form key` вкажіть `shared-dispatch-task`;
//* у полі `Assignee` вкажіть ${initiator};
//* у полі `Candidate roles` введіть значення `task-dispatcher` -- роль, для якої буде доступна ця задача;
//* у полі `Form variables` вкажіть `officerUsers` -- змінну, що буде передана на форму.
* In the *Id* field, enter `dispatchTaskActivity`;
* In the *Name* field, enter `Assign a task executor for document validation`;
* In the *Form key* field, enter `shared-dispatch-task`;
* In the *Assignee* field, enter `${initiator}`;
* In the *Candidate roles* field, enter `task-dispatcher` -- the role for which this task will be available;
* In the *Form variables* field, enter `officerUsers` -- the variable that will be passed to the form.

+
image:study-project/task-5/task-5-bp-14.png[]

[#create-script-task-prepare-doc-data-view]
//==== Створення задачі скриптування "Підготовка даних документа для показу"
==== Creating a script task "Prepare document data for display"

//На прикладі xref:#create-script-task-prepare-data-view[] _змоделюйте та приєднайте нову задачу скриптування_. Для цього виконайте наступні кроки:
Using the example of xref:#create-script-task-prepare-data-view[], _model and attach a new script task_. Follow these steps:

//. Оберіть прямокутник із користувацькою задачею, змодельованою на xref:#create-user-task-set-executor-validate-docs[попередньому етапі], та приєднайте нову задачу, натиснувши іконку *Append Task*.
. Select the rectangle with the user task modeled on the xref:#create-user-task-set-executor-validate-docs[previous stage], and attach a new script task by clicking the *Append Task* icon.
+
//. Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *Script Task* (Задача скриптування).
. Specify the task type by clicking the key icon and selecting *Script Task* from the menu.
+
//. Виділіть додану задачу скриптування та налаштуйте наступні параметри:
. On the settings panel on the right, fill in the following fields:
+
//* у полі `Name` вкажіть `Підготовка даних документа для показу`;
//* у полі `Script Format` вкажіть тип (мову) скриптування -- `groovy`;
//* у полі `Script Type` вкажіть тип скрипту `InlineScript`;
//* у полі `Script` вставте безпосередньо groovy-скрипт:
* In the *Name* field, enter `Prepare document data for display`;
* In the *Script Format* field, select the type (language) of the script -- `groovy`;
* In the *Script Type* field, select the type of the script -- `InlineScript`;
* In the *Script* field, insert the actual groovy script.
+
====
[%collapsible]
//.Натисніть, щоб розгорнути або згорнути
.Click to expand or collapse
=====
[source,groovy]
----
execution.removeVariable('officerAssignee')
set_variable('officerAssignee', submission('dispatchTaskActivity').formData.prop('userTaskAssignee').prop('userName').value())

----
=====
====

+
image:study-project/task-5/task-5-bp-15.png[]

[#create-user-task-check-uniqueness-lab-record]
//==== Створення користувацької задачі "Перевірка унікальности запису про лабораторію"
==== Creating a user task "Check the uniqueness of the laboratory record"

//На прикладі xref:#create-user-task-set-executor-validate-docs[] _створіть нову користувацьку задачу для перевірки унікальності запису про лабораторію_. Для цього виконайте кроки, подані нижче:
Using the example of xref:#create-user-task-set-executor-validate-docs[], _create a new user task to check the uniqueness of the laboratory record_. Follow these steps:

//. Оберіть прямокутник зі скрипт-задачею, змодельованою на xref:#create-script-task-prepare-doc-data-view[попередньому етапі], та приєднайте нову задачу, натиснувши іконку *Append Task*.
. Select the rectangle with the script task modeled in the previous stage, and attach a new user task by clicking the *Append Task* icon.
+
//. Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *User Task* (Користувацька задача).
. Specify the task type by clicking the key icon and selecting *User Task* from the menu.
+
//. На панелі налаштувань справа натисніть `Open Catalog`, оберіть шаблон *User Form* та натисніть `Apply` для підтвердження.
. Click `Open Catalog`, select the *User Form* template, and click *`Apply`* to confirm.
+
//. На панелі налаштувань справа заповніть наступні поля:
. On the settings panel on the right, fill in the following fields:
+
//* у полі `Id` введіть `checkLabOfficerActivity`;
//* у полі `Name` введіть `Перевірка унікальности запису про лабораторію`;
//* у полі `Form key` вкажіть `shared-officer-check-lab`;
//* у полі `Assignee` введіть `${officerAssignee}`;
//* у полі `Form data pre-population` вкажіть `${submission('signLabCitizenActivity').formData}`.
* In the *Id* field, enter `checkLabOfficerActivity`;
* In the *Name* field, enter `Check the uniqueness of the laboratory record`;
* In the *Form key* field, enter `shared-officer-check-lab`;
* In the *Assignee* field, enter `${officerAssignee`};
* In the *Form data pre-population* field, enter `${submission('signLabCitizenActivity').formData}`.

+
image:study-project/task-5/task-5-bp-16.png[]

[#create-xor-gw-lab-unique]
//==== Створення XOR-шлюзу "Лабораторія унікальна?"
==== Creating an XOR Gateway "Is the laboratory unique?"

//На прикладі xref:#create-xor-gateway[] змоделюйте та приєднайте новий XOR-шлюз. Для цього виконайте кроки, подані нижче:
Using the example of xref:#create-xor-gateway[], model and connect a new XOR gateway. Follow the steps below:

//. Оберіть прямокутник із користувацькою задачею, змодельованою на xref:#create-user-task-check-uniqueness-lab-record[попередньому етапі], та приєднайте XOR-шлюз, натиснувши іконку *Append Gateway*.
. Select the rectangle with the user task modeled on the xref:#create-user-task-check-uniqueness-lab-record[previous stage], and connect an XOR gateway by clicking the *Append Gateway* icon.
+
//. На панелі налаштувань справа, у полі `Name` вкажіть назву шлюзу -- `Лабораторія Унікальна? labUniqueCheckFlag`.
. On the right-hand settings panel, in the *Name* field, specify the gateway name as "Is the laboratory unique?" `labUniqueCheckFlag`.

image:study-project/task-5/task-5-bp-17.png[]


[#create-branch-negative-bp-result]
//==== Створення гілки із негативним результатом бізнес-процесу
==== Creating a branch with a negative business process outcome

//На прикладі xref:#create-branch-validation-error[] створіть нову гілку із негативним результатом бізнес-процесу. Для цього виконайте кроки, подані нижче:
Using the example of xref:#create-branch-validation-error[], create a new branch with a negative business process outcome. Follow the steps below:

//. Оберіть ромб із XOR-шлюзом `Лабораторія унікальна?`, змодельованим на xref:#create-xor-gw-lab-unique[попередньому етапі], та створіть нову сервісну задачу, натиснувши іконку *Append Task*.
. Select the diamond with the XOR gateway "Is the laboratory unique?" modeled on the xref:#create-xor-gw-lab-unique[previous stage], and create a new service task by clicking the *Append Task* icon.
+
//. Визначте тип задачі, натиснувши іконку ключа та обравши з меню пункт *Service Task* (Сервісна задача).
. Determine the task type by clicking the key icon and selecting *Service Task* from the menu.
+
//. Натисніть `Open Catalog`, оберіть шаблон *Define business process status* та натисніть `Apply` для підтвердження.
. Click `*Open Catalog*`, select the *Define business process status* template, and click *`Apply`* to confirm.
+
//. На панелі налаштувань справа заповніть наступні поля:
. On the right-hand settings panel, fill in the following fields:
+
//* у полі `Name` введіть значення `Результат виконання "Лабораторія не створена - Дублікат"`;
//* у полі `Status` введіть `Лабораторія не створена - Така лабораторія вже існує`.
* In the *Name* field, enter the value `"Execution result "Laboratory not created -- Duplicate"`;
* In the *Status* field, enter `"Laboratory not created -- Such a laboratory already exists"`.

+
image:study-project/task-5/task-5-bp-18.png[]
+
//. Виділіть гілку, що прямує до сервісної задачі `Результат виконання "Лабораторія не створена - Дублікат"` та налаштуйте такі параметри:
. Highlight the branch leading to the service task Execution result `"Laboratory not created -- Duplicate"` and configure the following parameters:
+
//* у полі `Name` введіть значення `ні`;
//* у полі `Condition Type` тип `Expression`;
//* у полі `Expression` вкажіть вираз `${!submission('checkLabOfficerActivity').formData.hasProp('labUniqueCheckFlag') || submission('checkLabOfficerActivity').formData.prop('labUniqueCheckFlag').value() == false}`.
* In the *Name* field, enter `No`;
* In the *Condition Type* field, select `Expression`;
* In the *Expression* field, enter the expression `${!submission('checkLabOfficerActivity').formData.hasProp('labUniqueCheckFlag') || submission('checkLabOfficerActivity').formData.prop('labUniqueCheckFlag').value() == false}`.

+
image:study-project/task-5/task-5-bp-19.png[]

[#create-branch-continue-bp-1]
//==== Створення гілки із подальшим продовженням бізнес-процесу
==== Creating a branch with further business process continuation

//На прикладі xref:#create-branch-continue-bp[] _створіть нову гілку для продовження процесу_.
Using the example of xref:#create-branch-continue-bp[], _create a new branch for continuing the process_.

//Для цього на гілці, що прямує від шлюзу `Лабораторія унікальна?` (_див. xref:#create-xor-gw-lab-unique[]_) до користувацької задачі `Підписати дані лабораторії` (_див. нижче xref:#create-user-task-sign-lab-data[]_) налаштуйте такі параметри:
To do this, on the branch leading from the XOR gateway `Is the laboratory unique?` (_see xref:#create-xor-gw-lab-unique[]_), to the user task `Sign laboratory data` (_see  xref:#create-user-task-sign-lab-data[]_) configure the following parameters:

//. У полі `Id` лишіть значення за замовчуванням.
//. У полі `Name` вкажіть `так`.
//. у полі `Condition Type` вкажіть `Expression`.
//. У полі `Expression` вкажіть вираз `${submission('checkLabOfficerActivity').formData.hasProp('labUniqueCheckFlag') && submission('checkLabOfficerActivity').formData.prop('labUniqueCheckFlag').value() == true}`.
. Leave the *Id* field with the default value.
. In the *Name* field, enter `Yes`.
. In the *Condition Type* field, select `Expression`.
. In the *Expression* field, enter the expression `${submission('checkLabOfficerActivity').formData.hasProp('labUniqueCheckFlag') && submission('checkLabOfficerActivity').formData.prop('labUniqueCheckFlag').value() == true}`.

image:study-project/task-5/task-5-bp-20.png[]

[#create-user-task-sign-lab-data]
//==== Створення користувацької задачі для підпису даних
==== Creating a user task for data signing

//Необхідно _створити користувацьку задачу для підпису даних_. Для цього виконайте наступні кроки:
It is necessary to _create a user task for data signing_. Follow these steps:

//. Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *User Task*.
. Specify the task type by clicking the key icon and selecting *User Task* from the menu.
+
//. На панелі налаштувань справа натисніть `Open Catalog`, оберіть шаблон *User Form* та натисніть `Apply` для підтвердження.
. On the right-hand settings panel, click *Open Catalog*, select the *User Form* template, and click *`Apply`* to confirm.
+
//. Заповніть наступні поля відповідними значеннями:
. Fill in the following fields with the appropriate values:
//* у полі `Id` вкажіть `signLabOfficerActivity`;
//* у полі `Name` введіть `Підписати дані лабораторії`;
//* у полі `Form key` введіть `shared-officer-sign-lab`;
//* у полі `Assignee` вкажіть `${officerAssignee}`;
//* у полі `Form data pre-population` введіть `${submission('checkLabOfficerActivity').formData}`.
* In the *Id* field, enter `signLabOfficerActivity`;
* In the *Name* field, enter `Sign laboratory data`;
* In the *Form key* field, enter `shared-officer-sign-lab`;
* In the *Assignee* field, enter `${officerAssignee}`;
* In the *Form data pre-population* field, enter `${submission('checkLabOfficerActivity').formData}`.

+
image:study-project/task-5/task-5-bp-21.png[]

[#create-script-task-prepare-data-record-transient-var]
//==== Створення задачі скриптування "Підготовка даних до запису (transient var)"
==== Creating a scripting task "Prepare data for recording (transient var)"

//Створіть нову задачу скриптування для підготовки даних до запису_. Для цього виконайте подальші налаштування:
Create a new scripting task to prepare data for recording. To do this, proceed with the following settings:

//. Оберіть прямокутник із користувацькою задачею, змодельованою на xref:#create-user-task-sign-lab-data[попередньому етапі], та приєднайте нову задачу, натиснувши іконку *Append Task*.
. Select the rectangle with the user task modeled on the xref:#create-user-task-sign-lab-data[previous stage], and attach a new task by clicking the *Append Task* icon.
+
//. Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *Script Task* (Задача скриптування).
. Specify the task type by clicking the key icon and selecting *Script Task* from the menu.
+
//. Виділіть додану задачу скриптування та налаштуйте наступні параметри:
. Highlight the added scripting task and configure the following parameters:
+
//* у полі `Name` вкажіть `Підготовка даних для запису (transient var)`;
//* у полі `Script Format` вкажіть тип (мову) скриптування -- `groovy`;
//* у полі `Script Type` вкажіть тип скрипту `InlineScript`;
//* у полі `Script` вставте безпосередньо groovy-скрипт:
* In the *Name* field, enter `Prepare data for recording (transient var)`;
* In the *Script Format* field, specify the scripting language as `groovy`;
* In the *Script Type* field, select the `InlineScript` script type;
* In the *Script* field, insert the groovy script directly:
+
====
[%collapsible]
//.Натисніть, щоб розгорнути або згорнути
.Click to expand or collapse
=====
[source,groovy]
----
def signedFormData = submission('signLabOfficerActivity').formData

signedFormData.prop('oblast', signedFormData.prop('oblast').prop('code'))

signedFormData.prop('koatuuId', signedFormData.prop('koatuu').prop('koatuuId'))
signedFormData.deleteProp('koatuu')
signedFormData.prop('ownershipId', signedFormData.prop('ownership').prop('ownershipId'))
signedFormData.deleteProp('ownership')

if(signedFormData.hasProp('premisesFile') && !signedFormData.prop('premisesFile').isNull() &&
!signedFormData.prop('premisesFile').elements().isEmpty()) {
signedFormData.prop('premisesFile', signedFormData.prop('premisesFile').elements()[0])
} else {
signedFormData.prop('premisesFile', null as String)
}

if(signedFormData.hasProp('accreditationFile') && !signedFormData.prop('accreditationFile').isNull() && !signedFormData.prop('accreditationFile').elements().isEmpty()) {
signedFormData.prop('accreditationFile', signedFormData.prop('accreditationFile').elements()[0])
} else {
signedFormData.prop('accreditationFile', null as String)
}


execution.removeVariable('dataPayload')
set_transient_variable('dataPayload', signedFormData)
----
=====
====

+
image:study-project/task-5/task-5-bp-22.png[]

[#create-call-activity-sign-data-by-system-key]
//==== Моделювання сервісної задачі для підпису даних системним ключем
==== Modeling a service task for data signing with system key

//Створіть сервісну задачу (Service Task) для підпису даних системним ключем та налаштуйте відповідне інтеграційне розширення. Для цього виконайте кроки, подані нижче:
Create a service task for data signing using a system key and configure the appropriate integration extension. Follow the steps below:

//. Оберіть прямокутник зі [.underline]#скриптовою задачею#, змодельованою на попередньому етапі, та приєднайте нову задачу, натиснувши іконку *Append Task*.
. Select the rectangle with the [.underline]#scripting task# created in the previous stage, and attach a new task by clicking the *Append Task* icon.
+
//. Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *Service Task*.
. Specify the task type by clicking the key icon and selecting *Service Task* from the menu.
+
//. На панелі налаштувань справа натисніть `*Open Catalog*`, щоб відкрити список доступних шаблонів делегатів.
. On the right-hand settings panel, click *Open Catalog* to open the list of available delegate templates.
+
image:study-project/task-5/task-5-bp-23.png[]
+
//. З отриманого переліку оберіть шаблон *System signature by DSO service*, який необхідно використовувати для підписання даних системним ключем.
. From the list received, select the *System signature by DSO service* template, which is required for data signing with a system key.
+
image:study-project/task-5/task-5-bp-24.png[]
+
//. На панелі налаштувань справа, відкрийте вкладку *General* та сконфігуруйте параметри делегата:
. On the right-hand settings panel, open the *General* tab and configure the delegate parameters as follows:
+
//* у полі `Name` вкажіть назву задачі -- "Підписати дані системним ключем";
//* у полі `Payload` передайте дані, на які треба накласти системний підпис -- ${dataPayload};
//•	у полі `X-Access-Token source` передайте токен доступу особи, яка наразі виконує задачу з ID `'signLabOfficerActivity'` -- `${completer('signLabOfficerActivity').accessToken}`;
* In the *Name* field, enter the task name as `Sign data with system key`;
* In the *Payload* field, provide the data to be digitally signed – `${dataPayload}`;
* In the *X-Access-Token source* field, provide the access token of the person currently executing the task with ID '`signLabOfficerActivity`' -- `${completer('signLabOfficerActivity').accessToken}`.
+
[WARNING]
====
//Після відпрацювання першої користувацької задачі (User Task), намагайтеся використовувати функцію *`completer('<task_id>')`* для отримання даних користувача, замість `initiator()`.
After the execution of the first user task, try to use the function `*completer*('<*task_id*>')` to obtain user data, instead of `initiator()`.

//Токен доступу береться з АБО ініціатора (наприклад, `$initiator().accessToken}`), АБО виконавця останньої користувацької задачі (наприклад, `${completer('taskDefinitionId').accessToken}`).
Access token is taken from either the initiator (e.g., `$initiator().accessToken} or the executor of the last user task (e.g., `${completer('taskDefinitionId').accessToken}`).

//JWT-токен має свій термін дії, який триває 300 секунд. Якщо вказати токен ініціатора, який запустив бізнес-процес, а користувач довго не виконував задачу, то термін дії токена спливе, й бізнес-процес необхідно буде запускати повторно.
JWT token has a validity period of 300 seconds. If you specify the token of the initiator who started the business process, and the user takes a long time to complete the task, the token's validity will expire, and the business process will need to be restarted.

//Детальніше про JUEL-функції ви можете переглянути на сторінці xref:registry-develop:bp-modeling/bp/modeling-facilitation/modelling-with-juel-functions.adoc[].
For more details on JUEL functions, you can refer to xref:registry-develop:bp-modeling/bp/modeling-facilitation/modelling-with-juel-functions.adoc[].
====
//•	у полі `Result variable` зазначте назву змінної, до якої запишеться цифровий підпис вказаних даних -- `system_signature_ceph_key`.
•	In the `Result variable` field, specify the variable name to store the digital signature of the provided data -- `system_signature_ceph_key`.

+
image:study-project/task-5/task-5-bp-24-1.png[]

[#create-service-task-save-data-to-data-factory]
//==== Створення сервісної задачі "Зберегти дані до Фабрики даних"
==== Creating a service task "Save data to data factory"

//На цьому кроці необхідно _створити та налаштувати нову сервісну задачу для збереження даних до Дата-фабрики_. Для цього виконайте кроки, зазначені нижче:
At this step, you need to _create and configure a new service task to save data to the Data Factory_. Follow the steps provided below:

//. Оберіть прямокутник зі створеною на xref:#create-call-activity-sign-data-by-system-key[попередньому етапі] задачею Call Activity та створіть нову сервісну задачу `Зберегти дані до Фабрики даних`, натиснувши іконку ключа та обравши з меню пункт *Service Task*.
. Select the rectangle with the Call Activity task created on the xref:#create-call-activity-sign-data-by-system-key[previous stage] and create a new service task `Save data to data factory` by clicking the key icon and selecting *Service Task* from the menu.
//. Натисніть `Open Catalog`, оберіть шаблон *Create entity in data factory* та натисніть `Apply` для підтвердження.
. Click *`Open Catalog`*, select the C**reate entity in data factory** template, and click *`Apply`* to confirm.
+
//. На панелі налаштувань справа сконфігуруйте наступні параметри:
. On the right-hand settings panel, configure the following parameters:
+
//* у полі `Name` введіть `Зберегти дані до Фабрики даних`;
//* у полі `Resource` вкажіть `laboratory`;
//* у полі `Payload` введіть `${dataPayload}`;
//* у полі `X-Access-Token` введіть `${completer('signLabOfficerActivity').accessToken}`;
* In the *Name* field, enter `Save data to data factory`;
* In the *Resource* field, specify `laboratory`;
* In the *Payload* field, enter `${dataPayload}`;
* In the *X-Access-Token* field, enter `${completer('signLabOfficerActivity').accessToken}`.
+
[WARNING]
====
//Після відпрацювання першої користувацької задачі (User Task), намагайтеся використовувати функцію *`completer('<task_id>')`* для отримання даних користувача, замість `initiator()`.
After the execution of the first user task, try to use the function *`completer('<task_id>')`* to obtain user data, instead of `initiator()`.

//Токен доступу береться з АБО ініціатора (наприклад, `$initiator().accessToken}`), АБО виконавця останньої користувацької задачі (наприклад, `${completer('taskDefinitionId').accessToken}`).
Access token is taken from either the initiator (e.g., `$initiator().accessToken}`) or the executor of the last user task (e.g., `${completer('taskDefinitionId').accessToken}`).

//JWT-токен має свій термін дії, який триває 300 секунд. Якщо вказати токен ініціатора, який запустив бізнес-процес, а користувач довго не виконував задачу, то термін дії токена спливе, й бізнес-процес необхідно буде запускати повторно.
JWT token has a validity period of 300 seconds. If you specify the token of the initiator who started the business process, and the user takes a long time to complete the task, the token's validity will expire, and the business process will need to be restarted.

//Детальніше про JUEL-функції ви можете переглянути на сторінці xref:registry-develop:bp-modeling/bp/modeling-facilitation/modelling-with-juel-functions.adoc[].
For more details on JUEL functions, you can refer to xref:registry-develop:bp-modeling/bp/modeling-facilitation/modelling-with-juel-functions.adoc[].
====
//* у полі `X-Digital-Signature source` введіть `${sign_submission('signLabOfficerActivity').signatureDocumentId}`;
//* у полі `X-Digital-Signature-Derived source` введіть `${system_signature_ceph_key}`;
//* у полі `Result Variable` вкажіть `response`.
* In the *X-Digital-Signature source* field, enter `${sign_submission('signLabOfficerActivity').signatureDocumentId}`;
* In the *X-Digital-Signature-Derived source* field, enter `${system_signature_ceph_key}`;
* In the *Result Variable* field, enter `response`.

+
image:study-project/task-5/task-5-bp-25.png[]

[#create-error-intermediate-boundary-event]
//==== Створення події для опрацювання помилки
==== Creating an event for handling errors

//На цьому етапі необхідно змоделювати та налаштувати проміжну граничну подію для опрацювання сценарію із виникненням передбачених помилок. Для цього виконайте кроки, подані нижче:
At this stage, you need to model and configure an intermediate boundary event for handling scenarios with anticipated errors. Follow the steps below:

//. Перетягніть *Intermediate/Boundary event* з панелі інструментів та прикріпіть його до *Service Task* "Зберегти дані в Дата-фабрику".
. Drag an *Intermediate/Boundary event* from the toolbar and attach it to the *Save data to data factory* Service Task.
+
image:study-project/task-5/task-5-bp-error-boundary-branch-1.png[]
+
//. Визначте тип події як *Error Boundary Event* (Проміжна гранична подія "Помилка").
. Define the event type as an *Error Boundary Event* (Intermediate boundary event "Error")
+
image:study-project/task-5/task-5-bp-error-boundary-branch-2.png[]
+
//. Створіть *Gateway* (шлюз), який буде виконувати роль контрольної точки для перенаправлення у випадку виникнення помилки.
. Create a *Gateway* that will act as a checkpoint for redirection in case of an error.
+
image:study-project/task-5/task-5-bp-error-boundary-branch-3.png[]
+
//. Додайте логіку опрацювання помилки за допомогою з'єднання *Error Boundary Event* та *Gateway*.
. Add error handling logic by connecting the *Error Boundary Event* and the *Gateway*.
+
[TIP]
//Це буде означати, що при виникненні помилки на етапі "Збереження даних в Дата-фабрику" ми автоматично повернемося до контрольної точки, звідки заново почнеться виконання процесу.
This means that if an error occurs during the *Save data to data factory* stage, we will automatically return to the checkpoint, from where the process execution will restart.
+
image:study-project/task-5/task-5-bp-error-boundary-branch-4.png[]

[NOTE]
//Компоненти моделювання "Дата Фабрика" та усі пунктирні лінії носять [.underline]#виключно інформаційний характер#.
//Прикладу їх створення в інструкції немає, але можете додати їх самостійно за бажанням.
Modeling components related to "Data factory" and all dashed lines are purely informational. The instructions do not include an example of their creation, but you can add them according to your preferences.

[#create-service-task-bp-result-lab-created]
//==== Створення сервісної задачі для встановлення результату бізнес-процесу
==== Creating a service task to set business process result

//На прикладі xref:study-project/study-tasks/task-backup-restore-bp-modeling-with-integration.adoc#create-service-task-create-entity-end[Завдання 3] _змоделюйте нову сервісну задачу, що встановлюватиме результат бізнес-процесу_. Для цього виконайте кроки, подані нижче:
Using xref:study-project/study-tasks/task-3-bp-modeling-with-integration.adoc#create-service-task-create-entity-end[Task 3] as an example, model a new service task that will set the result of the business process. Follow the steps below:

//. Оберіть прямокутник із сервісною задачею, створеною на xref:#create-service-task-save-data-to-data-factory[попередньому етапі], та приєднайте нову задачу, натиснувши іконку *Append Task*.
. Select the rectangle with the service task created on the xref:#create-service-task-save-data-to-data-factory[previous stage], and attach a new task by clicking the *Append Task* icon.
+
//. Визначте тип задачі, натиснувши іконку ключа та обравши з меню пункт *Service Task*.
. Specify the task type by clicking the key icon and selecting *Service Task* from the menu.
//. Натисніть `Open Catalog`, оберіть шаблон *Define business process status* та натисніть `Apply` для підтвердження.
. Click `Open Catalog`, select the *Define business process status* template, and click *`Apply`* to confirm.
//. На панелі налаштувань справа сконфігуруйте наступні параметри:
. On the right-hand settings panel, configure the following parameters:
+
//* у полі `Name` вкажіть `Результат виконання "Лабораторія створена"`;
//* у полі `Status` вкажіть `Лабораторія створена`.
* In the *Name* field, enter `Process result: Laboratory created`;
* In the *Status* field, enter `Laboratory created`.

+
image:study-project/task-5/task-5-bp-26.png[]

[#create-end-event]
//==== Створення події завершення бізнес-процесу
==== Creating an end event for business process completion

//На цьому етапі необхідно _створити подію, яка завершуватиме бізнес-процес_.
At this stage, create an event that will _mark the completion of the business process_.

//. На прикладі xref:study-project/study-tasks/task-backup-restore-bp-modeling-with-integration.adoc#create-task-entity-finish[Завдання 3] приєднайте та налаштуйте подію завершення бізнес-процесу.
. Using xref:study-project/study-tasks/task-3-bp-modeling-with-integration.adoc#create-task-entity-finish[Task 3] as an example, attach and configure the end event for the business process.
+
//. На панелі налаштувань справа для параметра `Name` вкажіть значення `Лабораторія створена`.
. On the right-hand settings panel, set the `Name` parameter to `Laboratory created`.

+
image:registry-develop:study-project/task-3/task-3-26-bp.png[]

//TIP: В результаті маємо змодельований бізнес-процес для використання декількома учасниками та з викликом зовнішнього підпроцесу Call Activity.
TIP: As a result, we have modeled a business process for use by multiple participants, including the invocation of an external subprocess (Call Activity).


[#save-bp-schema]
//==== Збереження змодельованої схеми бізнес-процесу
==== Saving the modeled business process diagram

//Після завершення процесу моделювання збережіть отриману схему бізнес-процесу із назвою _citizen-add-lab.bpmn_ до регламентної папки *_bpmn_* проєкту в Gerrit-репозиторії. Для цього у лівому верхньому куті відкрийте меню `*File* > *Save File As..*`, введіть відповідну назву та шлях.
After completing the modeling process, save the resulting business process diagram with the name _citizen-add-lab.bpmn_ to the *_bpmn_* project's regulatory folder in the Gerrit repository. To do this, in the top-left corner, open the *File* menu > *Save File As...*, enter the appropriate name and path.

[#form-modeling]
//=== Моделювання UI-форм для бізнес-процесу
=== Modeling UI forms for the business process

[TIP]
====
//На етапі моделювання форм необхідно створити та прив'язати JSON-форми до попередньо змодельованих задач в рамках бізнес-процесу.
During the form modeling phase, create and link JSON forms to the previously modeled tasks within the business process.

//Форми прив'язуються до бізнес-процесів за службовою назвою.
Forms are linked to business processes by their service name.

//Використовуйте файли
Use the files
_link:{attachmentsdir}/study-project/task-5/bp-forms/shared-officer-sign-lab.json[shared-officer-sign-lab.json]_,
_link:{attachmentsdir}/study-project/task-5/bp-forms/shared-officer-check-lab.json[shared-officer-check-lab.json]_, _link:{attachmentsdir}/study-project/task-5/bp-forms/shared-dispatch-task.json[shared-dispatch-task.json]_, _link:{attachmentsdir}/study-project/task-5/bp-forms/shared-citizen-sign-lab.json[shared-citizen-sign-lab.json]_, _link:{attachmentsdir}/study-project/task-5/bp-forms/citizen-add-lab-bp-add-lab.json[citizen-add-lab-bp-add-lab.json]_
//зі змодельованими формами для прикладу.
with the modeled forms as an example.
====

[checklist-form-modeling]
//==== Чекліст моделювання UI-форм
==== Checklist of the UI forms modeling

//Використовуйте наведений чекліст із переліком кроків для створення форм: ::
Use the provided checklist with a list of steps to create forms: ::
+
[%interactive]
* [ ] xref:#form-insert-data[]
* [ ] xref:#form-sign-data-by-citizen[]
* [ ] xref:#form-dispatch-task[]
* [ ] xref:#form-check-data-by-officer[]
* [ ] xref:#form-officer-sign-data[]
* [ ] xref:#form-save[]

//CAUTION: Після проходження всіх етапів, завантажте та збережіть файли зі схемами форм до відповідної папки з регламентом реєстру (_див. xref:#form-save[]_)
CAUTION: After completing all stages, upload and save the form schema files to the corresponding folder with the registry regulations (_see xref:#form-save[]_).

[#form-insert-data]
//==== Створення форми для внесення даних
==== Creating a form for data entry

//TIP: Змоделюйте форму для внесення даних користувачем, використовуючи приклад із xref:study-project/study-tasks/task-backup-restore-bp-modeling-with-integration.adoc#form-insert-data[Завдання 3].
TIP: Model a form for data entry by the user, using the example from xref:study-project/study-tasks/task-3-bp-modeling-with-integration.adoc#form-insert-data[Task 3].

//. Увійдіть до застосунку [.underline]#Кабінет адміністратора регламентів#.
. Log in to the [.underline]#Regulations administrator portal#.
+
image::registry-develop:bp-modeling/forms/admin-portal-form-modeling-step-1.png[]
+
//За замовчуванням користувач опиняється на домашній сторінці [.underline]#Огляд версії# майстер-версії регламенту.
By default, the user lands on the home page of the [.underline]#Version overview# of regulations master data.
+
image:registry-admin/admin-portal/new-admin-portal-1.png[]
+
[TIP]
====
//Детальніше про майстер-версію регламенту ви можете переглянути за посиланням:
For more details about the version of regulations master data, you can refer to the following link:

* xref:registry-develop:registry-admin/admin-portal/version-control/master-version-settings.adoc[]
====
+
[WARNING]
====
//Майстер-версія змін до регламенту реєстру дозволяє працювати з UI-формами лише у режимі перегляду.
The master version of changes to the registry regulations allows working with UI forms only in preview mode.

//Для того, щоб створювати, або редагувати будь-які сутності регламенту (форми, бізнес-процеси тощо), а також їх складові, необхідно створити нову версію-кандидат на внесення змін до регламенту реєстру і працювати в ній.
To create or edit any entities of the regulations (forms, business processes, etc.) and their components, you need to create a new candidate version for changes to the regulations master data and work within it.
====
+
//. Створіть новий запит на внесення змін до регламенту, тобто створіть нову версію-кандидат на внесення змін.
. Create a new change request for the regulations master data, which means creating a new candidate version for changes.
+
image:registry-develop:study-project/task-5/task-5-forms-new-change-request.png[]
+
//АБО
OR
+
//Оберіть наявну версію-кандидат на внесення змін.
Select an existing candidate version for changes.
+
image:registry-develop:study-project/task-5/task-5-forms-new-change-request-1.png[]
+
[TIP]
====
//Детальніше про створення та перегляд запитів на внесення змін до регламенту ви можете переглянути за посиланнями:
For more details about creating and viewing change requests for the regulations master data, you can refer to the following links:

* xref:registry-develop:registry-admin/admin-portal/version-control/create-new-change-request.adoc[]
* xref:registry-develop:registry-admin/admin-portal/version-control/overview-new-change-request.adoc[]
====
+
//. В рамках своєї версії-кандидата перейдіть до розділу [.underline]#UI-форми#.
. Within your candidate version, navigate to the [.underline]#UI forms# section.

+
image:registry-develop:study-project/task-5/task-5-forms-overview.png[]
+
//. Скопіюйте форму xref:study-project/study-tasks/task-backup-restore-bp-modeling-with-integration.adoc#form-insert-data[ add-lab-bp-add-lab], змодельовану в рамках Завдання 3, натиснувши _іконку копіювання_ -- це дозволить створити форму із готового шаблону.
. Copy the xref:study-project/study-tasks/task-3-bp-modeling-with-integration.adoc#form-insert-data[ add-lab-bp-add-lab] form modeled in Task 3 by clicking the _copy icon_ -- this will allow you to create a form from an existing template.

+
image:registry-develop:study-project/task-3/task-3-49-forms.png[]
+
//. У новому вікні, на вкладці [.underline]#Загальна# введіть бізнес-назву форми -- `Внести дані про лабораторію`. Назва відповідає бізнес-назві змодельованої користувацької задачі xref:#create-user-task-add-lab-data[`addLabCitizenActivity`].
. In the new window, on the [.underline]#General# tab, enter the business name of the form as `Enter laboratory data`. The name corresponds to the business name of the modeled user task xref:#create-user-task-add-lab-data[`addLabCitizenActivity`].
//. Заповніть поле `Службова назва форми` значенням `citizen-add-lab-bp-add-lab` (відповідає значенню поля `Form key` тієї ж користувацької задачі xref:#create-user-task-add-lab-data[`addLabCitizenActivity`]);
. Fill in the *Form's service name* field with the value `citizen-add-lab-bp-add-lab` (corresponds to the *Form Key* field value of the same user task xref:#create-user-task-add-lab-data[`addLabCitizenActivity`]).

+
image:study-project/task-5/task-5-forms-2.png[]
+
//. Перейдіть на вкладку [.underline]#Конструктор#.
. Navigate to the [.underline]#Constructor# tab.
+
//* У компонентах "Область", "Назва населеного пункту", та "Форма власності", на вкладці *Data* у полі `Data Source type URL` видаліть `/officer`.
* For the "Region", "Settlement Name", and "Ownership Form" components, on the *Data* tab, in the *Data Source Type URL* field, remove `/officer`.

+
image:study-project/task-5/task-5-forms-2-1.png[]

+
//* Переконайтеся, що остаточний вигляд компонентів є наступним:
* Ensure that the final data source configurations for the components are as follows:
+
//** компонент [.underline]#"Область"# -- `/api/data-factory/koatuu-obl-contains-name`;
** The [.underline]#"Region"# component -- `/api/data-factory/koatuu-obl-contains-name`;
//** компонент [.underline]#"Назва населеного пункту"# -- `/api/data-factory/koatuu-np-starts-with-name-by-obl`;
** The [.underline]#"Settlement Name"# component -- `/api/data-factory/koatuu-np-starts-with-name-by-obl`;
** компонент [.underline]#"Форма власності"# -- `/api/data-factory/ownership-contains-name`.
** The [.underline]#"Ownership Form"# component -- `/api/data-factory/ownership-contains-name`.
+
//. Збережіть форму, натиснувши кнопку `Зберегти зміни` у правому верхньому куті.
. Save the form by clicking the *`Save changes`* button in the top-right corner.

+
image:study-project/task-5/task-5-forms-3.png[]

[#form-sign-data-by-citizen]
//==== Моделювання форми підпису даних отримувачем послуг реєстру
==== Citizen's signature form modeling

//Після завершення xref:#form-insert-data[попереднього етапу] зі створенням форми для внесення даних, _створіть ще одну форму -- для підпису даних_.
After completing the xref:#form-insert-data[previous stage] of creating a data input form, create another form specifically for data signature.

//TIP: Змоделюйте форму для внесення даних користувачем, використовуючи приклад із xref:study-project/study-tasks/task-backup-restore-bp-modeling-with-integration.adoc#form-data-signing[Завдання 3].
TIP: Model a form for user input using the example from ref:study-project/study-tasks/task-3-bp-modeling-with-integration.adoc#form-data-signing[Task 3].

//. Скопіюйте xref:#form-insert-data[UI-форму для внесення даних про лабораторію], натиснувши _іконку копіювання_ -- це дозволить створити форму із готового шаблону.
. Copy the xref:#form-insert-data[UI form for laboratory data] input by clicking on the copy icon -- this will allow you to create a form from a ready-made template.
+
//. Увійдіть до режиму редагування форми та перейдіть на вкладку [.underline]#Загальна#.
. Enter the form editing mode and switch to the [.underline]#General# tab.
+
//. У полі `Бізнес-назва форми` введіть назву відповідної користувацької задачі xref:#create-user-task-lab-data-signing[`Підписати дані про лабораторію` (`signLabCitizenActivity`)];
. In the *Form business name* field, enter the name of the corresponding user task: xref:#create-user-task-lab-data-signing[signLabCitizenActivity].
//. Заповніть поле `Службова назва форми` значенням `shared-citizen-sign-lab` (відповідає значенню поля `Form key` тієї ж користувацької задачі
. Fill in the *Form Key* field with the value `shared-citizen-sign-lab` (corresponds to the Form key field value of the same user task).

+
image:study-project/task-5/task-5-forms-4.png[]
+
//. Перейдіть на вкладку [.underline]#Конструктор# та у налаштуваннях кожного компонента виконайте наступне:
. Switch to the [.underline]#Builder# tab and perform the following settings for each component:
+
//* На вкладці *Display* встановіть прапорець для параметра *Disabled*.
//* Натисніть кнопку `Save` для збереження змін.
* On the *Display* tab, check the *Disabled* parameter.
* Click the *Save* button to save the changes.
+
image:study-project/task-5/task-5-forms-4-01.png[]
+
image:registry-develop:study-project/task-3/task-3-50-forms.png[]
+
//. Перейдіть на вкладку [.underline]#Перегляд#. Тут ви можете побачити, як виглядатиме форма в інтерфейсі користувачів. Усі поля є неактивними.
. Switch to the [.underline]#Preview# tab. Here you can see how the form will appear in the user interface. All fields are inactive.
+
image:study-project/task-5/task-5-forms-4-1.png[]
+
//. Збережіть форму, натиснувши кнопку `Зберегти зміни` у правому верхньому куті.
. Save the form by clicking the *Save changes* button in the upper right corner.

//=== Моделювання форм за допомогою formVariables
=== Modeling forms using formVariables

[#form-dispatch-task]
//==== Моделювання форми призначення виконавця задачі
==== Task executor assignment form modeling

//CAUTION: Продовжуйте моделювання форм в рамках тієї ж версії-кандидата на внесення змін, що була створена у xref:#form-insert-data[попередньому розділі].
CAUTION: Continue modeling forms within the same candidate version for changes that was created in the ref:#form-insert-data[previous section].

//. В рамках своєї версії-кандидата перейдіть до розділу [.underline]#UI-форми#.
. Within your candidate version, navigate to the [.underline]#UI Forms# section.

+
image:registry-develop:study-project/task-5/task-5-forms-overview.png[]
+
//. Щоб створити нову форму для бізнес-процесу, натисніть кнопку `Створити нову форму`:
. To create a new form for the business process, click the *Create new form* button:

+
image:registry-develop:study-project/task-5/task-5-forms-overview-1.png[]
+
//* У новому вікні, у полі `Бізнес-назва форми` вкажіть назву, що відповідає назві змодельованої користувацької задачі -- xref:#create-user-task-set-executor-validate-docs[`Призначення виконавця задачі` (`dispatchTaskActivity`)].
* In the new window, enter a *Business form name* that corresponds to the name of the modeled user task -- xref:#create-user-task-set-executor-validate-docs[Assign task executor (dispatchTaskActivity)].
//* Заповніть поле `Службова назва форми` значенням `shared-dispatch-task` (має відповідати значенню поля `Form key` тієї ж користувацької задачі xref:#create-user-task-set-executor-validate-docs[`Призначення виконавця задачі` (`dispatchTaskActivity`)].
* Fill in the *Form's service name* field with the value `shared-dispatch-task` (matching the *Form key* field value of the user task xref:#create-user-task-set-executor-validate-docs[`Assign task executor` (`dispatchTaskActivity`)].

+
image:study-project/task-5/task-5-forms-5.png[]
+
//. Перейдіть на вкладку [.underline]#Конструктор# та виконайте моделювання форми за допомогою компонентів.
. Switch to the [.underline]#Builder# tab and model the form using components.
+
image:study-project/task-5/task-5-forms-5-1.png[]
+
//. З панелі компонентів зліва перетягніть компонент *Select* до панелі моделювання та виконайте подальші налаштування компонента:
. Drag and drop the *Select* component from the component panel on the left to the modeling panel and proceed with further configuration of the component:
+
image:study-project/task-3/task-3-37-forms-drag-select.png[]
+
//* Перейдіть на вкладку *Display* та заповніть поле `Label` значенням `Оберіть ПІБ виконавця`:
* Switch to the *Display* tab and fill in the *Label* field with the value `Choose executor's full name`:

+
image:study-project/task-5/task-5-forms-6.png[]

+
//* Перейдіть на вкладку *API* та заповніть поле `Property Name` значенням `userTaskAssignee`:
* Switch to the *API* tab and fill in the `Property Name` field with `userTaskAssignee`:

+
image:study-project/task-5/task-5-forms-7.png[]

+
//* Перейдіть на вкладку *Data* та налаштуйте наступні параметри:
* Switch to the *Data* tab and configure the following parameters:
//** у полі `Data source type` введіть `Custom`;
//** у полі `Id Path` вкажіть `userName`;
//** у полі `Custom Values` вкажіть `values = formVariables.officerUsers`;
//** у полі `Item Template` введіть `<span>{{ item.fullName }}</span>`.
** In the *Data source type* field, enter `Custom`;
** In the *Id Path* field, enter `userName`;
** In the *Custom Values* field, enter `values = formVariables.officerUsers`;
** In the *Item Template* field, enter `<span>{{ item.fullName }}</span>`.
+
//* Натисніть кнопку `Save` для збереження.
* Click the *Save* button to save the changes.
+
image:study-project/task-5/task-5-forms-8.png[]
+
//. Збережіть форму, натиснувши кнопку `Створити форму` у правому верхньому куті:
. Save the form by clicking the *Create form* button in the upper right corner:
+
image:study-project/task-5/task-5-forms-9.png[]

[#form-check-data-by-officer]
//==== Моделювання форми перевірки даних посадовою особою
==== Data validation form modeling by officer

//Змоделюйте форму для можливості перевірки даних посадовою особою. Для цього виконайте наступні кроки:
Model a form for data validation by an officer. To do this, follow these steps:

//. Скопіюйте форму xref:#form-dispatch-task[Призначення виконавця задачі], змодельовану вище, натиснувши _іконку копіювання_ -- це дозволить створити форму із готового шаблону:
. Copy the xref:#form-dispatch-task[Assign task executor] form modeled above by clicking the _copy icon_ -- this will allow you to create a form from a ready-made template:
+
//* У новому вікні відкрийте вкладку [.underline]#Загальна#.
* In the new window, open the [.underline]#General# tab.
+
//* У полі `Бізнес-назва форми` введіть назву `Перевірка унікальності запису про лабораторію`, що відповідає назві користувацької задачі xref:#create-user-task-check-uniqueness-lab-record[`checkLabOfficerActivity`].
* In the *Business form name* field, enter the name `Unique laboratory record check`, corresponding to the name of the user task xref:#create-user-task-check-uniqueness-lab-record[`checkLabOfficerActivity`].
+
//* Заповніть поле `Службова назва форми` значенням `shared-officer-check-lab` (має відповідати значенню поля `Form key` тієї ж користувацької задачі -- xref:#create-user-task-check-uniqueness-lab-record[`checkLabOfficerActivity`].
* Fill in the *Form's service name* field with the value `shared-officer-check-lab` (matching the *Form key* field value of the user task xref:#create-user-task-check-uniqueness-lab-record[checkLabOfficerActivity]).
+
image:study-project/task-5/task-5-forms-10.png[]
+
//. Перейдіть на вкладку [.underline]#Конструктор# виконайте моделювання форми за допомогою компонентів.
. Switch to the [.underline]#Builder# tab and model the form using components.
+
//. З панелі компонентів зліва перетягніть компонент *Checkbox* до панелі моделювання та виконайте подальші налаштування:
. Drag and drop the *Checkbox* component from the component panel on the left to the modeling panel and proceed with further configuration:
+
//* Перейдіть на вкладку *Display* та заповніть поле `Label` значенням `Лабораторія не дублюється`:
* Switch to the *Display* tab and fill in the *Label* field with the value `Laboratory is not duplicated`:
+
image:study-project/task-5/task-5-forms-11.png[]
+
//* Перейдіть на вкладку *API* та заповніть поле `Property Name` значенням `labUniqueCheckFlag`.
* Switch to the *API* tab and fill in the *Property Name* field with `labUniqueCheckFlag`.
//* Натисніть кнопку `Save` для збереження змін:
* Click the *Save* button to save the changes:
+
image:study-project/task-5/task-5-forms-12.png[]
+
//. Збережіть форму, натиснувши кнопку `Створити форму` у правому верхньому куті:
. Save the form by clicking the *Create form* button in the upper right corner:
+
image:study-project/task-5/task-5-forms-13.png[]

[#form-officer-sign-data]
//==== Моделювання форми підпису даних посадовою особою
==== Modeling a form for data signing by an officer

//Змоделюйте форму для можливості підпису даних посадовою особою. Для цього виконайте наступні кроки:
Model a form to enable data signing by an officer. Follow these steps:

//. Скопіюйте форму xref:#form-check-data-by-officer[перевірки даних посадовою особою], змодельовану вище, натиснувши _іконку копіювання_ -- це дозволить створити форму із готового шаблону:
. Copy the form for xref:#form-check-data-by-officer[data verification by an officer] modeled earlier by clicking the _copy icon_ -- this will allow you to create a form from an existing template:
+
//* У новому вікні перейдіть до вкладки [.underline]#Загальна#.
* In the new window, switch to the [.underline]#General# tab.
+
//* У полі `Бізнес-назва форми` введіть назву `Підписати дані лабораторії`, що відповідає назві користувацької задачі xref:#create-user-task-sign-lab-data[`signLabOfficerActivity`].
* In the *Business form name* field, enter a name corresponding to the task xref:#create-user-task-sign-lab-data[`signLabOfficerActivity`].
+
//* Заповніть поле `Службова назва форми` значенням `shared-officer-sign-lab` (має відповідати значенню поля `Form key` тієї ж користувацької задачі xref:#create-user-task-sign-lab-data[`signLabOfficerActivity`].
* Fill in the *Service form name* field with the value `shared-officer-sign-lab` (should correspond to the Form Key field value of the same user task -- xref:#create-user-task-sign-lab-data[`signLabOfficerActivity`].

+
image:study-project/task-5/task-5-forms-14.png[]
+
//. Перейдіть на вкладку [.underline]#Конструктор# та виконайте наступні налаштування для усіх компонентів форми:
. Switch to the [.underline]#Constructor# tab and perform the following settings for all components of the form:
+
//* Перейдіть на вкладку *Display* та встановіть прапорець для параметра `Disabled` -- `True`.
* Switch to the *Display* tab and set the `Disabled` parameter to `True`.
//* Натисніть кнопку `Save` для збереження.
* Click the *Save* button to save the changes.
+
//. Збережіть форму, натиснувши кнопку `Створити форму` у правому верхньому куті.
. Save the form by clicking the *Create form* button in the top-right corner.
+
image:study-project/task-5/task-5-forms-14-1.png[]

[#form-save]
//==== Завантаження змодельованих форм бізнес-процесу до локальної директорії
==== Loading modeled business process forms to local directory

//TODO на майбутнє
// Чи треба показувати, як застосувати зміни до майстер-гілки після завершення моделювання форм? Чи йдемо лише хардкорним шляхом, як і у всіх завданнях до цього?
//TODO на майбутнє
// Якщо моделювальник працює у власній гілці, а потім вирішує залити форми через Gerrit, то після того, як зміни потраплять у майстер, необхідно видалити усі непотрібні гілки.
//TODO на майбутнє
// Якщо ж гілка-кандидат потрібна для подальшої роботи, то її можна лишити. Відразу після оновлення майстер-версії усі версії-кандидати оновляться автоматично.

//Завантажте форми, натиснувши `&#10515;` (_іконку завантаження_) , та помістіть їх до регламентної папки *_forms_* проєкту в локальному Gerrit-репозиторії.
To load the forms, click on the `&#10515;` (_download icon_), and place them in the project's regulatory *_forms_* folder within the local Gerrit repository.
image:registry-develop:study-project/task-1/task-1-14-forms.png[]


[#bp-access]
//=== Моделювання доступу до бізнес-процесу
=== Access modeling for business process

[TIP]
====
//На цьому етапі необхідно надати доступ до бізнес-процесу із Кабінету отримувача послуг.
At this stage, it is necessary to provide access to the business process from the Citizen portal.

//Параметри доступу налаштовуються у конфігураційному файлі, що має назву
Access parameters are configured in the configuration file named citizen.yml._link:{attachmentsdir}/study-project/task-5/bp-access/citizen.yml[citizen.yml]_.
====

//. Створіть файл _citizen.yml_ та сконфігуруйте в ньому наступні параметри:
. Create the _citizen.yml_ file and configure the following parameters within it:

+
.Приклад. Налаштування доступу до бізнес-процесу із Кабінету отримувача послуг реєстру
[source,yaml]
.Example: Configuring access to the business process from the Citizen portal
----
authorization:
  realm: 'citizen'
  process_definitions:
    - process_definition_id: 'citizen-add-lab'
      process_name: 'Laboratory creation process'
      process_description: 'Business process of creating a laboratory by a Citizen'
      roles:
        - 'unregistered-individual'
        - 'unregistered-entrepreneur'
        - 'unregistered-legal'
----
+
//. xref:#save-roles-access-files[Збережіть файл] до папки *_bp-auth_* проєкту.
. xref:#save-roles-access-files[Save a file] to the *_bp-auth_* project folder.

//==== Створення нової ролі для розподілення задач в Кабінеті посадової особи
==== Creating a new role for task allocation in the Officer portal

//. Перейдіть до регламентної папки *_roles_*, знайдіть файл _link:{attachmentsdir}/study-project/task-3/bp-access/officer.yml[officer.yml]_ та додайте у ньому до наявних 2 нових параметри:
. Navigate to the regulatory *_roles_* folder, find the _link:{attachmentsdir}/study-project/task-5/bp-access/officer.yml[officer.yml]_, and add 2 new parameters to it:

+
.Приклад. Додавання параметрів для створення ролі для розподілення задач
[source,yaml]
.Example: Adding parameters to create a role for task allocation
----
  - name: task-dispatcher
    description: Task dispatcher role
----
+
//. xref:#save-roles-access-files[Збережіть файл] до папки *_bp-auth_* проєкту.
. xref:#save-roles-access-files[Save a file] to the *_bp-auth_* project folder.

[#save-roles-access-files]
//==== Збереження файлів із налаштуваннями доступу
==== Saving access configuration files

//Збережіть файл _officer.yml_ до регламентної папки *_bp-auth_* проєкту в локальному Gerrit-репозиторії.
Save the _officer.yml_ file to the *_bp-auth_* folder of the project in the local Gerrit repository.

//== Перенесення файлів регламенту до віддаленого репозиторію Gerrit
== Transferring regulatory files to remote Gerrit repository

//Для успішного розгортання бізнес-процесу, форм, а також застосування правильних налаштувань доступу до бізнес-процесу у цільовому середовищі, адміністратор регламенту має завантажити збережені локально файли регламенту реєстру до віддаленого сховища коду Gerrit.
For successful deployment of the business process, forms, and applying the correct access settings to the business process in the target environment, the regulations administrator must upload the saved local regulation files to the remote Gerrit code repository.

//Для цього виконайте кроки з інструкції
To do this, follow the steps in
xref:registry-develop:registry-admin/regulations-deploy/registry-admin-deploy-regulation.adoc[].

//IMPORTANT: Після того, як локальні зміни потраплять до регламенту в Gerrit, та після того, як ви переконаєтеся, що все працює коректно, xref:registry-develop:registry-admin/admin-portal/version-control/overview-new-change-request.adoc#abandon-changes[видаліть створену версію-кандидат на внесення змін у Кабінеті адміністратора регламентів].
IMPORTANT: Once the local changes are incorporated into the regulation process in Gerrit and after confirming that everything is functioning correctly, xref:registry-develop:registry-admin/admin-portal/version-control/overview-new-change-request.adoc#abandon-changes[delete the created candidate version for changes in the Regulations administrator portal].

//== Додатки
== Appendices

//Розділ містить приклади іх готовими артефактами моделювання регламенту, які ви можете використовувати під час виконання цього завдання.
This section contains examples of ready-made artifacts of regulations modeling that you can use during the execution of this task.

//=== Схема бізнес-процесу
=== Business process schema

* _link:{attachmentsdir}/study-project/task-5/bp-schema/citizen-add-lab.bpmn[citizen-add-lab.bpmn]_

//=== Форми для бізнес-процесу
=== Forms for the business process

* _link:{attachmentsdir}/study-project/task-5/bp-forms/shared-officer-sign-lab.json[shared-officer-sign-lab.json]_
* _link:{attachmentsdir}/study-project/task-5/bp-forms/shared-officer-check-lab.json[shared-officer-check-lab.json]_
* _link:{attachmentsdir}/study-project/task-5/bp-forms/shared-dispatch-task.json[shared-dispatch-task.json]_
* _link:{attachmentsdir}/study-project/task-5/bp-forms/shared-citizen-sign-lab.json[shared-citizen-sign-lab.json]_
* _link:{attachmentsdir}/study-project/task-5/bp-forms/citizen-add-lab-bp-add-lab.json[citizen-add-lab-bp-add-lab.json]_

//=== YAML для доступу ролі citizen до бізнес-процесу
=== Yaml for Citizen role access to business process

* _link:{attachmentsdir}/study-project/task-5/bp-access/citizen.yml[bp-auth/citizen.yml]_

//=== YAML для створення нової ролі Task Dispatcher
===  Yaml for creating a new Task Dispatcher role

* _link:{attachmentsdir}/study-project/task-5/bp-access/officer.yml[roles/officer.yml]_


