= Розширення можливостей редактору коду за допомогою _Language Server Protocol (LSP)_

У якості єдиного редактора коду для внесення змін до регламенту реєстру та порівняння версій обрано рішення https://microsoft.github.io/monaco-editor/[monaco-editor].

Регламент реєстру складається з набору декларативних описів важливих аспектів функціонування реєстру у вигляді конфігураційних файлів наступних типів:

- _XML_
- _JSON_
- _YAML_
- _HTML_
- _CSV_
- _Groovy_

Для забезпечення розширених можливостей по роботі з визначеними типами конфігураційних файлів через _Систему Управління Регламентом Реєстру_ та формуванням єдиного підходу до реалізації підтримки нових типів файлів та мов, рекомендовано розглянути https://microsoft.github.io/language-server-protocol/[Language Server Protocol], який стандартизує інтеграцію зовнішніх мовних серверів та редактора коду.

== Ключові вимоги до редактора коду

В залежності від природи окремої складової регламенту, редактор коду має реалізовувати особливі вимоги для спрощення використання на зниження вірогідності внесення помилок.

=== BPMN XML

- Підтримка автодоповнення
- Синтаксичний аналіз
- Підтримка валідації вибраної schema
- Підтримка автодоповнення для вибраної schema

=== Liquibase XML

- Підтримка автодоповнення
- Синтаксичний аналіз
- Підтримка валідації вибраної schema
- Підтримка автодоповнення для вибраної schema

=== JSON

- Авто-доповнення
- Синтаксичний аналіз
- Підтримка валідації вибраної schema
- Підтримка вибраної schema(автодоповнення)

=== YAML

* ...
* ...

=== HTML

- Авто-доповнення
- Підтримка автодоповнення директив із Thymeleaf

=== CSV

* ...
* ...

=== Groovy

- Авто-доповнення
- Підтримка автодоповнення для кастомних функцій
- Синтаксичний аналіз

== Опис _Language Server Protocol_

Протокол мовного сервера (LSP) визначає протокол, який використовується між редактором та мовним сервером, який забезпечує такі функції мови, як автоматичне завершення, перевірка помилок (діагностика), пошук усіх посилань тощо.

Мовний сервер призначений для надання інтелектуальних можливостей для певної мови та зв’язку з інструментами розробки через протокол, який забезпечує взаємодію між процесами.

Ідея, що лежить в основі протоколу мовного сервера (LSP), полягає в стандартизації протоколу для обміну даними між такими серверами та інструментами розробки.

image::architecture-workspace/research/admin-portal/lsp-languages-editors.png[]

== Інтеграції редактора коду та мовних серверів

Обмін данними між редактор коду(https://microsoft.github.io/monaco-editor/[monaco-editor]) та мовним сервером, відбувається за домомогою https://developer.mozilla.org/docs/Web/API/WebSocket[WebSocket], в якості формату данних використовується https://www.jsonrpc.org/specification[JSON-RPC 2.0]. Ілюстрація взаємодії нижче:

image::architecture-workspace/research/admin-portal/lsp-illustration.png[]

Для цього був розроблений проксі веб сервер який використовує пакет https://www.npmjs.com/package/vscode-ws-jsonrpc[vscode-ws-jsonrpc]. Ми можемо настроїти наш сервер для будь-якої кількості мовних серверів. Для цього нам потрібно розшири файл _languageServers.json_.

- ключем вказати мову
- в поле _name_ вказати повну назву мовного серверу
- в поле _command_ вказати команду для запуску процеса +
Приклад _xml_ з викорристанням https://github.com/eclipse/lemminx[XML Language Server (LemMinX)]:

[source, json]
----
{
  "xml": { // ключ, вказати мову
    "name": "XML Language Server", // повна назва мовного серверу
    "command": "java", // команда для запуску процеса 
    "args": [...] // аргументи для запуску процеса 
  }
}
----

Кожен мовний сервер запускається як підпроцес, до якого підключається клієнт, передаючи назву мовного серверу в URL, наприклад _wss://host/xml_

TIP: Список доступних мовних серверів можна знайти https://langserver.org/[тут]




