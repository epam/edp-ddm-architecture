= Федерація споріднених реєстрів

== Концепції

* _Федерація споріднених реєстрів_ - група реєстрів, об'єднаних за визначеною ознакою, доступ до яких надається зі спрощеним механізмом аутентифікації через _SSO_ та авторизацією, яка налаштовується на рівні окремих реєстрів.
* _Споріднений реєстр_ - складова федерації реєстрів, який може належати окремому власнику, розробляється та адмініструється окремою групою адміністраторів згідно з специфічними вимогами.
* _Головний реєстр федерації_ - реєстр, який забезпечує доступ до інформаційних послуг усіх реєстрів федерації, аналітичної звітності, управління персональними налаштуваннями користувачів.
* _Цільовий реєстр федерації_ - реєстр, який забезпечує отримання / надання адміністративних послуг цільового реєстру та є _system-of-record_ даних.
* _Ріалм реєстру федерації_ - рілм, який обслуговує користувачів цільового або головного реєстру та забезпечує управління його ролями та доступом.
* _Мастер-ріалм федерації споріднених реєстрів_ - рілм, який забезпечує управління користувачами, які мають доступ до реєстрів федерації та надає єдиний спрощений механізм аутентифікації через _SSO_.

== Принципи

* На єдиному екземплярі Платформи можна створити безліч федерацій споріднених реєстрів
* Не має обмежень на кількість споріднених реєстрів, що входять до однієї федерації
* Один реєстр може бути частиною лише однієї федерації
* Аутентифікація користувачів федерації реєстрів обслуговується групою з двох мастер-ріалмів для отримувачів послуг та надавачів послуг відповідно
* Всі реєстри федерації мають єдиний механізм аутентифікації, який налаштовується на рівні мастер-ріалмів
* Всі користувачі федерації є частиною одного з мастер-ріалмів в залежності від їх ролі
* Адміністратори кожного з реєстрів федерації обслуговуються окремим відповідним ріалмом на рівні реєстру
* При аутентифікації користувача через кабінет реєстру проти мастер-ріалму, користувач автоматично реєструється в мастер-ріалмі та синхронізуються до відповідного ріалму на рівні реєстру
* У разі аутентифікації користувача через будь-який кабінет реєстру федерації проти мастер-ріалму, користувач автоматично отримує доступ до відповідних кабінетів всіх реєстрів федерації
* Налаштування прав доступу та ролей відбувається на рівні ріалмів окремих реєстрів
* Управління персональними налаштуваннями користувача доступне лише через кабінет головного реєстру федерації
* Кабінети реєстрів єдиної федерації надають можливість швидкого переходу між собою для спрощення надання та отримання послуг
* Цільовий реєстр призначений для обслуговування реєстру посадовими особами та надання / отримання адміністративних послуг
* Модель даних цільового реєстру відповідає вимогам до його типу та призначення
* Модель даних головного реєстру є узагальненою та мінімально-достатньою для надання інформаційних послуг та побудови аналітичних звітів
* Головний реєстр призначений для отримання інформаційних послуг по всім реєстрам федерації
* Головний реєстр призначений для перегляду даних та аналітичної звітності по всім реєстрам федерації
* Відправка нотифікацій користувачам в рамках надання адміністративних послуг в цільових реєстрах реалізується через міжреєстрову інтеграцію з головним реєстром федерації
* Синхронізація даних між цільовими та головним реєстром реалізується на рівні бізнес-процесів за моделлю _eventual consistency_

== Відкриті питання

* Шаринг сесій користувачів між реєстрами на рівні реєстрової "Підсистеми управління зовнішнім трафіком":
** Розглянути підхід Identity Brokering (https://groups.google.com/g/keycloak-user/c/grVY_eq2j6s/m/2iYZySePAQAJ?pli=1)

== Технічний дизайн

image::architecture-workspace/research/registry-federation/registry-federation.svg[]

== Інтерфейс користувача

.Селектор федерації споріднених реєстрів
image::architecture-workspace/research/registry-federation/registry-federation-selector.png[]

.Розкритий cелектор федерації споріднених реєстрів
image::architecture-workspace/research/registry-federation/registry-federation-selector-expanded.png[]