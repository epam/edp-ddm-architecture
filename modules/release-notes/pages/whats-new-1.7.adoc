= Що нового у версії 1.7?
:toc:
:toclevels: 5
:toc-title: ЗМІСТ
:sectnums:
:sectnumlevels: 5
:sectanchors:

WARNING: Документ у процесі формування.

== Моделювання
=== Моделювання бізнес-процесів
==== Розширення можливостей моделювання бізнес-процесів підтримкою альтернативних гілок

Імплементовано можливість моделювати альтернативні гілки у бізнес-процесах та поєднувати їх із відповідним компонентом форм -- *Button* (_Кнопка_). Це дозволяє посадовій особі повернутися до попередньої форми бізнес-процесу та виправити внесені дані (тобто виконати "step back"), якщо в рамках бізнес-процесу є дві або більше задач розподілених на нього в ряд, та коли процес змодельований зі стартовою формою.

Виділяють 2 сценарії використання функціональності: ::

* Користувач може повернутися до попередньої задачі відповідно до навігації у змодельованій альтернативній гілці бізнес-процесу.
* Користувач може скасувати внесені дані на формі та повернутися до меню послуг.

Користувач може здійснити перехід за одним зі сценаріїв на формі підписання даних. Саме тут розміщуються змодельовані кнопки компонента *Button* з налаштованою навігацією. Вони розташовані під віджетом КЕП та візуально відділені від нього.

[TIP]
====
Детальну інформацію з описом функціональності ви можете переглянути за посиланнями:

//TODO: add links
* xref:fffff[Моделювання навігаційних кнопок для альтернативних гілок]
* xref:fffff[Моделювання альтернативних гілок у бізнес-процесі]
====

==== Розширення можливостей моделювання бізнес-процесів підтримкою відправки повідомлень

Імплементовано функціональність, що дозволяє надсилати повідомлення користувачам кабінетів на електронну пошту в рамках виконання бізнес-процесу. Для цього розширено можливості моделювання процесів, а саме розроблено додаткове розширення-конектор (делегат):

* `Send User Notification` -- для відправки повідомлень із бізнес-процесів на SMTP-сервер електронної пошти.

Службова назва делегата: `SendUserNotificationDelegate`.

Назва типового розширення: `Відправка повідомлення користувачу`.

image:tech:lowcode/notifications/send-notification-element-template.png[]

Наразі повідомлення можна надіслати лише каналом зв'язку "Email".
Розглядаються два сценарії моделювання відправки повідомлень у межах виконання бізнес-процесу:

* Відправка повідомлення 1 користувачу.
image:tech:lowcode/notifications/send-single-notification.png[]
* Відправка повідомлень N користувачам.
image:tech:lowcode/notifications/send-multi-notifications.png[]
+
[NOTE]
====
Для одночасної відправки повідомлень N користувачам використовується процес `Parallel Multi Instance`.

Також з метою отримання списку користувачів було реалізовано новий шаблон делегату `getCitizenUsersByAttributesFromKeycloak`, який використовується для пошуку користувачів Кабінету отримувачів послуг у Keycloak за їх атрибутами. Він є аналогом `getUsersByAttributesFromKeycloak` для отримання списку користувачів Кабінету посадових осіб.
====

Процес відправки повідомлення не блокує основний потік виконання бізнес-процесу та виконується асинхронно.

[TIP]
====
Детальну інформацію з описом функціональності ви можете переглянути за посиланнями:

* xref:fffff[Делегат getCitizenUsersByAttributesFromKeycloak]
* xref:fffff[Делегат Send User Notification]
* xref:fffff[Налаштування SMTP-сервера в Control Plane]

====

====  Розширення можливостей моделювання бізнес-процесів підтримкою пошуку користувачів у Keycloak за їх атрибутами (для отримувачів послуг)


Реалізовано нове розширення пошук користувачів у Keycloak за їх атрибутами — делегат `getCitizenUsersByAttributesFromKeycloak`.
Делегат потрібний для того, щоб при виконанні бізнес-процесу отримувати список користувачів отримувачів послуг за певними атрибутами із сервісу керування ідентифікацією та доступом Keycloak.

image:release-notes:whats-new-1-7-1.png[]

[NOTE]
====
Цей делегат є аналогом реалізованого раніше xref:registry-develop:bp-modeling/bp/bp-element-templates-installation-configuration.adoc#_пошук_користувачів_у_keycloak_за_їх_атрибутами[`getUsersByAttributesFromKeycloak`] для отримання списку користувачів Кабінету посадових осіб.
====

В результаті використання шаблону делегата можливо отримати список користувачів із Keycloak за їх атрибутами, який зберігатиметься у відповідній змінній.

* Якщо передати лише значення параметра `edrpou`, то сервіс повертає список усіх посадових осіб відповідної організації.

* Якщо передати значення параметрів `edrpou` та `drfo`, то сервіс повертає список з іменем конкретної посадової особи відповідної організації.

=== Моделювання форм

==== Розширення переліку підтримуваних компонентів для моделювання UI-форм

[components-styling]
===== Стилізація компонентів форм

Реалізовано стилізацію елементів інтерфейсів користувачів (посадова особа та отримувач послуг) відповідно до стайл-гайду додатка "Дія" (див. табл. “Оновлені компоненти інтерфейсів користувача”).

.Оновлені компоненти інтерфейсів користувача
|===
|Компонент (форми задач)|Опис|Приклад
|`FieldSet`|Компонент `FieldSet` використовується для створення заголовка області форми. Це може бути корисним для об'єднання багатьох пов'язаних компонентів між собою одним заголовком. FieldSet призначається лише для відображення і не використовується в API.|image:release-notes:whats-new-1-7-2.png[]
|`Columns`|Компонент `Columns` можна використовувати для групування інших компонентів, таких як текстове поле, текстова область, прапорець тощо, у стовпці, які можна налаштувати. Це може бути корисним, якщо потрібно відобразити декілька компонентів в одному рядку.|image:release-notes:whats-new-1-7-3.png[]
|`Table`|Компонент `Table` дозволяє створити таблицю зі стовпцями та рядками. У відповідні клітинки можливо додавати додаткові компоненти.|image:release-notes:whats-new-1-7-4.png[]
|===

== Адміністрування реєстру
=== Автоматична валідація змін до регламенту на етапі публікації

У цьому релізі розширено автоматичну валідацію змін до регламенту при його розгортанні. Це зроблено для уникнення помилок при ручній валідації регламенту під час процедури перевірки коду (Code Review), та з метою покращення безпекових складових при роботі з регламентом реєстру.

Імплементовано автоматичну перевірку наявності бізнес-процесу за значенням атрибута `process_definition_id`. Додано до утиліти `validator-cli` правило валідації щодо відсутнього бізнес-процесу.

image:registry-develop:registry-admin/regulations-deploy/auto-validation/registry-regulations-auto-validation-8.png[]

[TIP]
====
Детальну інформацію з описом функціональності ви можете переглянути за посиланням:

* xref:registry-develop:registry-admin/regulations-deploy/registry-regulations-auto-validation.adoc[]
====

=== Налаштування та контроль рейт-лімітів

У цьому релізі імплементовано підтримку рейт-лімітів для API Платформи. Метою рейт-лімітів є обмеження кількості HTTP-запитів до сервісу чи маршруту за заданий період секунд, хвилин, годин, днів, місяців або років. Механізм рейт-лімітів реалізований на базі OIDC Rate-Limiting плагіну для Kong API Gateway.

Рейт-ліміти дозволяють обмежувати кількість запитів від одного авторизованого користувача за одиницю часу, а також обмежувати кількості запитів з однієї IP адреси, якщо користувач не авторизований у системі. Їх налаштування дозволяє уникнути надмірного навантаження, або збою системи.

image:registry-develop:registry-admin/Kong-Rate-Limits.drawio.png[]

[TIP]
====
Детальну інформацію з описом функціональності ви можете переглянути за посиланням:

* xref:registry-develop:registry-admin/api-rate-limits.adoc[]
====

=== Налаштування каналів зв’язку для відправки повідомлень користувачам реєстру

Налаштування каналів зв’язку окремого реєстру реалізовано за допомогою розширення Адміністративного інтерфейсу управління платформою (control-plane-console) на етапах створення та редагування реєстру.

Наразі платформа підтримує одну з наступних опцій налаштувань поштового сервера в залежності від вимог реєстру:

* *_Внутрішній поштовий сервер (platform-mail-server)_* - поштовий сервер, який розповсюджується у якості платформенного сервісу та доступний для використання усіма реєстрами одного екземпляру платформи.
* *_Зовнішній поштовий сервер (external-mail-server)_* - зовнішній відносно платформи поштовий сервіс (Gmail, тощо).

image:tech:lowcode/notifications/control-plane-registry-creation-external-mail-server.png[]

image:tech:lowcode/notifications/control-plane-registry-creation-platform-mail-server.png[]

[TIP]
====
Детальну інформацію з описом функціональності ви можете переглянути за посиланнями:

* xref:fffff[Налаштування SMTP-сервера в Control Plane]

====

=== Налаштування шаблонів повідомлень на рівні окремих каналів зв'язку

В структуру регламенту нотифікацій закладено підтримку шаблонів повідомлень для каналу зв'язку
email (відправка повідомлень у HTML-вигляді електронною поштою).

Для забезпечення можливостей створення та користувацького налаштування шаблонів повідомлень, у якості технології шаблонізації обрано Apache FreeMarker (розширення файлів "*.ftlh" та "*.ftl" для HTML та текстових документів відповідно).

Структура типового шаблону поштового повідомлення::
[plantuml, notification-regulation-structure, svg]
----
@startsalt
{
{T
+ <&folder> registry-regulation
++ ...
++ <&folder> notifications
+++ <&folder> email
++++ <&folder> <b><template-directory></b>
+++++ <&folder> css
++++++ <&file> style.css
+++++ <&folder> images
++++++ <&file> image.jpg
++++++ <&file> ...
+++++ <&file> notification.ftlh
++++ ...
}
}
@endsalt
----

* _<template-directory>_ - Директорія з ресурсами шаблону, яка має унікальне ім'я для заданого каналу зв'язку (_email_ у даному разі);
* _<template-directory>/notification.ftlh_ - HTML-документ шаблону для подальшої генерації тіла повідомлення;
* _<template-directory>/css/style.css_ - "Єдиний CSS-файл стилів, які використовуються в HTML-документі (Приклад: _<link rel="stylesheet" href="css/style.css">_);
* _<template-directory>/images/*.*_ - Перелік файлів зображень, які використовуються в HTML-документі (Приклад: _<img src="images/image.jpg">_).


== Моделювання даних

=== Міжреєстрова взаємодія реєстрів на Платформі зі сторонньою інформаційною системою

Реалізовано взаємодію реєстрів на Платформі зі сторонньою інформаційною системою без участі SOAP-інтерфейсів ШБО «Трембіта». Для цього:

* Розроблено інтеграційний REST-конектор (делегат) *Connect to external system* для інтеграції та виклику зовнішніх інформаційних систем через інтерфейси REST API.
+
Наразі імплементовано підтримку двох HTTP-методів: `POST` і `GET`.

* Розширено можливості моделювання бізнес-процесів з використанням шаблону делегата Connect to external system.

* Розширено можливості сервісу `bp-webservice-gateway` підтримкою REST-інтерфейсів для ініціювання бізнес-процесів у реєстрах Платорми зовнішньою системою. Сервіс використовує імплементовану точку входу `/startBp` для старту бізнес-процесу.

* Розширено REST API Фабрики даних -- `registry-rest-api` відповідними ендпоінтами.

[TIP]
====
Детальну інформацію з описом функціональності ви можете переглянути за посиланнями:

//TODO: add links
* xref:registry-develop:bp-modeling/bp/rest-connector.adoc[]
* xref:ffffff[Посилання]
====

//Call ext system by REST API
//Internal Platform Registry --> bpms api --> REST Connector --> Ext-system

// Ext system calls us by REST API
//Ext-system --> registry-rest-api/bp-webservice-gateway --> postgresql/bpms api of Internal Platform Registry

=== Міжреєстрова взаємодія реєстрів, що розгорнуті на одному екземплярі Платформи

//Internal Registry 1 --> bpms api --> platform-gateway --> registry-rest-api/bp-webservice-gateway --> postgresql/bpms of Internal Registry 2

Реалізовано взаємодію реєстрів в межах одного екземпляра Платформи без участі SOAP-інтерфейсів ШБО «Трембіта». Для цього:

* Розширено можливості сервісу `bp-webservice-gateway` підтримкою REST-інтерфейсів для ініціювання бізнес-процесів в іншому реєстрі на Платформі. Сервіс використовує імплементовану точку входу `/startBp` для старту бізнес-процесу.
* Розроблено сервіс `platform-gateway` як єдину точку для вихідних запитів від реєстру-споживача даних до реєстру-власника даних. Сервіс виконує роль проксі для маршрутизації до необхідних ендпоінтів.
* Розширено REST API Фабрики даних -- `registry-rest-api` відповідними ендпоінтами.

* Впроваджено декілька інтеграційних розширень (делегатів) на рівні BPMS, і, відповідно, розширено можливості моделювання шаблонами цих делегатів, що використовуються при моделюванні бізнес-процесів. Це дозволяє налаштувати взаємодію між процесами, що розгорнуті в межах регламентів різних реєстрів.

Ось список таких делегатів:

* Делегат для старту БП в іншому реєстрі (*Start business process in another registry*)
* Делегат для пошуку сутностей у БД іншого реєстру (*Search for entities from another registry data factory*)
* Делегат для читання даних із сутності БД іншого реєстру (*Read entity from another registry data factory*)

[TIP]
====
Детальну інформацію з описом функціональності ви можете переглянути за посиланнями:

//TODO: add links
* xref:ffffff[Посилання]
* xref:ffffff[Посилання]
* xref:ffffff[Посилання]
====