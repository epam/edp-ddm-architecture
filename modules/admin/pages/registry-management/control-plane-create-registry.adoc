:toc-title: ЗМІСТ
:toc: auto
:toclevels: 5
:experimental:
:important-caption:     ВАЖЛИВО
:note-caption:          ПРИМІТКА
:tip-caption:           ПІДКАЗКА
:warning-caption:       ПОПЕРЕДЖЕННЯ
:caution-caption:       УВАГА
:example-caption:           Приклад
:figure-caption:            Зображення
:table-caption:             Таблиця
:appendix-caption:          Додаток
:sectnums:
:sectnumlevels: 5
:sectanchors:
:sectlinks:
:partnums:

= Розгортання екземпляра реєстру

Після успішного встановлення Платформи у цільовому оточенні, адміністратор Платформи отримує доступ до адміністративної панелі керування Платформою, що має назву **Control Plane** або **Admin Console** .

[TIP]
====
Посилання до сервісу **Control Plane** можливо отримати в консолі Openshift. Перейдіть до розділу `Networking` → `Routes`, у пошуку вкажіть значення "control-plane", посилання буде доступне у колонці `Location`.

image:infrastructure/cluster-mgmt/cp-registry-deploy-12.png[]
====

////
**Control Plane** або **Admin Console** і доступна за посиланням: https://control-plane-console-{CP-NAMESPACE}.{DNS-WILDCARD}/[].

TIP: `{CP-NAMESPACE}` та `{DNS-WILDCARD}` є змінними, де `{CP-NAMESPACE}` -- назва namespace (простору імен) у Control Plane, а `{DNS-WILDCARD}` -- значення DNS wildcardfootnote:[В системі DNS можна задавати запис за замовчуванням для неоголошених піддоменів. Такий запис називається wildcard.].
////


[IMPORTANT]
====
Розгорнути реєстр в адмін-панелі *Control Plane* може лише адміністратор Платформи з відповідними правами доступу. Для цього необхідна роль `cp-cluster-mgmt-admin` у реалмі `control-plane-admin` сервісу *Keycloak*.

Детальна інформація доступна за посиланням:

* xref:admin:registry-management/control-plane-assign-platform-admins.adoc[]
====


Для розгортання нового реєстру необхідно виконати наступні кроки:



. Увійдіть до адміністративної панелі керування кластером та реєстрами *Control Plane*, використовуючи попередньо отримані логін та пароль.
+
image:admin:infrastructure/cluster-mgmt/update-cluster-mgmt-01.png[]



. Перейдіть до розділу _Реєстри_ -> далі натисніть `Створити новий`.
+
image:infrastructure/cluster-mgmt/cp-registry-deploy-1.png[]



. У новому вікні заповніть форми відповідними даними.
+
У полі `Назва реєстру` введіть назву реєстру, що буде розгорнуто.
+
CAUTION: Назва повинна бути унікальною і її неможливо буде змінити після створення реєстру.
Для введення доступні лише латинські літери та знак "-".
Довжина не повинна перевищувати 12 символів.
+
image:infrastructure/cluster-mgmt/cp-registry-deploy-2.png[]



. У полі `Адміністратори` зазначте адміністраторів регламенту реєстру,
яким буде надано доступ до реєстру.
+
Натисніть "+", і далі у вікні, що з'явилося, введіть дані кожного адміністратора реєстру, а саме:
+
--
* імя;
* прізвище;
* електронну пошту;
* тимчасовий пароль.
--
+
Для надання доступу декільком адміністраторам реєстру,
необхідно повторити дію для кожного адміністратора окремо (+ -> вказати дані -> `Підтвердити`).
+
[NOTE]
====
Дані електронної пошти мають бути введені у нижньому регістрі.



Доступні символи: `"0-9"`, `"a-z"`, `"_"`, `"-"`, `"@"`, `"."`, `","`.
====



+
[IMPORTANT]
====
Саме на цьому етапі визначаються _адміністратори реєстру_.



Можливість внесення нових адміністраторів буде доступна і згодом після розгортання, через опцію редагування реєстру.
====



+
image:infrastructure/cluster-mgmt/cp-registry-deploy-3.png[]
↓
image:infrastructure/cluster-mgmt/cp-registry-deploy-4.png[]
+
[NOTE]
====
Користувач-адміністратор реєстру автоматично створюється в `openshift`-реалмі сервісу Keycloak з роллю `cp-registry-admin-<registry-name>` та групою `/cp-registry-admin-<registry-name>`, де `<registry-name>` -- назва реєстру.
====

. Заповніть поле `Опис`, воно може містити офіційну назву реєстру або
його призначення.



. У полі `Шаблон реєстру` оберіть шаблон, який буде застосований для реєстру.
+
Шаблон реєстру визначає параметри конфігурації та кількість інстансів для реєстру,
що розгортається, тобто виділену кількість ресурсів (CPU, RAM тощо) та кількість нод в MachineSets.
+
image:infrastructure/cluster-mgmt/cp-registry-deploy-5.png[]



. У полі `Гілка шаблону реєстру` оберіть гілку, яка буде застосована при розгортанні реєстру.
+
Мається на увазі версія гілки компонента у Gerrit-репозиторії, що містить відповідну версію шаблону реєстру.
+
image:infrastructure/cluster-mgmt/cp-registry-deploy-14.png[]
//Секція `Дані про ключ` має містити дані про файловий ключ та сертифікований орган, що такий ключ видав.

. Оберіть тип поштового серверу.
+
image:infrastructure/cluster-mgmt/cp-registry-deploy-13.png[]

* _Внутрішній поштовий сервер (platform-mail-server)_ — поштовий сервер, який розповсюджується у якості платформенного сервісу та доступний для використання усіма реєстрами одного екземпляру платформи.

* _Зовнішній поштовий сервер (external-mail-server)_ — зовнішній відносно платформи поштовий сервіс (Gmail, тощо).
+
[TIP]
====
Детальна інформація доступна за посиланням:

* xref:registry-develop:registry-admin/config-smtp-server.adoc[]
====



. У полі `Тип носія` оберіть відповідний тип ключа, що використовується.
+
image:infrastructure/cluster-mgmt/cp-registry-deploy-8.png[]
+
[CAUTION]
====
Секція `Дані про ключ` має містити дані про ключ для ініціалізації криптосервісу і накладання системного підпису (печатки системи).

Цей ключ використовується для підпису витягів, сформованих Платформою, та підпису даних, що трансформуються згідно з логікою бізнес-процесів реєстру.
====
+
[TIP]
====
Детальна інформація доступна за посиланням:

* xref:admin:registry-management/control-plane-change-key.adoc#setting_key[Налаштування ключа]
====

. Оберіть електронний ключ.
+
Поле `Файловий ключ (розширення .dat)` заповнюється операційним ключем із розширенням
`.dat` (`Key-6.dat`) адміністратора Платформи.
Завантажте файл із ключем, натиснувши `Browse`, оберіть ключ у відповідній директорії,
натисніть `Open`.
+
image:infrastructure/cluster-mgmt/cp-registry-deploy-9.png[]

. У полі `АЦСК, що видав ключ` відображається повна назва АЦСКfootnote:[**АЦСК** - Атестований центр сертифікації ключів.], що видав ключ.

. У полі `Пароль до файлового ключа` введіть пароль до завантаженого ключа.
+
image:infrastructure/cluster-mgmt/cp-registry-deploy-10.png[]

. Секція `Дані для перевірки ключа` має містити дані публічних сертифікатів та перелік АЦСК:

* У полі `Публічні сертифікати АЦСК (розширення `.p7b`)` завантажте файл із переліком сертифікатів сумісних ЦСК (link:https://iit.com.ua/download/productfiles/CACertificates.p7b[CACertificates.p7b]), який можна отримати на сайті АТ "ІІТ" за посиланням https://iit.com.ua/downloads.
* У полі `Список АЦСК (розширення .json)` завантажте файл із параметрами взаємодії сумісними ЦСК (link:https://iit.com.ua/download/productfiles/[CAs.json]), який можна отримати на сайті АТ "ІІТ" за посиланням: https://iit.com.ua/downloads.

. Вкажіть «Перелік дозволених ключів», підпис яких може вважатися достовірним.
+
image:infrastructure/cluster-mgmt/change-key/change-key-16.png[]
+
[NOTE]
====
У цьому блоці зазначається перелік ключів, у тому числі й старих (наприклад, при ротації ключів), щоб все, що раніше було підписано старим ключем, вважалося валідованим. Тобто перелік дозволених ключів повинен містити історію даних усіх ключів, що використовувались у системі для накладання підпису.
====

. Після виконання вищезазначених кроків натисніть `Підтвердити`.

Таким чином, реєстр додається до переліку реєстрів у розділі `Реєстри` панелі керування.

У разі успішного розгортання, реєстр позначається зеленою піктограмою в колонці `Статус`.

image:infrastructure/cluster-mgmt/cp-registry-deploy-11.png[]