= Оновлення інфраструктурних компонентів кластера Платформи
:toc:
:toclevels: 5
:toc-title: ЗМІСТ
:sectnums:
:sectnumlevels: 5
:sectanchors:

== Загальний опис

Керування кластером Платформи відбувається за методологією *GitOps*. Це означає, що будь-які зміни у конфігурації кластера, компонентів кластера та компонентів Платформи відбуваються через зміну конфігурації кластера у git-гілці відповідного компонента.
Метадані усіх компонентів, для яких реалізована можливість управління через GitOps-підхід, зберігаються у компоненті *cluster-management*.

TIP: *Cluster Management* або *cluster-mgmt* -- це композитний репозиторій, який визначає конкретні версії інфраструктурних компонентів. Оновлення цього компонента дозволить автоматично оновити відповідні інфраструктурні компоненти кластера.

Нижче представлено список компонентів, для яких наразі імплементована можливість оновлення через GitOps-підхід:

* `catalog-source`;
* `storage`;
* `monitoring`;
* `logging`;
* `service-mesh`;
* `velero`;
* `control-plane-nexus`;
* `user-management`.

Керування оновленнями інфраструктурних компонентів кластера відбувається в адміністративній панелі керування кластером та реєстрами *Control Plane*.

Етапи оновлення інфраструктурних компонентів кластера: ::

Оновлення інфраструктурних компонентів кластера Платформи до нової версії складається з таких етапів:

. Налаштування в адміністративній панелі керування кластером та реєстрами *Control Plane*.

. Проходження процедури перевірки коду в системі рецензування коду *Gerrit*.

. Контроль за перевіркою складання коду у *Jenkins*.

== Налаштування в адміністративній панелі керування кластером та реєстрами Control Plane

[IMPORTANT]
====
Передумови: ::

Переконайтеся, що у вас є доступ до відповідного кластера, на якому розгорнуто Control Plane. За необхідності, зверніться до адміністратора Платформи для надання доступу до панелі.
====

. Увійдіть до адміністративної панелі керування кластером та реєстрами *Control Plane*.

. Відкрийте меню _Керування кластером_.
. У правому верхньому куті сторінки натисніть `Редагувати`.
. На новій сторінці знайдіть секцію _Оновлення кластера_.
. У випадному списку оберіть версію, до якої необхідно оновити кластер.
. Натисніть кнопку `Підтвердити` для збереження змін.
+
В результаті відбудеться передача нових даних (`git push`) до репозиторію Gerrit для подальшої перевірки коду.
+
NOTE: Доступні версії збірки для оновлення кластера завжди будуть вищими за поточну.
+
image:admin:infrastructure/cluster-mgmt-update.png[]

== Проходження процедури перевірки коду в системі рецензування коду Gerrit

Після успішного створення запита на оновлення в інтерфейсі Control Plane, необхідно пройти процедуру перевірки коду в системі Gerrit. Для цього виконайте наступні кроки:

. Перейдіть до інтерфейсу Gerrit за відповідним посиланням.
. Виконайте перевірку коду та підтвердьте внесення змін (`git merge`) до `master`-гілки репозиторію.
+
image:admin:infrastructure/cluster-mgmt-gerrit-mr.png[]

== Контроль за перевіркою складання коду у Jenkins

Після успішного злиття змін до `master`-гілки репозиторію Gerrit, необхідно переконатися, що Jenkins-pipeline `cluster-mgmt` запустився й успішно завершився. Для цього виконайте наступні кроки:

. Перейдіть до інтерфейсу Jenkins за відповідним посиланням.
. Дочекайтеся виконання усіх кроків у pipeline `MASTER-Build-cluster-mgmt`.
+
image:admin:infrastructure/cluster-mgmt-jenkins.png[]

Після успішної збірки, інфраструктурні компоненти кластера оновлюються до нової версії.