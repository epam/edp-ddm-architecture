= Розширення місці в CEPH

При виникненні потреби розширення дискового простору Ceph середовища (планове або при досягненні порогу в 85% від існуючого) треба виконати наступний алгоритм дій на Openshift (OKD 4.x) кластері:

Передумови: потрібно мати права доступу до кластеру з роллю cluster-admin


1) Розририти корневі volume на cloud провайдері (у нашому випадку - AWS). Для цього достатньо перейти за допомогою web консолі OKD у розділ Persistent Volume Claims неймспейсу openshift-storage та визвати Expand PVC на 3х (тьох) volume - ocs-deviceset-gp2-0-data-0-xxx, ocs-deviceset-gp2-1-data-0-xxx, ocs-deviceset-gp2-2-data-0-xxx і вказати потрібний новий розмір цих volume.

image::admin:ceph-volumes.png[]

2) У CR ocs-storagecluster (інстанс CRD storagecluster.ocs.openshift.io) зайти в редагування yaml та поміняти значення  storage: 768Gi на нове, яке визначене і встановлене у п.1 при розширенні корневих volume.

image::admin:ceph-cr.png[]

Також це значення можно змінити за допомогою команди oc patch... використовуючи cli

3) У неймспейсі openshift-storage перезапустити pods:

image::admin:ceph-pods.png[]

Або перезапустити всі pods цього неймспейсу.


Після виконання всіх послідуючих автоматичних процедур ceph кластеру, дискове пространство буде розширене до нового, встановленого значення.