= Налаштування СЕВ ДЕІР "Трембіта" для виклику для виклику зовнішніми учасниками
:sectnums:
:sectanchors:

== Передумови

=== Задеплоїти обов'язкові файли бізнес-процесів та доступу для звернення:

Приклад
----
- add-lab-trembita.bpmn,
- get-lab-accreditation-info.bpmn
- bp-trembita.yaml
----

=== Обов'язковий компонент на оточенні --> bp-webservice-gateway

== Створення Лабораторії

=== Увійти до сервісу Trembita
=== Розділ «КЛІЄНТИ СЕРВЕРА БЕЗПЕКИ» обрати потрібну SUBSYSTEM
=== Перейти у розділ «Сервіси SOAP»

image::admin:trembita-bp-invoking/trembita-bp-invoking-1.png[]

=== Додати WSDL

Приклад
----
https://bp-webservice-gateway-lowcode-gryffindor-qa.apps.cicd2.mdtu-ddm.projects.epam.com/ws/bpWebservice.wsdl
----

=== Додати права доступу на створеній WSDL

image::admin:trembita-bp-invoking/trembita-bp-invoking-2.png[]

=== Додати об'єкт

image::admin:trembita-bp-invoking/trembita-bp-invoking-3.png[]


=== Вимкнути «Підтвердження сертифікату TLS»

image::admin:trembita-bp-invoking/trembita-bp-invoking-4.png[]

=== Створити файл WSDL з даними Trembita

за форматом
----
http://{​​​Адреса шлюзу безпечного обміну Трембіта}​​​/wsdl?xRoadInstance={​​​Екземпляр системи Трембіта}​​​&memberClass={​​​Тип установи клієнта (GOV)}​​​&memberCode={​​​Унікальний ідентифікатор клієта (код ЄДРПОУ)}​​​&serviceCode={​​​Назва сервісу}​​​&subsystemCode={​​​Назва підсистеми}​​​
----

===  Зберегти файл з WSDL на PC (Повинен бути файл з назвою response)
=== Увійти до SOAP UI та стовити запрос з цим ендпоінтом, як у прикладі

image::admin:trembita-bp-invoking/trembita-bp-invoking-5.png[]

=== Заповнити поля згідно з прикладом та вказата дані створеної лабораторії
Приклад
----
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xro="http://x-road.eu/xsd/xroad.xsd" xmlns:iden="http://x-road.eu/xsd/identifiers" xmlns:bp="https://gitbud.epam.com/mdtu-ddm/low-code-platform/platform/backend/applications/bp-webservice-gateway">

   <soapenv:Header>

      <xro:client iden:objectType="SUBSYSTEM">

         <iden:xRoadInstance>SEVDEIR-TEST</iden:xRoadInstance>

         <iden:memberClass>GOV</iden:memberClass>

         <iden:memberCode> Код Учасника </iden:memberCode>

         <!--Optional:-->

         <iden:subsystemCode>DDMTest_cons</iden:subsystemCode>

      </xro:client>

      <xro:service iden:objectType="SERVICE">

         <iden:xRoadInstance>SEVDEIR-TEST</iden:xRoadInstance>

         <iden:memberClass>GOV</iden:memberClass>

         <iden:memberCode> Код Учасника </iden:memberCode>

         <!--Optional:-->

         <iden:subsystemCode>DDMTest_cons</iden:subsystemCode>

         <iden:serviceCode>startBp</iden:serviceCode>

      </xro:service>

      <xro:userId>MDTUDDM</xro:userId>

      <xro:id>MDTUDDM</xro:id>

      <xro:protocolVersion>4.0</xro:protocolVersion>

   </soapenv:Header>

   <soapenv:Body>

      <bp:startBpRequest>

           <businessProcessDefinitionKey>get-lab-accreditation-info</businessProcessDefinitionKey>

         <startVariables>

            <!--Zero or more repetitions:-->

            <entry>

               <!--Optional:-->

               <key>name</key>

               <!--Optional:-->

               <value>Тестова лабораторія №1</value>

            </entry>

            <entry>

               <!--Optional:-->

               <key>edrpou</key>

               <!--Optional:-->

               <value>12345678</value>

            </entry>

         </startVariables>

      </bp:startBpRequest>

   </soapenv:Body>

</soapenv:Envelope>
----

=== Відправити запит на сервер

image::admin:trembita-bp-invoking/trembita-bp-invoking-6.png[]