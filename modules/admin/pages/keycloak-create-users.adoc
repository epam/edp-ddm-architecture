= Створення користувачів та надання їм прав доступу
:sectnums:
:sectanchors:

Створення нових користувачів та надання їм прав доступу до інструментів реєстру здійснюється у адмін-консолі сервісу https://www.keycloak.org/[Keycloak].

//TODO: Додати інструкцію: "Як отримати доступ до Keycloak?"

Адміністратор платформи повинен мати доступ до 4-х реєстрових reamlfootnote:[*Realm* - це концепція в https://www.keycloak.org/[Keycloak], яка відноситься до об’єкта,
що керує набором користувачів, а також їхніми обліковими даними, ролями та групами.] реєстру:

|===
|realm |Призначення

|`-admin`
|новий realm - в подальшому змінить main

|`-main`
|доступ до Gerrit та Jenkins реєстру

|`-officer-portal`
|Системна роль для доступу до Кабінету Посадової особи (**Officer Portal**) та звітів (https://redash.io/[Redash]).

|-citizen-portal
|Системна роль для доступу до Кабінету Громадянина (**Citizen Portal**).

|===

image:admin:keycloak_list_of_realms.png[]

== Створення та конфігурування користувачів Gerrit та Jenkins реєстру

Для створення нового користувача Gerrit та Jenkins необхідно виконати наступні кроки:

*  Перейдіть до `-main` realm відповідного реєстру -> далі на вкладці **Users** натисніть `View all users` -> далі натисніть кнопку `Add user`.

image:admin:keycloak_view_users.png[]

*  У відкритому вікні введіть дані користувача:

** `Username` - імя, що буде використовуватись як логін до Gerrit та Jenkins.
** `Email` - електронна пошта користувача.
** `First Name` - ім'я користувача.
** `Last Name` - прізвище.
** `User Enabled` - позначка, що користувач активований у системі (якщо вона не активна, доступ такого користувача буде обмежено до систем).
** `Email Verified` - активується у разі необхідності підтвердження електронної пошти.

* Натисніть кнопку `Save` та перейдіть на вкладку **Credentials**.

image:admin:keycloak_add_user.png[]

* Задайте пароль у полі `Password` та підтвердьте його у полі `Password Confirmation`, активуйте позначку `Temporary`, щоб згенерувати тимчасовий пароль.

CAUTION: З метою безпеки необхідно змінити тимчасовий пароль при першому логіні.

* Натисніть кнопку `Save Password`.

image:admin:keycloak_set_credentials.png[]

* Перейдіть на вкладку **Role Mappings** та встановіть необхідні ролі користувачу:

** `gerrit-administrators` - адміністратор Gerrit, роль необхідна для розгортяння регламенту та підтвердження змін (проходження Quality gates)
** `jenkins-administrators` - адміністратор системи Jenkins. Ця роль необхідна для запуску `clean-up` job, перегляду згенегованих та доданих до Jenkins pipelines, перегляду логів та ін.

image:admin:keycloak_assign_roles.png[]

* Виберіть ці ролі та натисніть кнопку `Add selected`, щоб обрана роль відображувалася у секції **Assigned Roles**.

image:admin:keycloak_assign_roles_check.png[]

== Адміністрування доступу користувачів до Кабінету Посадової особи

Для створення нового користувача **Кабінету Посадової особи** необхідно виконати наступні кроки:

* Перейдіть до `-officer-portal` realm відповідного реєстру -> вкладка **Users** -> натисніть кнопку `View all users` -> натисніть кнопку `Add user`.

image:admin:keycloak_op_view_all.png[]

* Виконайте кроки зі створення користувача, описані вище, та встановіть роль `officer` у вкладці **Role Mappings**.
* Натисніть кнопку `Add selected`.

image:admin:keycloak_op_add_user_and_assign_roles.png[]

* Перейдіть на вкладку **Attributes**, та встановіть значення для ключів параметрів `drfo`, `edrpou` та `fullName`, що пов'язані з КЕП користувача, наприклад:

** `drfo:1010101014`;
** `edrpou: 34554362`;
** `fullName: Сидоренко Василь Леонідович`.

CAUTION: *[red]##Увага!##* У разі невідповідності значень атрибутів до значень заданих у КЕП користувач не матиме можливості увійти до Кабінету Посадової особи та підписувати задачі КЕП.

* Вкажіть значення `Registry Officers` для атрибуту `RedashGroups` для можливості перегляду звітів:

** `RedashGroups:Registry Officers`

image:admin:keycloak_op_check_attributes.png[]

== Адміністрування доступу користувачів до Кабінету Громадянина

Для створення нового користувача **Кабінету Громадянина**, необхідно виконати наступні кроки:

* Перейдіть до `-citizen-portal` realm відповідного реєстру -> далі -- на вкладку **Users**. Натисніть **View all users** -> далі натисніть клавішу `Add user`.
* Виконайте кроки зі створення користувача, що описані вище, та зазначте роль `citizen` у вкладці **Role Mappings**.
* Натисніть кнопку `Add selected`
* Перейдіть на вкладку **Attributes**, та вкажіть значення для ключів параметрів `drfo`, `edrpou` та `fullName`, що пов'язані з КЕП користувача, що пов'язані з КЕП користувача.

image:admin:keycloak_cp_create_user.png[]