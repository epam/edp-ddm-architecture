= Створення користувачів та надання їм прав доступу

Створення нових користувачів та наданя їм прав доступу до інструментів реєстру здійснюється у Keycloak платформи, доступ до якого можна отримати виконуючи інструкцію за посиланням.
//TODO: Додати інструкцію: "Як отримати доступ до Keycloak?"
Адміністратор платформи повинен мати доступ до 4-х реєстрових reaml реєстру:

|===
|realm |Призначення

|-admin
|новий realm - у подальшому замінить main

|-main
|доступ до Gerrit та Jenkins реєстру

|-officer-portal
|доступи до кабінету чиновника (Officer Portal) та звітів (Redash)

|-citizen-portal
|доступ до кабінету громадянина (Citizen Portal)

|===

image:admin:keycloak_list_of_realms.png[]

== Створення та конфігорування користувачів Gerrit та Jenkins реєстру

Для створення нового користувача Gerrit та Jenkins необхідно виконати наступні кроки:

*  Перейдіть до **"-main"** realm відповідного реєстру -> вкладка **"Users"** -> натисніть кнопку **"View all users"** -> натисніть кнопку **"Add user"**

image:admin:keycloak_view_users.png[]

*  У відкритому вікні введіть дані користувача:

** __"Username"__ - імя, що буде використовуватись як логін до Gerrit та Jenkins
** __"Email"__ - електронна пошта користувача
** __"First Name" __ - імя користувача
** __"Last  Name" __ - пізвище
** __"User Enabled" __ - позначка, що користувач буде активованим у системі (якщо вона не активна, доступ даного користувача буде обмежений до систем)
** __"Email Verified" __ - активується у разі необхідності підтвердження електронної пошти

* Натисніть кнопку **"Save"** та перейдіть на вкладку **"Credentials"**

image:admin:keycloak_add_user.png[]

* Задайте пароль у полі **"Password"** та  підтвердіть його у полі **"Password Confirmation"**, активуйте позначку **"Temporary"**, щоб згенерувати тимчасовий пароль (який необхідно змінити при першому логіні)
* Натисніть кнопку **"Save Password"**

image:admin:keycloak_set_credentials.png[]

* Перейдіть на вкладку **"Role Mappings"** та задайте необхідні ролі користувачу:

** "_gerrit-administrators_" - адміністратор Gerrit, роль необхідна для розгортяння регламенту та підтвердження змін (проходження Quality gates)
** "_jenkins-administrators_" - адміністратор Jenkins-а, роль необхідна для запуску clean-up job, перегляду роздеплоїних та згенегованих pipelines, перегляду логів та ін.

image:admin:keycloak_assign_roles.png[]

* Виберіть  дані  ролі та натисніть кнопку **"Add selected"**, щоб обрана роль відображалась у секції Assigned Roles

image:admin:keycloak_assign_roles_check.png[]

== Аміністрування доступу користовачів до Кабінету Чиновника

Для створення нового користувача "Кабінету Чиновника" необхідно виконати наступні кроки:

* Перейдіть до **"-officer-portal"** realm відповідного реєстру -> вкладка **"Users"** -> натисніть кнопку **"View all users"** -> натисніть кнопку **"Add user"**

image:admin:keycloak_op_view_all.png[]

* Виконайте кроки по створенню користувача описані вище, та задайте роль **"officer"** у вкладці **"Role Mappings"**
* Натисніть кнопку **"Add selected"**
image:admin:keycloak_op_add_user_and_assign_roles.png[]

* Перейдіть на вкладку "Attributes", та задайте значення _drfo_, _edrpou_ та _fullName_, що  зв'язані з КЕП користувача, наприклад:

** drfo 1010101014
** edrpou 34554362
** fullName Сидоренко Василь Леонідович

CAUTION: *[red]##Увага!##* У разі невідповідності даних значень атрибутів до значень заданих у КЕП - користувач не буде мати можливіть зайти до кабінету чиновника та підписувати задачі КЕП

* Задайте значення **"Registry Officers"** для атрибуту **"RedashGroups"**, для можливості перегляду звітів:

** RedashGroups  Registry Officers

image:admin:keycloak_op_check_attributes.png[]

== Аміністрування доступу користовачів до Кабінету Громадянина

Для створення нового користувача "Кабінету Громадянина" необхідно виконати наступні кроки:

* Перейдіть до **"-citizen-portal"** realm відповідного реєстру -> вкладка **"Users"** -> натисніть кнопку **"View all users"** -> натисніть кнопку **"Add user"**
* Виконайте кроки по створенню користувача описані вище, та задайте роль **"citizen"** у вкладці **"Role Mappings"**
* Натисніть кнопку **"Add selected"**
* Перейдіть на вкладку "Attributes", та задайте значення _drfo_, _edrpou_ та _fullName_, що  зв'язані з КЕП користувача

image:admin:keycloak_cp_create_user.png[]
