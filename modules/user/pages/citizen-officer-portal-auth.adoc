= Автентифікація користувачів реєстру
:toc:
:toc-title: ЗМІСТ
:toclevels: 5
:sectnums:
:sectnumlevels: 5
:sectanchors:

== Загальний опис

Платформа реалізовує складні механізми автентифікації кінцевих користувачів, що дозволяє забезпечити належний захист даних користувачів реєстрів, а також нівелювати можливість несанкціонованого доступу до даних.

В центрі цієї складної системи стоїть **система управління ідентифікацією та доступом (IAM) Keycloak**, що інтегрується із **сервісом для роботи з КЕП** та інтегрованою системою електронної ідентифікації **ID.GOV.UA (ІСЕІ)**.

Наразі Платформа підтримує два типи автентифікації:

* автентифікація користувача за допомогою кваліфікованого електронного підпису (КЕП);
* автентифікація користувача за допомогою інтегрованої системи електронної ідентифікації ID.GOV.UA (ІСЕІ) -- зовнішнього постачальника ідентифікаційних даних та схем електронної ідентифікації, що надаються цією системою, а саме:

** BankID;
** MobileID;
** Дія.Підпис.

[#kep-auth]
== Автентифікація за допомогою кваліфікованого електронного підпису (КЕП)

Автентифікація користувачів за допомогою КЕП відбувається з використанням встановленого на стороні браузера стороннього віджета https://iit.com.ua/downloads[IIT] для виконання операцій, що вимагають шифрування та підпису даних, а також сервісу для роботи з КЕП, що використовує окрему криптобібліотеку від IIT на стороні Платформи для перевірки цілісності та незмінності даних, що передаються з вебклієнта.

Взаємодія користувачів з Платформою та розгорнутими на її базі реєстрами відбувається виключно через імплементовані вебінтерфейси -- додатки **Кабінет отримувача послуг** та **Кабінет посадової особи** -- із будь-якого визнаного індустрією браузера останньої версії.

Автентифікація з КЕП передбачає використання асиметричних алгоритмів шифрування, що забезпечують криптографічний захист даних користувачів.

Для отримання доступу до функцій Кабінету, користувач має увійти до системи, виконавши кроки, описані нижче.

NOTE: Автентифікація з КЕП доступна як в Кабінеті посадової особи, так і в Кабінеті отримувач послуг реєстру.

=== Передумови

Отримайте особистий ключ для підпису даних в одному з https://czo.gov.ua/ca-registry[акредитованих центрів сертифікації ключів (АЦСК)]. Відкритий ключ зберігатиметься на сервері постачальника, в той час, як секретний (закритий) ключ необхідно буде зберегти на одному із захищених носіїв, доступних для використання при вході до системи за допомогою КЕП (_див. крок 3 в підрозділі  xref:auth-process-pass[]_).

[#auth-process-pass]
=== Проходження автентифікації

.*Крок 1*

* Відкрийте сторінку входу до Кабінету отримувача послуг за адресою `https://citizen-portal.example.com/login`, якщо ви фізична або юридична особа і хочете замовити послугу.

* Відкрийте сторінку входу до Кабінету посадової особи за адресою `https://officer-portal.example.com/officer/login`, якщо ви посадова особа, що уповноважена надавати послуги.

NOTE: Адреси сервісів, наведених в тексті вище, є тестовими. При виникненні будь-яких питань, зверніться до адміністратора.

NOTE: Процес входу за допомогою ключа КЕП є ідентичним як для посадових осіб, так і для осіб-отримувачів послуг реєстру.

.*Крок 2*

Натисніть `Увійти до кабінету`:

image:user:cp-auth-1.png[]

[#iit-digital-sign-widget]
.*Крок 3*

* Оберіть тип послуг:
** *Для громадян* -- якщо ви бажаєте увійти як фізична особа (параметр встановлюється за замовчуванням);
** *Для бізнесу* -- якщо ви бажаєте увійти як ФОП або юридична особа.
* Оберіть тип носія особистого ключа:
** оберіть тип *Файловий носій* (параметр встановлюється за замовчуванням).
* У полі `Кваліфікований надавач ел. довірчих послуг` оберіть один з акредитованих центрів сертифікації ключів (АЦСК), натиснувши на елемент випадного списку, або залиште значення `Визначити автоматично`, встановлене за замовчуванням.

image:user:cp-auth-2.png[]

image:user:cp-auth-3.png[]

* Оберіть особистий ключ:

** у полі `Особистий ключ` натисніть `Обрати`;
** знайдіть особистий ключ (наприклад `Key-6.dat`) та натисніть `Open` для підтверження.

image:user:cp-auth-4.png[]

* у полі `Пароль захисту ключа` введіть пароль захисту ключа;
* натисніть `Зчитати` для перевірки введених даних.

image:user:cp-auth-5.png[]

.**Крок 4**

* На формі *Підписати дані* натисніть `Увійти` для входу до Кабінету.
* Альтернативно натисніть `Змінити ключ`, якщо необхідно обрати інший ключ для входу.

image:user:cp-auth-6.png[]

NOTE: У разі використання невірного ключа, на кроці підпису даних сервер повертає помилку, показану на зображенні нижче:

image:user:cp-auth-7-wrong-key.png[]

NOTE: У разі введення невірних ідентифікаційних даних (як то пароль захисту ключа), на кроці підпису даних сервер повертає помилку, показану на зображенні нижче:

image:user:cp-auth-8-wrong-credentials.png[]

NOTE: Після успішного проходження автентифікації в Кабінеті отримувача послуг, у випадку першого входу, особі буде запропоновано пройти процес онбордингуfootnote:[**Онбординг (онбордінг)** -- реєстрація в системі.]. Після проходження цього процесу, особа отримає доступ до функцій Кабінету.

NOTE: В Кабінеті посадової особи процес автоматичної реєстрації не передбачений. Тому перед входом до Кабінету необхідно переконатися, що адміністратор доступу створив відповідного користувача.

== Автентифікація з ID.GOV.UA

NOTE: Автентифікація з ID.GOV.UA доступна лише в Кабінеті отримувача послуг реєстру і не передбачається для посадових осіб. Посадові особи мають проходити процедуру автентифікації виключно з КЕП.

На Платформі реалізована можливість проходження електронної ідентифікації за допомогою електронних підписів (на файловому, хмарному чи інших захищених носіях, за допомогою MobileID), Дія.Підпис та BankID НБУ.

Інтегрована система електронної ідентифікації ID.GOV.UA (ІСЕІ) має атестат відповідності комплексної системи захисту інформації (КСЗІ), тому персональні дані користувачів надійно захищені.

TIP: Для отримання деталей підключення та використання ID.GOV.UA, будь ласка, зверніться до https://id.gov.ua/downloads/IDInfoProcessingD.pdf[технічної документації] або https://id.gov.ua[офіційного сайту].

=== Передумови

* Найперше, виконайте **кроки 1 та 2** підрозділу xref:citizen-officer-portal-auth.adoc#auth-process-pass[] цього документа.
* Натисніть на відповідний елемент для автентифікації з ID.GOV.UA:

image:user:cp-auth-idgovua-1.png[]

* Оберіть бажану схему (спосіб) автентифікації:

** xref:citizen-officer-portal-auth.adoc#auth-mobile-id[MobileID];
** xref:citizen-officer-portal-auth.adoc#auth-bank-id[BankID];
** xref:citizen-officer-portal-auth.adoc#auth-dia-signature[Дія.Підпис].

image:user:cp-auth-idgovua-2.png[]

** Дотримуйтеся інструкцій, описаних у підрозділах нижче.

[#auth-mobile-id]
=== Автентифікація з MobileID

**MobileID** -- послуга електронної ідентифікації та кваліфікованого електронного підпису, яку надає оператор мобільного зв’язку. Ця послуга передбачає, що особистий ключ записується безпосередньо на спеціально призначену для цього SIM-карту.

За більш детальною інформацією щодо можливості надання цієї послуги ви можете звернутись до вашого оператора мобільного зв’язку.

Щоб авторизуватися на сайті за допомогою MobileID, вам необхідно:

1. Обрати вашого мобільного оператора.

2. Ввести ваш номер мобільного телефону.

3. Підтвердити вхід або підпис за допомогою пін-коду, який ви створили ще при підключенні послуги.

[#auth-bank-id]
=== Автентифікація з BankID НБУ

Сервіс надається Національним банком України та можливий лише для клієнтів тих банків, які його підтримують.

Після обрання свого банку ви будете переадресовані на його сайт для проходження автентифікації з використанням логіна, пароля, номера картки.

У разі успішної автентифікації на сайті банку, система Bank ID передасть ваші персональні дані, що дозволить вас ідентифікувати.

[#auth-dia-signature]
=== Автентифікація з Дія.Підпис

**Дія ID** -- послуга електронної ідентифікації для користувачів, які отримували особистий ключ віддалено за допомогою мобільного застосунку Дія. Дія.Підпис містить дві частини. Одна частина зберігається у вашому смартфоні, а інша — в спеціальному захищеному модулі порталу Дія.

Отримати особистий ключ віддалено за допомогою мобільного застосунку Дія мають можливість громадяни України, які є власниками ID-картки або біометричного закордонного паспорта.

Щоб авторизуватися на сайті за допомогою Дія ID, вам необхідно:

1. Відсканувати QR-код.

2. Зчитати особистий ключ шляхом сканування обличчя (перевірки за фото) та вводу пароля до особистого ключа.

3. У разі успішної автентифікації у мобільному застосунку Дія, система передає ваші персональні дані, що дозволить вас ідентифікувати.