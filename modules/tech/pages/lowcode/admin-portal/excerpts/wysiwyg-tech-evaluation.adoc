= Аналіз WYSIWYG-редакторів на відповідність ключовим вимогам

== Контекст

Задля спрощення досвіду створення HTML-шаблонів, необхідно надати адміністратору візуальний _WYSIWYG_ редактор, який дозволить формувати статичний шаблон та визначати місця для вставки динамічних даних визначати конструкції циклів, умов, тощо.

== Функціональні сценарії

- Створення HTML-шаблонів для генерації витягів з реєстру
- Створення HTML-шаблонів для генерації поштових повідомлень

== Шаблонізація

=== Технології шаблонізації

В рамках аналізу розглядаються підходи з використанням наступних технологій шаблонізації:

- https://freemarker.apache.org/[Freemarker] - технологія шаблонізації, яка дозволяє на базі статичного шаблону (_ftl_ / _ftlh_) зі спеціальними директивами та вхідних даних згенерувати вихідний HTML-документ
- https://www.thymeleaf.org/[Thymeleaf] - технологія шаблонізації, яка дозволяє на базі статичного HTML-шаблону зі спеціальними атрибутами та вхідних даних згенерувати вихідний HTML-документ

=== Опис шаблонів

Файл шаблону описує статичну структуру документу з використанням спеціальних конструкцій для заповнення динамічними даними. Результатом роботи процесора шаблонізації є фінальний HTML-документ заповнений даними.

==== Приклад Freemarker-шаблону

[source, html]
----
<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="center">
        <img src="images/ua.png" class="trinity"/>
    </div>
    <#if user == "Joe">
    <p class="header text14">
        ...
    </p>
    </#if>
    <table>
        <tbody>
        <#list animals as animal>
            <tr><td>${animal.name}<td>${animal.price} Euros
        </#list>
        </tbody>
    </table>
</body>
</html>
----

=== Приклад Thymeleaf-шаблону

[source, html]
----
<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="center">
        <img src="images/ua.png" class="trinity"/>
    </div>
    <p class="header text14" th:if="${user} == 'Joe'">
        ...
    </p>
    <table>
        <tbody>
            <tr th:each="animal: ${animals}">
              <td th:text="${animal.name}"></td>
            </tr>
        </tbody>
    </table>
</body>
</html>
----

=== Підходи до моделювання шаблонів з використанням WYSIWYG та шаблонізатора

- Кастомізація _WYSIWYG_-редактора для коректної підтримки _Freemarker_-шаблонів з директивами
- Формування власного підходу на базі атрибутів до серіалізації/десеріалізації _Freemarker_-шаблонів з директивами у _HTML_-сумісний вигляд для використання у _WYSIWYG_-редакторі
- Використання HTML-сумісної технології шаблонізації на базі спеціальних атрибутів _Thymeleaf_ та її натуральне використання у _WYSIWYG_-редакторі

== Вибір WYSIWYG-редактора шаблонів

=== Ключові функціональні вимоги до візуального редактора

- Можливість завантаження зображень в inlined формі
- Можливість використання зображень за URL лінками
- Можливість використання чітко визначених наборів стилів для формування та перегляду шаблонів
- Використання чітко визначених css класів стилів в кожному наборі стилів задля підтримки темізації.
- Можливість окремої стилізації для FTL значень (включаючи репорт)
- Підсвічення FTL вставок при редагуванні (to be discussed)
- FTL функціональність:
** Можливість вибору ключа значення (назви змінної) прі вставці значення
** Візуальна категоризація та вибір необхідних FTL тегів для використання
- Можливість використання таблиць
** look and feel:
*** Colgroup з можливістю коригування ширини колонок у відсотках
*** Товщина границь включно з нульовою
*** Alignment всередині комірок
** Data source access requirements (action: ask for most complex report)
- Два режими для редагування шаблону: WYSIWYG та вихідного коду, та синхронізація обох варіантів
- Робота з посиланнями
** href повинен підтримувати темплітизацію та підстановку значень змінных в FTL (do we need to support this?)
** mailto посилання

=== Ключові нефункціональні вимоги до візуального редактора

- Централізація контенту (включно із зображеннями)
- Шаблонізація для репортів та mail листів
- Додаткові класи для комірок таблиць

=== Розглянуті WYSIWYG-редактори

- TinyMCE
- CKEditor
- Quill
- Draft.js
- Slate

=== Аналіз WYSIWYG-редакторів на відповідність вимогам

[cols=">.^,^.^,^.^,^.^,^.^,^.^"]
|===
|Рішення|Quill (+ react-quill)|Draft.js|TinyMCE (+ tinymce-react)|CKEditor (+ ckeditor5-react)|Slate (+ slate-react)

6+^|Загальна інформація

|Ліцензія
|BSD-3-Clause + MIT
|MIT
|MIT
|GPL-2.0-or-later
|MIT

|Завантажень
|868k+/329k+
|795k+
|302k+/136k+
|177k+/72k+
|332k+/263k+

|Підтримка TypeScript
|DT + TS
|DT
|TS
|-
|TS

|Issues (Open/Closed)
|1143/1891 + 229/419
|773/970
|944/4710 + 11/213
|2440/7681 + 48/201
|487/2355

|PRs (Open/Closed)
|89/450 + 13/141
|166/1192
|15/2099 + 0/81
|41/1657 + 0/61
|21/2057

|Підтримка пакету
|Остання стабільна версія 1.3.7 - три роки тому; готується реліз 2.х версії
|Актуальна версія 0.11.7 - два роки тому
|Останні оновлення - протягом попередніх тижнів
|Останні оновлення - протягом попередніх тижнів
|Досі в бета-режимі; часті зміни, відсутність стабільної версії

// |Сумісність з браузерами
// |
// |
// |
// |
// |

|Складність інтеграції
|S
|L
|M
|L
|L

|Коментарі щодо складності інтеграції
|Є невеликі нюанси із налаштуваннями додаткового функціонала
|Потребує створення навіть найпростішого тулбара та операцій "з нуля"
|Відносно легко, але потребує або API-ключ для хмарного використання, або додаткових налаштувань для бандлінгу, або копіювання статичних файлів
|Базова інтеграція - нескладно, розширення функціоналу - складно
|Майже потребує створення тулбару, форматів та серіалізації "з нуля"

6+^|Functional Requirements

|Можливість завантаження зображень в inlined формі
|S
|XL
|S
|(skip)
|L

|Можливість використання зображень за URL лінками
|M
|XL
|S
|S
|L

|Можливість використання чітко визначених наборів стилів для формування та перегляду шаблонів
|M
|L
|M
|L
|L

|Використання чітко визначених css класів стилів в кожному наборі стилів задля підтримки темізації.
|S
|L
|M
|XL
|L

|Можливість налаштування кнопок для FTL-кодів
|S
|(skip)
|S
|(skip)
|(skip)

|Можливість окремої стилізації для FTL значень (включаючи репорт)
|
|(skip)
|S
|(skip)
|(skip)

|Підсвічення FTL вставок при редагуванні (to be discussed)
|
|(skip)
|S
|(skip)
|(skip)

|FTL: можливість вибору ключа значення (назви змінної) прі вставці значення
|M
|(skip)
|M
|(skip)
|(skip)

|FTL: візуальна категорізація та вибір необхідних FTL тегів для використання
|
|
|
|
|

|Таблиці: colgroup з можливістю коригування ширини колонок у відсотках
|XL (M для 2.х.х)
|(skip)
|M
|N/A
|(skip)

|Таблиці: товщина границь включно з нульовою
|XL (M для 2.х.х)
|(skip)
|S
|M
|(skip)

|Таблиці: alignment всередині комірок
|XL (M для 2.х.х)
|(skip)
|S
|M
|(skip)

|Таблиці: merge cells
|XL (M для 2.х.х)
|(skip)
|S
|S
|(skip)

|Таблиці: FTL-теги для умов та циклів
|XL
|XL
|XL
|XL
|XL

|Два режими для редагування шаблону: WYSIWYG та вихідного коду, та синхронізація обох варіантів
|S
|M
|S
|S
|M

|Лінки: href повинен підтримувати темплітизацію та підстановку значень змінних у FTL
|S
|(skip)
|S
|(skip)
|(skip)

|Лінки: mailto посилання
|S
|(skip)
|S
|(skip)
|(skip)

|Шаблонізація ітерованих даних
|L
|XL
|M
|(skip)
|L

|Історія контенту (Undo/Redo)
|
|
|S
|S
|M

|
|
|
|
|
|

6+^|Non-functional Requirements

|Доступність форматів "з коробки"
|M
|L
|S
|S
|L

|Централізація контенту (включно із зображеннями)
|
|
|S
|M
|

|Шаблонізація для репортів та mail листів
|
|
|M
|L
|

|Створення кастомних тегів для умов та циклів
|
|(skip)
|S
|L
|M

|Окреме оформлення кастомних тегів у редакторі
|
|
|S
|(skip)
|

|Додатковий інтерактивний функціонал кастомних тегів у редакторі
|(not investigated)
|(not investigated)
|(not investigated)
|(not investigated)
|(not investigated)

|Додаткові класи для комірок таблиць
|
|
|S
|
|

6+^|Технічні нотатки

// |Функціонал "з коробки"
// |
// |
// |
// |
// |

|Тулбар "з коробки"
|Присутній, кастомізується перелік та порядок кнопок та форматів
|Відсутній, створюється з нуля
|Присутній; багато функціоналу у вигляді вбудованих плагінів
|Присутній; багато функціоналу у вигляді плагінів
|Відсутній, створюється з нуля

|Кастомізація зовнішнього вигляду тулбару
|дві вбудовані теми (звичайний тулбар та тулбар-тултіп); додаткові кнопки - через псевдоелементи
|повністю кастомний тулбар із кастомними стилями
|
|
|повністю кастомний тулбар із кастомними стилями

|Кастомізація тулбару - створення кнопок
|Самі кнопки - легко; операції з ними - мають певні нюанси для операцій оформлення елементів
|Можливо, кнопки "ламаються" при синхронізації з іншим текстовим полем
|Легко
|
|Можливо

|Автоматичне форматування вмісту
|+
|+
|+
|+
|+

|Формати за замовчанням
|Вбудований набір основних необхідних форматів
|Вбудовані утиліти для створення форматів
|Широкий набір форматів у рамках вбудованих плагінів
|Широкий набір форматів у рамках зовнішніх плагінів
|Гнучке створення форматів власноруч

|Зображення (по URL)
|Вручну, при вставленні за замовчанням
|?
|Вручну, при вставленні за замовчанням
|Вручну, при вставленні за замовчанням
|

|Зображення (base64)
|За замовчанням при завантаженні з диску
|?
|Вбудований плагін для завантаження з диску
|
|

|Зображення (upload на бекенд)
|(not investigated), але існують зовнішні приклади
|(not investigated)
|(not investigated)
|(not investigated)
|(not investigated)

|Зображення (вставити)
|З іншого сайту - URL
|З іншого сайту - не працює
|З іншого сайту - URL
|З іншого сайту - URL
|

|Зображення (завантаження з диску)
|За замовчанням - в base64
|?
|Вбудований плагін для завантаження з диску, base64
|За замовчанням - нема дії, попередження про відсутність адаптера завантаження
|

|Використання зовнішніх стилів для контенту
|Легко, за іменами класів з підключених стилів, є певні обмеження по префіксах імен класів
|
|Середня складність, необхідно задавати CSS як рядковий проп редактора
|
|

|Використання inline-стилів для контенту
|Легко, із використанням наперед визначених форматів та можливих значень
|
|Легко, із використанням наперед визначених форматів та можливих значень
|
|

|Використання шорт-кодів FTL
|Легко за допомогою кастомних кнопок тулбару
|
|Легко у разі заміни на кастомні теги
|
|Прогнозовано легко за рахунок внутрішнього довільного формату даних

|Можливість синхронізації вмісту з окремим текстовим полем для редагування вихідного коду
|Тільки з десинхронізацією оновлення
|Тільки з десинхронізацією оновлення; ламає функціонал операції форматування
|Тільки з десинхронізацією оновлення; також є вбудований плагін із модалкою із власним десинхронізованим полем
|Тільки з десинхронізацією оновлення; наче є плагін із модалкою, але не протестовано
|Тільки з десинхронізацією оновлення

|Синхронізація змін між режимами перегляду
|Перегляд - в живому режимі, редагування - з десинхронізацією оновлення
|
|Перегляд - в живому режимі, редагування - з десинхронізацією оновлення
|Перегляд - в живому режимі, редагування - з десинхронізацією оновлення
|Перегляд - в живому режимі, редагування - з десинхронізацією оновлення

|Використання таблиць у контенті
|Плагіни лише для 2.0.0-dev.3 та вище; для першої версії - нема
|-
|Вбудований плагін для управління таблицями; можна редагувати ширину таблиці та колонок, ховати границі, редагувати вирівнювання в комірках; усі стилі - інлайнові
|Можливість вставки таблиць; за замовчанням нема можливості редагування розмірів колонок та вирівнювання, лише потенційно з плагінами
|

|Можливість імплементації існуючого шаблону
|
|
|
|
|

|Можливість імплементації email-шаблону
|
|
|
|
|

|Експорт HTML
|З коробки
|З використанням зовнішньої бібліотеки
|З коробки
|З коробки
|Імпорт та експорт прописуються власноруч

|Інші формати експорту
|-
|Markdown - з використанням зовнішньої бібліотеки
|Текстовий
|-
|Імпорт та експорт прописуються власноруч

|Примітки
|
|Зберігає контент у власному внутрішньому форматі, з якого та в який треба окремо конвертувати; операції залежні від фокуса елементу редактора, котрий конфліктує з іншими елементами форми
|За замовчанням підтягується із зовнішньої хмари та потребує API-ключ; є можливість натомість бандлити
|Відсутній TypeScript; окремі танці з бубном при управлінні залежностями і плагінами; все це робить підтримку коду досить складною; нові кнопки можна додавати лише через самописні плагіни
|Still Beta; документація часто застаріла через нестабільність версій; зберігає контент у власному внутрішньому форматі; певні танці з бубном для TypeScript
|===

== Рішення за результатами аналізу

[TIP]
Додати резолюцію за результатами проведеного аналізу з рекомендацією по обраній технології шаблонізації та WYSIWYG-редактору

Рекомендовано використання https://www.thymeleaf.org/[Thymeleaf] у якості шаблонізатора для HTML-документів з урахуванням сумісності з WYSIWYG-редактором.

== Підтримка темування та стилізації

[TIP]
Описати механізм реалізації вимоги

== Підтримка локалізації

[TIP]
Описати механізм реалізації вимоги

== Інтерфейс веб-редактора

[TIP]
Додати екрани для візуалізації досвіду моделювання згідно функціональних сценаріїв
