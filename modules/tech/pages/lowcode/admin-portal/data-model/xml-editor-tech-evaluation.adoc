= Аналіз XML-редакторів на відповідність ключовим вимогам

== Функціональні сценарії

- Внесення змін до _Liquibase_ XML-Changelog файлів опису дата моделі

== Приклади коду для редагування

=== Liquibase XML-Changelog опису дата моделі

[source, xml]
----
<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.5.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext https://nexus-public-mdtu-ddm-edp-cicd.apps.cicd2.mdtu-ddm.projects.epam.com/repository/extensions/com/epam/digital/data/platform/liquibase-ext-schema/latest/liquibase-ext-schema-latest.xsd">

<changeSet id="table koatuu" author="registry owner">
        <createTable tableName="koatuu" ext:historyFlag="true">
            <column name="koatuu_id" type="UUID" defaultValueComputed="uuid_generate_v4()">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_koatuu_id"/>
            </column>
            <column name="code" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="level1" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="level2" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="type" type="TEXT"/>
            <column name="category" type="CHAR(1)"/>
            <column name="name" type="TEXT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
</databaseChangeLog>
----

== Ключові вимоги до редактора

- Підтримка автодоповнення
- Синтаксичний аналіз
- Підтримка валідації вибраної schema
- Підтримка автодоповнення для вибраної schema

== Розглянуті рішення

[NOTE]
Необхідно провести дослідження альтернативних рішень _XML_ веб-редакторів та додати до порівняння.

- https://github.com/suren-atoyan/monaco-react[@monaco-editor/react] React бібліотека розроблена на базі https://microsoft.github.io/monaco-editor/[monaco-editor]
-  https://codemirror.net[CodeMirror]

== Аналіз на відповідність вимогам

|===
|Критерій / Функціональність | @monaco-editor/react

|Підтримка автодоповнення
|Так

|Підтримка валідації вибраної schema
|Базовий функціонал відсутній, але потрібно розглянути рішення з інтегруванням кастомних розширень з VsCode для веб версії редактора

|Синтаксичний аналіз
|Базовий функціонал відсутній, але потрібно розглянути рішення з інтегруванням кастомних розширень з VsCode для веб версії редактора

|Підтримка автодоповнення для вибраної schema
| Базовий функціонал відсутній, але потрібно розглянути рішення з інтегруванням кастомних розширень з VsCode для веб версії редактора. Існує базова підтрика Liquibase-конструкцій, реалізована в розширенні https://github.com/rockinrimmer/VSCode-Liquibase-Snippets[VSCode-Liquibase-Snippets]
|Підтримка можливості порівняння версій xml
|Так

|Підтримка коментарів
|Так

|Можливість згортання та розгортання блока з кодом
|Так

|===

== Рішення за результатами аналізу
Рекомендовано використовувати бібліотеку @monaco-editor/react. Наразі декотрі функції не підтримуються, але буде розглянута можливість реалізації в наступних задачах(PoC). 

== Підтримка темування та стилізації

Бібліотека @monaco-editor/react надає доступні варіанти теми "vs-dark" | «light». Також ми можемо визначати власні теми за допомогою monaco.editor.defineTheme https://microsoft.github.io/monaco-editor/playground.html#customizing-the-appearence-exposed-colors[Приклад]

== Підтримка автодоповнення
Бібліотека @monaco-editor надає наступне API для підтримки автодоповнення. Для цього ми викликаємо метод https://microsoft.github.io/monaco-editor/api/modules/monaco.languages.html#registerCompletionItemProvider[_registerCompletionItemProvider()_] у об'єкта _monaco.languages_, який приймає два аргументи _languageId_(мова, на прикладі xml) та об'єкт https://microsoft.github.io/monaco-editor/api/interfaces/monaco.languages.CompletionItemProvider.html[_provider_]. В об'єкта _provider_ є значення https://microsoft.github.io/monaco-editor/api/interfaces/monaco.languages.CompletionItemProvider.html#provideCompletionItems[_provideCompletionItems_], в яке передаємо функцію, яка, в свою чергу, повертає об'єкт зі значенням https://microsoft.github.io/monaco-editor/api/interfaces/monaco.languages.CompletionItem.html[_suggestions_] - це масив елементів, в якому ми опишемо значення для автодоповнення. +
На приклад:
[source, javascript]
----
monaco.languages.registerCompletionItemProvider('xml', {
	provideCompletionItems: function () {
		return {
			suggestions: [
        {
          label: 'createTable',
          kind: monaco.languages.CompletionItemKind.Function,
          documentation: 'Create Table.',
          insertText: `
            <createTable 
              catalogName="${cat}",
              remarks="${remarks}",
              schemaName="${public}",
              tableName="${person}",
              tablespace="${tablespace}"
            >
              <column name="${address}" type="${int}" />,
            </createTable>`,
          insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
        }
      ]
		};
	}
});

----
На прикладі вищє, якщо користувач почне набирати символи які будуть співпадати з полем _label_, редактор запропонує вибрати це значення зі списку автодоповнення. Якщо користувач натисне на це слово, в редакторі автоматично підставиться значення з поля _insertText_.

== Інтерфейс веб-редактора

=== Основний інтерфейс редактора

image::lowcode/admin-portal/business-processes/xml.png[]

=== Авто-доповнення

image::lowcode/admin-portal/business-processes/xml-autocomplete.png[]

=== Порівняння версій xml

image::lowcode/admin-portal/business-processes/xml-diff.png[]