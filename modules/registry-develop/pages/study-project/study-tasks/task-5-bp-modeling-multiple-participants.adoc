:toc-title: ЗМІСТ
:toc: auto
:toclevels: 5
:experimental:
:important-caption:     ВАЖЛИВО
:note-caption:          ПРИМІТКА
:tip-caption:           ПІДКАЗКА
:warning-caption:       ПОПЕРЕДЖЕННЯ
:caution-caption:       УВАГА
:example-caption:           Приклад
:figure-caption:            Зображення
:table-caption:             Таблиця
:appendix-caption:          Додаток
:sectnums:
:sectnumlevels: 5
:sectanchors:
:sectlinks:
:partnums:

= Завдання 5. Моделювання бізнес-процесу із декількома учасниками

== Мета завдання

Мета завдання: ::
* [*] навчити моделювати бізнес-процес, що має декількох учасників.
* [*] навчити моделювати форми та налаштовувати їх за допомогою *formVariables*.

В рамках цього завдання моделювальники мають: ::
+
[%interactive]
* [ ] змоделювати 1 бізнес-процес;
* [ ] змоделювати 5 форм внесення даних до бізнес-процесу;
* [ ] створити ролі, необхідні для функціонування у бізнес-процесі;
* [ ] надати доступи до бізнес-процесу для відповідних ролей;
* [ ] зберегти створені артефакти до локального git-репозиторію;
* [ ] перенести локальні зміни до віддаленого Gerrit-репозиторію.

== Передумови

Перед проходженням завдання необхідно виконати наступні передумови:

. xref:bp-modeling/bp/element-templates/bp-element-templates-installation-configuration.adoc#business-process-modeler-extensions-installation[Встановіть додаток Camunda Modeler і типові розширення до нього].
. xref:registry-develop:bp-modeling/forms/bp-modeling-forms-general-description.adoc[Ознайомтеся із компонентами FormIO для моделювання форм].

== Процес виконання завдання

=== Моделювання бізнес-процесу

[TIP]
====
На етапі моделювання бізнес-процесу необхідно створити та зберегти відповідну BPMN-діаграму.

Використовуйте файл _link:{attachmentsdir}/study-project/task-5/bp-schema/citizen-add-lab.bpmn[citizen-add-lab.bpmn]_ із готовою схемою бізнес-процесу як приклад.
====

[checklist-bp-modeling]
==== Чекліст моделювання бізнес-процесу

Використовуйте наведений чекліст із переліком кроків для створення бізнес-процесу:

[%interactive]
* [ ] xref:#create-pool-participant[]
* [ ] xref:#create-start-event[]
* [ ] xref:#create-script-task-prepare-data-view[]
* [ ] xref:#create-user-task-add-lab-data[]
* [ ] xref:#create-service-task-search-lab-data-transient-var[]
* [ ] xref:#create-xor-gateway[]
* [ ] xref:#create-branch-validation-error[]
* [ ] xref:#create-branch-continue-bp[]
* [ ] xref:#create-user-task-sign-lab-data[]
* [ ] xref:#create-service-task-get-users-officer-role[]
* [ ] xref:#create-user-task-set-executor-validate-docs[]
* [ ] xref:#create-script-task-prepare-doc-data-view[]
* [ ] xref:#create-user-task-check-uniqueness-lab-record[]
* [ ] xref:#create-xor-gw-lab-unique[]
* [ ] xref:#create-branch-negative-bp-result[]
* [ ] xref:#create-branch-continue-bp-1[]
* [ ] xref:#create-user-task-sign-lab-data[]
* [ ] xref:#create-script-task-prepare-data-record-transient-var[]
* [ ] xref:#create-call-activity-sign-data-by-system-key[]
* [ ] xref:#create-service-task-save-data-to-data-factory[]
* [ ] xref:#create-error-intermediate-boundary-event[]
* [ ] xref:#create-service-task-bp-result-lab-created[]
* [ ] xref:#create-end-event[]
* [ ] xref:#save-bp-schema[]

CAUTION: *Важливо!* Після проходження всіх етапів, не забудьте зберегти змодельовану схему бізнес-процесу до відповідної папки з регламентом реєстру (_див. xref:#save-bp-schema[]_)

[#create-pool-participant]
==== Створення пулу для бізнес-процесу

Найперше, _змоделюйте пул для бізнес-процесу_. Для цього виконайте кроки, подані нижче:

NOTE: Моделювання діаграми бізнес-процесу має відбуватися в рамках елемента *Create Pool/Participant*.


. Відкрийте додаток *Camunda Modeler* та створіть нову діаграму BPMN. Для цього у лівому верхньому куті натисніть меню *File* -> *New File* -> *BPMN Diagram*:
+
image:registry-develop:bp-modeling/bp/modeling-instruction/bp-1.png[]

. На панелі інструментів зліва знайдіть елемент *Create pool/Participant* та перетягніть його до панелі моделювання:
+
image:registry-develop:bp-modeling/bp/modeling-instruction/bp-2.png[]

. Заповніть наступні поля відповідними значеннями:

* у полі `Name` введіть значення `Створення лабораторії`;
* у полі `Process id` вкажіть `citizen-add-lab`;
* у полі `Process name` вкажіть `Процес створення лабораторії`:

+
image:study-project/task-5/task-5-bp-1.png[]

[#create-start-event]
==== Створення початкової події

_Створіть початкову подію_. Для цього виконайте наступні кроки:

. На панелі інструментів, зліва, знайдіть елемент (коло) *CreateStartEvent* та перетягніть його до панелі моделювання:
+
image::registry-develop:bp-modeling/bp/bp-keys/bp-keys-create-start-event.png[]
+
image::registry-develop:bp-modeling/bp/bp-keys/bp-keys-create-start-event-1.png[]

. На панелі налаштувань справа заповніть наступні параметри відповідними значеннями:
** у полі `Name` введіть `Початок`;
** у полі `Initiator` введіть `initiator`.

+
image:study-project/task-5/task-5-bp-2.png[]

[#create-script-task-prepare-data-view]
==== Створення задачі скриптування "Підготовка даних для показу"

На цьому етапі необхідно _змоделювати задачу скриптування для підготовки даних до показу_. Для цього виконайте наступні кроки:

. Оберіть коло із початковою подією, змодельованою на xref:#create-start-event[попередньому етапі], та приєднайте нову задачу, натиснувши іконку *Append Task*:
+
image:study-project/task-5/task-5-bp-03.png[]

. Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *Script Task* (Задача скриптування):
+
image:study-project/task-5/task-5-bp-03-1.png[]

. Виділіть додану задачу скриптування та налаштуйте наступні параметри:

* у полі `Id` вкажіть `convertSignFormDataToDataFactoryFormatActivity`;
* у полі `Name` введіть `Підготовка даних для показу`;
* у полі `Script Format` зазначте формат (мову) скриптування `groovy`;
* у полі `Script type` вкажіть тип скрипту `InlineScript`;
* у полі `Script` вставте безпосередньо groovy-скрипт:
+
====
[%collapsible]
.Натисніть, щоб розгорнути або згорнути
=====
[source,groovy]
----
def cephData = [:]

cephData['edrpou'] = initiator().edrpou

execution.removeVariable('payload')
set_transient_variable('payload', S(cephData, 'application/json'))
----
=====
====
+
image:study-project/task-5/task-5-bp-3.png[]

[#create-user-task-add-lab-data]
==== Створення користувацької задачі "Додати інформацію про лабораторію"

На цьому етапі необхідно _змоделювати користувацьку задачу_ `Додати інформацію про лабораторію`.

На прикладі xref:study-project/study-tasks/task-3-bp-modeling-with-integration.adoc#create-task-add-lab-data[Завдання 3] створіть користувацьку задачу, призначену для внесення даних користувачем. Для цього виконайте наступні кроки:

. Оберіть прямокутник із задачею скриптування, змодельованою на xref:#create-script-task-prepare-data-view[попередньому етапі], та приєднайте нову задачу.

. Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *User Task* (Користувацька задача).

. На панелі налаштувань справа натисніть `Open Catalog`, оберіть шаблон *User Form* із каталогу та натисніть `Apply` для підтвердження.

. На панелі налаштувань справа заповніть наступні поля:

* у полі `Id` зазначте `addLabCitizenActivity`;
* у полі `Name` введіть `Додати інформацію про лабораторію`;
* у полі `Form key` введіть `citizen-add-lab-bp-add-lab`;
* у полі `Assignee` вкажіть `${initiator}`;
* у полі `Form data pre-population` вкажіть `${payload}`.

+
image:study-project/task-5/task-5-bp-4.png[]

[#create-service-task-search-lab-data-transient-var]
==== Створення сервісної задачі "Пошук даних про лабораторію (transient var)"

На цьому етапі необхідно _створити сервісну задачу_ `Пошук даних про лабораторію (transient var)`.

На прикладі xref:study-project/study-tasks/task-3-bp-modeling-with-integration.adoc#create-service-task-search-lab-data[Завдання 3] змоделюйте сервісну задачу для пошуку даних про лабораторію. Для цього виконайте наступні кроки:

. Оберіть прямокутник із користувацькою задачею `Додати інформацію про лабораторію`, змодельованою на xref:#create-user-task-add-lab-data[попередньому етапі], та приєднайте нову задачу, натиснувши іконку *Append Task*.

. Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *Service Task* (Сервісна задача).

. На панелі налаштувань справа натисніть `Open Catalog`, оберіть шаблон *Search for entities in data factory* (Пошук значень у фабриці даних) та натисніть `Apply` для підтвердження.

. На панелі налаштувань справа заповніть наступні поля:

* у полі `Name` має бути вказано `Пошук даних про лабораторію (transient var)`;

* у розділі *Input Parameters* -> *Resource* зазначте наступне:
** у полі `Variable Assignment Type` вкажіть `String or Expression`;
** у полі `Variable Assignment Value` вкажіть `laboratory-equal-edrpou-name-count`;

+
image:study-project/task-5/task-5-bp-5.png[]

* у розділі *Input Parameters* -> *Search Variables* вкажіть наступне:
** у полі `Variable Assignment type` вкажіть `Map`.
** у полі `Add Entry` додайте параметри `name` та `edrpou`, натиснувши на позначку плюса (`+`) та вкажіть для них відповідні значення:
+
|===
|Key |Value

|`name` |`${submission('addLabCitizenActivity').formData.prop('name').value()}`

|`edrpou`
|`${submission('addLabCitizenActivity').formData.prop('edrpou').value()}`
|===
+
image:study-project/task-5/task-5-bp-6.png[]


* у розділі *Input Parameters* -> *X-Access-Token* вкажіть наступне:
** у полі `Variable Assignment Type` вкажіть `String or Expression`;
** у полі `Variable Assignment Value` вкажіть `${completer('addLabCitizenActivity').accessToken}`.
+
[WARNING]
====
Після відпрацювання першої користувацької задачі (User Task), намагайтеся використовувати функцію *`completer('<task_id>')`* для отримання даних користувача, замість `initiator()`.

Токен доступу береться з АБО ініціатора (наприклад, `$initiator().accessToken}`), АБО виконавця останньої користувацької задачі (наприклад, `${completer('taskDefinitionId').accessToken}`).

JWT-токен має свій термін дії, який триває 300 секунд. Якщо вказати токен ініціатора, який запустив бізнес-процес, а користувач довго не виконував задачу, то термін дії токена спливе, й бізнес-процес необхідно буде запускати повторно.

Детальніше про JUEL-функції ви можете переглянути на сторінці xref:registry-develop:bp-modeling/bp/modeling-facilitation/modelling-with-juel-functions.adoc[].
====

* У розділі *Output Parameters* -> *Result Variable* параметр `Assign to Process Variable` заповніть значенням `response`:

+
image:study-project/task-5/task-5-bp-7.png[]

[#create-xor-gateway]
==== Створення та заповнення XOR-шлюзу "Дані присутні?"

На прикладі xref:study-project/study-tasks/task-3-bp-modeling-with-integration.adoc#create-xor-gateway[Завдання 3] приєднайте XOR-шлюз. Для цього виконайте кроки, подані нижче:

. Оберіть прямокутник із сервісною задачею `Пошук даних про лабораторію (transient var)`, змодельованою на xref:#create-service-task-search-lab-data-transient-var[попередньому етапі], та приєднайте XOR-шлюз, натиснувши іконку *Append Gateway*.

. На панелі налаштувань справа, у полі `Name` вкажіть назву шлюзу -- `Дані присутні?`.

+
image:study-project/task-5/task-5-bp-8.png[]

[#create-branch-validation-error]
==== Створення гілки з валідаційною помилкою

На прикладі xref:study-project/study-tasks/task-3-bp-modeling-with-integration.adoc#create-validation-error-branch[Завдання 3] створіть гілку з валідаційною помилкою. Для цього виконайте кроки, подані нижче:

. Оберіть ромб із XOR-шлюзом `Дані присутні?`, змодельованим на xref:#create-xor-gateway[попередньому етапі], та створіть нову сервісну задачу, натиснувши іконку *Append Task*.

. Визначте тип задачі, натиснувши іконку ключа та обравши з меню пункт *Service Task* (Сервісна задача).

. Натисніть `Open Catalog`, оберіть шаблон *Throw validation error* та натисніть `Apply` для підтвердження.

. На панелі налаштувань справа заповніть наступні поля:

* у полі `Name` введіть `Формування валідаційної помилки`.

* У розділі *Input Parameters* -> *Validation Errors* зазначте наступне:
** у полі `Variable Assignment Type` вкажіть тип `List`;
** для поля `Value` додайте наступне значення:
+
.Значення
[source,json]
----
{"field": "name", "value": "${submission('addLabCitizenActivity').formData.prop('name').stringValue().replaceAll("\"", "\\\\\"")}", "message": "Дані про цю лабораторію вже присутні"}
----

+
image:study-project/task-5/task-5-bp-9.png[]

. На гілці, що прямує від шлюзу `Дані присутні?` до сервісної задачі `Формування валідаційної помилки`, потрібно налаштувати наступне:
** у полі `Name` введіть `так`;
** у полі `Condition Type` введіть тип `Expression`;
** у полі `Expression` введіть `${!response.value.responseBody.elements().isEmpty()}`.

+
image:study-project/task-5/task-5-bp-10.png[]

[#create-branch-continue-bp]
==== Створення гілки з подальшим продовженням бізнес-процесу

На прикладі xref:registry-develop:study-project/study-tasks/task-3-bp-modeling-with-integration.adoc#create-continuation-of-bp-branch[Завдання 3] необхідно _створити гілку, що продовжить бізнес-процес_.

Для цього на гілці, що прямує від шлюзу `Дані присутні?` до користувацької задачі `Підписати дані про лабораторію` (_див. нижче xref:#create-user-task-lab-data-signing[]_) налаштуйте такі параметри:

. У полі `Id` лишіть значення за замовчуванням.
. У полі `Name` вкажіть `ні`.
. у полі `Condition Type` вкажіть `Expression`.
. У полі `Expression` вкажіть `${response.value.responseBody.elements().isEmpty()}`.

+
image:study-project/task-5/task-5-bp-11.png[]

[#create-user-task-lab-data-signing]
==== Створення користувацької задачі для підпису даних

На прикладі xref:study-project/study-tasks/task-3-bp-modeling-with-integration.adoc#create-task-lab-data-signing[Завдання 3] необхідно _створити користувацьку задачу для підпису даних_. Для цього виконайте наступні кроки:

. Визначте тип задачі, натиснувши іконку ключа та обравши з меню пункт *User Task* (Користувацька задача).

. Натисніть `Open Catalog`, оберіть шаблон *Citizen Sign Task* та натисніть `Apply` для підтвердження.

. На панелі налаштувань справа заповніть наступні поля:

* у полі `Id` вкажіть `signLabCitizenActivity`;
* у полі `Name` введіть `Підписати дані про лабораторію`;
* у полі `Form key` введіть `shared-citizen-sign-lab`;
* у полі `Assignee` вкажіть `${initiator}`;
* у полі `Form data pre-population` введіть `${submission('addLabCitizenActivity').formData}`.
+
image:study-project/task-5/task-5-bp-12.png[]

* поле `INDIVIDUAL` залиште у значенні `disabled` (за замовчуванням);
* для поля `ENTREPRENEUR` оберіть значення `enabled`;
* для поля `LEGAL` оберіть значення -- `enabled`.
+
image:study-project/task-5/task-5-bp-12-1.png[]


[#create-service-task-get-users-officer-role]
==== Створення сервісної задачі "Отримання користувачів із роллю 'officer' "

На прикладі xref:#create-service-task-search-lab-data-transient-var[] необхідно _створити сервісну задачу для отримання користувачів із роллю "Посадова особа" із сервісу управління ідентифікацію та доступом Keycloak_. Для цього виконайте наступні кроки:

. Оберіть прямокутник із користувацькою задачею `Підписати дані про лабораторію`, змодельованою на xref:#create-user-task-lab-data-signing[попередньому етапі], та приєднайте нову задачу, натиснувши іконку *Append Task*.

. Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *Service Task* (Сервісна задача).

. На панелі налаштувань справа натисніть `Open Catalog`, оберіть шаблон *Get users by role from keycloak* (Отримання користувачів у Keycloak за роллю) та натисніть `Apply` для підтвердження.

. На панелі налаштувань справа заповніть наступні поля:

* у полі `Name` введіть `Отримання користувачів з роллю 'officer'`;
* у полі `Result Variable` вкажіть `officerUsers`.

+
image:study-project/task-5/task-5-bp-13.png[]

[#create-user-task-set-executor-validate-docs]
==== Створення користувацької задачі "Призначення виконавця задачі "Перевірка документів на відповідність"

На прикладі xref:#create-user-task-lab-data-signing[] необхідно _створити користувацьку задачу, що дозволить призначати виконавця іншої задачі._ Для цього виконайте наступні кроки:

. Оберіть прямокутник із користувацькою задачею `Отримання користувачів із роллю 'officer'`, змодельованою на xref:#create-service-task-get-users-officer-role[попередньому етапі], та приєднайте нову задачу, натиснувши іконку *Append Task*.

. Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *User Task* (Користувацька задача).

. На панелі налаштувань справа натисніть `Open Catalog`, оберіть шаблон *User Form* та натисніть `Apply` для підтвердження.

. На панелі налаштувань справа заповніть наступні поля:

* у полі `Id` введіть `dispatchTaskActivity`;
* у полі `Name` введіть `Призначення виконавця задачі "Перевірка документів на відповідність"`;
* у полі `Form key` вкажіть `shared-dispatch-task`;
* у полі `Assignee` вкажіть ${initiator};
* у полі `Candidate roles` введіть значення `task-dispatcher` -- роль, для якої буде доступна ця задача;
* у полі `Form variables` вкажіть `officerUsers` -- змінну, що буде передана на форму.

+
image:study-project/task-5/task-5-bp-14.png[]

[#create-script-task-prepare-doc-data-view]
==== Створення задачі скриптування "Підготовка даних документа для показу"

На прикладі xref:#create-script-task-prepare-data-view[] _змоделюйте та приєднайте нову задачу скриптування_. Для цього виконайте наступні кроки:

. Оберіть прямокутник із користувацькою задачею, змодельованою на xref:#create-user-task-set-executor-validate-docs[попередньому етапі], та приєднайте нову задачу, натиснувши іконку *Append Task*.

. Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *Script Task* (Задача скриптування).

. Виділіть додану задачу скриптування та налаштуйте наступні параметри:

* у полі `Name` вкажіть `Підготовка даних документа для показу`;
* у полі `Script Format` вкажіть тип (мову) скриптування -- `groovy`;
* у полі `Script Type` вкажіть тип скрипту `InlineScript`;
* у полі `Script` вставте безпосередньо groovy-скрипт:
+
====
[%collapsible]
.Натисніть, щоб розгорнути або згорнути
=====
[source,groovy]
----
execution.removeVariable('officerAssignee')
set_variable('officerAssignee', submission('dispatchTaskActivity').formData.prop('userTaskAssignee').prop('userName').value())

----
=====
====

+
image:study-project/task-5/task-5-bp-15.png[]

[#create-user-task-check-uniqueness-lab-record]
==== Створення користувацької задачі "Перевірка унікальности запису про лабораторію"

На прикладі xref:#create-user-task-set-executor-validate-docs[] _створіть нову користувацьку задачу для перевірки унікальності запису про лабораторію_. Для цього виконайте кроки, подані нижче:

. Оберіть прямокутник зі скрипт-задачею, змодельованою на xref:#create-script-task-prepare-doc-data-view[попередньому етапі], та приєднайте нову задачу, натиснувши іконку *Append Task*.

. Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *User Task* (Користувацька задача).

. На панелі налаштувань справа натисніть `Open Catalog`, оберіть шаблон *User Form* та натисніть `Apply` для підтвердження.

. На панелі налаштувань справа заповніть наступні поля:

* у полі `Id` введіть `checkLabOfficerActivity`;
* у полі `Name` введіть `Перевірка унікальности запису про лабораторію`;
* у полі `Form key` вкажіть `shared-officer-check-lab`;
* у полі `Assignee` введіть `${officerAssignee}`;
* у полі `Form data pre-population` вкажіть `${submission('signLabCitizenActivity').formData}`.

+
image:study-project/task-5/task-5-bp-16.png[]

[#create-xor-gw-lab-unique]
==== Створення XOR-шлюзу "Лабораторія унікальна?"

На прикладі xref:#create-xor-gateway[] змоделюйте та приєднайте новий XOR-шлюз. Для цього виконайте кроки, подані нижче:

. Оберіть прямокутник із користувацькою задачею, змодельованою на xref:#create-user-task-check-uniqueness-lab-record[попередньому етапі], та приєднайте XOR-шлюз, натиснувши іконку *Append Gateway*.

. На панелі налаштувань справа, у полі `Name` вкажіть назву шлюзу -- `Лабораторія Унікальна? labUniqueCheckFlag`.

image:study-project/task-5/task-5-bp-17.png[]


[#create-branch-negative-bp-result]
==== Створення гілки із негативним результатом бізнес-процесу

На прикладі xref:#create-branch-validation-error[] створіть нову гілку із негативним результатом бізнес-процесу. Для цього виконайте кроки, подані нижче:

. Оберіть ромб із XOR-шлюзом `Лабораторія унікальна?`, змодельованим на xref:#create-xor-gw-lab-unique[попередньому етапі], та створіть нову сервісну задачу, натиснувши іконку *Append Task*.

. Визначте тип задачі, натиснувши іконку ключа та обравши з меню пункт *Service Task* (Сервісна задача).

. Натисніть `Open Catalog`, оберіть шаблон *Define business process status* та натисніть `Apply` для підтвердження.

. На панелі налаштувань справа заповніть наступні поля:

* у полі `Name` введіть значення `Результат виконання "Лабораторія не створена - Дублікат"`;
* у полі `Status` введіть `Лабораторія не створена - Така лабораторія вже існує`.

+
image:study-project/task-5/task-5-bp-18.png[]

. Виділіть гілку, що прямує до сервісної задачі `"Результат виконання "Лабораторія не створена - Дублікат"` та налаштуйте такі параметри:

* у полі `Name` введіть значення `ні`;
* у полі `Condition Type` тип `Expression`;
* у полі `Expression` вкажіть вираз `${!submission('checkLabOfficerActivity').formData.hasProp('labUniqueCheckFlag') || submission('checkLabOfficerActivity').formData.prop('labUniqueCheckFlag').value() == false}`.

+
image:study-project/task-5/task-5-bp-19.png[]

[#create-branch-continue-bp-1]
==== Створення гілки із подальшим продовженням бізнес-процесу

На прикладі xref:#create-branch-continue-bp[] _створіть нову гілку для продовження процесу_.

Для цього на гілці, що прямує від шлюзу `Лабораторія унікальна?` (_див. xref:#create-xor-gw-lab-unique[]_) до користувацької задачі `Підписати дані лабораторії` (_див. нижче xref:#create-user-task-sign-lab-data[]_) налаштуйте такі параметри:

. У полі `Id` лишіть значення за замовчуванням.
. У полі `Name` вкажіть `так`.
. у полі `Condition Type` вкажіть `Expression`.
. У полі `Expression` вкажіть вираз `${submission('checkLabOfficerActivity').formData.hasProp('labUniqueCheckFlag') && submission('checkLabOfficerActivity').formData.prop('labUniqueCheckFlag').value() == true}`.

image:study-project/task-5/task-5-bp-20.png[]

[#create-user-task-sign-lab-data]
==== Створення користувацької задачі для підпису даних

Необхідно _створити користувацьку задачу для підпису даних_. Для цього виконайте наступні кроки:

. Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *User Task*.

. На панелі налаштувань справа натисніть `Open Catalog`, оберіть шаблон *User Form* та натисніть `Apply` для підтвердження.

. Заповніть наступні поля відповідними значеннями:
* у полі `Id` вкажіть `signLabOfficerActivity`;
* у полі `Name` введіть `Підписати дані лабораторії`;
* у полі `Form key` введіть `shared-officer-sign-lab`;
* у полі `Assignee` вкажіть `${officerAssignee}`;
* у полі `Form data pre-population` введіть `${submission('checkLabOfficerActivity').formData}`.

+
image:study-project/task-5/task-5-bp-21.png[]

[#create-script-task-prepare-data-record-transient-var]
==== Створення задачі скриптування "Підготовка даних до запису (transient var)"

Створіть нову задачу скриптування для підготовки даних до запису_. Для цього виконайте подальші налаштування:

. Оберіть прямокутник із користувацькою задачею, змодельованою на xref:#create-user-task-sign-lab-data[попередньому етапі], та приєднайте нову задачу, натиснувши іконку *Append Task*.

. Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *Script Task* (Задача скриптування).

. Виділіть додану задачу скриптування та налаштуйте наступні параметри:

* у полі `Name` вкажіть `Підготовка даних для запису (transient var)`;
* у полі `Script Format` вкажіть тип (мову) скриптування -- `groovy`;
* у полі `Script Type` вкажіть тип скрипту `InlineScript`;
* у полі `Script` вставте безпосередньо groovy-скрипт:
+
====
[%collapsible]
.Натисніть, щоб розгорнути або згорнути
=====
[source,groovy]
----
def signedFormData = submission('signLabOfficerActivity').formData

signedFormData.prop('oblast', signedFormData.prop('oblast').prop('code'))

signedFormData.prop('koatuuId', signedFormData.prop('koatuu').prop('koatuuId'))
signedFormData.deleteProp('koatuu')
signedFormData.prop('ownershipId', signedFormData.prop('ownership').prop('ownershipId'))
signedFormData.deleteProp('ownership')

if(signedFormData.hasProp('premisesFile') && !signedFormData.prop('premisesFile').isNull() &&
!signedFormData.prop('premisesFile').elements().isEmpty()) {
signedFormData.prop('premisesFile', signedFormData.prop('premisesFile').elements()[0])
} else {
signedFormData.prop('premisesFile', null as String)
}

if(signedFormData.hasProp('accreditationFile') && !signedFormData.prop('accreditationFile').isNull() && !signedFormData.prop('accreditationFile').elements().isEmpty()) {
signedFormData.prop('accreditationFile', signedFormData.prop('accreditationFile').elements()[0])
} else {
signedFormData.prop('accreditationFile', null as String)
}


execution.removeVariable('dataPayload')
set_transient_variable('dataPayload', signedFormData)
----
=====
====

+
image:study-project/task-5/task-5-bp-22.png[]

[#create-call-activity-sign-data-by-system-key]
==== Моделювання сервісної задачі для підпису даних системним ключем

Створіть сервісну задачу (Service Task) для підпису даних системним ключем та налаштуйте відповідне інтеграційне розширення. Для цього виконайте кроки, подані нижче:

. Оберіть прямокутник зі [.underline]#скриптовою задачею#, змодельованою на попередньому етапі, та приєднайте нову задачу, натиснувши іконку *Append Task*.

. Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *Service Task*.

. На панелі налаштувань справа натисніть `*Open Catalog*`, щоб відкрити список доступних шаблонів делегатів.
+
image:study-project/task-5/task-5-bp-23.png[]

. З отриманого переліку оберіть шаблон *System signature by DSO service*, який необхідно використовувати для підписання даних системним ключем.
+
image:study-project/task-5/task-5-bp-24.png[]

. На панелі налаштувань справа, відкрийте вкладку *General* та сконфігуруйте параметри делегата:

* у полі `Name` вкажіть назву задачі -- "Підписати дані системним ключем";
* у полі `Payload` передайте дані, на які треба накласти системний підпис -- ${dataPayload};
•	у полі `X-Access-Token source` передайте токен доступу особи, яка наразі виконує задачу з ID `'signLabOfficerActivity'` -- `${completer('signLabOfficerActivity').accessToken}`;
+
[WARNING]
====
Після відпрацювання першої користувацької задачі (User Task), намагайтеся використовувати функцію *`completer('<task_id>')`* для отримання даних користувача, замість `initiator()`.

Токен доступу береться з АБО ініціатора (наприклад, `$initiator().accessToken}`), АБО виконавця останньої користувацької задачі (наприклад, `${completer('taskDefinitionId').accessToken}`).

JWT-токен має свій термін дії, який триває 300 секунд. Якщо вказати токен ініціатора, який запустив бізнес-процес, а користувач довго не виконував задачу, то термін дії токена спливе, й бізнес-процес необхідно буде запускати повторно.

Детальніше про JUEL-функції ви можете переглянути на сторінці xref:registry-develop:bp-modeling/bp/modeling-facilitation/modelling-with-juel-functions.adoc[].
====
•	у полі `Result variable` зазначте назву змінної, до якої запишеться цифровий підпис вказаних даних -- `system_signature_ceph_key`.

+
image:study-project/task-5/task-5-bp-24-1.png[]

[#create-service-task-save-data-to-data-factory]
==== Створення сервісної задачі "Зберегти дані до Фабрики даних"

На цьому кроці необхідно _створити та налаштувати нову сервісну задачу для збереження даних до Дата-фабрики_. Для цього виконайте кроки, зазначені нижче:

. Оберіть прямокутник зі створеною на xref:#create-call-activity-sign-data-by-system-key[попередньому етапі] задачею Call Activity та створіть нову сервісну задачу `Зберегти дані до Фабрики даних`, натиснувши іконку ключа та обравши з меню пункт *Service Task*.
. Натисніть `Open Catalog`, оберіть шаблон *Create entity in data factory* та натисніть `Apply` для підтвердження.

. На панелі налаштувань справа сконфігуруйте наступні параметри:

* у полі `Name` введіть `Зберегти дані до Фабрики даних`;
* у полі `Resource` вкажіть `laboratory`;
* у полі `Payload` введіть `${dataPayload}`;
* у полі `X-Access-Token` введіть `${completer('signLabOfficerActivity').accessToken}`;
+
[WARNING]
====
Після відпрацювання першої користувацької задачі (User Task), намагайтеся використовувати функцію *`completer('<task_id>')`* для отримання даних користувача, замість `initiator()`.

Токен доступу береться з АБО ініціатора (наприклад, `$initiator().accessToken}`), АБО виконавця останньої користувацької задачі (наприклад, `${completer('taskDefinitionId').accessToken}`).

JWT-токен має свій термін дії, який триває 300 секунд. Якщо вказати токен ініціатора, який запустив бізнес-процес, а користувач довго не виконував задачу, то термін дії токена спливе, й бізнес-процес необхідно буде запускати повторно.

Детальніше про JUEL-функції ви можете переглянути на сторінці xref:registry-develop:bp-modeling/bp/modeling-facilitation/modelling-with-juel-functions.adoc[].
====
* у полі `X-Digital-Signature source` введіть `${sign_submission('signLabOfficerActivity').signatureDocumentId}`;
* у полі `X-Digital-Signature-Derived source` введіть `${system_signature_ceph_key}`;
* у полі `Result Variable` вкажіть `response`.

+
image:study-project/task-5/task-5-bp-25.png[]

[#create-error-intermediate-boundary-event]
==== Створення події для опрацювання помилки

На цьому етапі необхідно змоделювати та налаштувати проміжну граничну подію для опрацювання сценарію із виникненням передбачених помилок. Для цього виконайте кроки, подані нижче:

. Перетягніть *Intermediate/Boundary event* з панелі інструментів та прикріпіть його до *Service Task* "Зберегти дані в Дата-фабрику".
+
image:study-project/task-5/task-5-bp-error-boundary-branch-1.png[]

. Визначте тип події як *Error Boundary Event* (Проміжна гранична подія "Помилка").
+
image:study-project/task-5/task-5-bp-error-boundary-branch-2.png[]

. Створіть *Gateway* (шлюз), який буде виконувати роль контрольної точки для перенаправлення у випадку виникнення помилки.
+
image:study-project/task-5/task-5-bp-error-boundary-branch-3.png[]

. Додайте логіку опрацювання помилки за допомогою з'єднання *Error Boundary Event* та *Gateway*.
+
[TIP]
Це буде означати, що при виникненні помилки на етапі "Збереження даних в Дата-фабрику" ми автоматично повернемося до контрольної точки, звідки заново почнеться виконання процесу.
+
image:study-project/task-5/task-5-bp-error-boundary-branch-4.png[]

[NOTE]
Компоненти моделювання "Дата Фабрика" та усі пунктирні лінії носять [.underline]#виключно інформаційний характер#.
Прикладу їх створення в інструкції немає, але можете додати їх самостійно за бажанням.

[#create-service-task-bp-result-lab-created]
==== Створення сервісної задачі для встановлення результату бізнес-процесу

На прикладі xref:study-project/study-tasks/task-3-bp-modeling-with-integration.adoc#create-service-task-create-entity-end[Завдання 3] _змоделюйте нову сервісну задачу, що встановлюватиме результат бізнес-процесу_. Для цього виконайте кроки, подані нижче:

. Оберіть прямокутник із сервісною задачею, створеною на xref:#create-service-task-save-data-to-data-factory[попередньому етапі], та приєднайте нову задачу, натиснувши іконку *Append Task*.

. Визначте тип задачі, натиснувши іконку ключа та обравши з меню пункт *Service Task*.
. Натисніть `Open Catalog`, оберіть шаблон *Define business process status* та натисніть `Apply` для підтвердження.
. На панелі налаштувань справа сконфігуруйте наступні параметри:

* у полі `Name` вкажіть `Результат виконання "Лабораторія створена"`;
* у полі `Status` вкажіть `Лабораторія створена`.

+
image:study-project/task-5/task-5-bp-26.png[]

[#create-end-event]
==== Створення події завершення бізнес-процесу

На цьому етапі необхідно _створити подію, яка завершуватиме бізнес-процес_.

. На прикладі xref:study-project/study-tasks/task-3-bp-modeling-with-integration.adoc#create-task-entity-finish[Завдання 3] приєднайте та налаштуйте подію завершення бізнес-процесу.

. На панелі налаштувань справа для параметра `Name` вкажіть значення `Лабораторія створена`.

+
image:registry-develop:study-project/task-3/task-3-26-bp.png[]

TIP: В результаті маємо змодельований бізнес-процес для використання декількома учасниками та з викликом зовнішнього підпроцесу Call Activity.


[#save-bp-schema]
==== Збереження змодельованої схеми бізнес-процесу

Після завершення процесу моделювання збережіть отриману схему бізнес-процесу із назвою _citizen-add-lab.bpmn_ до регламентної папки *_bpmn_* проєкту в Gerrit-репозиторії. Для цього у лівому верхньому куті відкрийте меню `*File* > *Save File As..*`, введіть відповідну назву та шлях.

[#form-modeling]
=== Моделювання UI-форм для бізнес-процесу

[TIP]
====
На етапі моделювання форм необхідно створити та прив'язати JSON-форми до попередньо змодельованих задач в рамках бізнес-процесу.

Форми прив'язуються до бізнес-процесів за службовою назвою.

Використовуйте файли _link:{attachmentsdir}/study-project/task-5/bp-forms/shared-officer-sign-lab.json[shared-officer-sign-lab.json]_,  _link:{attachmentsdir}/study-project/task-5/bp-forms/shared-officer-check-lab.json[shared-officer-check-lab.json]_, _link:{attachmentsdir}/study-project/task-5/bp-forms/shared-dispatch-task.json[shared-dispatch-task.json]_, _link:{attachmentsdir}/study-project/task-5/bp-forms/shared-citizen-sign-lab.json[shared-citizen-sign-lab.json]_, _link:{attachmentsdir}/study-project/task-5/bp-forms/citizen-add-lab-bp-add-lab.json[citizen-add-lab-bp-add-lab.json]_  зі змодельованими формами для прикладу.
====

[checklist-form-modeling]
==== Чекліст моделювання UI-форм

Використовуйте наведений чекліст із переліком кроків для створення форм: ::
+
[%interactive]
* [ ] xref:#form-insert-data[]
* [ ] xref:#form-sign-data-by-citizen[]
* [ ] xref:#form-dispatch-task[]
* [ ] xref:#form-check-data-by-officer[]
* [ ] xref:#form-officer-sign-data[]
* [ ] xref:#form-save[]

CAUTION: Після проходження всіх етапів, завантажте та збережіть файли зі схемами форм до відповідної папки з регламентом реєстру (_див. xref:#form-save[]_)

[#form-insert-data]
==== Створення форми для внесення даних

TIP: Змоделюйте форму для внесення даних користувачем, використовуючи приклад із xref:study-project/study-tasks/task-3-bp-modeling-with-integration.adoc#form-insert-data[Завдання 3].

. Увійдіть до застосунку [.underline]#Кабінет адміністратора регламентів#.
+
image::registry-develop:bp-modeling/forms/admin-portal-form-modeling-step-1.png[]
+
За замовчуванням користувач опиняється на домашній сторінці [.underline]#Огляд версії# майстер-версії регламенту.
+
image:registry-admin/admin-portal/new-admin-portal-1.png[]
+
[TIP]
====
Детальніше про майстер-версію регламенту ви можете переглянути за посиланням:

* xref:registry-develop:registry-admin/admin-portal/version-control/master-version-settings.adoc[]
====
+
[WARNING]
====
Майстер-версія змін до регламенту реєстру дозволяє працювати з UI-формами лише у режимі перегляду.

Для того, щоб створювати, або редагувати будь-які сутності регламенту (форми, бізнес-процеси тощо), а також їх складові, необхідно створити нову версію-кандидат на внесення змін до регламенту реєстру і працювати в ній.
====

. Створіть новий запит на внесення змін до регламенту, тобто створіть нову версію-кандидат на внесення змін.
+
image:registry-develop:study-project/task-5/task-5-forms-new-change-request.png[]
+
АБО
+
Оберіть наявну версію-кандидат на внесення змін.
+
image:registry-develop:study-project/task-5/task-5-forms-new-change-request-1.png[]
+
[TIP]
====
Детальніше про створення та перегляд запитів на внесення змін до регламенту ви можете переглянути за посиланнями:

* xref:registry-develop:registry-admin/admin-portal/version-control/create-new-change-request.adoc[]
* xref:registry-develop:registry-admin/admin-portal/version-control/overview-new-change-request.adoc[]
====

. В рамках своєї версії-кандидата перейдіть до розділу [.underline]#UI-форми#.

+
image:registry-develop:study-project/task-5/task-5-forms-overview.png[]

. Скопіюйте форму xref:study-project/study-tasks/task-3-bp-modeling-with-integration.adoc#form-insert-data[ add-lab-bp-add-lab], змодельовану в рамках Завдання 3, натиснувши _іконку копіювання_ -- це дозволить створити форму із готового шаблону.

+
image:registry-develop:study-project/task-3/task-3-49-forms.png[]

. У новому вікні, на вкладці [.underline]#Загальна# введіть бізнес-назву форми -- `Внести дані про лабораторію`. Назва відповідає бізнес-назві змодельованої користувацької задачі xref:#create-user-task-add-lab-data[`addLabCitizenActivity`].
. Заповніть поле `Службова назва форми` значенням `citizen-add-lab-bp-add-lab` (відповідає значенню поля `Form key` тієї ж користувацької задачі xref:#create-user-task-add-lab-data[`addLabCitizenActivity`]);

+
image:study-project/task-5/task-5-forms-2.png[]

. Перейдіть на вкладку [.underline]#Конструктор#.

* У компонентах "Область", "Назва населеного пункту", та "Форма власності", на вкладці *Data* у полі `Data Source type URL` видаліть `/officer`.

+
image:study-project/task-5/task-5-forms-2-1.png[]

* Переконайтеся, що остаточний вигляд компонентів є наступним:

** компонент [.underline]#"Область"# -- `/api/data-factory/koatuu-obl-contains-name`;

** компонент [.underline]#"Назва населеного пункту"# -- `/api/data-factory/koatuu-np-starts-with-name-by-obl`;

** компонент [.underline]#"Форма власності"# -- `/api/data-factory/ownership-contains-name`.

. Збережіть форму, натиснувши кнопку `Зберегти зміни` у правому верхньому куті.

+
image:study-project/task-5/task-5-forms-3.png[]

[#form-sign-data-by-citizen]
==== Моделювання форми підпису даних отримувачем послуг реєстру

Після завершення xref:#form-insert-data[попереднього етапу] зі створенням форми для внесення даних, _створіть ще одну форму -- для підпису даних_.

TIP: Змоделюйте форму для внесення даних користувачем, використовуючи приклад із xref:study-project/study-tasks/task-3-bp-modeling-with-integration.adoc#form-data-signing[Завдання 3].

. Скопіюйте xref:#form-insert-data[UI-форму для внесення даних про лабораторію], натиснувши _іконку копіювання_ -- це дозволить створити форму із готового шаблону.

. Увійдіть до режиму редагування форми та перейдіть на вкладку [.underline]#Загальна#.

. У полі `Бізнес-назва форми` введіть назву відповідної користувацької задачі xref:#create-user-task-lab-data-signing[`Підписати дані про лабораторію` (`signLabCitizenActivity`)];
. Заповніть поле `Службова назва форми` значенням `shared-citizen-sign-lab` (відповідає значенню поля `Form key` тієї ж користувацької задачі xref:#create-user-task-lab-data-signing[`signLabCitizenActivity`]).

+
image:study-project/task-5/task-5-forms-4.png[]

. Перейдіть на вкладку [.underline]#Конструктор# та у налаштуваннях кожного компонента виконайте наступне:

* На вкладці *Display* встановіть прапорець для параметра *Disabled*.
* Натисніть кнопку `Save` для збереження змін.
+
image:study-project/task-5/task-5-forms-4-01.png[]
+
image:registry-develop:study-project/task-3/task-3-50-forms.png[]

. Перейдіть на вкладку [.underline]#Перегляд#. Тут ви можете побачити, як виглядатиме форма в інтерфейсі користувачів. Усі поля є неактивними.
+
image:study-project/task-5/task-5-forms-4-1.png[]

. Збережіть форму, натиснувши кнопку `Зберегти зміни` у правому верхньому куті.

=== Моделювання форм за допомогою formVariables

[#form-dispatch-task]
==== Моделювання форми призначення виконавця задачі

CAUTION: Продовжуйте моделювання форм в рамках тієї ж версії-кандидата на внесення змін, що була створена у xref:#form-insert-data[попередньому розділі].

. В рамках своєї версії-кандидата перейдіть до розділу [.underline]#UI-форми#.

+
image:registry-develop:study-project/task-5/task-5-forms-overview.png[]

. Щоб створити нову форму для бізнес-процесу, натисніть кнопку `Створити нову форму`:

+
image:registry-develop:study-project/task-5/task-5-forms-overview-1.png[]

* У новому вікні, у полі `Бізнес-назва форми` вкажіть назву, що відповідає назві змодельованої користувацької задачі -- xref:#create-user-task-set-executor-validate-docs[`Призначення виконавця задачі` (`dispatchTaskActivity`)].
* Заповніть поле `Службова назва форми` значенням `shared-dispatch-task` (має відповідати значенню поля `Form key` тієї ж користувацької задачі xref:#create-user-task-set-executor-validate-docs[`Призначення виконавця задачі` (`dispatchTaskActivity`)].

+
image:study-project/task-5/task-5-forms-5.png[]

. Перейдіть на вкладку [.underline]#Конструктор# та виконайте моделювання форми за допомогою компонентів.
+
image:study-project/task-5/task-5-forms-5-1.png[]

. З панелі компонентів зліва перетягніть компонент *Select* до панелі моделювання та виконайте подальші налаштування компонента:

+
image:study-project/task-3/task-3-37-forms-drag-select.png[]

* Перейдіть на вкладку *Display* та заповніть поле `Label` значенням `Оберіть ПІБ виконавця`:

+
image:study-project/task-5/task-5-forms-6.png[]

+
* Перейдіть на вкладку *API* та заповніть поле `Property Name` значенням `userTaskAssignee`:

+
image:study-project/task-5/task-5-forms-7.png[]

+
* Перейдіть на вкладку *Data* та налаштуйте наступні параметри:
** у полі `Data source type` введіть `Custom`;
** у полі `Id Path` вкажіть `userName`;
** у полі `Custom Values` вкажіть `values = formVariables.officerUsers`;
** у полі `Item Template` введіть `<span>{{ item.fullName }}</span>`.

* Натисніть кнопку `Save` для збереження.
+
image:study-project/task-5/task-5-forms-8.png[]

. Збережіть форму, натиснувши кнопку `Створити форму` у правому верхньому куті:
+
image:study-project/task-5/task-5-forms-9.png[]

[#form-check-data-by-officer]
==== Моделювання форми перевірки даних посадовою особою

Змоделюйте форму для можливості перевірки даних посадовою особою. Для цього виконайте наступні кроки:

. Скопіюйте форму xref:#form-dispatch-task[Призначення виконавця задачі], змодельовану вище, натиснувши _іконку копіювання_ -- це дозволить створити форму із готового шаблону:

* У новому вікні відкрийте вкладку [.underline]#Загальна#.

* У полі `Бізнес-назва форми` введіть назву `Перевірка унікальності запису про лабораторію`, що відповідає назві користувацької задачі xref:#create-user-task-check-uniqueness-lab-record[`checkLabOfficerActivity`].

* Заповніть поле `Службова назва форми` значенням `shared-officer-check-lab` (має відповідати значенню поля `Form key` тієї ж користувацької задачі -- xref:#create-user-task-check-uniqueness-lab-record[`checkLabOfficerActivity`].

+
image:study-project/task-5/task-5-forms-10.png[]

. Перейдіть на вкладку [.underline]#Конструктор# виконайте моделювання форми за допомогою компонентів.

. З панелі компонентів зліва перетягніть компонент *Checkbox* до панелі моделювання та виконайте подальші налаштування:

* Перейдіть на вкладку *Display* та заповніть поле `Label` значенням `Лабораторія не дублюється`:
+
image:study-project/task-5/task-5-forms-11.png[]

* Перейдіть на вкладку *API* та заповніть поле `Property Name` значенням `labUniqueCheckFlag`.
* Натисніть кнопку `Save` для збереження змін:
+
image:study-project/task-5/task-5-forms-12.png[]

. Збережіть форму, натиснувши кнопку `Створити форму` у правому верхньому куті:
+
image:study-project/task-5/task-5-forms-13.png[]

[#form-officer-sign-data]
==== Моделювання форми підпису даних посадовою особою

Змоделюйте форму для можливості підпису даних посадовою особою. Для цього виконайте наступні кроки:

. Скопіюйте форму xref:#form-check-data-by-officer[перевірки даних посадовою особою], змодельовану вище, натиснувши _іконку копіювання_ -- це дозволить створити форму із готового шаблону:

* У новому вікні перейдіть до вкладки [.underline]#Загальна#.

* У полі `Бізнес-назва форми` введіть назву `Підписати дані лабораторії`, що відповідає назві користувацької задачі xref:#create-user-task-sign-lab-data[`signLabOfficerActivity`].

* Заповніть поле `Службова назва форми` значенням `shared-officer-sign-lab` (має відповідати значенню поля `Form key` тієї ж користувацької задачі xref:#create-user-task-sign-lab-data[`signLabOfficerActivity`].

+
image:study-project/task-5/task-5-forms-14.png[]

. Перейдіть на вкладку [.underline]#Конструктор# та виконайте наступні налаштування для усіх компонентів форми:

* Перейдіть на вкладку *Display* та встановіть прапорець для параметра `Disabled` -- `True`.
* Натисніть кнопку `Save` для збереження.

. Збережіть форму, натиснувши кнопку `Створити форму` у правому верхньому куті.
+
image:study-project/task-5/task-5-forms-14-1.png[]

[#form-save]
==== Завантаження змодельованих форм бізнес-процесу до локальної директорії

//TODO на майбутнє
// Чи треба показувати, як застосувати зміни до майстер-гілки після завершення моделювання форм? Чи йдемо лише хардкорним шляхом, як і у всіх завданнях до цього?
//TODO на майбутнє
// Якщо моделювальник працює у власній гілці, а потім вирішує залити форми через Gerrit, то після того, як зміни потраплять у майстер, необхідно видалити усі непотрібні гілки.
//TODO на майбутнє
// Якщо ж гілка-кандидат потрібна для подальшої роботи, то її можна лишити. Відразу після оновлення майстер-версії усі версії-кандидати оновляться автоматично.

Завантажте форми, натиснувши `&#10515;` (_іконку завантаження_) , та помістіть їх до регламентної папки *_forms_* проєкту в локальному Gerrit-репозиторії.
image:registry-develop:study-project/task-1/task-1-14-forms.png[]

[#bp-access]
=== Моделювання доступу до бізнес-процесу

[TIP]
====
На цьому етапі необхідно надати доступ до бізнес-процесу із Кабінету отримувача послуг.

Параметри доступу налаштовуються у конфігураційному файлі, що має назву _link:{attachmentsdir}/study-project/task-5/bp-access/citizen.yml[citizen.yml]_.
====

. Створіть файл _citizen.yml_ та сконфігуруйте в ньому наступні параметри:

+
.Приклад. Налаштування доступу до бізнес-процесу із Кабінету отримувача послуг реєстру
[source,yaml]
----
authorization:
  realm: 'citizen'
  process_definitions:
    - process_definition_id: 'citizen-add-lab'
      process_name: 'Процес створення лабораторії'
      process_description: 'Бізнес-процес створення лабораторії отримувачем послуг реєстру'
      roles:
        - 'unregistered-individual'
        - 'unregistered-entrepreneur'
        - 'unregistered-legal'
----

. xref:#save-roles-access-files[Збережіть файл] до папки *_bp-auth_* проєкту.

==== Створення нової ролі для розподілення задач в Кабінеті посадової особи

. Перейдіть до регламентної папки *_roles_*, знайдіть файл _link:{attachmentsdir}/study-project/task-5/bp-access/officer.yml[officer.yml]_ та додайте у ньому до наявних 2 нових параметри:

+
.Приклад. Додавання параметрів для створення ролі для розподілення задач
[source,yaml]
----
  - name: task-dispatcher
    description: Task dispatcher role
----

. xref:#save-roles-access-files[Збережіть файл] до папки *_bp-auth_* проєкту.

[#save-roles-access-files]
==== Збереження файлів із налаштуваннями доступу

Збережіть файл _officer.yml_ до регламентної папки *_bp-auth_* проєкту в локальному Gerrit-репозиторії.

== Перенесення файлів регламенту до віддаленого репозиторію Gerrit

Для успішного розгортання бізнес-процесу, форм, а також застосування правильних налаштувань доступу до бізнес-процесу у цільовому середовищі, адміністратор регламенту має завантажити збережені локально файли регламенту реєстру до віддаленого сховища коду Gerrit.

Для цього виконайте кроки з інструкції xref:registry-develop:registry-admin/regulations-deploy/registry-admin-deploy-regulation.adoc[].

IMPORTANT: Після того, як локальні зміни потраплять до регламенту в Gerrit, та після того, як ви переконаєтеся, що все працює коректно, xref:registry-develop:registry-admin/admin-portal/version-control/overview-new-change-request.adoc#abandon-changes[видаліть створену версію-кандидат на внесення змін у Кабінеті адміністратора регламентів].

== Додатки

Розділ містить приклади іх готовими артефактами моделювання регламенту, які ви можете використовувати під час виконання цього завдання.

=== Схема бізнес-процесу

* _link:{attachmentsdir}/study-project/task-5/bp-schema/citizen-add-lab.bpmn[citizen-add-lab.bpmn]_

=== Форми для бізнес-процесу

* _link:{attachmentsdir}/study-project/task-5/bp-forms/shared-officer-sign-lab.json[shared-officer-sign-lab.json]_
* _link:{attachmentsdir}/study-project/task-5/bp-forms/shared-officer-check-lab.json[shared-officer-check-lab.json]_
* _link:{attachmentsdir}/study-project/task-5/bp-forms/shared-dispatch-task.json[shared-dispatch-task.json]_
* _link:{attachmentsdir}/study-project/task-5/bp-forms/shared-citizen-sign-lab.json[shared-citizen-sign-lab.json]_
* _link:{attachmentsdir}/study-project/task-5/bp-forms/citizen-add-lab-bp-add-lab.json[citizen-add-lab-bp-add-lab.json]_

=== YAML для доступу ролі citizen до бізнес-процесу

* _link:{attachmentsdir}/study-project/task-5/bp-access/citizen.yml[bp-auth/citizen.yml]_

=== YAML для створення нової ролі Task Dispatcher

* _link:{attachmentsdir}/study-project/task-5/bp-access/officer.yml[roles/officer.yml]_


