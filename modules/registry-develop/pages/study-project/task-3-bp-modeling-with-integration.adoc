= Завдання 3. Моделювання бізнес-процесу з інтеграцією

:sectanchors:
:sectnums:

== Мета завдання

*Виконання цього завдання має на меті:*

* Навчити моделювати бізнес-процес, що має інтеграцію з фабрикою даних.
* Навчити моделювати гілки у бізнес-процесі.
* Навчити моделювати уніфіковані кроки у бізнес-процесах  за допомогою `Call Activity`.
* Навчити моделювати форми та налаштовувати компоненти `Select` для отримання даних із фабрики даних.

== Передумови

Перед проходженням завдання виконайте наступні передумови:

* xref:registry-develop:bp-modeling/bp/bp-element-templates-installation-configuration.adoc#business-process-modeler-extensions-installation[Встановіть додаток Camunda Modeler і типові розширення до нього].
* xref:registry-develop:bp-modeling/forms/bp-modeling-forms-general-description.adoc[Ознайомтеся із компонентами FormIO для моделювання форм].

== Процес виконання завдання

[#bp-modeling]
=== Моделювання бізнес-процесу

[TIP]
====
На етапі моделювання бізнес-процесу необхідно створити та зберегти відповідну BPMN-діаграму.

Використовуйте файл _link:{attachmentsdir}/study-project/task-3/bp-schema/add-lab.bpmn[add-lab.bpmn]_ із готовою схемою бізнес-процесу для прикладу.
====

==== Етапи моделювання бізнес-процесу

В рамках цього завдання моделювальник має створити бізнес-процес, що складається з наступних етапів:

. xref:#create-pool-bp[Створення пулу для бізнес-процесу].
. xref:#create-start-event[Створення початкової події].
. xref:#create-task-add-lab-data[Створення користувацької задачі для внесення даних].
. xref:#create-service-task-bp-result[Створення сервісної задачі для пошуку даних (transient var)].
. xref:#create-xor-gateway[Створення та заповнення XOR-шлюза].
. xref:#create-validation-error-branch[Створення гілки з валійдаційною помилкою].
. xref:#create-continuation-of-bp-branch[Створення гілки з подальшим продовженням бізнес-процеса].
. xref:#create-task-lab-data-signing[Створення користувацької задачі для підписання даних].
. xref:#create-task-script-data-signing[Cтворення скрипт задачі для підготовки даних для запису (transient var)].
. xref:#create-task-call-activity-data-signing[Моделювання Call Activity для підпису даних системним ключем].
. xref:#call-activity-modeling[Моделювання окремого процесу Call Activity].
. xref:#create-service-task-create-entity[Створення скрипт задачі для збереження даних в Дата фабрику].
. xref:#create-service-task-create-entity-end[Створення скрипт задачі для встановлення результату БП].
. xref:#create-task-entity-finish[Створення кінцевої події].

CAUTION: *Важливо!* Після проходження всіх етапів, не забудьте зберегти змодельовану схему бізнес-процесу до відповідної папки з регламентом реєстру

[#create-pool-bp]
==== Створення пулу для бізнес-процесу

Найперше, *змоделюйте пул для бізнес-процесу*. Для цього виконайте наступні кроки:

* Відкрийте додаток *Camunda Modeler* та створіть нову діаграму BPMN. Для цього у лівому верхньому куті натисніть меню *File* -> *New File* -> *BPMN Diagram*.

//TODO: Додати скриншот тут і аналогічно у завданні 1

* На панелі інструментів, зліва, знайдіть елемент *Create pool/Participant*, перетягніть його до панелі моделювання та заповніть наступні поля відповідними значеннями:

** у полі `Name` введіть `Створення лабораторії`;
** у полі `Process id` введіть `add-lab`;
** у полі `Process name` вкажіть `Створення лабораторії`.

image:registry-develop:study-project/task-3/task-3-1-bp.png[]

[#create-start-event]
==== Створення початкової події

*Створіть початкову подію*. Для цього виконайте наступні кроки:

* На панелі інструментів, зліва, знайдіть елемент (коло) *CreateStartEvent* та перетягніть його до панелі моделювання.

* На панелі налаштувань, справа, заповніть наступні параметри відповідними значеннями:
** у полі `Name` введіть `Початок`;
** у полі `Initiator` введіть `initiator`.

image:registry-develop:study-project/task-3/task-3-2-bp.png[]

[#create-task-add-lab-data]
==== Створення користувацької задачі для додавання даних про лабораторію

Далі *створіть користувацьку задачу (User Form), призначену для додавання даних*. Для цього виконайте наступні кроки:

* Оберіть коло з початковою подією, змодельованою на xref:#create-start-event[попередньому етапі], та приєднайте нову користувацьку задачу, натиснувши іконку *Append Task*.

//TODO: Додати скриншот

* Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *User Form*.

//TODO: Додати скриншот

* На панелі налаштувань, справа, заповніть наступні параметри відповідними значеннями:

** натисніть `Open Catalog`, оберіть шаблон *User Form* (*Користувацька форма*) та натисніть `Apply` для підтвердження;

//TODO: Додати скриншот

** заповніть наступні поля:

*** у полі `Id` зазначте `addLabFormActivity`;
*** у полі `Name` введіть `Додати інформацію про лабораторію`;
*** у полі `Form key` введіть `add-lab-bp-add-lab`;
*** у полі `Assignee` вкажіть `$\{initiator}`.

image:registry-develop:study-project/task-3/task-3-3-bp.png[]

[#create-service-task-bp-result]
==== Створення сервісної задачі для пошуку даних про лабораторію

Далі необхідно *створити сервісну задачу (Service Task) для пошуку даних про лабораторію*. Для цього виконайте наступні кроки:

* Оберіть прямокутник із користувацькою задачею *Додати інформацію про лабораторію*, змодельованою на xref:#create-task-add-lab-data[попередньому етапі], та приєднайте нову сервісну задачу, натиснувши іконку *Append Task*.
Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *Service Task*.

* Натисніть `Open Catalog`, оберіть шаблон *Search for entities in data factory* (*Пошук значень у дата фабриці*) та натисніть `Apply` для підтвердження;
* Заповніть наступні поля:
** у поле `Id` введіть `searchForLabByNameAndEdrpouActivity`
** у полі `Name` має бути вказано `Пошук даних про лабораторію (transient var)`;

** У розділі Input Parameters -  Resource:
*** у полі `Variable Assignment Type` вкажіть `String or Expression`
*** у полі `Variable Assignment Value` вкажіть `laboratory-equal-edrpou-name-count`

image:registry-develop:study-project/task-3/task-3-4-bp.png[]

** Search Variables:
у полі `Variable Assignment type` вкажіть Map

|===
|Key |Value

|name |${submission('addLabFormActivity').formData.prop('name').value()}

|edrpou
|${submission('addLabFormActivity').formData.prop('edrpou').value()}
|===

image:registry-develop:study-project/task-3/task-3-5-bp.png[]

*** X-Access-Token:
**** у полі `Variable Assignment Type` вказати `String or Expression`
**** у полі `Variable Assignment Value` вказати `${completer('addLabFormActivity').accessToken}`

image:registry-develop:study-project/task-3/task-3-6-bp.png[]

*** У розділі Output Parameters - Result Variable
  для параметру `Assign to Process Variable` вказати `response`

image:registry-develop:study-project/task-3/task-3-7-bp.png[]

[#create-xor-gateway]
==== Створення та заповнення XOR-шлюза

* На панелі налаштувань, справа, вкажіть назву задачі:

** у поле `Id` введіть значення `isLaboratoryExistGateway`;
** у поле `Name` введіть значення `Дані присутні?`.

image:registry-develop:study-project/task-3/task-3-8-bp.png[]

[#create-validation-error-branch]
==== Створення гілки з валійдаційною помилкою
* Створіть нову сервісну задачу, натиснувши іконку ключа та обравши з меню пункт *Service Task*.
* Натисніть `Open Catalog`, оберіть шаблон *Throw validation error* та натисніть `Apply` для підтвердження;
* Заповніть поля:
** `Id` - `throwDuplicateLabValidationError`
** `Name` - `Формування валідаційної помилки`
** У розділі Input Parameters - Validation Errors:
*** `Variable Assignment Type` - `List`
*** `Value`:
**** `{"field": "name", "value": "${submission('addLabFormActivity').formData.prop('name').stringValue().replaceAll("\"", "\\\\\"")}", "message": "Дані про цю лабораторію вже присутні"}`
**** `{"field": "edrpou", "value": "${submission('addLabFormActivity').formData.prop('edrpou').value()}", "message": "Дані про цю лабораторію вже присутні"}`

image:registry-develop:study-project/task-3/task-3-9-bp.png[]

* На гілці, що прямує до сервісної задачі "Формування валідаційної помилки", потрібно налаштувати:
** у поле `Id` введіть `isLaboratoryAlreadyExistFlow`
** у поле `Name` введіть `так`
** у поле `Expression` введіть `${!response.value.responseBody.elements().isEmpty()}`

image:registry-develop:study-project/task-3/task-3-10-bp.png[]

[#create-continuation-of-bp-branch]
==== Створення гілки з подальшим продовженням бізнес-процеса

* На гілці, що прямує до користувацької задачі "Підписати дані про лабораторію" потрібно налаштувати:
** у полі `Id` значення по дефолту
** у полі `Name` вкажіть `ні`
** у полі `Condition Type` вкажіть `Expression`
** у полі `Expression` вкажіть `${response.value.responseBody.elements().isEmpty()}`

image:registry-develop:study-project/task-3/task-3-11-bp.png[]

[#create-task-lab-data-signing]
==== Створення користувацької задачі для підписання даних
* Вкажіть тип задачі, натиснувши іконку ключа та обравши з меню пункт *User Form*.

* На панелі налаштувань, справа, заповніть наступні параметри відповідними значеннями:

** натисніть `Open Catalog`, оберіть шаблон *Officer Sign Task* та натисніть `Apply` для підтвердження;
** заповніть наступні поля:
*** `Id` - `signLabFormActivity`
*** `Name` - `Підписати дані про лабораторію`
*** `Form key` - `add-lab-sign-lab-data`
*** `Assignee` - `$\{initiator}`
*** `Form data pre-population` - `${submission('addLabFormActivity').formData}`

image:registry-develop:study-project/task-3/task-3-12-bp.png[]

[#create-task-script-data-signing]
==== Створення скрипт задачі для підготовки даних для запису (transient var)

Заповніть наступні поля:

* `Id` - `convertSignFormDataToDataFactoryFormatActivity`
* `Name` - `Підготовка даних для запису (transient var)`
* `Script Format` - `groovy`
* `Script Type` - `InlineScript`

====

.`Script`
[%collapsible]
======
        def signedFormData = submission('signLabFormActivity').formData
        signedFormData.prop('oblast', signedFormData.prop('oblast').prop('code').value())

        signedFormData.prop('koatuuId', signedFormData.prop('koatuu').prop('koatuuId').value())
        signedFormData.deleteProp('koatuu')
        signedFormData.prop('ownershipId', signedFormData.prop('ownership').prop('ownershipId').value())
        signedFormData.deleteProp('ownership')

        if(signedFormData.hasProp('premisesFile') && !signedFormData.prop('premisesFile').isNull() &&
!signedFormData.prop('premisesFile').elements().isEmpty()) {
signedFormData.prop('premisesFile', signedFormData.prop('premisesFile').elements()[0])
} else {
signedFormData.prop('premisesFile', null as String)
}
if(signedFormData.hasProp('accreditationFile') && !signedFormData.prop('accreditationFile').isNull() && !signedFormData.prop('accreditationFile').elements().isEmpty()) {
signedFormData.prop('accreditationFile', signedFormData.prop('accreditationFile').elements()[0])
} else {
signedFormData.prop('accreditationFile', null as String)
}

        execution.removeVariable('dataPayload')
        execution.setVariableLocalTransient('dataPayload', signedFormData)
======
====

image:registry-develop:study-project/task-3/task-3-13-bp.png[]

[#create-task-call-activity-data-signing]
==== Моделювання Call Activity для підпису даних системним ключем

Заповніть наступні поля:

* Таба General
** `Name` - `Підписати дані системним ключем`
** `CallActivity Type` - `BPMN`
** `Called Element` -  `system-signature-bp`
** `Binding` - `latest`
* Таба Variables
** In Mapping
*** `Type` - `Source`
*** `Source` - `dataPayload`
*** `Target` - `dataToSign`
** Out Mapping
*** `Type` - `Source`
*** `Source` - `system_signature_ceph_key`
*** `Target` - `system_signature_ceph_key`

image:registry-develop:study-project/task-3/task-3-14-bp.png[]

image:registry-develop:study-project/task-3/task-3-15-bp.png[]

image:registry-develop:study-project/task-3/task-3-16-bp.png[]


[#call-activity-modeling]
==== Моделювання окремого процесу Call Activity

Створіть нову діаграму BPMN у додатку Camunda modeler. Заповніть параметри:

* `Id` - `system-signature-bp`
* `Name` - `Підписати дані системним ключем`
* checkbox `Executable` - `True`

image:registry-develop:study-project/task-3/task-3-17-bp.png[]

Заповніть початкову подію:

* `Name` - `Start`
* `Initiator` - `initiator`

image:registry-develop:study-project/task-3/task-3-18-bp.png[]

Заповніть скрипт задачу "Підготовка даних для системного підпису (transient var)":

* `Name` - `Підготовка даних для запису (transient var)`
* `Script Format` - `groovy`
* `Script Type` - `InlineScript`

====
.`Script`
[%collapsible]
======
  var signObj = ['data':S(dataToSign, 'application/json').toString()]

  execution.removeVariable('dataSignPayload')
  execution.setVariableLocalTransient('dataSignPayload', S(signObj, 'application/json'))
======
====

image:registry-develop:study-project/task-3/task-3-19-bp.png[]

* Створіть нову сервісну задачу "Підписати дані системним ключем", натиснувши іконку ключа та обравши з меню пункт *Service Task*.
* Натисніть `Open Catalog`, оберіть шаблон *Digital Signature by DSO service* та натисніть `Apply` для підтвердження;
* Заповніть поля:
** `Name` - `Підписати дані системним ключем`
** `Payload` - `$\{dataSignPayload}`
** `X-Access-Token source` - `${initiator().accessToken}`
** `Result Variable` - `systemSignatureResponse`

image:registry-develop:study-project/task-3/task-3-20-bp.png[]

Заповніть скрипт задачу "Підготовка даних для запису системного підпису (transient var)":

* `Name` - `Підготовка даних для запису системного підпису (transient var)`
* `Script Format` - `groovy`
* `Script Type` - `InlineScript`

====
.`Script`
[%collapsible]
======
  def rootProcessInstanceId = execution.getRootProcessInstanceId()
  def processInstanceId = execution.getProcessInstanceId()

  execution.setVariable('system_signature_ceph_key', "lowcode_${rootProcessInstanceId}_${processInstanceId}_system_signature_ceph_key".toString())

  def systemSignature = systemSignatureResponse.prop('signature').value()

  def cephObj = ['data':S(dataToSign, 'application/json').toString(), 'signature':systemSignature]

  execution.removeVariable('systemSignaturePayload')
  execution.setVariableLocalTransient('systemSignaturePayload', S(cephObj, 'application/json').toString())
======
====

image:registry-develop:study-project/task-3/task-3-21-bp.png[]

* Створіть нову сервісну задачу "Запис системного підпису у Ceph", натиснувши іконку ключа та обравши з меню пункт *Service Task*.
* Натисніть `Open Catalog`, оберіть шаблон *Put content to Ceph* та натисніть `Apply` для підтвердження;
* Заповніть поля:
** `Name` - `Запис системного підпису у Ceph`
** `Ceph key` - `$\{system_signature_ceph_key}`
** `Content` - `$\{systemSignaturePayload}`

image:registry-develop:study-project/task-3/task-3-22-bp.png[]

Заповніть кінцеву подію:

`Name` - `end`

image:registry-develop:study-project/task-3/task-3-23-bp.png[]

[#create-service-task-create-entity]
==== Створення скрипт задачі для збереження даних в Дата фабрику

* Створіть нову сервісну задачу "Зберегти дані в Дата фабрику", натиснувши іконку ключа та обравши з меню пункт *Service Task*.
* Натисніть `Open Catalog`, оберіть шаблон *Create entity in data factory* та натисніть `Apply` для підтвердження;
* Заповніть поля:
** `Id` - `sendLabToDataFactoryActivity`
** `Name` - `Зберегти дані в Дата фабрику`
** `Resource` - `laboratory`
** `Payload` - `$\{dataPayload}`
** `X-Access-Token` - `${completer('signLabFormActivity').accessToken}`
** `X-Digital-Signature source` - `${sign_submission('signLabFormActivity').signatureDocumentId}`
** `X-Digital-Signature-Derived source` - `$\{system_signature_ceph_key}`
** `Result Variable` - `response`

image:registry-develop:study-project/task-3/task-3-24-bp.png[]

[#create-service-task-create-entity-end]
==== Створення скрипт задачі для встановлення результату БП

* Створіть нову сервісну задачу "Встановити результат БП", натиснувши іконку ключа та обравши з меню пункт *Service Task*.
* Натисніть `Open Catalog`, оберіть шаблон *Define business process status* та натисніть `Apply` для підтвердження;
* Заповніть поля:
** `Name` - `Результат виконання "Лабораторія створена"`
** `Status` - `Лабораторія створена!`

image:registry-develop:study-project/task-3/task-3-25-bp.png[]

[#create-task-entity-finish]
==== Створення кінцевої події
Заповніть кінцеву подію:

`Name` - `Лабораторія створена`

image:registry-develop:study-project/task-3/task-3-26-bp.png[]

[#forms-modeling]
=== Моделювання форм

[TIP]
====
На етапі моделювання форм необхідно створити та прив'язати JSON-форми до попередньо змодельованих задач в рамках бізнес-процесу.

Форми прив'язуються до бізнес-процесів за службовою назвою.

Використовуйте файли _link:{attachmentsdir}/study-project/task-3/bp-forms/add-lab-bp-add-lab.json[add-lab-bp-add-lab.json]_ та _link:{attachmentsdir}/study-project/task-3/bp-forms/add-lab-sign-lab-data.json[add-lab-sign-lab-data.json]_ зі змодельованими формами для прикладу.
====

[#form-insert-data]
==== Створення форми для внесення даних

Найперше, необхідно *створити форму для внесення даних* користувачем. Для цього виконайте наступні кроки:

* Увійдіть до застосунку *Кабінет адміністратора регламентів*.

image::registry-develop:bp-modeling/forms/admin-portal-form-modeling-step-1.png[]

* Перейдіть до розділу *Моделювання UI-форм*.

image:registry-develop:bp-modeling/forms/admin-portal-form-modelling-step-2.png[]

* Щоб створити нову форму для бізнес-процесу, натисніть кнопку `Створити нову форму`.

image:registry-develop:bp-modeling/forms/admin-portal-form-modelling-step-4.png[]

* У вікні, що відкрилося, вкажіть назву відповідної користувацької задачі -- xref:#create-task-add-lab-data[`Додати інформацію про лабораторію`] в полі `Бізнес-назва форми`.
* Заповніть поле `Службова назва форми` значенням `add-lab-bp-add-lab`.

* З панелі зліва перетягніть компонент *Text Field* до панелі моделювання та виконайте наступні налаштування:
** на вкладці *Display* заповніть поле `Label` значенням `Назва лабораторії`

image:registry-develop:study-project/task-3/task-3-27-forms.png[]

** на вкладці *Validation* заповніть чекбокс  `Required` - true

image:registry-develop:study-project/task-3/task-3-28-forms.png[]

** на вкладці *API* заповніть поле `Property Name` значенням `name`
** натисніть кнопку `Save` для збереження змін

image:registry-develop:study-project/task-3/task-3-29-forms.png[]

* Аналогічно змоделюйте текстові поля для "Код ЄДРПОУ або РНОКПП" , "Адреса", "Телефон ", "Керівник".

* З панелі зліва перетягніть компонент *Checkbox* до панелі моделювання та виконайте наступні налаштування:
** на вкладці *Display* заповніть поле `Label` значенням `Наявність акредитації`

image:registry-develop:study-project/task-3/task-3-30-forms.png[]

** на вкладці *API* заповніть поле `Property Name` значенням `accreditationFlag`
** натисніть кнопку `Save` для збереження змін

image:registry-develop:study-project/task-3/task-3-31-forms.png[]

* З панелі зліва перетягніть компонент *File* до панелі моделювання та виконайте наступні налаштування:
** на вкладці *Display* заповніть поле `Label` значенням `Документи про приміщення`

image:registry-develop:study-project/task-3/task-3-32-forms.png[]

** на вкладці *File* заповніть поля:
*** `Storage` - `Url`
*** `Url` - `/documents`

image:registry-develop:study-project/task-3/task-3-33-forms.png[]

*** `File Pattern` - `application/pdf,image/jpeg,image/png`
*** `File Minimum size` - `0KB`
*** `File Maximum size` - `50MB`

image:registry-develop:study-project/task-3/task-3-34-forms.png[]

** на вкладці *Data* чекбокс `Multiple Values` - `False`

image:registry-develop:study-project/task-3/task-3-35-forms.png[]

** на вкладці *API* заповніть поле `Property Name` значенням `premisesFile`
** натисніть кнопку `Save` для збереження змін

image:registry-develop:study-project/task-3/task-3-36-forms.png[]

* З панелі зліва перетягніть компонент *Select* до панелі моделювання та виконайте наступні налаштування для отримання інформації з довідника:
** на вкладці *Display* заповніть поле `Label` значенням `Форма власності`

image:registry-develop:study-project/task-3/task-3-37-forms.png[]

** на вкладці *Data* заповніть поля:

*** `Data Source Type` - `URL`
*** `Data Source URL` - `/officer/api/data-factory/ownership-contains-name`, де
**** `/officer` - вказує, що до довідника буде запит з кабінету посадової особи,
**** `/api/data-factory/` - вказує шлях до дата-фабрики
**** `ownership-contains-name` - назва search condition для отримання даних з довідника форм власності, який був змодельований та доданий у репозиторій
*** `Value Property` - `ownershipId`
*** `Item Template` - `<span>{{ item.name }}</span>`,  де `name` - назва параметру, що повертає search condition та буде відображений на формі.

image:registry-develop:study-project/task-3/task-3-38-forms.png[]

image:registry-develop:study-project/task-3/task-3-39-forms.png[]

** на вкладці *Validation* чекбокс `Required` - `true`

** на вкладці *API* заповніть поле `Property Name` значенням `ownership`

image:registry-develop:study-project/task-3/task-3-40-forms.png[]

** натисніть кнопку `Save` для збереження змін

** Аналогічно  виконайте налаштування для отримання інформації з довідника "Область". З панелі зліва перетягніть компонент *Select* до панелі моделювання:
*** на вкладці *Display* заповніть поле `Label` значенням `Область`

image:registry-develop:study-project/task-3/task-3-41-forms.png[]

*** на вкладці *Data* заповніть поля:

**** `Data Source Type` - `URL`
**** `Data Source URL` - `/officer/api/data-factory/koatuu-obl-contains-name`, де
***** `/officer` - вказує, що до довідника буде запит з кабінету посадової особи,
***** `/api/data-factory/` - вказує шлях до дата-фабрики
***** `koatuu-obl-contains-name` - назва search condition для отримання даних з довідника областей, який був змодельований та доданий у репозиторій
*** `Value Property` - `code`
*** `Item Template` - `<span>{{ item.name }}</span>`,  де `name` - назва параметру, що повертає search condition та буде відображений на формі.

image:registry-develop:study-project/task-3/task-3-42-forms.png[]

image:registry-develop:study-project/task-3/task-3-43-forms.png[]

** на вкладці *Validation* чекбокс `Required` - `true`

** на вкладці *API* заповніть поле `Property Name` значенням `oblast`

image:registry-develop:study-project/task-3/task-3-44-forms.png[]

** натисніть кнопку `Save` для збереження змін

** Налаштування залежного компонента Select:
*** З панелі зліва перетягніть компонент *Select* до панелі моделювання та виконайте наступні налаштування для отримання інформації з довідника:
*** на вкладці *Display* заповніть поле `Label` значенням `Назва населеного пункту`

image:registry-develop:study-project/task-3/task-3-45-forms.png[]

*** на вкладці *Data* заповніть поля:

**** `Data Source Type` - `URL`
**** `Data Source URL` - `/officer/api/data-factory/koatuu-np-starts-with-name-by-obl`, де
***** `/officer` - вказує, що до довідника буде запит з кабінету посадової особи,
***** `/api/data-factory/` - вказує шлях до дата-фабрики
***** `koatuu-np-starts-with-name-by-obl` - назва search condition для отримання даних з довідника населених пунктів, який був змодельований та доданий у репозиторій
**** `Value Property` - `koatuuId`
**** `Filter Query` - `level1={{data.oblast.code}}`, де
***** `level1` - вхідний параметр для ендпоінта koatuu-np-starts-with-name-by-obl
***** `{{data.oblast.code}}`- шлях для отримання даних `data.Property name.Value Property` з попереднього Select

**** `Item Template` - `<span>{{ item.name }}</span>`,  де `name` - назва параметру, що повертає search condition та буде відображений на формі
**** `Refresh options On` - `Область` ,  (поточне значення буде видалено, коли значення в полі Область зміниться)
**** чекбокс `Clear Value On Refresh Options` встановити `True`

image:registry-develop:study-project/task-3/task-3-46-forms.png[]

image:registry-develop:study-project/task-3/task-3-47-forms.png[]

** на вкладці *Validation* чекбокс `Required` - `true`

** на вкладці *API* заповніть поле `Property Name` значенням `koatuu`

** натисніть кнопку `Save` для збереження змін

** Збережіть форму, натиснувши кнопку `Створити форму` у правому верхньому куті:

image:registry-develop:study-project/task-3/task-3-48-forms.png[]

[#form-data-signing]
==== Створення форми для підпису даних

Після завершення попереднього кроку та створення форми для внесення даних, *створіть* ще одну *форму для підпису даних*.

Для цього *скопіюйте* попередньо змодельовану форму, натиснувши **іконку копіювання** -- це дозволить створити форму із готового шаблону.


image:registry-develop:study-project/task-3/task-3-49-forms.png[]

*Налаштуйте параметри форми*:

* введіть назву користувацької задачі xref:#create-task-lab-data-signing[`Підписати дані про лабораторію`] в полі `Бізнес-назва форми`;
* заповніть поле `Службова назва форми` значенням `add-lab-sign-lab-data`;

* В усіх компонентах:

** на вкладці *Display* встановіть прапорець для параметра *Disabled*;
** Натисніть кнопку `Save` для збереження змін.

image:registry-develop:study-project/task-3/task-3-50-forms.png[]

==== Збереження змодельованих форм бізнес-процесу

* Збережіть форму, натиснувши кнопку `Створити форму` у правому верхньому куті.

* Завантажте форми, натиснувши *іконку завантаження*, та помістіть їх до регламентної папки *_forms_* проєкту в локальному Gerrit-репозиторії.
image:registry-develop:study-project/task-1/task-1-14-forms.png[]

[#bp-access]
=== Моделювання доступу до бізнес-процесу

[TIP]
====
На цьому етапі необхідно надати доступ до бізнес-процесу із Кабінеті посадової особи.

Параметри доступу налаштовуються у конфігураційному файлі, що має назву _link:{attachmentsdir}/study-project/task-1/bp-access/officer.yml[officer.yml]_.
====

* Створіть файл _officer.yml_ та зазначте в ньому наступні параметри:

[source,yaml]
----
authorization:
  realm: 'officer'
  process_definitions:
    – process_definition_id: 'add-lab'
      process_name: 'Створення лабораторії'
      process_description: 'Створення лабораторії'
      roles:
        – officer
----

==== Збереження файлу з налаштування доступу

Збережіть файл _officer.yml_ до регламентної папки *_bp-auth_* проєкту в локальному Gerrit-репозиторії.

== Завантаження файлів регламенту до віддаленого репозиторію Gerrit

Для успішного розгортання бізнес-процесу, форм, а також застосування правильних налаштувань доступу до бізнес-процесу у цільовому середовищі, адміністратор регламенту має завантажити збережені локально файли регламенту реєстру до віддаленого сховища коду Gerrit.

