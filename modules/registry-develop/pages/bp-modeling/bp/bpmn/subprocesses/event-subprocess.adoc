= Подієвий підпроцес
:toc:
:toc-title: ЗМІСТ
:toclevels: 5
:sectnums:
:sectnumlevels: 5
:sectanchors:

== Загальний опис

_Подієвий підпроцес_ (*Event Subprocess*) -- це підпроцес, що ініційований подією. Його можна додати локально всередині вбудованого підпроцесу. Такий підпроцес починає виконуватися, якщо ініціюється його початкова подія. Батьківськийfootnote:[_Батьківський_ або _основний_ процес (*Parent process*) -- процес, що ініціює запуск підпроцесу. Відносно батьківського процесу підпроцес є *Child*-процесом (*Child process*).] процес зупиняється в точці очікування результату від підпроцесу.

image:bp-modeling/bp/subprocesses/event-subprocess/event-subprocess-01.png[]

[event-types]
=== Типи подій

Для ініціювання подієвого підпроцесу можуть бути використані наступні типи подій:

xref:bp-modeling/bp/bpmn/events/message-event.adoc[Подія «Повідомлення» (Message Event)] ::

Подія «Повідомлення» (*Message Event*) -- це подія у бізнес-процесі, яка використовується для передачі інформації від одного бізнес-процесу до іншого бізнес-процесу або підпроцесу за допомогою повідомлення.

xref:bp-modeling/bp/bpmn/events/error-event.adoc[Подія «Помилка» (Error Event)] ::
+
Під час автоматизації процесів можна часто стикнутися із відхиленнями від стандартного сценарію. Одним зі способів усунути відхилення є використання BPMN-події «Помилка», що дозволяє моделі бізнес-процесу реагувати на передбачені сценаріями помилки в рамках виконання задачі.
+
Початкова подія, викликана помилкою (*Error Start Event*), може використовуватися _лише_ для запуску подієвого підпроцесу.

NOTE: Подію «Помилка» не можна використовувати для запуску екземпляра процесу. Початкова подія, викликана помилкою, є завжди _переривальною_.

== Моделювання вбудованого підпроцесу, ініційованого подією «Повідомлення»

=== Передумови

Перед застосуванням сценарію із запуском підпроцесу подією «Повідомлення», виконайте наступні передумови:

. Змоделюйте батьківський процес (він може запускати підпроцес, а може і не запускати).

. Змоделюйте (за необхідності) інший процес, що запускатиме підпроцес.
+
NOTE: Процес, що надсилатиме повідомлення, повинен мати змодельовану xref:bp-modeling/bp/bpmn/events/message-event.adoc[подію відправки повідомлення] (проміжну або кінцеву) для запуску підпроцесу (_див. xref:#example-preconditions-message-throw-event[приклад] нижче_).

+
[#example-preconditions-message-throw-event]
.Приклад. Моделювання підпроцесу, ініційованого подією «Повідомлення»

image:bp-modeling/bp/subprocesses/event-subprocess/event-subprocess-02.png[]

. Налаштуйте подію відправки повідомлення:

* Виділіть елемент та перейдіть до панелі налаштувань.
* У полі `Global Message Name` та `Global Message referenced` введіть значення для `Global Message`. Значення `Global Message referenced` заповнюється автоматично. Наприклад, `sendMessagefirst`.
+
NOTE: Значення параметрів `Global Message Name` та `Global Message referenced` для обох подій (відправки та отримання повідомлення) мають бути ідентичними. Для елемента відправки параметри необхідно ввести. Для елемента отримання параметри необхідно обрати із випадного списку для кореляції.
+
image:bp-modeling/bp/subprocesses/event-subprocess/event-subprocess-03.png[]

=== Моделювання

Після виконання усіх передумов, продовжіть моделювання та налаштування подієвого підпроцесу:

. На панелі інструментів зліва оберіть елемент *Create expanded SubProcess* та перетягніть його до області моделювання, всередину пулу із батьківським процесом.
+
image:bp-modeling/bp/subprocesses/event-subprocess/event-subprocess-1.png[]
+
image:bp-modeling/bp/subprocesses/event-subprocess/event-subprocess-2.png[]

. Виділіть контейнер із вбудованим підпроцесом та вкажіть тип підпроцесу, натиснувши _іконку ключа_ (*Change Type*) та обравши *Event Sub Process*.
+
image:bp-modeling/bp/subprocesses/event-subprocess/event-subprocess-3.png[]

. Виділіть стартову подію у підпроцесі й вкажіть її тип, натиснувши _іконку ключа_ та обравши *Message Start Event (non-interrupting)*.
+
[NOTE]
====
На відміну від налаштувань основного процесу, подія старту підпроцесу додається автоматично, разом із контейнером *Create expanded SubProcess*.
====
+
[WARNING]
====
Вибір переривальної події (non-interrupting) обумовлений тим, що при виборі переривальної, токен батьківського процесу анулюється відразу ж при старті підпроцесу, і батьківський процес вже НЕ запуститься.
====
+
image:bp-modeling/bp/subprocesses/event-subprocess/event-subprocess-4.png[]

. Налаштуйте стартову подію, що прийматиме повідомлення у підпроцесі:

* Виділіть елемент та перейдіть до панелі налаштувань.
* У полі `Global Message Name` та `Global Message referenced` оберіть значення для `Global Message`. Значення `Global Message referenced` заповнюється автоматично. Наприклад, `sendMessagefirst`.
+
NOTE: Значення параметрів `Global Message Name` та `Global Message referenced` для обох подій (відправки та отримання повідомлення) мають бути ідентичними. Для елемента відправки параметри необхідно ввести. Для елемента отримання параметри необхідно обрати із випадного списку для кореляції.
+
image:bp-modeling/bp/subprocesses/event-subprocess/event-subprocess-5.png[]

. Приєднайте будь-яку проміжну задачу та завершіть підпроцес.

В результаті підпроцес, що ініційований подією «Повідомлення», змодельовано та налаштовано.

[#event-subprocess-error-start-event]
== Моделювання вбудованого підпроцесу, ініційованого подією «Помилка»

Для запуску вбудованого підпроцесу подією «Помилка», використовується _стартова переривальна подія «Помилка»_ -- *Error Sub-Process Interrupting Start Event*.

IMPORTANT: Стартова переривальна подія «Помилка» (*Error Sub-Process Interrupting Start Event*) може використовуватися лише для запуску подієвого підпроцесу й не може ініціювати запуск екземпляра процесу. Така подія є завжди переривальною.

Для моделювання та налаштування стартової події «Помилка» у підпроцесі, необхідно виконати наступні кроки:

. Змоделюйте батьківський бізнес-процес, який завершується, наприклад, кінцевою подією «Помилка» (*Error End Event*).
+
TIP: Детальніше про моделювання та налаштування кінцевої події «Помилка» (*Error End Event*) -- за xref:bp-modeling/bp/bpmn/events/error-event.adoc#error-end-event[посиланням].
+
CAUTION: Елемент *Error Sub-Process Interrupting Start Event* може бути ініційований не лише елементом *Error End Event*, а й бізнес-помилкою, яка сталася при виконанні певної задачі (користувацької, сервісної тощо) у батьківському бізнес-процесі.

. На панелі зліва оберіть елемент *Create expanded SubProcess*.
+
image:bp-modeling/bp/subprocesses/event-subprocess/error2_1.png[]

. Перетягніть елемент *Create expanded SubProcess* до пулу із батьківським процесом.
+
image:bp-modeling/bp/subprocesses/event-subprocess/error2_2.png[]

. Змініть тип вбудованого підпроцесу, натиснувши _іконку ключа_ -- (*Change Type*) та обравши *Event Sub Process* (_Подієвий підпроцес_).
+
image:bp-modeling/bp/subprocesses/event-subprocess/error2_3.png[]

. Виділіть стартову подію у підпроцесі й вкажіть її тип, натиснувши _іконку ключа_ та обравши *Error Start Event*.
+
[NOTE]
====
На відміну від налаштувань основного процесу, подія старту підпроцесу додається автоматично, разом із контейнером *Create expanded SubProcess*.
====
+
image:bp-modeling/bp/subprocesses/event-subprocess/error2_4.png[]
+
image:bp-modeling/bp/subprocesses/event-subprocess/error2_5.png[]

. На вкладці *General* налаштуйте елемент:
* У полі `Id` вкажіть робочий ідентифікатор елемента, або залиште значення за замовчуванням.
* У полі `Name` вкажіть робочу назву елемента.

. Розгорніть блок *Details*. Для цього натисніть позначку плюса (`+`).
+
image:bp-modeling/bp/subprocesses/event-subprocess/error2_6.png[]

* Якщо помилка ініціюється елементом *Error End Event*, то у полі `Global Error referenced` необхідно обрати посилання до елемента помилки-відправника (наприклад, таку, що змодельовано та налаштовано у батьківському бізнес-процесі). При цьому значення полів `Name` та `Code` заповнюються автоматично.
+
IMPORTANT: Вказане значення поля `Global Error referenced` має бути ідентичним для пов'язаних елементів: відправника та приймального елемента помилки.
+
image:bp-modeling/bp/subprocesses/event-subprocess/error2_7.png[]

* Якщо подія «Помилка» ініціюється помилкою, що передбачена бізнес-логікою при виконанні задачі бізнес-процесу, то необхідно:

** У полі `Name` вказати найменування помилки.
Наприклад, `startError`.
** У полі `Code` вказати тип (назву класу) будь-якого винятку Java як коду помилки.
Наприклад, `java.lang.Exception`.
+
[NOTE]
====
Значення коду `java.lang.Exception` перехоплюватиме будь-яку логічну помилку, яка відбудеться у батьківському бізнес-процесі.
====

** Значення поля `Global Error referenced` заповнюється автоматично, відповідно до введених даних назви та коду помилки.
Наприклад, `startError` (`code=java.lang.Exception`).
+
image:bp-modeling/bp/subprocesses/event-subprocess/error2_8.png[]

** За потреби, у полі `Message` вкажіть дані помилки, що передається системою.
** Якщо помилка ініціюється змінною, то її значення можна вказати наступним чином:
*** у полі `Code Variable` вкажіть константу або JUEL-функцію, яка містить код помилки;
*** у полі `Message Variable` вкажіть константу або JUEL-функцію, яка містить дані помилки.

. Завершіть моделювання активностей підпроцесу.

В результаті підпроцес, що ініційований подією «Помилка», змодельовано та налаштовано.

.Приклад. Моделювання підпроцесу, старт якого ініційовано подією помилки в батьківському бізнес-процесі
====
image:bp-modeling/bp/subprocesses/event-subprocess/error2_9.png[]
====








