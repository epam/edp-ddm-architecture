= Використання бізнес-ключів у бізнес-процесах

:sectnums:
:sectanchors:

Поточний документ описує розширення можливостей моделювання бізнес-процесів за допомогою бізнес-ключів.

== Загальний опис

*Бізнес-ключ* (*Business Key*) -- це специфічний ідентифікатор екземпляра бізнес-процесу в https://camunda.com/bpmn/reference[Camunda BPM]. Він виступає як додатковий атрибут, що застосовується при моделюванні бізнес-процесів для їх однозначної ідентифікації, а також ідентифікації користувацьких задач процесу.

TIP: Зверніться до https://camunda.com/blog/2018/10/business-key/[офіційного джерела] для отримання детальної інформації щодо бізнес-ключів в Camunda.

// TODO Що мається на увазі під "бізнес-значимими" атрибутами?
Бізнес-ключем може виступати будь-який один атрибут або сполучення бізнес-значимих атрибутів конкретного бізнес-процесу чи користувацької задачі.

За допомогою бізнес-ключа користувач може відрізнити один бізнес-процес від іншого (або одну користувацьку задачу від іншої) в *переліку бізнес-задач особистих Кабінетів посадової особи та отримувача послуг*.

=== Випадки використання бізнес-ключів

При моделюванні бізнес-ключ може застосовуватись для:

. xref:#bp-key-start[Ідентифікації бізнес-процесу на старті процесу].
. xref:#bp-key-start-message-event[Ідентифікації бізнес-процесу на старті процесу, що ініційований стартовою подією «Повідомлення»].
. xref:#bp-key-bp-stage[Ідентифікації бізнес-процесу на етапі виконання процесу].

[#bp-key-start]
=== Створення та налаштування бізнес-ключа на старті бізнес-процесу

Для створення бізнес-ключа на старті бізнес-процесу, необхідно виконати наступні кроки:

* На вкладці *General* додайте початкову подію для старту бізнес-процесу та налаштуйте її параметри (_див. xref:registry-develop:bp-modeling/bp/bp-modeling-instruction.adoc#initial-event[Налаштування початкової події]_).
* На вкладці *Extensions* налаштуйте параметри бізнес-ключа:
** У полі `Add Property` натисніть `+` (позначку плюса) та вкажіть такі налаштування:
*** для параметра `Name` вкажіть `businessKeyExpression`;
*** у полі `Value` вкажіть вираз, що встановлює значення бізнес-ключа, використовуючи функцію `submission()` (_див. xref:registry-develop:bp-modeling/bp/modeling-facilitation/modelling-with-juel-functions.adoc#submission-fn[Функція submission()]_).

image::bp-modeling/bp/bp-keys/bp-key-start-1.png[]

[CAUTION]
====
Для створення виразу `businessKeyExpression`, необхідно попередньо визначити, який саме атрибут чи сполучення атрибутів ідентифікуватиме цей бізнес-процес.

Для кабінету користувача результатом виразу `businessKeyExpression` є текстове поле, що складається із конкатенованих, тобто поєднаних, значень атрибутів полів, вказаних у виразі.
====

.Приклад. Створення бізнес-процесу внесення паспортних даних особи

Розглянемо приклад створення бізнес-процесу внесення паспортних даних особи.

При моделюванні вказуємо для параметра `businessKeyExpression` (вираз бізнес-ключа) наступне значення:

// TODO: Clarify about the source - Java or JUEL?
[source, juel]
----
${submission('Id початкової події').formData.prop('Property Name  <атрибут1>').value()+" "+submission('Id початкової події ').formData.prop(''Property Name <атрибут2>').value()}
----

[TIP]
====
* Змінній `<атрибут1>` відповідає значення прізвища особи, наприклад, `Сидоренко`.
* Змінній `<атрибут2>` відповідає значення імені особи, наприклад, `Іван`.
====

Підставляємо необхідні значення змінних та отримуємо наступний вираз:

[source, juel]
----
${submission('Id початкової події').formData.prop('Property Name  Сидоренко').value()+" "+submission('Id початкової події ').formData.prop(''Property Name Іван').value()}
----

В результаті, на інтерфейсі користувача сформований бізнес-ключ відображатиметься як `Сидоренко Іван`.

[#bp-key-start-message-event]
=== Створення та налаштування бізнес-ключа на старті бізнес-процесу, що ініційований отриманою стартовою подією «Повідомлення»

Для створення бізнес-ключа на старті бізнес-процесу, що ініційований отриманою стартовою подією «Повідомлення», необхідно виконати наступні кроки:

* Додайте стартову подію *"Повідомлення"* (*Start Message Event*), яка ініціює бізнес-процес, та налаштуйте її параметри на вкладці *General* (_див. xref:registry-develop:bp-modeling/bp/events/message-event.adoc[Налаштування стартової події "Повідомлення"]_):
* На вкладці *Extensions* налаштуйте параметри бізнес-ключа:
** У полі `Add Property` натисніть `+` (позначку плюса) та вкажіть такі налаштування:
*** для параметра `Name` вкажіть `businessKeyExpression`;
*** у полі `Value` вкажіть вираз, що встановлює значення бізнес-ключа, використовуючи функцію `submission()` (_див. xref:registry-develop:bp-modeling/bp/modeling-facilitation/modelling-with-juel-functions.adoc#submission-fn[Функція submission()]_).

image:bp-modeling/bp/bp-keys/bp-key-start-message-event.png[]

[#bp-key-bp-stage]
=== Налаштування ключа бізнес-процесу на етапі виконання процесу

Існує також можливість змоделювати та налаштувати бізнес-ключ на етапі виконання бізнес-процесу.

[IMPORTANT]
====
Для моделювання та налаштування бізнес-ключа, бізнес-процес має містити змодельовані попередньо xref:registry-develop:bp-modeling/bp/bp-modeling-instruction.adoc#_створення_та_налаштування_користувацької_задачі_user_task_внести_запис_довідника[Користувацькі задачі].
====

Для створення бізнес-ключа на етапі виконання бізнес-процесу, необхідно виконати наступні кроки:

* Додайте  сервісну задачу  до бізнес-процесу:
** Вкажіть тип задачі, натиснувши на іконку ключа (*Change type*) та оберіть з меню пункт *Service Task*.

* Відкрийте вкладку *General* та перейдіть до каталогу шаблонів. Для цього у полі *Template* натисніть кнопку `Open Catalog` та оберіть відповідний шаблон *Define process business key*.

image:bp-modeling/bp/bp-keys/bp-key-in-process.png[]

* Далі, у полі `Name` введіть назву сервісної задачі (тут -- `Сервісна задача 1`);
* у полі `Business key` вкажіть вираз, що встановлює значення бізнес-ключа, використовуючи функцію `submission()` (_див. xref:registry-develop:bp-modeling/bp/modeling-facilitation/modelling-with-juel-functions.adoc#submission-fn[Функція submission()]_).

.Приклад
[source, juel]
----
${submission('Usertask').formData.prop('<атрибут1>').value()+" "+submission('Usertask').formData.prop('<атрибут2>').value()}
----

image:bp-modeling/bp/bp-keys/bp-key-in-process-submission-user-task-3.png[]

[TIP]
====
* Параметр `Usertask` -- це ID користувацької задачі *"Користувацька задача 1"*.

image:bp-modeling/bp/bp-keys/bp-key-in-process-submission-user-task-1.png[]

image:bp-modeling/bp/bp-keys/bp-key-in-process-submission-user-task.png[]

* Змінні `<атрибут1>` та `<атрибут2>` -- параметри поля `Property Name`, що використовуються і для форм користувача (вкладка *API*) з метою приєднати форми до відповідних бізнес-процесів.

image:bp-modeling/bp/bp-keys/bp-key-in-process-submission-user-task-2.png[]
====

В результаті сервісна задача є налаштованою і стає доступною у бізнес-процесі.




