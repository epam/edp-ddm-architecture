= Використання бізнес-ключів у бізнес-процесах

:sectnums:
:sectanchors:

Поточний документ описує розширення можливостей моделювання бізнес-процесів за допомогою бізнес-ключів.

== Загальний опис

*Бізнес-ключ* (*Business Key*) -- це специфічний ідентифікатор екземпляра бізнес-процесу в https://camunda.com/bpmn/reference[Camunda BPM]. Він виступає як додатковий атрибут, що застосовується при моделюванні бізнес-процесів для їх однозначної ідентифікації, а також ідентифікації користувацьких задач процесу.

TIP: Зверніться до https://camunda.com/blog/2018/10/business-key/[офіційного джерела] для отримання детальної інформації щодо бізнес-ключів в Camunda.

Бізнес-ключем може виступати будь-який один атрибут або сполучення бізнес-значимих атрибутів конкретного бізнес-процесу чи користувацької задачі.

За допомогою бізнес-ключа користувач може відрізнити один бізнес-процес від іншого (або одну користувацьку задачу від іншої) в *переліку бізнес-задач особистих Кабінетів посадової особи та отримувача послуг*.

== Випадки використання бізнес-ключів

При моделюванні бізнес-ключ може застосовуватись для:

. xref:#bp-key-start[Ідентифікації бізнес-процесу на старті процесу].
. xref:#bp-key-start-message-event[Ідентифікації бізнес-процесу на старті процесу, що ініційований стартовою подією «Повідомлення»].
. xref:#bp-key-bp-stage[Ідентифікації бізнес-процесу на етапі виконання процесу].

[#bp-key-start]
== Створення та налаштування бізнес-ключа на старті бізнес-процесу

Для створення бізнес-ключа на старті бізнес-процесу, необхідно виконати наступні кроки:

. Відкрийте додаток **Camunda Modeler** та створіть нову **діаграму BPMN**, натиснувши кнопку `BPMN diagram`.

В результаті з`явиться вікно нової діаграми.

image:registry-develop:bp-modeling/bp/modeling-instruction/bp-1.png[]

[start=2]
. Перетягніть елемент *Create Pool/Participant* до панелі моделювання (_див. xref:registry-develop:bp-modeling/bp/bp-modeling-instruction.adoc#create-pool-participant[Додавання елемента Create pool/Participant]_).

NOTE: Моделювання діаграми бізнес-процесу має відбуватися в рамках елемента *Create Pool/Participant*.

[start=3]
. Додайте та налаштуйте початкову подію:
* З панелі інструментів зліва перетягніть елемент коло (*Create StartEvent*) до панелі моделювання:
+
image::registry-develop:bp-modeling/bp/bp-keys/bp-keys-create-start-event.png[]
+
image::registry-develop:bp-modeling/bp/bp-keys/bp-keys-create-start-event-1.png[]
* Натисніть на елемент *Create StartEvent* та на панелі налаштувань справа сконфігуруйте початкову подію:
** На вкладці *General* налаштуйте основні параметри для старту бізнес-процесу (_див. xref:registry-develop:bp-modeling/bp/bp-modeling-instruction.adoc#initial-event[Налаштування початкової події]_).
** На вкладці *Extensions* налаштуйте параметри бізнес-ключа:
*** у полі `Add Property` натисніть `+` (позначку плюса) та зазначте такі налаштування:
**** для параметра `Name` вкажіть `businessKeyExpression`;
**** у полі `Value` вкажіть вираз, що встановлює значення бізнес-ключа, використовуючи функцію `submission()` (_див. xref:registry-develop:bp-modeling/bp/modeling-facilitation/modelling-with-juel-functions.adoc#submission-fn[Функція submission()]_).

image::bp-modeling/bp/bp-keys/bp-keys-create-start-event-2.png[]

.Приклад. Функція submission()
[source, juel]
----
${submission('Usertask').formData.prop('<атрибут1>').value()+" "+submission('Usertask').formData.prop('<атрибут2>').value()}
----

[CAUTION]
====
Для створення виразу `businessKeyExpression` необхідно попередньо визначити, який саме атрибут чи сполучення атрибутів ідентифікуватиме цей бізнес-процес.

Для Кабінетів користувача (посадової особи та отримувача послуг реєстру) результатом виразу `businessKeyExpression` є текстове поле, що складається із конкатенованих, тобто поєднаних, значень атрибутів полів, вказаних у виразі.
====

=== Приклад створення бізнес-процесу внесення паспортних даних особи

Розглянемо приклад створення бізнес-процесу внесення паспортних даних особи із використанням бізнес-ключа та функції `submission()`.

. При моделюванні вказуємо для параметра `businessKeyExpression` (вираз бізнес-ключа) наступне значення:

[source, juel]
----
${submission('Id початкової події').formData.prop('Property Name  <атрибут1>').value()+" "+submission('Id початкової події ').formData.prop('Property Name <атрибут2>').value()}
----

[TIP]
====
* Змінній `<атрибут1>` може відповідати, наприклад, параметр `Прізвище`.
* Змінній `<атрибут2>` може відповідати, наприклад, параметр `Ім'я`.
* Змінна `Id початкової події` повинна містити ідентифікатор початкової події, в рамках якої застосовуються бізнес-ключі. ID призначається автоматично при моделюванні події, але може також визначатися вручну.
====

[start=2]
. Підставляємо необхідні значення змінних та отримуємо наступний вираз:

[source, juel]
----
${submission('StartEvent_1').formData.prop('Property Name  Прізвище').value()+" "+submission('StartEvent_1').formData.prop('Property Name Ім'я).value()}
----

[start=3]
. В результаті, на xref:#_налаштування_ключів_бізнес_процесу_при_моделюванні_користувацьких_форм[інтерфейсі користувацьких форм] сформований бізнес-ключ буде представлено двома полями: `Прізвище` та `Ім'я`.

[#bp-key-start-message-event]
== Створення та налаштування бізнес-ключа на старті бізнес-процесу, що ініційований стартовою подією «Повідомлення»

Для створення бізнес-ключа на старті бізнес-процесу, що ініційований стартовою подією «Повідомлення», необхідно виконати наступні кроки:

. Відкрийте додаток **Camunda Modeler** та створіть нову **діаграму BPMN**, натиснувши кнопку `BPMN diagram`.

В результаті з`явиться вікно нової діаграми.

image:registry-develop:bp-modeling/bp/modeling-instruction/bp-1.png[]

[start=2]
. Перетягніть елемент *Create Pool/Participant* до панелі моделювання (_див. xref:registry-develop:bp-modeling/bp/bp-modeling-instruction.adoc#create-pool-participant[Додавання елемента Create pool/Participant]_).

NOTE: Моделювання діаграми бізнес-процесу має відбуватися в рамках елемента *Create Pool/Participant*.

[start=3]
. Додайте та налаштуйте початкову подію:
* З панелі інструментів зліва перетягніть елемент коло (*Create StartEvent*) до панелі моделювання:
+
image::registry-develop:bp-modeling/bp/bp-keys/bp-keys-create-start-event.png[]
+
image::registry-develop:bp-modeling/bp/bp-keys/bp-keys-create-start-event-1.png[]

* Виділіть елемент *Create StartEvent*, натисніть на іконку ключа та оберіть тип стартової події, що ініціює бізнес-процес -- *Message Start Event*.
+
image:bp-modeling/bp/bp-keys/bp-keys-create-start-message-event.png[]

* На панелі налаштувань справа сконфігуруйте початкову подію:
** На вкладці *General* налаштуйте параметри події (_див. xref:registry-develop:bp-modeling/bp/bp-modeling-instruction.adoc#initial-event[Налаштування початкової події]_):
+
TIP: За детальною інформацією щодо налаштування події «Повідомлення» зверніться до сторінки xref:registry-develop:bp-modeling/bp/events/message-event.adoc[Налаштування стартової події «Повідомлення»].

** На вкладці *Extensions* налаштуйте параметри бізнес-ключа:
*** У полі `Add Property` натисніть `+` (позначку плюса) та вкажіть такі налаштування:
**** для параметра `Name` вкажіть `businessKeyExpression`;
**** у полі `Value` вкажіть вираз, що встановлює значення бізнес-ключа, використовуючи функцію `submission()` (_див. xref:registry-develop:bp-modeling/bp/modeling-facilitation/modelling-with-juel-functions.adoc#submission-fn[Функція submission()]_).

image:bp-modeling/bp/bp-keys/bp-keys-create-start-message-event-1.png[]

.Приклад. Функція submission()
[source, juel]
----
${submission('Usertask').formData.prop('<атрибут1>').value()+" "+submission('Usertask').formData.prop('<атрибут2>').value()}
----

TIP: Приклад використання бізнес-ключа за допомогою функції `submission()` дивіться у розділі xref:#_приклад_створення_бізнес_процесу_внесення_паспортних_даних_особи[].

[#bp-key-bp-stage]
== Налаштування ключа бізнес-процесу на етапі виконання процесу

Існує також можливість змоделювати та налаштувати бізнес-ключ на етапі виконання бізнес-процесу.

[IMPORTANT]
====
Для моделювання та налаштування бізнес-ключа, бізнес-процес має містити попередньо змодельовану xref:registry-develop:bp-modeling/bp/bp-modeling-instruction.adoc#_створення_та_налаштування_користувацької_задачі_user_task_внести_запис_довідника[Користувацьку задачу], що буде пов'язана із сервісною.
====

Для створення бізнес-ключа на етапі виконання бізнес-процесу, необхідно виконати наступні кроки:

. Додайте  сервісну задачу  до бізнес-процесу:
* Вкажіть тип задачі, натиснувши іконку ключа (*Change type*) та оберіть з меню пункт *Service Task*.
+
image::bp-modeling/bp/bp-keys/bp-keys-process-stage-service-task.png[]

* Виділіть сервісну задачу, відкрийте вкладку *General* та перейдіть до каталогу шаблонів. Для цього у полі *Template* натисніть кнопку `Open Catalog` та оберіть відповідний шаблон *Define process business key*.
* Натисніть `Apply` для підтвердження.
+
image::bp-modeling/bp/bp-keys/bp-keys-process-stage.png[]
+
image::bp-modeling/bp/bp-keys/bp-keys-process-stage-1.png[]

* Далі, у полі `Name` введіть назву сервісної задачі (тут -- `Сервісна задача 1`);
* у полі `Business key` вкажіть вираз, що встановлює значення бізнес-ключа, використовуючи функцію `submission()` (_див. xref:registry-develop:bp-modeling/bp/modeling-facilitation/modelling-with-juel-functions.adoc#submission-fn[Функція submission()]_):
+
[source, juel]
----
${submission('Usertask').formData.prop('<атрибут1>').value()+" "+submission('Usertask').formData.prop('<атрибут2>').value()}
----
+
TIP: Приклад використання бізнес-ключа за допомогою функції `submission()` дивіться у розділі xref:#_приклад_створення_бізнес_процесу_внесення_паспортних_даних_особи[].
+
image:bp-modeling/bp/bp-keys/bp-keys-process-stage-template-params.png[]

В результаті сервісна задача є налаштованою і стає доступною у бізнес-процесі.

== Застосування ключів бізнес-процесу за допомогою функції submission() для використання у користувацьких формах

Ключі бізнес-процесів, створені в рамках моделювання BPMN-діаграм можна використовувати при моделюванні користувацьких форм.

Розглянемо приклад такого використання бізнес-ключів у користувацьких формах із застосуванням JUEL-функції `submission()`.

TIP: Застосування такої функції у бізнес-процесі наочно показано в рамках розділу xref:#bp-key-bp-stage[].

.Приклад. Використання атрибутів бізнес-ключів у функції submission()
[source, juel]
----
${submission('Usertask').formData.prop('<атрибут1>').value()+" "+submission('Usertask').formData.prop('<атрибут2>').value()}
----

[TIP]
====
* Параметр `Usertask` є ідентифікатором користувацької задачі `Користувацька задача 1`.

Таким чином `Сервісна задача 1` та `Користувацька задача 1` пов'язуються між собою, а бізнес-ключі, налаштовані за допомогою функції `submission()`, можуть бути використані при подальшому моделюванні форм бізнес-процесів.

CAUTION: Заповніть поле `Form key` значенням ключа, що використовуватиметься як xref:#_налаштування_ключів_бізнес_процесу_при_моделюванні_користувацьких_форм[службова назва конкретної форми], пов'язаної з конкретною користувацькою задачею бізнес-процесу (тут -- `add-usertask`).

image:bp-modeling/bp/bp-keys/bp-keys-process-stage-template-params-userform.png[]

* Змінні `<атрибут1>` та `<атрибут2>` -- параметри поля `Property Name`, що використовуються для API форм користувача (вкладка *API*) в Кабінеті адміністратора регламентів.
====

TIP: Приклад використання бізнес-ключа за допомогою функції `submission()` дивіться у розділі xref:#_приклад_створення_бізнес_процесу_внесення_паспортних_даних_особи[].

=== Налаштування ключів бізнес-процесу при моделюванні користувацьких форм

TIP: За деталями щодо процесу моделювання форм зверніться до сторінки xref:bp-modeling/forms/registry-admin-modelling-forms.adoc[].

Щоб налаштувати ключі бізнес-процесу у користувацьких формах, необхідно виконати наступні кроки:

. Увійдіть до Кабінету адміністратора регламентів, створіть користувацьку форму до бізнес-процесу та налаштуйте бізнес-ключ:

* На панелі компонентів зліва оберіть компонент *Text Field* та перетягніть його до панелі моделювання:
image:bp-modeling/bp/bp-keys/bp-keys-admin-portal-form-1.png[]

* У вікні, що відкрилося, на вкладці *Display*, у полі `Label` введіть значення змінної `<атрибут 1>`, передане функції `submission()` при моделюванні бізнес-процесу в Camunda (тут -- `Прізвище`).
image:bp-modeling/bp/bp-keys/bp-keys-admin-portal-form-4.png[]

* Перейдіть на вкладку *API* та у полі `Property Name` введіть службову назву атрибута `Прізвище`, тобто параметр для API-ендпоінту (тут `surname`).
* Натисніть кнопку `Save`, щоб зберегти зміни.
image:bp-modeling/bp/bp-keys/bp-keys-admin-portal-form-5.png[]

* На панелі компонентів зліва оберіть новий компонент *Text Field* та перетягніть його до панелі моделювання.

* У вікні, що відкрилося, на вкладці *Display*, у полі `Label` введіть значення змінної `<атрибут 2>`, передане функції `submission()` при моделюванні бізнес-процесу в Camunda (тут -- `Ім'я`).
image:bp-modeling/bp/bp-keys/bp-keys-admin-portal-form-2.png[]

* Перейдіть на вкладку *API* та у полі `Property Name` введіть службову назву атрибута `Ім'я`, тобто параметр для API-ендпоінту (тут `name`).
* Натисніть кнопку `Save`, щоб зберегти зміни.
image:bp-modeling/bp/bp-keys/bp-keys-admin-portal-form-3.png[]
+
В результаті отримаємо форму бізнес-процесу із двома полями для вводу даних користувача, що виконуватимуть роль бізнес-ключа.

* Приєднайте створену форму до бізнес-процесу, змодельованого вище у цьому розділі:
** У полі `Службова назва форми` введіть значення параметра `Form key`, налаштованого xref:#bp-key-bp-stage[при моделюванні користувацької задачі] в рамках бізнес-процесу (тут -- `add-usertask`).
* Натисніть іконку налаштувань над полем кожного з атрибутів для редагування компонента.
* Збережіть змодельовану користувацьку форму, натиснувши кнопку `Створити форму` у правому верхньому куті.
image:bp-modeling/bp/bp-keys/bp-keys-admin-portal-form-6.png[]








