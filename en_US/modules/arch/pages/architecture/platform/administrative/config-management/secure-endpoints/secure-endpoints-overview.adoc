== Функціональні можливості

З метою забезпечення безпечного доступу до наступних компонент кластера OpenShift 4.x:

- Платформні;
- Реєстрові;
- Інфраструктурні.
+
NOTE: Більш детально ознайомитись з кожною категорією можна xref:architecture/platform/operational/user-management/ddm-auth.adoc[тут].

Платформа реалізує функціонал блокування доступу до кожного маршруту (route) на рівні HAProxy наступним чином:

==== Реєстрові

. При створенні реєстру Адміністратором, у нього є можливість задати IP-адреси з яких буде дозволений доступ до реєстрових компонентів. Інтерфейс адміністрування платформи додає внесені IP-адреси до файлу `values.yaml` в реєстрову конфігурацію в форматі:
[source, yaml]
global:
  whiteListIP:
    adminRoutes: "192.168.1.64/26 172.16.0.192/27"
    officerPortal: "192.168.1.240/29"
    citizenPortal: "0.0.0.0/0"
+
який, надалі використовується Helm-чартами компонент для розгортання реєстру з анотаціями у відповідних роутах:
[source, yaml]
metadata:
  annotations:
    haproxy.router.openshift.io/ip_whitelist: 192.168.1.64/26 172.16.0.192/27
+
Адміністратор має можливість задавати список IP-адрес окремо для кабінету чиновника, кабінету громадянина та окремо для адміністративних компонентів.
+
[WARNING]
Кожен компонент має містити публічну IP-адресу кластера. Keycloak, у свою чергу, має містити всі CIDR з інших операційних зон або доступний всім, якщо кабінет громадянина не має обмежень.
+
Інтерфейс додавання має наступний вигляд:
+
image::architecture/platform/administrative/config-management/secure-endpoints/creating-reg.png[adding-route-registry-ui,float="center",align="center"]
процес ввведення IP-адреси:
+
image::architecture/platform/administrative/config-management/secure-endpoints/adding.png[]
+
інтерфейс відображення та редагування списку IP-адрес реєстру має наступний вигляд:
+
image::architecture/platform/administrative/config-management/secure-endpoints/reg-info.png[editing-route-registry-ui,float="center",align="center"]

. При редагуванні вже наявного реєстру в адміністратора також є можливість задати або видалити IP-адреси з яких буде дозволений доступ до реєстрових компонентів. Інтерфейс адміністрування платформи оновлює внесені IP-адреси в файлі `values.yaml` в конфігураційному репозиторії реєстру, який надалі використовується Helm-чартом для розгортання реєстру. Інтерфейс додавання має такий самий вигляд як і при створенні реєстру.

==== Платформні, інфраструктурні та інші роути

. У розділі "Керування кластером" в адміністратора є можливість задати CIDR для обмеження зовнішнього доступу для платформних та інфраструктурних компонентів. Інтерфейс адміністрування платформи створює запит на зміну (MR) в файлі `values.yaml` та після затвердження адміністратором `cluster-mgmt` пайплайн виконує оновлення та додавання необхідних анотацій.

. У всі інші роути, які не керуються Helm-чартами, анотації додаються/змінюються за допомогою `annotate-routes` стейджу в `cluster-mgmt` пайплайні. Приклад `values.yaml`:
+
[source, yaml]
global:
  whiteListIP:
    adminRoutes: "192.168.1.64/26 172.16.0.192/27"
+
[WARNING]
CIDR внесені адміністратором для реєстру повинні також бути додані для платформних компонентів автоматично.