:toc-title: ЗМІСТ
:toc: auto
:toclevels: 5
:experimental:
:important-caption:     ВАЖЛИВО
:note-caption:          ПРИМІТКА
:tip-caption:           ПІДКАЗКА
:warning-caption:       ПОПЕРЕДЖЕННЯ
:caution-caption:       УВАГА
:example-caption:           Приклад
:figure-caption:            Зображення
:table-caption:             Таблиця
:appendix-caption:          Додаток
:sectnums:
:sectnumlevels: 5
:sectanchors:
:sectlinks:
:partnums:

= Редагування скриптів бізнес-процесів у візуальному редакторі коду

== Загальний опис

Розробник регламенту реєстру може у вбудованому редакторі діаграм *BPMN.iO* редагувати https://uk.wikipedia.org/wiki/Groovy[*Groovy*]-скрипти через візуальний редактор коду. Для цього імплементовано рішення https://microsoft.github.io/monaco-editor/[Monaco Editor], візуалізоване темою *Visual Studio Dark*.

Рішення є збагаченим вебредактором коду (спрощеною версією середовищ розробки IDE), яке дозволяє набагато ефективніше працювати із Groovy-скриптами у бізнес-процесах. Інструмент підтримує основні функції при роботі з вихідним кодом, дозволяючи створювати та редагувати скрипти в єдиному місці -- скрипт-задачах бізнес-процесів регламенту, не виходячи за межі середовища для використання сторонніх настільних додатків.

Підтримуються наступні функції при роботі з редактором: ::

* [*] Автодоповнення
* [*] Автодоповнення для кастомних функцій
* [*] Синтаксичний аналіз коду та перевірка помилок
* [*] Підтримка коментарів
* [*] Згортання та розгортання блоку з кодом

== Функціональні можливості

=== Загальний процес використання

Використовуйте візуальний редактор коду при створенні та редагуванні скриптів у рамках моделювання бізнес-процесів.

[CAUTION]
====
Редагування складових регламенту реєстру можливе лише в рамках версій-кандидатів на внесення змін. Для майстер-версії доступна лише опція перегляду.

Детальніше про особливості роботи з версіями регламенту дивіться на сторінці
xref:registry-admin/admin-portal/version-control/version-control-overview.adoc[].
====

. У [.underline]#Кабінеті адміністратора регламентів# відкрийте розділ [.underline]#Моделі процесів#.
+
TIP: Портал адміністратора ви можете знайти за посиланням: +
https://admin-tools-<назва-реєстру>.apps.envone.dev.registry.eua.gov.ua/.
+
image:registry-develop:registry-admin/admin-portal/process-models/process-models-1.png[]

. В рамках версії-кандидата оберіть процес і натисніть [.underline]#&#128393; іконку редагування#.
+
image:registry-develop:registry-admin/admin-portal/process-models/process-models-6.png[]

. Перейдіть на вкладку [.underline]#Конструктор# та змоделюйте бізнес-процес у вебредакторі.
+
TIP: Можливості вкладки [.underline]#Конструктор# більш детально описані на сторінці xref:registry-admin/admin-portal/registry-modeling/process-models/components/tab-bpmn-editor.adoc[].
+
image:registry-develop:registry-admin/admin-portal/process-models/process-models-4.png[]

. Створіть скрипт-задачу (*Script Task*).
. Натисніть kbd:[*Open script editor*], щоб відкрити [.underline]#Редактор скриптів#.

. Створіть або відредагуйте скрипт.
+
TIP: Розгорніть вікно редагування, або перегляду скрипту у повноекранному режимі для зручності.

* Натисніть kbd:[Зберегти], щоб зберегти зміни.
* Натисніть kbd:[Закрити], щоб скасувати зміни.
+
image::registry-admin/hierarchical-model/hierarchical-model-bp-2.png[]
+
image::registry-admin/hierarchical-model/hierarchical-model-bp-3.png[]
+
[NOTE]
====
Якщо скрипт міститиме ймовірні помилки, редактор попередить про це через відповідне повідомлення на екрані.

image:registry-admin/admin-portal/process-models/edit-groovy-scripts/edit-groovy-scripts-6.png[]

====

=== Автодоповнення коду та кастомних JUEL-функцій

При роботі зі скриптами у редакторі моделювальник може використовувати [.underline]#автодоповнення коду#, зокрема [.underline]#автодоповнення кастомних JUEL-функцій# з випадного списку. Це дозволить уникати помилок при ручному введенні параметрів.

==== Автодоповнення коду

Вбудовані можливості інтелектуального завершення передбачають тип і потік даних і пропонують параметри, що відповідають контексту. Наприклад, підказки щодо можливих методів, які використовуються у змінних, доповнення функцій тощо.

image:registry-admin/admin-portal/process-models/edit-groovy-scripts/edit-groovy-scripts-1-1.png[]

==== Автодоповнення кастомних JUEL-функцій

Вбудовані можливості інтелектуального завершення передбачають автодоповнення власних JUEL-функцій, які розширюють можливості бізнес-процесів та полегшують моделювання.

[TIP]
====
Використовуйте платформні JUEL-функції для спрощення моделювання бізнес-процесів. Наразі імплементовано такі функції та їх автодоповнення у візуальному редакторі коду:

* *`initiator()`*
* *`completer()`*
* *`system_user()`*
* *`submission()`*
* *`sign_submission()`*
* *`get_variable()`*
* *`set_variable()`*
* *`set_transient_variable()`*
* *`process_caller()`*
* *`message_payload()`*
* *`save_digital_document_from_url()`*
* *`get_trembita_auth_token()`*.

Детальніше про використання JUEL-функцій ви можете переглянути на сторінці xref:bp-modeling/bp/modeling-facilitation/modelling-with-juel-functions.adoc[].
====

image:registry-admin/admin-portal/process-models/edit-groovy-scripts/edit-groovy-scripts-1-2.png[]

image:registry-admin/admin-portal/process-models/edit-groovy-scripts/edit-groovy-scripts-1-3.png[]

=== Синтаксичний аналіз коду та перевірка помилок

Редактор підтримує синтаксиний аналіз коду та пояснення для деталізації помилок.

При наведенні на певні елементи, наприклад, на змінну, що використовується у скрипті, редактор підкаже, до якого пакету та класу вона відновиться.

image:registry-admin/admin-portal/process-models/edit-groovy-scripts/edit-groovy-scripts-1.png[]

==== Критичні помилки

Якщо код містить критичну помилку, допущену моделювальником, редактор підсвітить червоним кольором, де саме у скрипті виявлено помилку, та виведе відповідне пояснення на екран.

image:registry-admin/admin-portal/process-models/edit-groovy-scripts/edit-groovy-scripts-2.png[]

image:registry-admin/admin-portal/process-models/edit-groovy-scripts/edit-groovy-scripts-3.png[]

==== Не критичні помилки

Якщо код містить НЕ критичну помилку, допущену моделювальником, при наведенні курсора редактор підсвітить жовтим кольором, де саме у скрипті виявлено помилку, та виведе відповідне пояснення на екран.

image:registry-admin/admin-portal/process-models/edit-groovy-scripts/edit-groovy-scripts-4.png[]

image:registry-admin/admin-portal/process-models/edit-groovy-scripts/edit-groovy-scripts-5.png[]

=== Коментування коду

Вбудований редактор скриптів дозволяє вносити коментарі до коду. Коментарі надають [.underline]#зрозуміле для розробника пояснення, або анотацію у вихідному коді# скрипту/програми. Вони додаються з метою зробити вихідний код легшим для розуміння людьми, й ігноруються компіляторами та інтерпретаторами. Тобто ви можете таким чином "приховати" від виконання частину програми, або певний рядок тощо.

Використовуйте [.underline]#однорядкові#, або [.underline]#багаторядкові# коментарі.

==== Однорядкові коментарі

Однорядкові коментарі починаються з *`//`* (подвійна коса риска) і можуть використовуватися у будь-якому місці рядка. Символи після *`//`* і до кінця рядка вважаються частиною коментаря.

image:registry-admin/admin-portal/process-models/edit-groovy-scripts/edit-groovy-scripts-7.png[]

==== Багаторядкові коментарі

Багаторядковий коментар починається з +++<b><code>/*</code></b>+++ (_одинарна коса риска та зірочка_) і може бути використаний у будь-якому місці рядка. Символи після +++<b><code>/*</code></b>+++ вважатимуться частиною коментаря, включаючи символи нового рядка, до першого +++<b><code>*/</code></b>+++ (_зірочка та одинарна коса риска_), який закриває коментар. Таким чином, багаторядкові коментарі можна розмістити в кінці, або навіть усередині висловлювання тощо.

image:registry-admin/admin-portal/process-models/edit-groovy-scripts/edit-groovy-scripts-8.png[]


=== Згортання та розгортання блоків коду

Використовуйте функції згортання та розгортання блоків з кодом. Це дозволить зробити ваш код більш читабельним та сховати, або, навпаки, розкрити деталі певного блоку за потреби.

Ви можете організовувати блокову структуру, використовуючи зарезервовані висловлювання, як-то `def`, `for`, `if`, `else` тощо.

Якщо навести курсор навпроти певного висловлювання (відкритого блоку), з'явиться перемикач, який дозволить вам його згорнути.

Перемикачі для розгортання видимі завжди. Просто натисніть на такий, щоб показати деталі у блоці з кодом.

image:registry-admin/admin-portal/process-models/edit-groovy-scripts/edit-groovy-scripts-9.png[]


