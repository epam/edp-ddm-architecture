openapi: 3.0.1
info:
  title: Control plane console
  version: v1
paths:

  /admin/cluster/management:
    get:
      summary: View Cluster Management
      operationId: viewClusterManagement
      responses:
        '200':
          description: Successful response
          content:
            text/html:
              schema:
                type: string
      tags:
        - Cluster

  /admin/cluster/edit:
    get:
      summary: Get Cluster Edit Form
      operationId: editGet
      responses:
        '200':
          description: Successful response
          content:
            text/html:
              schema:
                type: string
      tags:
        - Cluster
    post:
      summary: Edit Cluster Configuration
      operationId: editPost
      responses:
        '302':
          description: Successful response
      tags:
        - Cluster

  /admin/cluster/admins:
    post:
      summary: Update Cluster Admins
      operationId: updateAdminsView
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                admins:
                  type: array
                  items:
                    $ref: '#/components/schemas/Admin'
      responses:
        '302':
          description: Successful response

      tags:
        - Cluster

  /admin/cluster/key:
    post:
      summary: Update Key
      operationId: updateKeyView
      responses:
        '302':
          description: Redirect response
          headers:
            Location:
              description: The URL to redirect to
              schema:
                type: string
      tags:
        - Cluster

  /admin/cluster/upgrade:
    post:
      summary: Upgrade Cluster
      operationId: clusterUpdate
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRequest'
        required: true
      responses:
        '302':
          description: Successful response
      tags:
        - Cluster

  /admin/cluster/cidr:
    post:
      summary: Update Cluster CIDR
      operationId: updateCIDRView
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CIDRUpdateRequest'
        required: true
      responses:
        '302':
          description: Successful response
      tags:
        - Cluster

  /admin/cluster/backup-schedule:
    post:
      summary: Update Backup Schedule
      operationId: backupSchedule
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BackupScheduleForm'
        required: true
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BackupScheduleResponse'
      tags:
        - Cluster

  /admin/cluster/upload-pem-dns:
    post:
      summary: Upload PEM and Verify DNS
      operationId: uploadPEMDNS
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                hostname:
                  type: string
        required: true
      responses:
        '302':
          description: Redirect response
      tags:
        - Cluster

  /admin/cluster/add-keycloak-dns:
    post:
      summary: Add Keycloak DNS
      operationId: keycloakDNS
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/KeycloakDNSRequest'
        required: true
      responses:
        '302':
          description: Redirect response
      tags:
        - Cluster

  /admin/cluster/check-keycloak-hostname-used/{hostname}:
    get:
      summary: Check if Keycloak Hostname is Used
      operationId: checkKeycloakHostnameUsed
      parameters:
        - in: path
          name: hostname
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response
        '422':
          description: Hostname is already used
      tags:
        - Cluster

  /admin/registry/create:
    get:
      summary: Render HTML for creating a registry
      operationId: renderRegistryCreatePage
      tags:
        - Registry
      responses:
        '200':
          description: Successful response
          content:
            text/html:
              schema:
                type: string
    post:
      tags:
        - Registry
      summary: Create a new registry
      operationId: createRegistryPost
      requestBody:
        description: Registry data
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                scenario:
                  type: string
                  description: Scenario for registry creation
      responses:
        '302':
          description: Created - Redirect to registry overview page
        '400':
          description: Bad Request - Invalid input data
        '403':
          description: Forbidden - Access denied
        '500':
          description: Internal Server Error - Something went wrong on the server

  /admin/registry/edit/{name}:
    get:
      tags:
        - Registry
      summary: Get registry data for editing
      operationId: editRegistryGet
      parameters:
        - name: name
          in: path
          description: Name of the registry to be edited
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successful response with HTML page for editing registry data
          content:
            text/html:
              schema:
                type: string
        '404':
          description: Not Found - Registry with the specified name not found
        '500':
          description: Internal Server Error - Something went wrong on the server
    post:
      tags:
        - Registry
      summary: Edit registry data
      operationId: editRegistryPost
      parameters:
        - name: name
          in: path
          description: Name of the registry to be edited
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegistryEditInput'
      responses:
        '302':
          description: Found - Successful response with redirect URL after editing registry data
          headers:
            Location:
              description: URL to the view page of the edited registry
              schema:
                type: string
        '400':
          description: Bad Request - Invalid input data
        '404':
          description: Not Found - Registry with the specified name not found

  /admin/registry/overview:
    get:
      tags:
        - Registry
      summary: List all registries
      operationId: listRegistry
      responses:
        '200':
          description: OK - Successful HTML response with a list of registries
          content:
            text/html:
              schema:
                type: string
    post:
      tags:
        - Registry
      summary: Delete a registry
      operationId: deleteRegistry
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                registry-name:
                  type: string
      responses:
        '200':
          description: OK - Registry deleted successfully

  /admin/registry/check-pem:
    post:
      tags:
        - Registry
      summary: Validate PEM file
      operationId: validatePEMFile
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: OK - PEM file is valid
        '422':
          description: Unprocessable Entity - Invalid PEM file
        '500':
          description: Internal Server Error - Failed to process PEM file

  /admin/registry/check/{name}:
    get:
      tags:
        - Registry
      summary: Check if registry name is available
      operationId: registryNameAvailable
      parameters:
        - in: path
          name: name
          required: true
          schema:
            type: string
          description: Name of the registry to check
      responses:
        '200':
          description: OK - Registry name is available
          content:
            text/html:
              schema:
                type: string

  /admin/registry/view/{name}:
    get:
      tags:
        - Registry
      summary: View details of a registry
      operationId: viewRegistry
      parameters:
        - in: path
          name: name
          required: true
          schema:
            type: string
          description: Name of the registry to view
      responses:
        '200':
          description: OK - Successfully retrieved registry details

  /admin/registry/update/{name}:
    post:
      tags:
        - Registry
      summary: Update a registry
      parameters:
        - in: path
          name: name
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Successful response
    get:
      tags:
        - Registry
      summary: Get the update view for a registry
      parameters:
        - in: path
          name: name
          required: true
          schema:
            type: string
      responses:
        '200':
          content:
            text/html:
              schema:
                type: string
          description: Successful response

  /admin/registry/trembita-client/{name}:
    post:
      tags:
        - Registry
      summary: Set Trembita client registry data
      parameters:
        - in: path
          name: name
          required: true
          description: Registry name
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TrembitaClientRegistryForm'
      responses:
        '200':
          description: Successful response

  /admin/registry/trembita-client-create/{name}:
    post:
      tags:
        - Registry
      summary: Create Trembita client registry data
      parameters:
        - in: path
          name: name
          required: true
          description: Registry name
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TrembitaClientRegistryForm'
      responses:
        '200':
          description: Successful response

  /admin/registry/trembita-client-check/{name}:
    get:
      tags:
        - Registry
      summary: Check if a Trembita client exists for a registry
      parameters:
        - name: name
          in: path
          required: true
          description: Registry name
          schema:
            type: string
        - name: trembita-client
          in: query
          required: true
          description: Trembita client name
          schema:
            type: string
      responses:
        '200':
          description: Trembita client exists
        '404':
          description: Trembita client does not exist

  /admin/registry/trembita-client-delete/{name}:
    get:
      tags:
        - Registry
      summary: Delete a Trembita client for a registry
      parameters:
        - name: name
          in: path
          required: true
          description: Registry name
          schema:
            type: string
        - name: trembita-client
          in: query
          required: true
          description: Trembita client name
          schema:
            type: string
      responses:
        '200':
          description: Trembita client deleted successfully

  /admin/registry/external-system/{name}:
    post:
      tags:
        - Registry
      summary: Set external system registry data
      parameters:
        - name: name
          in: path
          required: true
          description: Registry name
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/RegistryExternalSystemForm'
      responses:
        '302':
          description: Data set successfully - Redirect to registry overview page

  /admin/registry/external-system-check/{name}:
    get:
      tags:
        - Registry
      summary: Check if external system exists
      parameters:
        - name: name
          in: path
          required: true
          description: Registry name
          schema:
            type: string
        - name: external-system
          in: query
          required: true
          description: External system name
          schema:
            type: string
      responses:
        '200':
          description: External system exists
        '404':
          description: External system not found

  /admin/registry/external-system-create/{name}:
    post:
      tags:
        - Registry
      summary: Create external system
      parameters:
        - name: name
          in: path
          required: true
          description: Registry name
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/RegistryExternalSystemForm'
      responses:
        '302':
          description: Created - Redirect to registry overview page

  /admin/registry/external-system-delete/{name}:
    get:
      summary: Delete external system
      tags:
        - Registry
      parameters:
        - name: name
          in: path
          required: true
          description: Registry name
          schema:
            type: string
        - name: external-system
          in: query
          required: true
          description: External system name
          schema:
            type: string
      responses:
        '302':
          description: Deleted - Redirect to registry overview page

  /admin/registry/external-reg-add/{name}:
    post:
      summary: Add external registration
      tags:
        - Registry
      parameters:
        - name: name
          in: path
          required: true
          description: Registry name
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExternalRegistration'
      responses:
        '302':
          description: Redirect to the registry view page

  /admin/registry/external-reg-remove/{name}:
    post:
      summary: Remove external registration
      tags:
        - Registry
      parameters:
        - name: name
          in: path
          required: true
          description: Registry name
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                reg-name:
                  type: string
      responses:
        '302':
          description: Redirect to the registry view page

  /admin/registry/external-reg-disable/{name}:
    post:
      summary: Disable external registration
      tags:
        - Registry
      parameters:
        - name: name
          in: path
          required: true
          description: Registry name
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                reg-name:
                  type: string
      responses:
        '302':
          description: Redirect to the registry view page

  /admin/change/{change}:
    get:
      summary: View change details
      tags:
        - Registry
      parameters:
        - name: change
          in: path
          required: true
          description: Change ID
          schema:
            type: string
      responses:
        '200':
          description: Success response
          content:
            text/html:
              schema:
                type: string

  /admin/submit-change/{change}:
    get:
      summary: Submit a change
      tags:
        - Registry
      parameters:
        - name: change
          in: path
          required: true
          description: Change ID
          schema:
            type: string
      responses:
        '200':
          description: Success response
          content:
            text/html:
              schema:
                type: string

  /admin/abandon-change/{change}:
    get:
      summary: Abandon a change
      tags:
        - Registry
      parameters:
        - name: change
          in: path
          required: true
          description: Change ID
          schema:
            type: string
      responses:
        '200':
          description: Success response
          content:
            text/html:
              schema:
                type: string

  /admin/registry/preload-values:
    get:
      summary: Preload template values
      tags:
        - Registry
      parameters:
        - name: template
          in: query
          required: true
          description: Template name
          schema:
            type: string
        - name: branch
          in: query
          required: true
          description: Branch name
          schema:
            type: string
      responses:
        '200':
          description: Success response
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: object

  /admin/registry/get-basic-username/{name}:
    get:
      summary: Get basic username from external system
      tags:
        - Registry
      parameters:
        - name: name
          in: path
          required: true
          description: Registry name
          schema:
            type: string
        - name: registry-name
          in: query
          required: true
          description: System registry name
          schema:
            type: string
      responses:
        '200':
          description: Success response
          content:
            application/json:
              schema:
                type: string

  /admin/registry/public-api-add/{name}:
    post:
      summary: Add a public API registration to a registry
      tags:
        - Registry
      parameters:
        - name: name
          in: path
          required: true
          description: Registry name
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                reg-name:
                  type: string
                reg-url:
                  type: string
                reg-limits:
                  type: object
                  additionalProperties:
                    type: number
      responses:
        '302':
          description: Redirect response to registry overview

  /admin/registry/public-api-edit/{name}:
    post:
      summary: Edit a public API registration in a registry
      tags:
        - Registry
      parameters:
        - name: name
          in: path
          required: true
          description: Registry name
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                reg-name:
                  type: string
                reg-url:
                  type: string
                reg-limits:
                  type: object
                  additionalProperties:
                    type: number
      responses:
        '302':
          description: Redirect response to registry overview

  /admin/registry/public-api-delete/{name}:
    post:
      summary: Remove a public API registration from a registry
      tags:
        - Registry
      parameters:
        - name: name
          in: path
          required: true
          description: Registry name
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                reg-name:
                  type: string
      responses:
        '302':
          description: Redirect response to registry overview

  /admin/registry/public-api-disable/{name}:
    post:
      summary: Disable or enable a public API registration in a registry
      tags:
        - Registry
      parameters:
        - name: name
          in: path
          required: true
          description: Registry name
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                reg-name:
                  type: string
      responses:
        '302':
          description: Redirect response to registry overview

  /admin/dashboard:
    get:
      summary: Fetch the dashboard page
      tags:
        - Dashboard
      responses:
        '200':
          description: Successful response
          content:
            text/html:
              schema:
                type: string

  /:
    get:
      summary: Fetch the main dashboard page
      tags:
        - Dashboard
      responses:
        '200':
          description: Successful response
          content:
            text/html:
              schema:
                type: string

  /auth/callback:
    get:
      summary: Authentication callback
      tags:
        - Dashboard
      parameters:
        - name: code
          in: query
          required: true
          description: Authorization code received from the authentication provider
          schema:
            type: string
      responses:
        '302':
          description: Redirect response to registries list

  /admin/logout:
    get:
      summary: Logout
      tags:
        - Dashboard
      responses:
        '302':
          description: Redirect response

components:
  schemas:
    Admin:
      type: object
      properties:
        username:
          type: string
        email:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        tmpPassword:
          type: string
      required:
        - username

    UpdateRequest:
      type: object
      properties:
        branch:
          type: string
          example: main
          description: The branch to upgrade to
          minLength: 1
          maxLength: 100
          pattern: '^[a-zA-Z0-9_\-]+$'
      required:
        - branch

    CIDRUpdateRequest:
      type: object
      properties:
        admin-cidr:
          type: string
          example: ["10.0.0.0/24", "192.168.0.0/16"]
          description: List of CIDR blocks for admin routes
          items:
            type: string
            minLength: 9
            maxLength: 18
          minItems: 1
          maxItems: 10
      required:
        - admin-cidr

    BackupScheduleForm:
      type: object
      properties:
        nexus-schedule:
          type: string
          description: Nexus backup schedule (cron expression)
        nexus-expires-in-days:
          type: string
          description: Nexus backup schedule expiration in days
        control-plane-schedule:
          type: string
          description: Control plane backup schedule (cron expression)
        control-plane-expires-in-days:
          type: string
          description: Control plane backup schedule expiration in days
        user-management-schedule:
          type: string
          description: User management backup schedule (cron expression)
        user-management-expires-in-days:
          type: string
          description: User management backup schedule expiration in days
        monitoring-schedule:
          type: string
          description: Monitoring backup schedule (cron expression)
        monitoring-expires-in-days:
          type: string
          description: Monitoring backup schedule expiration in days
      required:
        - nexus-schedule
        - nexus-expires-in-days
        - control-plane-schedule
        - control-plane-expires-in-days
        - user-management-schedule
        - user-management-expires-in-days
        - monitoring-schedule
        - monitoring-expires-in-days

    BackupScheduleResponse:
      type: object
      properties:
        errors:
          type: object
          description: Validation errors map
          additionalProperties:
            type: array
            items:
              type: string

    CustomHost:
      type: object
      properties:
        hostname:
          type: string
        cert:
          type: string

    KeycloakDNSRequest:
      type: object
      properties:
        hostnames:
          type: array
          items:
            $ref: '#/components/schemas/CustomHost'

    RegistryEditInput:
      type: object
      properties:
        action:
          type: string
        description:
          type: string
        admins:
          type: array
          items:
            type: object
            properties:
              username:
                type: string
              email:
                type: string
              firstName:
                type: string
              lastName:
                type: string
              passwordVaultSecret:
                type: string
              passwordVaultSecretKey:
                type: string
        'smtp-server-type':
          type: string
        'mail-server-opts':
          type: string
        key-device-type:
          type: string
        key6:
          type: string
        sign-key-issuer:
          type: string
        sign-key-pwd:
          type: string
        allowed-keys-issuer:
          type: array
          items:
            type: string
        allowed-keys-serial:
          type: array
          items:
            type: string
        ca-cert:
          type: string
        ca-json:
          type: string
        resources:
          type: object
        kafkaApi:
          type: integer
        restApi:
          type: integer
        crunchy-postgres-max-connections:
          type: integer
        crunchy-postgres-storage-size:
          type: string
        keycloak-custom-hostname:
          type: string
        officer-dns:
          type: string
        officer-ssl:
          type: string
        citizen-dns:
          type: string
        citizen-ssl:
          type: string
        officer-cidr:
          type: array
          items:
            type: string
        citizen-cidr:
          type: array
          items:
            type: string
        admin-cidr:
          type: array
          items:
            type: string
        sup-auth-browser-flow:
          type: string
        sup-auth-url:
          type: string
        sup-auth-widget-height:
          type: integer
        registry-citizen-auth:
          type: object
        edr-check-enabled:
          type: string
        rec-auth-browser-flow:
          type: string
        rec-auth-url:
          type: string
        rec-auth-widget-height:
          type: integer
        rec-sign-widget-url:
          type: string
        rec-sign-widget-height:
          type: integer
        digital-documents:
          type: object
          properties:
            maxFileSize:
              type: string
            maxTotalFileSize:
              type: string
        maxFileSize:
          type: integer
        maxTotalFileSize:
          type: integer
        cron-schedule:
          type: string
        cron-schedule-days:
          type: integer
        registry-backup-obc-cron-expression:
          type: string

    TrembitaClientRegistryForm:
      type: object
      properties:
        trembita-client-protocol-version:
          type: string
          description: Trembita client protocol version
        trembita-client-url:
          type: string
          description: Trembita client URL
        trembita-client-user-id:
          type: string
          description: Trembita client user ID
        trembita-client-x-road-instance:
          type: string
          description: Trembita client X-Road instance
        trembita-client-member-class:
          type: string
          description: Trembita client member class
        trembita-client-member-code:
          type: string
          description: Trembita client member code
        trembita-client-subsystem-code:
          type: string
          description: Trembita client subsystem code
        trembita-client-regitry-name:
          type: string
          description: Trembita client registry name
        trembita-client-protocol:
          type: string
          description: Trembita client protocol
        trembita-service-x-road-instance:
          type: string
          description: Trembita service X-Road instance
        trembita-service-member-class:
          type: string
          description: Trembita service member class
        trembita-service-member-code:
          type: string
          description: Trembita service member code
        trembita-service-subsystem-code:
          type: string
          description: Trembita service subsystem code
        trembita-service-service-code:
          type: string
          description: Trembita service service code
        trembita-service-service-version:
          type: string
          description: Trembita service service version
        trembita-service-auth-type:
          type: string
          description: Trembita service auth type
        trembita-service-auth-secret:
          type: string
          description: Trembita service auth secret

    RegistryExternalSystemForm:
      type: object
      properties:
        external-system-registry-name:
          type: string
        external-system-url:
          type: string
        external-system-protocol:
          type: string
        external-system-auth-type:
          type: string
        external-system-auth-url:
          type: string
        external-system-auth-access-token-json-path:
          type: string
        external-system-auth-secret:
          type: string
        external-system-auth-username:
          type: string

    ExternalRegistration:
      type: object
      properties:
        reg-name:
          type: string
        external-system-type:
          type: boolean